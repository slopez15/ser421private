var StaticImage=function(){function n(n,t,i,r,u,f,e,o){var l=this,s,h,c;this._cardPadding=0;n&&t&&(this._staticImageUrl=t.replace(/amp;/g,""),this._width=n.offsetWidth,this._height=n.offsetHeight,this._parentDiv=n,this._testHooks=r,s=typeof Microsoft!="undefined"&&Microsoft&&Microsoft.Maps&&Microsoft.Maps.Internal,r&&typeof s!="undefined"&&s._Helper?(h=s._Helper._getUrlParam(window.location,"mockV8Map"),h?(this._excelsior=s._Helper._getUrlParam(window.location,"setApplicationEndpoint"),this._excelsior||(this._excelsior="localhost"),this._selector='img[data-src-original*="'+this._excelsior+'"]'):this._selector='img[data-src-original*="'+i+'"]'):this._selector='img[src*="'+i+'"]',this._staticImage=this._parentDiv.querySelector(this._selector),!this._staticImage&&this._staticImageUrl&&(this._selector='img[src*="'+this._staticImageUrl+'"]',this._staticImage=this._parentDiv.querySelector(this._selector)),this._staticImage?this._initialize(u,o,!0):sj_evt.bind("RMS.ImgAOLCompleted",function(){return l._initialize(u,o,!1)}));f&&(c=new BootstrapStreetsideOverlay,c.initialize(r,e))}return n.prototype.removeImage=function(){if(this._testHooks){var n=document.getElementById("staticImageTesthook");n&&n.setAttribute("data-removeSuccess","StaticImageRemoved")}this._staticImageContainer&&this._parentDiv&&(this._staticImageContainer.parentElement===this._parentDiv?this._parentDiv.removeChild(this._staticImageContainer):this._staticImageContainer.parentElement&&this._staticImageContainer.parentElement.removeChild(this._staticImageContainer));this._staticImageContainer=null},n.replaceOrAppendMapModeParams=function(t,i,r,u){var h=i?"h":"r",f=n._replaceOrAppendParam(t,n._styleParam,h),c=r?"1":"",e,o,s;return f=n._replaceOrAppendParam(f,n._trafficParam,c),u&&(e=u.centerPoint.latitude+"~"+u.centerPoint.longitude,f=n._replaceOrAppendParam(f,n._centerPointParam,e),o=u.zoomLevel.toString(),f=n._replaceOrAppendParam(f,n._ZoomLevelParam,o),s=u.nwLocation.latitude+"~"+u.nwLocation.longitude+"~"+u.seLocation.latitude+"~"+u.seLocation.longitude,f=n._replaceOrAppendParam(f,n._MapViewParam,s,!0)),f},n.getUpdatedUrl=function(t,i,r){var u;if(i<n._minWidth?i=n._minWidth:i>n._maxWidth&&(i=n._maxWidth),r<n._minHeight?r=n._minHeight:r>n._maxHeight&&(r=n._maxHeight),u=t.indexOf("?ms=")+4,u!==3){var e=t.substring(0,u),f=t.substring(u,t.length),o=f.substring(f.indexOf("&"),f.length),s=i.toString(),h=r.toString();return e+s+","+h+o}},n.getCaptionSectionWidth=function(){var t=0;return t=n._getViewPortWidth(),t<n._minWidth?n._minWidth:t>n._maxWidth?n._maxWidth:t},n.getCaptionSectionHeight=function(){var t=0;return t=n._getViewPortHeight(),t<n._minHeight?n._minHeight:t>n._maxHeight?n._maxHeight:t},n.prototype._initialize=function(t,i,r){var u=this,f,e;r||(this._staticImage=this._parentDiv.querySelector("#mv_baseMap"));this._staticImageContainer=this._staticImage.parentElement!==this._parentDiv?this._staticImage.parentElement:this._staticImage;t&&t.imageInfoArr&&t.imageInfoArr.length>1?(this._imageInfoArr=t.imageInfoArr,f=this._parentDiv.querySelector("."+t.aerialButtonClassName),f&&(this._aerialButton=f,n._removeOrAddCssClass(this._aerialButton,"b_hide"),sj_be(this._aerialButton,"click",function(){return u._toggleAerialAndTraffic(!1)}),sj_be(this._aerialButton,"keydown",function(n){return u._processKeyboardEvent(n,!1)})),f=this._parentDiv.querySelector("."+t.trafficButtonClassName),f&&(this._trafficButton=f,n._removeOrAddCssClass(this._trafficButton,"b_hide"),sj_be(this._trafficButton,"click",function(){return u._toggleAerialAndTraffic(!0)}),sj_be(this._trafficButton,"keydown",function(n){return u._processKeyboardEvent(n,!0)})),t.resizeImage&&(this._cardPadding=parseInt(t.cardPadding),r?this._resizeImage():sj_evt.bind("onP1",function(){return u._resizeImage()}),sj_be(window,"resize",function(){return u._resizeImage()})),t.titleElemId&&(e=_ge(t.titleElemId),e&&(this._titleElement=e.querySelector("a"))),this._parentDiv.style.cssText=""):this._staticImageContainer&&i&&(this._staticImageContainer.style.cssText="position:absolute;overflow:hidden;z-index:10000;width:"+this._width+"px;height:"+this._height+"px")},n.prototype._resizeImage=function(){var t=n.getCaptionSectionWidth()-this._cardPadding,r=t.toString(),i=this._testHooks&&this._excelsior?this._staticImageUrl:n.getUpdatedUrl(this._staticImageUrl,t*2,this._height*2);this._staticImageUrl=i;this._staticImage.setAttribute("width",r);this._staticImage.setAttribute("src",i);this._updateMapImageUrls(t*2)},n.prototype._processKeyboardEvent=function(n,t){var i=n.which;(i===13||i===32)&&this._toggleAerialAndTraffic(t)},n.prototype._toggleAerialAndTraffic=function(t){var i=t?this._trafficButton:this._aerialButton,r;n._removeOrAddCssClass(i,"selected");r=this._getImageIndex(t);this._updateImageAndTitle(r);t||(n._removeOrAddCssClass(this._aerialButton,"mv_dark"),this._trafficButton&&n._removeOrAddCssClass(this._trafficButton,"mv_dark"));Log!==undefined&&Log.Log(t?"TrafficIcon":"AerialIcon",i.className,"MapsAnswer",!1);this._aerialEnabled=this._aerialButton.className.indexOf("mv_dark")>0;this._trafficEnabled=this._trafficButton.className.indexOf("selected")>0},n.prototype._getImageIndex=function(n){for(var i,t=0;t<this._imageInfoArr.length;t++)if(this._staticImageUrl===this._imageInfoArr[t].url){i=n?(t+2)%this._imageInfoArr.length:t%2==0?t+1:t-1;break}return i},n.prototype._updateImageAndTitle=function(t){t>=this._imageInfoArr.length||t<0||(this._staticImageUrl=this._imageInfoArr[t].url,this._staticImage.setAttribute("src",this._staticImageUrl),this._staticImageContainer.setAttribute("href",this._imageInfoArr[t].linkUrl),this._titleElement&&(this._titleElement.href=n.replaceOrAppendMapModeParams(this._titleElement.href,this._aerialButton.className.indexOf("selected")>0,this._trafficButton&&this._trafficButton.className.indexOf("selected")>0)))},n.prototype._updateMapImageUrls=function(t){if(this._imageInfoArr)for(var i=0;i<this._imageInfoArr.length;i++)this._imageInfoArr[i].url=n.getUpdatedUrl(this._imageInfoArr[i].url,t,this._height*2)},n._getViewPortWidth=function(){return typeof innerWidth!="undefined"?window.innerWidth:typeof _d.documentElement!="undefined"&&typeof _d.documentElement.clientWidth!="undefined"&&_d.documentElement.clientWidth!==0?document.documentElement.clientWidth:document.getElementsByTagName("body")[0].clientWidth},n._getViewPortHeight=function(){return typeof innerHeight!="undefined"?window.innerHeight:typeof _d.documentElement!="undefined"&&typeof _d.documentElement.clientHeight!="undefined"&&_d.documentElement.clientHeight!==0?document.documentElement.clientHeight:document.getElementsByTagName("body")[0].clientHeight},n._removeOrAddCssClass=function(n,t){t=" "+t;var i=n.className;i=i.indexOf(t)===-1?i.concat(t):i.replace(t,"");n.className=i},n._replaceOrAppendParam=function(t,i,r,u){var e=i+r,o=i.replace("&","?"),f=t;return t.indexOf(i)>0?f=n._replace(t,i,e):t.indexOf(o)>0?f=n._replace(t,o,e.replace("&","?")):u||(f+=e),f},n._replace=function(n,t,i){var u=n,f=n.indexOf(t),r,e;return f>=0?(r=n.indexOf("&",f+1),r==-1&&(r=n.length),e=u.substring(f,r),u.replace(e,i)):u},n._styleParam="&style=",n._trafficParam="&trfc=",n._centerPointParam="&cp=",n._ZoomLevelParam="&lvl=",n._MapViewParam="&mb=",n._minWidth=50,n._maxWidth=1182,n._minHeight=50,n._maxHeight=1440,n}(),BootstrapMapsAnswer=function(){function n(t,i){this.childrenBoundariesLayerId="childrenBoundariesLayer";this._mapOptions=t;this._bootstrapv7=i;this._bootstrappingTimeout=this._mapOptions&&this._mapOptions.testHooks?3e4:(this._mapOptions&&this._mapOptions.childrenBoundaryNames?2:1)*n._defaultTimeoutForBootstrapping;this._bootstrapv7&&(this.pinclick=new Microsoft.Maps.Internal._JSEvent,this.pinhover=new Microsoft.Maps.Internal._JSEvent,this.pinhoverend=new Microsoft.Maps.Internal._JSEvent);this._impressionGuids={};this._navigateToMapsVertical=!0}return n.prototype.bootstrap=function(n,t,i,r){var e=this,u=this._mapOptions,f=this._mapOptions.testHooks,o,s,h,c;this._titleElementId=n;var l=this._mapOptions.staticImageHostName,a=document.getElementById(this._mapOptions.id),v=f?FunctionalTestHooks.buildStaticImageUrl(this._getUrlParam,"DefaultStatic"):this._mapOptions.staticImageUrl;this._staticImage=new StaticImage(a,v,l,f,null,!1,null,!0);t&&(o=new BootstrapStreetsideOverlay,o.initialize(f,r));f&&(s=window.location.search.indexOf("&disableFunctionalTestHooks")>0?!1:!0,u.testHooksOptions={hitTest:!1,perfRun:!1,perfTest:!1,debugRun:!1,enableFunctionalTestHooks:s});u.navigationBarMode=2;u.navigationBarOrientation=1;this._mapOptions.centerLatitude&&this._mapOptions.centerLongitude&&(u.center=new Microsoft.Maps.Location(parseFloat(this._mapOptions.centerLatitude),parseFloat(this._mapOptions.centerLongitude)));u.showScalebar=typeof u.showScalebar=="boolean"?u.showScalebar:!1;u.showTermsLink=!1;u.allTileFeatures=!0;this._map=new Microsoft.Maps.Map(document.getElementById(this._mapOptions.id),this._mapOptions);this._impressionGuids.mapIG=Microsoft.Maps.GlobalConfig.dynamicProperties.impressionGuid;Microsoft.Maps.GlobalConfig.dynamicProperties.serpIG=this._impressionGuids.serpIG=_G&&_G.IG;Microsoft.Maps.GlobalConfig.dynamicProperties.impressionGuid=_G.IG;t&&i&&(h=new BootstrapBirdsEyeV2Overlay,h.initialize(this._map,f,r));this._bootstrapTimeoutHandle=window.setTimeout(function(){e._finishBootstrapping()},this._bootstrappingTimeout);c=this._map.getMapLoadedEvent();c.isPreviouslyInvoked?this._onMapLoaded():this._map.getMapLoadedEvent().addOne(function(){return e._onMapLoaded()})},n.prototype._onMapLoaded=function(){function n(){i--;i===0&&t._setNewFrame(function(){t._finishBootstrapping();t._instrumentServiceScenario()})}var t=this,i=this._mapOptions.childrenBoundaryNames||this._mapOptions.vectorDataPipelineId||this._mapOptions.polygonPoints?2:1;this._bootstrapCommonMapScenarios(function(){n()});this._mapOptions.childrenBoundaryNames?this._bootstrapChildrenBoundariesScenario(function(){n()}):this._mapOptions.vectorDataPipelineId?this._bootstrapBoundaryScenario(function(){n()}):this._mapOptions.polygonPoints&&this._bootstrapAreaPolygonScenario(function(){n()});this._mapOptions.pushpins&&this._bootstrapLocalEntitiesScenario()},n.prototype._instrumentServiceScenario=function(){var i,n,t,r,u;Microsoft&&Microsoft.Maps&&Microsoft.Maps.logger&&Microsoft.Maps.logger.logObject&&(Microsoft.Maps.logger.logObject({feature:"MapControl",action:"MapsLoaded",data:{scenario:this._mapOptions.scenario,service:this._mapOptions.service}}),i=Microsoft.Maps.Internal,i&&(n=i._PerfV2Logger,t=i._Helper,n&&typeof perf!="undefined"&&t&&(r=this._mapOptions.searchQueryCategory,u=t._isHotelsCategory(r)?n.controlSerpHotelsTTGLogKey:t._isRestaurantCategory(r)?n.controlSerpRestaurantsTTGLogKey:t._isHouseCategory(r)?n.controlSerpRealEstateTTGLogKey:typeof BootstrapMapsAnswerForTravelOverlay!="undefined"&&this instanceof BootstrapMapsAnswerForTravelOverlay?n.controlSerpTravelTTGLogKey:"",u&&perf.mark(u))))},n.prototype._bootstrapLocalEntitiesScenario=function(){var f=this,i=this._mapOptions.pushpins,o,s,r,t,h,e,n,u;if(i&&i.length>0)for(o={"151":{state:4,colorIndex:1},"163":{state:2,colorIndex:1},"164":{state:2,colorIndex:2},"165":{state:2,colorIndex:3},"166":{state:5,colorIndex:1},"167":{state:5,colorIndex:2},"168":{state:5,colorIndex:3},"169":{state:4,colorIndex:1},"170":{state:4,colorIndex:2},"171":{state:4,colorIndex:3},"176":{state:4,colorIndex:1},"180":{state:2,colorIndex:1},S593:{state:2,colorIndex:1},S575:{state:2,colorIndex:1},S541:{state:2,colorIndex:1},S589:{state:2,colorIndex:1}},s=[],r=0;r<i.length;r++)t=i[r],t.Location&&t.Location.Latitude&&t.Location.Longitude&&(h=parseInt(t.IconStyle)===118?{title:t.Label,icon:"/s/local/map/118.png"}:{title:t.Label,isMicroPoi:t.IsMicroPoi},e=new Microsoft.Maps.Location(t.Location.Latitude,t.Location.Longitude),n=new Microsoft.Maps.Pushpin(e,h),n.id=t.Id,n.catId=t.CatId,s.push(e),u=o[t.IconStyle],u?(n.taskDisplayState={activationState:1,colorIndex:u.colorIndex,prominence:1},n.setState(u.state),this._map.entities.push(n)):parseInt(t.IconStyle)===118?this._map.entities.push(n):this._mapOptions.categoryId&&(n.catId=this._mapOptions.categoryId,this._map.entities.push(n)),this._bootstrapv7&&(Microsoft.Maps.Events.addHandler(n,"mouseover",function(){f.pinhover.invoke({pin:n})}),Microsoft.Maps.Events.addHandler(n,"mouseout",function(){f.pinhoverend.invoke({pin:n})}),Microsoft.Maps.Events.addHandler(n,"click",function(){f.pinclick.invoke({pin:n})})))},n.prototype._bootstrapCommonMapScenarios=function(n){var t=this;this._mapOptions.showTraffic?Microsoft.Maps.loadModule("Microsoft.Maps.Traffic",function(){t._trafficManager=new Microsoft.Maps.Traffic.TrafficManager(t._map);t._trafficManager.show();n&&n()}):n&&n()},n.prototype._bootstrapChildrenBoundariesScenario=function(n){this._bindChildrenEntitiesCarouselEvents();this._loadChildrenEntitiesBoundaries(n)},n.prototype._bootstrapBoundaryScenario=function(n){var t=this,i=3,r=11;this._map.getV8Map().getCityPolygonManager().then(function(u){t._cityPolygonManager=u;u.removeLayer();u.addLayer(t._mapOptions.vectorDataPipelineId,i,r);n&&n()})},n.prototype._bootstrapAreaPolygonScenario=function(n){for(var i,u,r=[],t=0;t<this._mapOptions.polygonPoints.length;t++)r.push(new Microsoft.Maps.Location(this._mapOptions.polygonPoints[t].latitude,this._mapOptions.polygonPoints[t].longitude));i=JSON.parse(this._mapOptions.polygonConfig);r.length>1&&(u=new Microsoft.Maps.Polygon(r,{fillColor:i.FillColor,strokeColor:i.PenColor,strokeThickness:Number(i.PenWidth)}),this._map.entities.push(u));n&&n()},n.prototype._finishBootstrapping=function(){window.clearTimeout(this._bootstrapTimeoutHandle);this._hasCalledFinishBootstrapping||(this._hasCalledFinishBootstrapping=!0,this.completeBootstrapping())},n.prototype.completeBootstrapping=function(){var t=this,n;this._mapOptions.sdkMapUnwrapNotificationEvent?sj_evt.bind(this._mapOptions.sdkMapUnwrapNotificationEvent,function(){t._removeStaticImageAndShowLargeMapLink()},1,1):this._mapOptions.switchToDynamicView&&this._removeStaticImageAndShowLargeMapLink();this._bootstrapv7&&this._createDataForV7MapInterfaceBootstrap();sj_evt.fire("v8MapRenderEnd");sj_evt.fire("v8MapDataRenderStart");sj_evt.fire("dynMapLoaded",this._map,this);this.fireMapDataRenderEnd();this._mapOptions.testHooks&&(n=this._map.getV8Map().getRootElement()[0],n&&n.parentElement&&n.parentElement.setAttribute("data-mapLoaded","true"))},n.prototype.fireMapDataRenderEnd=function(){sj_evt.fire("v8MapDataRenderEnd")},n.prototype._createDataForV7MapInterfaceBootstrap=function(){var n=window.Bing=window.Bing||{};n.MapControl=n.MapControl||{};n.MapControl[this._mapOptions.id]=this;n.MapControl.MapCtrl=this;this.Map=this._map;Microsoft.Maps.EntityState={highlighted:2,none:0,selected:1}},n.prototype.ensureDynamic=function(n){n&&n()},n.prototype._loadChildrenEntitiesBoundaries=function(n){var t=this;if(this._childrenBoundariesLayer){this._childrenBoundariesLayer.setVisible(!0);n&&n();return}this._map.getV8Map().getCityPolygonManager().then(function(){t._childrenBoundariesLayer=new Microsoft.Maps.Layer(t.childrenBoundariesLayerId);t._map.layers.insert(t._childrenBoundariesLayer);Microsoft.Maps.Internal.CityPolygonManager.populatePostCodeLayer(t._map,t._childrenBoundariesLayer,t._mapOptions.childrenBoundaryNames,n)})},n.prototype._bindChildrenEntitiesCarouselEvents=function(){var n=this;this._map.getV8Map().getCityPolygonManager().then(function(){sj_evt.bind("Carousel.OnItemHover",function(t){var i,f,e,u,o,r;if(t&&t.length===4)for(i=[],n._childrenBoundariesLayer&&(f=function(n){return n.metadata&&n.metadata.title.indexOf(t[2])>=0},i=n._childrenBoundariesLayer.getPrimitives().filter(f),i.length===0&&(e=n._childrenBoundariesLayer.metadata&&n._childrenBoundariesLayer.metadata.pushpinPostCodes,i=e?e.filter(f):[])),u=0,o=i;u<o.length;u++)r=o[u],r&&r.metadata&&!r.metadata.polygon&&Microsoft.Maps.Internal.CityPolygonManager.handlePostCodePrimitiveHover({eventName:!t[3]?"mouseout":"mouseover",layer:n._childrenBoundariesLayer,primitive:r})})})},n.prototype._removeStaticImageAndShowLargeMapLink=function(){this._showLargeMapLink();this._staticImage.removeImage()},n.prototype._showLargeMapLink=function(){var i=this,n=this._getExploreMoreElement(),r,t;if(n){var u=this._map.getV8Map(),f=document.getElementById(this._mapOptions.id),e=u.getRootElement()[0];f.appendChild(n);n.style.display="block";r=this._mapOptions.disableAllMapInteractions?e:n.querySelector("a");sj_be(r,"click",function(t){i._mapOptions.supressLargerMapClick||(i._mapOptions.disableAllMapInteractions?n.click():i._processClickthrough(t))});this._titleElementId&&(t=_ge(this._titleElementId),t&&(t=t.querySelector("a"),sj_be(t,"click",function(n){return i._processClickthrough(n)})))}},n.prototype._getExploreMoreElement=function(){return _ge("mv_lm")},n.prototype._processClickthrough=function(n){n.preventDefault();var t=this._map.getV8Map(),i=t.getNavigationBar(),r=i&&i.getTrafficButton(),u=r&&r.getTrafficLayer();this._mapsUrl=StaticImage.replaceOrAppendMapModeParams(n.currentTarget.href,t.getMapType().id=="a"||t.getMapType().id=="h",i&&r&&u&&u.getIsShowing&&u.getIsShowing(),{centerPoint:{latitude:t.getView().cameraLocation.latitude,longitude:t.getView().cameraLocation.longitude},zoomLevel:t.getMercatorZoomLevel(),nwLocation:{latitude:t.getBounds().getNorthwest().latitude,longitude:t.getBounds().getNorthwest().longitude},seLocation:{latitude:t.getBounds().getSoutheast().latitude,longitude:t.getBounds().getSoutheast().longitude}});this._navigateToMapsVertical&&(window.location.href=this._mapsUrl)},n.prototype._getUrlParam=function(n,t){var r=encodeURI(t).replace(/[\.\(\)\*\+]/g,"\\$&"),u="^(?:.*[&\\?]"+r+"(?:\\=([^&]*))?)?.*$",i=new RegExp(u,"i").exec(n.search);return decodeURIComponent(i&&i[1]||"")},n.prototype._setNewFrame=function(n){var t=this._map.getV8Map().getFrameManager();t.frameRendered.addOne(function(){n&&n()});t.hackHackSetFrame()},n._defaultTimeoutForBootstrapping=3e3,n}()