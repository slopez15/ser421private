(function(){var wt,u,ft,ot,cr,ai,yi,pt,n,s;try{(function(){var n={L_microsoftcopyright_text:"© {year} Microsoft Corporation",L_DistanceUnitKm_Text:"km",L_DistanceUnitMeters_Text:"m",L_DistanceUnitMilesShortText_Text:"mi",L_DistanceUnitFeetShort_Text:"ft",L_Distance_Format:"{0} {1}",L_LatLon_Format:"{0}, {1}",L_Duration:"{0} hr {1} min",L_Duration_NoMin:"{0} hr",L_Duration_Min:"{0} min",L_DistanceUnitFeetSquareShort_Text:"sq ft",L_DistanceUnitKmSquare_Text:"sq km",L_DistanceUnitMetersSquare_Text:"sq m",L_DistanceUnitMilesSquareShortText_Text:"sq mi",L_AreaFieldString:"Area",L_FormatFieldString:"{0}: {1}",L_IncorrectValue_text:"N/A",L_LengthFieldString:"Length"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("MapCore",n):window.$MicrosoftMaps8.ResourcesObject=n})();n=function(){function n(n){Array.prototype.push.apply(this,n)}function t(i,r){if(i&&i instanceof n)return i;var u=!i&&[]||(r||typeof i=="string")&&t.query(i,r)||i instanceof Array&&i||[i];return new n(u)}function i(n,t){for(var i in t)t.hasOwnProperty(i)&&(n.prototype[i]=t[i])}return i(n,{length:Array.prototype.length,entities:function(){return Array.prototype.slice.apply(this)},sort:function(n){return Array.prototype.sort.call(this,n),this},reverse:function(){return Array.prototype.reverse.call(this),this},push:function(){return Array.prototype.push.apply(this,arguments),this},pop:function(){var t=Array.prototype.pop.call(this);return new n([t])},shift:function(){var t=Array.prototype.shift.call(this);return new n([t])},unshift:function(){return Array.prototype.unshift.apply(this,arguments),this},slice:function(){return new n(Array.prototype.slice.apply(this,arguments))},splice:function(){return new n(Array.prototype.splice.apply(this,arguments))},concat:function(t){return new n(Array.prototype.concat.apply(this.entities(),t.entities&&t.entities()||arguments))}}),t.Helper={get_guid:function(){var n=0;return function(t){if(!t)return"";if(t===window)return"win";if(t===document)return"doc";if(t.uniqueID)return t.uniqueID;var i="__$gimme$_guid__";return typeof t[i]=="undefined"&&(t[i]=i+n++),t[i]}}()},t.Browser=function(){var n=navigator.userAgent.toLowerCase(),t=-1,i;navigator.appName=="Microsoft Internet Explorer"&&(n=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),i.exec(n)!=null&&(t=parseFloat(RegExp.$1)));var r=typeof ActiveXObject!="undefined"||typeof MSPointerEvent!="undefined",f=new RegExp("\\s+Edge/([0-9]+).[0-9]+"),u=f.exec(navigator.userAgent)!=null;return{is_ie:r,is_edge:u,is_opera:typeof opera!="undefined",is_chrome:n.indexOf("chrome")>-1&&!u,is_khtml:n.indexOf("khtml")!==-1,is_gecko:n.indexOf("khtml")===-1&&n.indexOf("gecko")!==-1&&!r,is_in_quirks_mode:document.compatMode==="BackCompat",ie_version:t,is_webkit:n.indexOf("applewebkit/")!==-1}}(),t.undefined={}._$gimme$_undefined,t.ext=n.prototype,t}();n.ext.select=function(t){return n(t,this[0])};typeof g=="undefined"&&(window.g=n);n.Internals=new function(){function n(n){return function(t,i,r){this[n](t,i,r)}}return{addEventListener:n("addEventListener"),removeEventListener:n("removeEventListener"),attachEvent:n("attachEvent"),detachEvent:n("detachEvent")}};n.query=function(){return function(){function k(n,t,i){return r[t](n,i)}function d(n,t){var r=[],u=t.length,i;do i=h(n,t[--u]||t),i&&r.push(i);while(u);return r}function h(n,t){if(n===document||!t)return t;for(var i=t;(i=i.parentNode)&&i!==n;);return i===n&&t||null}function g(n,t){var i=n.document||document;return h(n,i.getElementById(t))}function c(n,t){var i,f,r,e;if(t=t||document,n.id)return a([g(t,n.id)],n);if(delete n.id,i=t.getElementsByTagName(n.tag||"*"),(!n.classes||n.classes.length<1)&&(!n.attributes||n.attributes.length<1)&&(!n.pseudos||n.pseudos.length<1))return l(i);for(f=[],e=i.length,r=0;r<e;r++)u(n,i[r])&&f.push(i[r]);return f}function u(n,t){if(!t)return!1;for(var u=n.propNames,f=u.length,i=0;i<f;i++)if(!r[u[i]](t,n[u[i]]))return!1;return!0}function l(n){for(var i=[],r=n.length,t=0;t<r;t++)i[t]=n[t];return i}function a(n,t){for(var r=[],f=n.length,i=0;i<f;i++)n[i]&&n[i].nodeType===1&&u(t,n[i])&&r.push(n[i]);return r}function y(n,t){return v(n,t)!==-1}function p(n){var r;t.inc();for(var u=t.name,f=[],e=n.length,i=0;i<e;i++)r=n[i],r[u]!==t.t&&(r[u]=t.t,f.push(r));return f}function w(n,t){if(!n)return!1;for(var r=" "+n+" ",i=t.length;i--;)if(r.indexOf(" "+t[i]+" ")===-1)return!1;return!0}function nt(n){var t=n.className;return typeof t!="string"&&(t=typeof n.getAttribute!="undefined"&&n.getAttribute("class")||""),t}function tt(n,t){typeof n.className=="string"?n.className=t:typeof n.setAttribute!="undefined"&&n.setAttribute("class",t)}function e(n){this.name=n;this.f=0;this.t=1;this.inc=function(){this.f=(this.t+=2)-1}}function it(n){this.parse=function(t){var u,i,o=n.preprocessInput,r,f,e;for(t=o&&o(t)||t,n.reset(),r=0,f=t.length;r<f;){if(u=t.charAt(r),i=i||n[u]||n["default"],i){if(e=i(t.substring(r,f)),!e)throw'No valid match found for "'+i.name+'" rule';r+=e}else throw'No suitable rule found to handle character "'+u+'"';i=null}return n.finish()}}function b(t,i){var w=i,r,u,h,o,a,y,v;if(i=i||document,n.inc(),typeof t!="string")return d(i||document,t);u=[];try{u=l(i.querySelectorAll(t))}catch(b){for(h=s.parse(t),a=h.length,o=0;o<a;o++){var f=h[o],p=f.length,e=p%2-1;for(r=e===0?c(f[e],i):[i||document];f[++e];)y=f[e++],v=f[e],v.root=i,r=k(r,y,v);u=a>1?u.concat(r):r}}return u}var t,i,n,r,o,s,v=function(){function n(n,t){return n.indexOf(t)}function t(n,t){for(var r=n.length,i=0;i<r;i++)if(n[i]===t)return i;return-1}return typeof Array.prototype.indexOf!="undefined"?n:t}(),f=function(){function n(n,t){return n.getAttribute(t)}function t(n,t){switch(t.toLowerCase()){case"class":return n.className||null;case"id":return n.id||null;case"href":case"src":if(typeof n.getAttribute!="undefined")return n.getAttribute(t,2)}return n.attributes&&n.attributes[t]&&n.attributes[t].nodeValue||n.getAttribute(t)}return function(){var i=document.createElement("div"),r;return i.innerHTML='<a href="#test">test<\/a>',r=i.firstChild,r.getAttribute("href")==="#test"?n:t}()}();return t=new e("__$gimme$_unique__"),i=new e("__$gimme$_genSib__"),n=new e("__$gimme$_nth__"),r={id:function(n,t){return n.id===t},tag:function(n,t){return n.tagName===t||t==="*"},classes:function(n,t){var i=n.className;return typeof i!="string"&&(i=f(n,"class")),w(i,t)},attributes:function(){var n={},t={parse:function(t){var i=t.match(/^\[([\w-_]+)?(\=|\^=|\$=|\*=|\|=|~=|!=)?(.*)\]$/);return n[t]={name:i&&i[1],delim:i&&i[2],val:i&&i[3].replace(/^['"]|["']$/g,"")}},"=":function(n,t){return n===t},"^=":function(n,t){return n.indexOf(t)===0},"$=":function(n,t){var i=n.lastIndexOf(t);return i!==-1&&i+t.length===n.length},"*=":function(n,t){return n.indexOf(t)!==-1},"|=":function(n,t){return n===t||n.indexOf(t+"-")===0},"~=":function(n,t){return n===t||y(n.split(" "),t)},"!=":function(n,t){return n!==t},unknown:function(){return!1}};return function(i,r){for(var e=r.length,u,o;e--;){if(u=n[r[e]]||t.parse(r[e]),o=f(i,u.name),!o)return!1;if(u.delim&&!t[u.delim||"unknown"](o,u.val))return!1}return!0}}(),pseudos:function(){function r(n){var t=n+"Sibling";return function(n){for(var i=n[t];i&&i.nodeType!==1;)i=i[t];return!i}}var i={},t={parse:function(n){var t=n.match(/([\w-_]+)\b(\((((-?\d*)n)?([+-]?\d+)?|.*)\))?/),r={name:t&&t[1],param:{wholeValue:t&&t[3],a:t&&t[5]||0,b:t&&t[6]||0}};return r.param.wholeValue==="even"?(r.param.a=2,r.param.b=0):r.param.wholeValue==="odd"&&(r.param.a=2,r.param.b=1),i[n]=r},"first-child":r("previous"),"last-child":r("next"),"only-child":function(n){return t["first-child"](n)&&t["last-child"](n)},"nth-child":function(t,i){var s=n.t*1e4,u=n.name,r=t.parentNode,h=0,f;if(r){if(r[u+":parent"]!==n.t){r[u+":parent"]=n.t;for(var h=0,e=r.children||r.childNodes,o=-1,c=e.length;++o<c;)e[o].nodeType===1&&(h++,e[o][u]=s+h)}return f=t[u]-s-i.param.b,!i.param.a&&i.param.b?f===0:i.param.a*f>=0&&f%(i.param.a||1)==0}return!1},contains:function(n,t){return(n.textContent||n.innerText||n.innerHTML).indexOf(t.param.wholeValue)!==-1},not:function(){return!1}};return function(n,r){for(var u=r.length,f;u--;)if(f=i[r[u]]||t.parse(r[u]),!t[f.name](n,f))return!1;return!0}}()," ":function(n,t){for(var r=[],f=n.length,u,i=0;i<f;i++)if(u=c(t,n[i]),r=r.concat(u),t.id&&u.length===1)break;return p(r)},">":function(n,t){for(var r=[],u=n.length,i=0;i<u;i++)r=r.concat(a(n[i].childNodes,t));return r},"+":function(n,t){for(var f=[],o=n.length,e,i,r=0;r<o;r++){for(e=n[r],i=e.nextSibling;i&&i.nodeType!==1;)i=i.nextSibling;u(t,i)&&f.push(i)}return f},"~":function(n,t){var s,r;i.inc();for(var e=i.name,o=[],h=n.length,f=0;f<h;f++)for(s=n[f],r=s.nextSibling;r&&r[e]!==i.t;)r.nodeType===1&&(r[e]=i.t,u(t,r)&&o.push(r)),r=r.nextSibling;return o}},o=new function(){function i(){this.propNames=[]}var r,t,n;return i.prototype.propNames=[],i.prototype.storePropertyValue=function(n,t){this[n]=t;this.propNames[n]||(this.propNames.push(n),this.propNames[n]=!0)},i.prototype.storeArrayValue=function(n,t){this[n]||(this[n]=[]);this[n].push(t);this.propNames[n]||(this.propNames.push(n),this.propNames[n]=!0)},{preprocessInput:function(n){return n.replace(/\s*([ >+~,])\s*/g,"$1")},reset:function(){r=[];t=[];n=new i},finish:function(){return n&&n.propNames.length>0&&t.push(n),t.length>0&&r.push(t),r},"default":function(t){var r=t.match(/(\w+|\*)/),i;return r?(i=r[0].toUpperCase(),n.storePropertyValue("tag",i),i.length):null},"#":function(t){var i=t.match(/#([_\-\w]+)/),r;return i?(r=i[1],n.storePropertyValue("id",r),i[0].length):null},".":function(t){var i=t.match(/\.([_\-\w\d]+)/),r;if(i)return r=i[1],n.storeArrayValue("classes",r),i[0].length},"[":function(t){var r=t.match(/(\[.*"\]|.*?\])/),i;return r?(i=r[0],n.storeArrayValue("attributes",i),i.length):null},":":function(t){var r=t.match(/:[\w-_]+\b(\(.*\))?/),i;return r?(i=r[0],n.storeArrayValue("pseudos",i),i.length):null}," ":function(){return t.push(n," "),n=new i,1},">":function(){return n.propNames.length>0&&t.push(n),t.push(">"),n=new i,1},"~":function(){return t.push(n,"~"),n=new i,1},"+":function(){return t.push(n,"+"),n=new i,1},",":function(){return t.push(n),r.push(t),t=[],n=new i,1}}},s=new it(o),b.Internal={unique:p,index_of:v,contains:y,contains_class:w,has_class:r.classes,get_attr:f,get_class:nt,set_class:tt},b}()}();n.Helper.index_of=n.query.Internal.index_of;n.Helper.contains=n.query.Internal.contains;n.Helper.unique=n.query.Internal.unique;n.Helper.get_attr=n.query.Internal.get_attr;n.Helper.contains_class=n.query.Internal.contains_class;n.Helper.has_class=n.query.Internal.has_class;n.Helper.get_class=n.query.Internal.get_class;n.Helper.set_class=n.query.Internal.set_class;n.Effects={Animation:function(n){function s(n){for(var h=e(n),r=t.length,o,s;r--;){s={};for(o in u)s[o]=i[o][r]+u[o][r]*h;f(t[r],s,n)}}var t=n.elements||[],o=n.duration||1,i=n.from||{},r=n.to||{},u={},f,e;(function(){var f,n,s,e={},o={},h={};for(n in i)for(e[n]=[],o[n]=[],h[n]=[],f=t.length;f--;)s=t[f],e[n][f]=typeof i[n]=="function"?i[n](s,n):i[n],o[n][f]=typeof r[n]=="function"?r[n](s,n):r[n],h[n][f]=o[n][f]-e[n][f];i=e;r=o;u=h})();f=n.animate;e=n.easing||function(n){return n};this.startTime=n.startTime||0;this.duration=o;this.add_element=function(n){t.push(n)};this.remove_element=function(n){for(var i=t.length;i--;)if(t[i]===n){t.splice(i,1);break}};this.tick=s},Storyboard:function(t){function o(){s||(s=!0,h=(new Date).getTime(),f=i.tileRefactoringEnabled?n.Effects.Animation.requestAnimationFrame(a):Microsoft.Maps.setInterval(a,w))}function b(){r=0;u=1;o()}function k(){l();y&&y(r)}function l(){i.tileRefactoringEnabled?n.Effects.Animation.cancelAnimationFrame(f):clearInterval(f);s=!1}function d(){o()}function g(){u=1;o()}function nt(){u=-1;o()}function tt(){u*=-1;o()}function it(n){r=n;p()}function rt(){return r}function ut(){return s}function ft(){return u}function et(){return e}function ot(){return c}function a(){var t=(new Date).getTime();r+=(t-h)/c*u;h=t;r=r<0?0:r>1?1:r;p();u===-1&&r===0||u===1&&r===1?(l(),v&&v(r)):i.tileRefactoringEnabled&&(f=n.Effects.Animation.requestAnimationFrame(a))}function p(){for(var t=e.length,n;t--;)n=(c*r-e[t].startTime)/e[t].duration,n=u===-1&&n<0?0:u===1&&n>1?1:n,n>=0&&n<=1&&e[t].tick(n)}var f,h,r=0,u=1,s=!1,e=t.animations,c=t.duration||0,w=t.interval||1,v=t.completed,y=t.aborted;this.begin=b;this.abort=k;this.pause=l;this.resume=d;this.forward=g;this.backward=nt;this.reverse=tt;this.seek=it;this.get_position=rt;this.is_running=ut;this.get_direction=ft;this.get_animations=et;this.get_duration=ot},Easing:{Back:new function(){function n(n,t,i,r){return t=.5,i=0,r=.5,Math.pow(1-n,i)*r*Math.sin(2*Math.PI*n*t)*-1+n}function t(){}function i(){}this.ease_in=n;this.ease_out=t;this.ease_in_out=i},Bounce:new function(){function t(n,t,i){return t=t||1.5,i=i||4,Math.abs(Math.pow(n,t)*Math.cos(Math.PI*n*i))}function i(t,i,r){return 1-n.Effects.Easing.Bounce.ease_in(1-t,i,r)}function r(t,i,r){var u=0,f=n.Effects.Easing.Bounce.ease_in;return t>.5&&(f=n.Effects.Easing.Bounce.ease_out,t-=.5,u=1/2),f(t,i,r)-u}this.ease_in=t;this.ease_out=i;this.ease_in_out=r},Elastic:new function(){function n(){}function t(n,t,i){return t=t||3.5,i=i||5,1-Math.pow(1-n,t)*Math.cos(2*Math.PI*n*i)}function i(){}this.ease_in=n;this.ease_out=t;this.ease_in_out=i},Exponential:new function(){function n(n,t){return Math.pow(n,t)}function t(n,t){return Math.pow(n,1/t)}function i(i,r){return i<=.5?n(i*2,r)*.5:t((i-.5)*2,r)*.5+.5}this.ease_in=n;this.ease_out=t;this.ease_in_out=i}},Enums:{Directions:{vertically:1,horizontally:2,both:3},Speeds:{quickly:500,slowly:1e3}},RunningAnimations:function(){var t={};return{add:function(n,i){t[n]=i},remove:function(n){delete t[n]},get:function(i){return t[i]||new n.Effects.Storyboard({animations:[]})},contains:function(n){return!!t[n]}}}()};n.Effects.Storyboard.create=function(t,i,r,u,f,e,o,s,h){f=Math.floor(f)||n.Effects.Enums.Speeds[f]||n.Effects.Enums.Speeds.quickly;var c=new n.Effects.Storyboard({duration:f,interval:h,completed:function(){o&&o.call(this);n.Effects.RunningAnimations.remove(e);c=null},aborted:function(){n.Effects.RunningAnimations.remove(e);c=null},animations:[new n.Effects.Animation({from:i,to:r,duration:f,animate:u,easing:s,elements:t})]});return e&&n.Effects.RunningAnimations.add(e,c),c},function(){var t=0,i={};n.Effects.Animation.requestAnimationFrame=function(){function u(n,t){return function(){i[t]&&n((new Date).getTime());delete i[t]}}function e(n,f){var e=i[++t]=u(n,t);return r(e,f),t}function o(n){var r=i[++t]=u(n,t);return Microsoft.Maps.setTimeout(r,f),t}var f=16,n=window,r=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame;return r?e:o}();n.Effects.Animation.cancelAnimationFrame=function(n){delete i[n]}}();n.Ajax=new function(){function t(t,i){n(t,i,!0)}function i(t,i){n(t,i,!1)}function r(){var n=e.Internal.originalXMLHttpRequest;if(typeof n!="undefined")return new n;if(typeof ActiveXObject!="undefined")try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){throw new Error("Error invoking XMLHTTP");}else throw new Error("XMLHttp is not supported");}function n(n,t,i){var u=r();u.onreadystatechange=function(){if(u.readyState===4){var n=u.responseText;i&&n&&(n=eval("("+u.responseText+")"));t.call(u,n,u.status);u=null;t=null}};u.open("GET",n,!0);u.send("")}this.request_json=t;this.request_ahah=i};n.Screen=new function(){function t(){return typeof innerWidth!="undefined"?{width:window.innerWidth,height:window.innerHeight}:typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0?{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}:{width:document.getElementsByTagName("body")[0].clientWidth,height:document.getElementsByTagName("body")[0].clientHeight}}function i(n){var t,i;return n=n||window.event,t={x:0,y:0},typeof n.pageX!="undefined"?(t.x=n.pageX,t.y=n.pageY):(i=this.get_scroll_pos(),t.x=n.clientX+i.x,t.y=n.clientY+i.y),t}function r(){return n(window).get_scroll_pos()}this.get_viewport_size=t;this.get_mouse_pos=i;this.get_scroll_pos=r};n.Util=new function(){function t(){return n(arguments,!1)}function i(){return n(arguments,!0)}function n(n,t){function u(){i.apply(this,Array.prototype.slice.call(n,2));t||(i=null)}var i=n[0],r=n[1];return t===!0?Microsoft.Maps.setInterval(u,r):Microsoft.Maps.setTimeout(u,r)}this.set_timeout=t;this.set_interval=i};n.Style=new function(){function o(i){var u=i.scrollTop&&i!==document.documentElement&&i!==document.body&&i.tagName!=="TEXTAREA"&&i.tagName!=="INPUT"?-1:0,r={x:i.scrollLeft*u,y:i.scrollTop*u},f;return n.Browser.is_ie&&t(i,"position")==="static"?(f=i.style.position,i.style.position="relative",r.x+=i.offsetLeft,r.y+=i.offsetTop,i.style.position=f):(r.x+=i.offsetLeft,r.y+=i.offsetTop),r}function l(u){var f={x:0,y:0},e;if(u.getBoundingClientRect){var s=u.getBoundingClientRect(),h=r(),c=n(window).get_scroll_pos();f.x=s.left-h.x+c.x;f.y=s.top-h.y+c.y}else while(u!==null)e=o(u),f.x+=e.x,f.y+=e.y,u=u.offsetParent,u&&!i()&&(f.x+=parseFloat(t(u,"borderLeftWidth"))||0,f.y+=parseFloat(t(u,"borderTopWidth"))||0);return f}function i(){var n,t;return typeof i.constantValue=="undefined"&&(n=document.createElement("div"),n.style.cssText="position:absolute;visibility:hidden;top:0;left:0;border:1px solid #000;",t=document.createElement("div"),n.appendChild(t),document.body.appendChild(n),i.constantValue=t.offsetTop===1,document.body.removeChild(n),n=t=null),i.constantValue}function r(){var i,u;if(typeof r.constantValue=="undefined"){var t=document.body,f=t.style.position,e=t.style.margin,o=t.style.border;t.style.position="static";t.style.margin="0";t.style.border="1px solid transparent";i=t.getBoundingClientRect();u=n(window).get_scroll_pos();r.constantValue={x:i.left+u.x,y:i.top+u.y};t.style.position=f;t.style.margin=e;t.style.border=o;document.documentElement.className=document.documentElement.className}return r.constantValue}function t(n,t){var i="",r,e,f;return n.currentStyle&&(t==="right"||t==="bottom")?i=u(t,"auto","auto",n)+"px":(r=document.defaultView&&document.defaultView.getComputedStyle&&document.defaultView.getComputedStyle(n,null)||n.currentStyle,r&&(i=r[t]||"",e=i.match(/px$/),e||(f=i.match(/(em|ex|%|in|cm|mm|pt|pc|small|medium|large|thin|thick|auto)$/),f&&(i=u(t,i,f[0],n)+"px")))),i}function u(i,r,u,f){var s,h,a,o,c,v,y,p,l,e,w;if(r){if(u==="px")return parseFloat(r);if(r==="auto")switch(i){case"top":case"left":return 0;case"bottom":case"right":if(s={bottom:["top","offsetTop","height","offsetHeight"],right:["left","offsetLeft","width","offsetWidth"]},h=n(f),h.get_style("position")==="relative")return a=s[i][0],-parseInt(h.get_style(a));for(o=f.parentNode;o!==document&&n(o).get_style("position")==="static";)o=o.parentNode;return c=s[i][2],v=o===document?n.Screen.get_viewport_size()[c]:parseInt(n(o).get_style(c)),y=s[i][1],p=s[i][3],v-f[y]-f[p];case"height":return f.clientHeight||f.offsetHeight&&f.offsetHeight-parseFloat(t(f,"borderTopWidth"))-parseFloat(t(f,"borderBottomWidth"))||0;case"width":return f.clientWidth||f.offsetWidth&&f.offsetWidth-parseFloat(t(f,"borderLeftWidth"))-parseFloat(t(f,"borderRightWidth"))||0;default:return 0}else{switch(i){case"borderLeftWidth":case"borderRightWidth":case"borderTopWidth":case"borderBottomWidth":return i=i.replace("Width","Style"),l=t(f,i),l==="none"?0:parseFloat(l)}f=f||document.body;e=document.createElement("div");e.style.visbility="hidden";e.style.position="absolute";e.style.lineHeight="0";u==="%"?(f=f.parentNode,i==="height"||i==="top"?e.style.height=r:(i==="width"||i==="left")&&(e.style.width=r)):(e.style.borderStyle="solid",e.style.borderBottomWidth="0",e.style.borderTopWidth=r);try{f.appendChild(e)}catch(b){f=f.parentNode;f.appendChild(e)}return f.offsetWidth,f.offsetHeight,w=e.offsetHeight||e.offsetWidth,f.removeChild(e),w}}else return 0}function a(n,t){var r,i;return t=t||document.body,r=f[n],r||(i=c(n),t.style[i]===undefined&&(i=v(i,t)||n),r=f[n]=i),r}function v(n,t){for(var r=c("-"+n),i=e.length;i--;)if(n=e[i]+r,t.style[n]!==undefined)return n;return""}function c(n){return n.replace(/-(\w)/g,function(n,t){return t.toUpperCase()})}function y(n){return n.replace(/([A-Z])/g,function(n){return"-"+n.toLowerCase()})}var s,h,f,e;this.get_relative_pos=o;this.get_absolute_pos=l;this.offset_includes_borders=i;this.get_bounding_client_rect_offsets=r;s=function(){function t(n,t){n.style.opacity=t}function i(n,t){t*=100;var i;try{i=n.filters.item("DXImageTransform.Microsoft.Alpha");t<100?(i.Opacity=t,i.enabled||(i.enabled=!0)):i.enabled=!1}catch(r){t<100&&(n.style.filter=(n.currentStyle||n.runtimeStyle).filter+" progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")")}}var n=document.createElement("div");return typeof n.style.opacity!="undefined"&&t||typeof n.style.filter!="undefined"&&i||function(){}}();this.set_opacity=s;h=function(){function i(n){return parseFloat(n.style.opacity)||t(n,"opacity")}function r(n){var t=n.filters["DXIMageTransform.Microsoft.Alpha"];return t?t.Opacity/100:1}var n=document.createElement("div");return typeof n.style.opacity!="undefined"&&i||typeof n.style.filter!="undefined"&&r||function(){}}();this.get_opacity=h;this.get_rendered_style=t;this.normalize_style=u;f={};e=["O","ms","Moz","Webkit"];this.get_camelized_style_name=a;this.get_dasherized_style_name=y};n.Events=new function(){var r=n.Helper,i=null,t=null;this.capture_mouse=function(r,u){return n.Events.release_mouse(),i=r,u!==!1&&(u=!0),r.setCapture!==undefined?r.setCapture(u):(t=function(r){var e=r.target,f,o,s;try{f=new MouseEvent(r.type,r)}catch(h){f=document.createEvent("MouseEvents");f.initMouseEvent(r.type,r.bubbles,r.cancelable,window,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,r.relatedTarget)}f.originalWhich=r.which;f.originalButtons=r.buttons;f.__defineGetter__&&(o=n.Screen.get_scroll_pos(),f.__defineGetter__("pageX",function(){return this.clientX+o.x}),f.__defineGetter__("pageY",function(){return this.clientY+o.y}));document.removeEventListener(r.type,t,!0);f.captureTarget=e;s=i;u||n(i).has(e)&&(s=e);s.dispatchEvent(f);t!==null&&document.addEventListener(r.type,t,!0);delete f.captureTarget;r.stopPropagation()},document.addEventListener("mouseover",t,!0),document.addEventListener("mouseout",t,!0),document.addEventListener("mousemove",t,!0),document.addEventListener("mouseup",t,!0),document.addEventListener("mousedown",t,!0),document.addEventListener("click",t,!0),document.addEventListener("dblclick",t,!0)),this};this.release_mouse=function(){return i!==null&&(i.releaseCapture!==undefined?i.releaseCapture():(document.removeEventListener("mouseover",t,!0),document.removeEventListener("mouseout",t,!0),document.removeEventListener("mousemove",t,!0),document.removeEventListener("mouseup",t,!0),document.removeEventListener("mousedown",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("dblclick",t,!0)),i=t=null),this};this.get_capture_target=function(n){return n.captureTarget||n.srcElement||n.target};this.Pseudo=new function(){function t(n,t,i){this.pseudoName=n;this.getNativeName=t;this.getProxiedHandler=i}function y(n,t,i){if(n===t)return!1;for(var r=0;t&&t!=n;)r++,t=t.parentNode;return i=i||r,t===n&&i===r}function l(n){var u=r.get_guid(n),t=i[u];return t||(t=i[u]=function(t){var i=t.relatedTarget;i&&this!==i&&!y(this,i)&&n.call(this,t)}),t}function p(t){if(!n.Browser.is_gecko)return t;var f=r.get_guid(t),u=i[f];return u||(u=i[f]=function(n){n.wheelDelta=-40*n.detail;t.call(this,n);n.wheelDelta=null}),u}function h(t){if(!(n.Browser.is_ie||n.Browser.is_edge))return t;var e=r.get_guid(t),u=i[e];return u||(u=i[e]=function(i){var o,u,s,h,e;if(i.pointerType===i.MSPOINTER_TYPE_TOUCH||i.pointerType==="touch"){i.type==="MSPointerUp"||i.type==="pointerup"||i.type==="MSPointerCancel"||i.type==="pointercancel"?delete f[i.pointerId]:(o=n.Screen.get_mouse_pos(i),f[i.pointerId]={_$targetId:r.get_guid(i.target),identifier:i.pointerId,pageX:o.x,pageY:o.y});s=[];h=[];for(u in f)f.hasOwnProperty(u)&&f[u]&&(e=f[u],s.push(e),e._$targetId===r.get_guid(i.target)&&h.push(e));i.touches=s;i.targetTouches=h;(i.type==="MSPointerDown"||i.type==="pointerdown")&&(i.preventDefault=w);t.call(this,i);i.touches=i.targetTouches=null}}),u}function w(){u[this.pointerId]=!0;var t=n.Browser.is_ie&&n.Browser.ie_version<11;return document.addEventListener(t?"MSPointerUp":"pointerup",a,!0),document.addEventListener("click",v,!0),(t?MSPointerEvent:PointerEvent).prototype.preventDefault.call(this)}function a(n){e=n.pointerId;u[e]&&(u[e]=!1)}function v(t){var i,r=0,f;for(i in u)i=parseInt(i),u[i]===!1&&delete u[i]||r++,i===e&&(t.stopPropagation()||t.preventDefault());r===0&&(f=n.Browser.is_ie&&n.Browser.ie_version<11,document.removeEventListener(f?"MSPointerUp":"pointerup",a,!0),document.removeEventListener("click",v,!0))}function c(){}var e=null,u={},i={},f={},o=n.Browser.is_ie&&n.Browser.ie_version<11,s={touchstart:o?"MSPointerDown":"pointerdown",touchend:o?"MSPointerUp":"pointerup",touchmove:o?"MSPointerMove":"pointermove",touchcancel:o?"MSPointerCancel":"pointercancel"};return t.prototype.add=function(n,t,i){n.add_event(this.getNativeName(this.pseudoName),this.getProxiedHandler(t,n),i,!0)},t.prototype.remove=function(t,u,f){t.remove_event(this.getNativeName(this.pseudoName),this.getProxiedHandler(u,t,!0),f,!0);var e=r.get_guid(u);e&&delete i[e];this.pseudoName==="touchstart"&&n(document).remove_event("touchend",c,!0).remove_event("touchcancel",c,!0)},{mouseenter:new t("mouseenter",function(){return"mouseover"},function(n){return l(n)}),mouseleave:new t("mouseleave",function(){return"mouseout"},function(n){return l(n)}),mousewheel:new t("mousewheel",function(t){return n.Browser.is_gecko?"DOMMouseScroll":t},function(n){return p(n)}),touchstart:new t("touchstart",function(t){return n.Browser.is_ie||n.Browser.is_edge?s[t]:t},function(t,i,r){return r||n(document).add_event("touchend",c,!0).add_event("touchcancel",c,!0),h(t)}),touchend:new t("touchend",function(t){return n.Browser.is_ie||n.Browser.is_edge?s[t]:t},function(n){return h(n)}),touchmove:new t("touchmove",function(t){return n.Browser.is_ie||n.Browser.is_edge?s[t]:t},function(n){return h(n)}),touchcancel:new t("touchcancel",function(t){return n.Browser.is_ie||n.Browser.is_edge?s[t]:t},function(n){return h(n)})}}},function(){var u=n.Helper,e=n.Internals,i,t,o={},f={},r={load:!1,unload:!1,focus:!1,blur:!1,beforeunload:!1,stop:!1,beforeprint:!1,afterprint:!1,propertychange:!1,filterchange:!1,readystatechange:!1,losecapture:!1};n.ext.add_event=function(){function s(t,i,r,u){for(var f,s=t?t.split(","):[],o=0;o<s.length;o++)f=s[o].trim(),!u&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[f]?n.Events.Pseudo[f].add(this,i,r):this.for_each(function(n){e.addEventListener.call(n,f,i,r)});return this}function h(s,h,c,l){function p(i,r){t=t||1;r.eventPhase=t;r.target=r.srcElement;r.currentTarget=i;var u=n.Screen.get_mouse_pos(r);r.pageX=u.x;r.pageY=u.y;switch(r.type){case"keyup":case"keydown":case"keypress":i.type!=="file"&&(r.keyCode===186?r.keyCode=59:r.keyCode===187?r.keyCode=61:r.keyCode===189?r.keyCode=109:null);r.which=r.keyCode;r.charCode=r.keyCode;break;case"mousedown":case"mouseup":case"click":case"dblclick":case"contextmenu":r.which=[1,1,3,r.button,2][r.button];break;case"mouseover":r.relatedTarget=r.fromElement;break;case"mouseout":r.relatedTarget=r.toElement}return r.preventDefault=function(){r.returnValue=!1},r.stopPropagation=function(){r.cancelBubble=!0},r}function w(n,t,i){var u=r[n],f;return u===!1?!1:(u||(u=r[n]={}),f=u[t],f||(f=u[t]=[]),f.push(i),!0)}function b(n,t){var r=f[n],i;r||(r=f[n]={});i=r[t];i||(i=r[t]={handlerCount:0,remainingHandlers:0});i.handlerCount++;i.remainingHandlers=i.handlerCount}function k(n,f){for(var l=[],h=n,o,e,s,v,c;h;)l.push(h),h=h.parentNode;while(o=l.pop())if(e=u.get_guid(o),r[a][e])for(i||(i=o),v=r[a][e].length,s=0;s<v;s++)f.cancelBubble||(o===f.target&&(f.eventPhase=t=2),c=r[a],c[e]&&c[e][s]&&c[e][s].call(o,f));return i}for(var a,y=s?s.split(","):[],v=0;v<y.length;v++)a=y[v].trim(),!l&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[a]?n.Events.Pseudo[a].add(this,h,c):this.for_each(function(n){var l=u.get_guid(n),y=u.get_guid(h)+(c||!1).toString(),v="{"+l+" / "+a+" / "+y+"}",s;c&&(c=w(a,l,h));s=o[v];s||(s=function(u){var e=f[a][l];e.remainingHandlers--;u=p(n,u);r[a]&&t===1&&(i=k(n,u));t=n===u.target?2:3;u.eventPhase=t;c||u.cancelBubble||h.call(n,u);(!i||u.cancelBubble||n==i&&e.remainingHandlers===0)&&(t=1,i=undefined,e.remainingHandlers=e.handlerCount);u.eventPhase=u.target=u.currentTarget=u.relatedTarget=u.which=u.preventDefault=u.stopPropagation=u.pageX=u.pageY=undefined},o[v]=s,e.attachEvent.call(n,"on"+a,s),b(a,l));v=null;s=null});return this}return document.addEventListener?s:document.attachEvent?h:function(){}}();n.ext.remove_event=function(){function t(t,i,r,u){for(var f,s=t?t.split(","):[],o=0;o<s.length;o++)f=s[o].trim(),!u&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[f]?n.Events.Pseudo[f].remove(this,i,r):this.for_each(function(n){e.removeEventListener.call(n,f,i,r)});return this}function i(t,i,s,h){function v(t,i,u){var e=r[t],f,o;e&&(f=e[i],f&&(o=n(f).index_of(u),o!==-1&&f.splice(o,1),f.length===0&&delete e[i]))}function y(n,t){var i=f[n]&&f[n][t];i&&(i.handlerCount>0&&i.handlerCount--,i.remainingHandlers=i.handlerCount)}for(var c,a=t?t.split(","):[],l=0;l<a.length;l++)c=a[l].trim(),!h&&n.Events&&n.Events.Pseudo&&n.Events.Pseudo[c]?n.Events.Pseudo[c].remove(this,i,s):this.for_each(function(n){var r=u.get_guid(n),h=u.get_guid(i)+(s||!1).toString(),f="{"+r+" / "+c+" / "+h+"}",t;s&&v(c,r,i);t=o[f];t&&(e.detachEvent.call(n,"on"+c,t),delete o[f],y(c,r));f=null;t=null});return this}return document.addEventListener?t:document.attachEvent?i:function(){}}()}(),function(){var t=n.Helper;n.ext.add_class=function(i){var r=i.split(/\s+/);return this.for_each(function(i){var u=t.get_class(i);n(r).for_each(function(n){t.contains_class(u,[n])||(u===""?u=n:u+=" "+n)});t.set_class(i,u)}),this}}();n.ext.remove_class=function(n){return this.swap_class(n,"$1")},function(){var t=n.Helper;n.ext.swap_class=function(i,r){r!=="$1"&&(r=" "+r+" ");var u=i.split(/\s+/);return this.for_each(function(i){var f=t.get_class(i);n(u).for_each(function(n){var t=new RegExp("(^| )"+n+"( |$)");f=f.replace(t,r)});t.set_class(i,f.replace(/^\s+|\s+$/g,""))}),this}}(),function(){var t=n.Helper;n.ext.has_class=function(n,i){var r=this[i||0];return r&&t.has_class(r,[n])||!1}}();n.ext.get_html=function(n){var t=this[n||0];return t&&t.innerHTML||""};n.ext.set_html=function(n){return this.for_each(function(t){t.innerHTML=n}),this};n.ext.get_val=function(n){var t=this[n||0];return t&&t.value||""};n.ext.set_val=function(n){return this.for_each(function(t){typeof t.value!="undefined"&&(t.value=n)}),this},function(){var t=n.Helper.get_attr;n.ext.get_attr=function(n,i){var r=this[i||0];return r&&t(r,n)||""}}();n.ext.set_attr=function(n,t){return this.for_each(function(i){var r;i.tagName.toUpperCase()==="INPUT"&&((r=n==="checked")||n==="value")?(i[n]=t,r&&(i.defaultChecked=t)):n.toUpperCase()==="CLASS"?i.className=t:i.setAttribute(n,t)}),this},function(){var t=n.Style.get_rendered_style,i=n.Style.get_opacity,r=n.Style.get_camelized_style_name;n.ext.get_style=function(n,u){var f=this[u||0];return f?n==="opacity"?i(f):t(f,r(n)):""}}(),function(){var t=n.Style.set_opacity,i=n.Style.get_camelized_style_name;n.ext.set_style=function(n){return this.for_each(function(r){var e,u,f;for(e in n){u=n[e];f=i(e);switch(f){case"height":case"maxHeight":case"minHeight":case"width":case"maxWidth":case"minWidth":case"top":case"right":case"bottom":case"left":case"marginTop":case"marginRight":case"marginBottom":case"marginLeft":case"paddingTop":case"paddingRight":case"paddingBottom":case"paddingLeft":r.style[f]=typeof u=="number"&&u+"px"||u;break;case"opacity":t(r,u);break;default:r.style[f]=u}}}),this}}();n.ext.get_native_prop=function(n,t){var i=this[t||0];return i?i[n]:""};n.ext.parent=function(t){var i=this[t||0];return n(i&&i.parentNode)};n.ext.element=function(n){return this[n||0]};n.ext.get_ancestor=function(t,i){for(var r=this[i||0],u=t;u-->0;)if(r)r=r.parentNode;else break;return n(r)};n.ext.get_sibling=function(t,i){var f=this[i||0],r=f;if(t!==0)for(var e=t>0?"nextSibling":"previousSibling",o=Math.abs(t),u=0;u<o;){if(r=r[e],!r)break;r.nodeType===1&&u++}return n(r)};n.ext.for_each=function(){function n(n,t){return this.entities().forEach(n,t),this}function t(n,t){for(var r=this.entities(),u=r.length,i=0;i<u;i++)n.call(t,r[i],i,r);return this}return typeof Array.prototype.forEach!="undefined"?n:t}();n.ext.iterate=function(t){for(var u=this.length,r,i=0;i<u;i++)r=n(this[i]),t.call(r,i);return t=null,this};n.ext.filter=function(t){for(var r=n(),i=this.length;i--;)t(this[i])&&r.unshift(this[i]);return r};n.ext.map=function(){function t(t,i){return n(this.entities().map(t,i))}function i(t,i){for(var r=n(),u=this.length;u--;)r.unshift(t.call(i,this[u]));return r}return typeof Array.prototype.map!="undefined"?t:i}(),function(){var t=n.Helper;n.ext.contains=function(n){return t.contains(this.entities(),n)}}(),function(){var t=n.Helper;n.ext.index_of=function(n){return t.index_of(this.entities(),n)}}();n.ext.select=function(t){return n(t,this[0])};n.ext.has=function(t,i){var r=this[i||0];return n(t,r).length>0},function(){var t=n.Helper;n.ext.unique=function(){return n(t.unique(this.entities()))}}(),function(){var t=n.Style.get_rendered_style;n.ext.get_style_pos=function(n){var i=this[n||0];return{x:parseFloat(t(i,"left")),y:parseFloat(t(i,"top"))}}}(),function(){var t=n.Style.get_absolute_pos;n.ext.get_absolute_pos=function(n){var i=this[n||0];return i&&t(i)||{x:0,y:0}}}(),function(){var t=n.Style.get_relative_pos;n.ext.get_relative_pos=function(n){var i=this[n||0];return i&&t(i)||{x:0,y:0}}}(),function(){n.ext.get_scroll_pos=function(t){var r=this[t||0],i={x:0,y:0};return r===window?typeof pageYOffset!="undefined"?(i.x=window.pageXOffset,i.y=window.pageYOffset):n.Browser.is_in_quirks_mode||typeof document.documentElement.scrollTop=="undefined"?typeof document.body.scrollTop!="undefined"&&(i.x=document.body.scrollLeft,i.y=document.body.scrollTop):(i.x=document.documentElement.scrollLeft,i.y=document.documentElement.scrollTop):(i.x=r.scrollLeft,i.y=r.scrollTop),i}}();n.ext.animate=function(t,i,r,u,f){function l(n,t,i){switch(n){case"+":return t+i;case"-":return t-i;case"*":return t*i;case"/":return t/i;default:return i}}function s(t,i){var r=n(t).get_style(i)+"",u=parseFloat(r);return e.units[i]=r.replace(u,""),u}function a(n,i){var e=s(n,i),r=t[i]+"",u=r.match(/^[+\-*\/]/),f=u&&u[0]||"noOp";return r=Number(r.replace(f,"")),l(f,e,r)}var e={units:{},ops:{}},h={},o,c;for(o in t)e[o]=s,h[o]=a;return c=n.Effects.Storyboard.create(this,e,h,function(t,i){var f=n(t),r,u;for(r in i)r!=="units"&&(u={},u[r]=i[r]+e.units[r],f.set_style(u))},i,r,u,f),c.begin(),this};n.ext.bounce=function(t,i,r,u,f){function e(t){return n(t).get_style_pos().y}t===null&&(t=e);var o=n.Effects.Storyboard.create(this,{top:t},{top:i},function(n,t){n.style.top=Math.ceil(t.top)+"px"},r,u,f,n.Effects.Easing.Bounce.ease_out);return o.begin(),this},function(){function t(t,i,r,u,f){this.set_style({zoom:1});t===null&&(t=function(t,i){return Number(n(t).get_style(i))});var e=n.Effects.Storyboard.create(this,{opacity:t},{opacity:i},function(t,i){n(t).set_style({opacity:i.opacity})},r,u,f,null);return e.begin(),this}n.ext.fade_to=t;n.ext.fade_in=function(n,i,r,u){return t.call(this,0,1,n,i,r,u)};n.ext.fade_out=function(n,i,r,u){return t.call(this,1,0,n,i,r,u)}}();n.ext.slide=function(t,i,r,u,f,e){function o(t,i){i=i==="left"?"x":"y";var r=t.__pos;return r||(r=t.__pos=n(t).get_style_pos()),i==="y"&&(t.__pos=n.undefined),r[i]}t===null&&(t={x:o,y:o});var s=Math.round,h=n.Effects.Easing.Exponential.ease_in_out,c=n.Effects.Storyboard.create(this,{left:t.x,top:t.y},{left:i.x,top:i.y},function(n,t){n.style.top=s(t.top)+"px";n.style.left=s(t.left)+"px"},r,u,f,e||function(n){return h(n,4)});return c.begin(),this};n.ext.scroll_to=function(t,i,r,u){var f=n.Screen.get_scroll_pos(),e=n(this[0]).get_absolute_pos(),o=Math.round,s=n.Effects.Easing.Exponential.ease_out,h=n.Effects.Storyboard.create([window],{scrollX:f.x,scrollY:f.y},{scrollX:e.x,scrollY:e.y},function(n,t){n.scrollTo(o(t.scrollX),o(t.scrollY))},t,i,r,u||function(n){return s(n,4)});return h.begin(),this};n.ext.veil=function(t,i,r,u,f){function l(t,i){var r=parseInt(n(t).get_style(i),10);return t[h]=t[h]||{},t[h][i]=r}var e=n.Effects.Enums.Directions,h,o,s,c;return t=Math.floor(t)||e[t]||e.vertically,h="_$gimme$_veil",o={},s={},(t&e.vertically)===e.vertically&&(s.height=s.paddingTop=s.paddingBottom=l,o.height=o.paddingTop=o.paddingBottom=0),(t&e.horizontally)===e.horizontally&&(s.width=s.paddingLeft=s.paddingRight=l,o.width=o.paddingLeft=o.paddingRight=0),c=n.Effects.Storyboard.create(this.filter(function(t){var i=t.style.display||n(t).get_style("display");return i!=="none"}),s,o,function(n,i){var r=n.style;(t&e.vertically)===e.vertically&&(r.height=i.height+"px",r.paddingTop=i.paddingTop+"px",r.paddingBottom=i.paddingBottom+"px");(t&e.horizontally)===e.horizontally&&(r.width=i.width+"px",r.paddingRight=i.paddingRight+"px",r.paddingLeft=i.paddingLeft+"px")},i,r,u,f||function(t){return n.Effects.Easing.Exponential.ease_in_out(t,4)}),c.get_animations().push(new n.Effects.Animation({startTime:0,elements:this,animate:function(n){n.style.overflow="hidden"}}),new n.Effects.Animation({startTime:c.get_duration(),elements:this,animate:function(n){n.style.display="none"}})),c.begin(),this};n.ext.unveil=function(t,i,r,u,f){function c(t,i){var r=t._$gimme$_veil;return r||(r=r||function(){var i=t.cloneNode(!0),r,u,f;return i.style.cssText="position:absolute;top:0;left:0;visibility:hidden;margin:0;padding:0;border:0;height:;width:;",i.style.display="block",t.parentNode.appendChild(i),i=n(i),r=parseInt(n(t).get_style("height"),10)||parseInt(i.get_style("height"),10),u=parseInt(n(t).get_style("width"),10)||parseInt(i.get_style("width"),10),i[0].style.padding=t.style.padding,f={height:r,width:u,paddingTop:parseInt(i.get_style("paddingTop"),10),paddingBottom:parseInt(i.get_style("paddingBottom"),10),paddingRight:parseInt(i.get_style("paddingRight"),10),paddingLeft:parseInt(i.get_style("paddingLeft"),10)},t.parentNode.removeChild(i[0]),t.style.overflow="hidden",f}()),r[i]}function l(){return document.fullscreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled}var e=n.Effects.Enums.Directions,o,s,h;return t=Math.floor(t)||e[t]||e.vertically,e=n.Effects.Enums.Directions,t=Math.floor(t)||e[t]||e.vertically,o={},s={},(t&e.vertically)===e.vertically&&(s.height=s.paddingTop=s.paddingBottom=0,o.height=o.paddingTop=o.paddingBottom=c),(t&e.horizontally)===e.horizontally&&(s.width=s.paddingLeft=s.paddingRight=0,o.width=o.paddingLeft=o.paddingRight=c),h=n.Effects.Storyboard.create(this.filter(function(t){var i=t.style.display||n(t).get_style("display");return i==="none"||i===null}),s,o,function(n,i){(t&e.vertically)===e.vertically&&(n.style.height=i.height+"px",n.style.paddingTop=i.paddingTop+"px",n.style.paddingBottom=i.paddingBottom+"px");(t&e.horizontally)===e.horizontally&&(n.style.width=i.width+"px",n.style.paddingRight=i.paddingRight+"px",n.style.paddingLeft=i.paddingLeft+"px")},i,r,u,f||function(t){return n.Effects.Easing.Exponential.ease_in_out(t,4)}),h.get_animations().push(new n.Effects.Animation({startTime:0,elements:this,animate:function(n){n.style.overflow="hidden";n.style.display="block"}}),new n.Effects.Animation({startTime:h.get_duration(),elements:this,animate:function(n){n.style.overflow=""}})),n.ext.exit_full_screen=function(){l()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.exitFullscreen())},n.ext.set_full_screen=function(n){n&&l()&&(n.webkitRequestFullScreen?n.webkitRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.requestFullscreen())},h.begin(),this};n.toString=function(){return"Gimme v2.7.0 (Edmund) :: Thursday, June 28, 2012 3:44:28 PM"},function(){function o(t){return n.Effects.Easing.Exponential.ease_in_out(t,4)}function s(){return document.fullscreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled?!0:!1}var r=n.ext,e=300,h=new RegExp('["\\b\\f\\n\\r\\t\\\\\\x00-\\x1F]',"i"),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=new RegExp("/[^A-Za-z0-9+/=]","g"),u=64,l=63,f=n.Internals;r.append=function(t){var i=this,r=i[0];return r&&n(t).for_each(function(n){var t=n.parentNode;t!==r&&(n.getRootElement?(n=n.getRootElement(),i.append(n)):r.appendChild(n))}),i};r.insertBefore=function(t,i){var r=this[0];return i.length&&(i=i[0]),r&&n(t).for_each(function(n){r.insertBefore(n,i)}),this};r.appendTo=function(t){return t=n(t)[0],t&&this.for_each(function(n){n.parentNode!==t&&t.appendChild(n)}),this};r.getParent=r.parent;r.appendText=function(n){return this.for_each(function(t){t.appendChild(document.createTextNode(n))}),this};r.appendHTML=function(n){return this.for_each(function(t){sj_appHTML(t,n)}),this};r.fadeIn=function(t,i,r){function f(){r&&r()}var u=this[0];return t=n(t).set_style({opacity:0}).appendTo(u),t.fade_in(i||e,null,f,o),this};r.fadeOut=function(n,t,i){function u(){n&&r.removeFromParent();i&&i()}var r=this;return r.fade_out(t||e,null,u,o),this};r.fadeToChild=function(t,i,r){function c(){t.set_style({zIndex:s});u.removeFromParent();r&&r()}var f=this[0];t=n(t).set_style({opacity:0}).appendTo(f);var s=t.get_style("zIndex"),h=this.select(">*").set_style({position:"absolute",top:0,left:0,zIndex:0}),u=h.filter(function(n){return t.index_of(n)===-1});return u.length?t.fade_in(i||e,null,c,o):t.set_style({opacity:1}),this};r.removeFromParent=function(){return this.for_each(function(n){n.parentNode&&n.parentNode.removeChild(n)}),this};r.get_size=function(){return new nt(this[0].clientWidth,this[0].clientHeight)};r.clear=function(){return this.for_each(function(n){for(var t=n.lastChild;t;)n.removeChild(t),t=n.lastChild}),this};r.set_text=function(n){return this.clear(),this.for_each(function(t){t.appendChild(document.createTextNode(n))}),this};r.getOpacity=function(){return parseFloat(this.get_style("opacity"))};r.fireEvent=function(n){return this.for_each(function(t){var r,i;document.createEventObject?(r=document.createEventObject(),t.fireEvent("on"+n,r)):(i=document.createEvent("HTMLEvents"),i.initEvent(n,!0,!0),t.dispatchEvent(i))}),this};r.inlineDataSvgs=function(){var r=/^(?:url\(['"]?)?data:(.+);base64,([^'")]+)(?:['"]?\))?$/,u=new DOMParser,i=this;return i.iterate(function(f){var e=i[f],w=e.children&&e.children.length||e.textContent&&e.textContent.trim(),s,a,y,v,o,h,p,c,l;if(!w&&(s=n(e).get_style("background-image").match(r),s&&(a=s[1],y=s[2],a==="image/svg+xml")))try{if(v=u.parseFromString(atob(y),a),o=v&&v.rootElement,!o||o.tagName!=="svg")return;for(h=e.attributes,p=h&&h.length,c=0;c<p;c++)l=h[c],l.value&&o.setAttribute(l.name,l.value);o.setAttribute("focusable","false");o.style.backgroundImage="none";e.parentNode.replaceChild(o,e);i[f]=o}catch(b){t.assert(!1,"Error creating SVG: "+b)}}),this};r.remove_attr=function(n){return this.for_each(function(t){t.removeAttribute(n)}),this};r.is_element_inView=function(n,t){var i=this[0].getBoundingClientRect(),r=n?n:0,u=t?t:0;return i.top-r>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)-u&&i.right<=(window.innerWidth||document.documentElement.clientWidth)};r.exit_full_screen=function(){s()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.exitFullscreen())};r.set_full_screen=function(n){n&&s()&&(n.webkitRequestFullScreen?n.webkitRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen?n.msRequestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.requestFullscreen())};f.stringify=function(n,t){function i(n,t){var u,r,i;if(t=t+'"',h.test(n))for(u=n.length,r=0;r<u;r++)if(i=n.charAt(r),i>=" ")(i==="\\"||i==='"')&&(t=t+"\\"),t=t+i;else switch(i){case"\b":t=t+"\\b";break;case"\f":t=t+"\\f";break;case"\n":t=t+"\\n";break;case"\r":t=t+"\\r";break;case"\t":t=t+"\\t";break;default:t=t+"\\u00";i.charCodeAt()<16&&(t=t+"0");t=t+i.charCodeAt().toString(16)}else t=t+n;return t+'"'}function r(n,t){var f,u,e;switch(typeof n){case"object":if(n)if(n instanceof Number)t=t+n.toString();else if(n instanceof Boolean)t=t+n.toString();else if(n instanceof String)t=i(n,t);else if(n instanceof Array){for(t=t+"[",u=0;u<n.length;u++)u>0&&(t=t+","),t=r(n[u],t);t=t+"]"}else{t=t+"{";u=0;for(f in n)n.hasOwnProperty(f)&&(e=n[f],typeof e!="undefined"&&typeof e!="function"&&(u>0&&(t=t+","),u++,t=i(f,t),t=t+":",t=r(e,t)));t=t+"}"}else t=t+"null";break;case"number":case"boolean":t=t+n.toString();break;case"string":t=i(n,t);break;default:t=t+"null"}return t}function f(n){return r(n,"")}var u=window.JSON&&window.JSON.stringify;return u&&!t?u(n):f(n)};f.base64Encode=function(n){if(!n||n.length===0)return n;for(var s=n.length,h=s%3,c=s-h,t="",f,e,o,r=0;r<c;r+=3)f=n.charCodeAt(r),e=n.charCodeAt(r+1),o=n.charCodeAt(r+2),t+=i.charAt((f&252)>>2),t+=i.charAt((f&3)<<4|(e&240)>>4),t+=i.charAt((e&15)<<2|(o&192)>>6),t+=i.charAt(o&l);r=c;f=n.charCodeAt(r);e=n.charCodeAt(r+1);switch(h){case 1:t+=i.charAt((f&252)>>2);t+=i.charAt((f&3)<<4);t+=i.charAt(u);t+=i.charAt(u);break;case 2:t+=i.charAt((f&252)>>2);t+=i.charAt((f&3)<<4|(e&240)>>4);t+=i.charAt((e&15)<<2);t+=i.charAt(u)}return t};f.base64Decode=function(n){var h,l,r,t,s,e,f,o;if(!n||n.length===0)return n;if(h=n.length,h%4!=0||c.exec(n))throw"Not a valid base64 encoded string";for(l=h-4,r="",t=0;t<l;t+=4)s=n.charAt(t),e=n.charAt(t+1),f=n.charAt(t+2),o=n.charAt(t+3),r+=String.fromCharCode(i.indexOf(s)<<2|i.indexOf(e)>>4),r+=String.fromCharCode((i.indexOf(e)&15)<<4|i.indexOf(f)>>2),r+=String.fromCharCode((i.indexOf(f)&3)<<6|i.indexOf(o));return t=l,s=n.charAt(t),e=n.charAt(t+1),f=n.charAt(t+2),o=n.charAt(t+3),r+=String.fromCharCode(i.indexOf(s)<<2|i.indexOf(e)>>4),i.indexOf(f)!==u&&(r+=String.fromCharCode((i.indexOf(e)&15)<<4|i.indexOf(f)>>2)),i.indexOf(o)!==u&&(r+=String.fromCharCode((i.indexOf(f)&3)<<6|i.indexOf(o))),r};f.isTouchDevice=function(){var n=window.navigator&&(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)||window.PointerEvent,t=n&&window.MSGesture;return"ontouchstart"in window||t||window.DocumentTouch&&document instanceof DocumentTouch};f.HTMLEncode=function(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}(),function(n){var t=function(){var n,t,i;try{return n=(new Date).toString(),t=window.localStorage,t.setItem(n,n),i=t.getItem(n)===n,t.removeItem(n),i&&t}catch(r){}}(),i=function(){function n(){}return n.isEnabled=function(){return!!t},n.getItem=function(i){var r,u,f,e;return t?(r=t.getItem(i),r&&(u=n._generateExpirationKey(i),f=t.getItem(u),f&&(e=parseInt(f),Date.now()>e&&(r=null,t.removeItem(i),t.removeItem(u)))),r):null},n.setItem=function(i,r,u){t&&((!isFinite(u)||u>0)&&t.setItem(i,r),u>0&&t.setItem(n._generateExpirationKey(i),(Date.now()+u*864e5).toString()))},n.removeItem=function(i){if(t){var r=n._generateExpirationKey(i);t.removeItem(i);t.removeItem(r)}},n._generateExpirationKey=function(n){return"_$Maps_"+n+"_expiration"},n}();n.LocalStorageCache=i}(wt||(wt={}));var br="MicrosoftMap",e=window.$MicrosoftMaps8,i=e.GlobalConfig,k=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),c=function(){function n(n,t,i){this.x=n;this.y=t;this.z=i}return n.prototype.add=function(t){return this.z&&t.z?new n(this.x+t.x,this.y+t.y,this.z+t.z):new n(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return this.z&&t.z?new n(this.x-t.x,this.y-t.y,this.z-t.z):new n(this.x-t.x,this.y-t.y)},n.prototype.clone=function(){return new n(this.x,this.y,this.z)},n.prototype.equals=function(t,i){return n.pointsEqual(this,t,i)},n.pointsEqual=function(n,t,i){return n&&t?i>0?Math.abs(n.x-t.x)<=i&&Math.abs(n.y-t.y)<=i:n.x===t.x&&n.y===t.y&&n.z===t.z:!1},n.prototype.toString=function(){return typeof this.z=="undefined"?"[Point ("+this.x+", "+this.y+")]":"[Point ("+this.x+", "+this.y+", "+this.z+")]"},n}(),nt=function(){function n(n,t){this.width=n;this.height=t}return n.Auto=new n(-1,-1),n}(),kr=function(){function n(n,i,r){t.assertIsFunction(n,"handler");t.assert(isFinite(i)&&i>0,"Argument: interval should be a positive number.");this.handler=n;this._interval=i;this._eventFilter=r;this._nextScheduledEventId=null}return n.prototype.invoke=function(n){var i=this,t;this._isScheduled()?(this._eventFilter&&(n=this._eventFilter(this._nextScheduledEventArgs,n)),this._nextScheduledEventArgs=n):(t=(new Date).getTime(),this._lastRaisedTime&&this._lastRaisedTime<t+this._interval?(this._nextScheduledEventArgs=n,this._nextScheduledEventId=Microsoft.Maps.setTimeout(function(){i._raiseScheduledEvent()},this._lastRaisedTime+this._interval-t)):(this.handler(n),this._lastRaisedTime=t))},n.prototype.dispose=function(){this._clearScheduledEvent()},n.prototype._raiseScheduledEvent=function(){this.handler(this._nextScheduledEventArgs);this._lastRaisedTime=(new Date).getTime();this._clearScheduledEvent()},n.prototype._isScheduled=function(){return this._nextScheduledEventId!==null},n.prototype._clearScheduledEvent=function(){this._isScheduled()&&(clearTimeout(this._nextScheduledEventId),this._nextScheduledEventId=null)},n}(),r=function(){function n(){this._handlers=[];this._throttledEventInvokers=[];this.isPreviouslyInvoked=!1;this.lastInvokedArgs=null}return n.prototype.add=function(n,i){var r=this;return i===void 0&&(i=!1),t.assertIsFunction(n,"handler"),i?this._handlers.splice(0,0,n):this._handlers.push(n),{dispose:function(){return r.remove(n)}}},n.prototype.addOne=function(n){var t=this.add(function(i){t.dispose();n(i)});return t},n.prototype.addThrottled=function(n,i,r){var u=this;return t.assertIsFunction(n,"handler"),t.assert(isFinite(i)&&i>0,"Argument: throttleInterval should be a positive number."),this._throttledEventInvokers.push(new kr(n,i,r)),{dispose:function(){return u._removeThrottledEventHandler(n)}}},n.prototype.remove=function(n){var t;if(typeof n=="function"){for(t=this._handlers.length;t--;)if(this._handlers[t]===n){this._handlers.splice(t,1);return}}else for(t=this._throttledEventInvokers.length;t--;)if(this._throttledEventInvokers[t].handler===n){this._throttledEventInvokers[t].dispose();this._throttledEventInvokers.splice(t,1);return}},n.prototype.invoke=function(n){var i,t,u,r;for(this.lastInvokedArgs=n,this.isPreviouslyInvoked=!0,i=this._handlers.slice(0),t=0,u=i.length;t<u;t++)i[t](n);for(r=this._throttledEventInvokers.slice(0),t=0;t<r.length;t++)r[t].invoke(n)},n.prototype.hasHandlersRegistered=function(){return this._handlers.length+this._throttledEventInvokers.length>0},n.prototype.isHandlerRegistered=function(n){return this._handlers.some(function(t){return n===t})||this._throttledEventInvokers.some(function(t){return n===t.handler})},n.prototype.dispose=function(){this._handlers=[];for(var n=this._throttledEventInvokers.length;n--;)this._throttledEventInvokers[n].dispose();this._throttledEventInvokers=[];this.lastInvokedArgs=null},n.prototype._removeThrottledEventHandler=function(n){for(var t=this._throttledEventInvokers.length;t--;)if(this._throttledEventInvokers[t].handler===n){this._throttledEventInvokers[t].dispose();this._throttledEventInvokers.splice(t,1);return}},n}(),v=function(){function i(){}return i.getValue=function(n,r){if(t.assertNotNull(n,"object"),t.assertNotNullOrEmpty(r,"name"),n.hasOwnProperty(r))return n[r];var u=n["get"+i.capitalizeProp(r)];return u?u.call(n):n.get?n.get(r):n.length===1&&n.constructor===i._gimmeConstructor?i.getValue(n[0],r):n[r]},i.mergeProperties=function(n,t){var i,r;for(i in t)r=t[i],t.hasOwnProperty(i)&&r!==undefined&&(n[i]=r)},i.setValue=function(n,r,u,f){t.assertNotNull(n,"object");t.assertNotNullOrEmpty(r,"name");f||i.cancelAnimation(n,r);var e=n["set"+i.capitalizeProp(r)];e?e.call(n,u):n.set?n.set(r,u):n.set_attr?u===null&&n.remove_attr?n.remove_attr(r):n.set_attr(r,u):n[r]=u},i.capitalizeProp=function(n){return(typeof n=="string")?n.charAt(0).toUpperCase()+n.substring(1):n},i.areEqual=function(n,t){if(n===t)return!0;if(typeof n!=typeof t)return!1;if(n instanceof Array&&t instanceof Array&&!n.length&&!t.length)return!0;if(typeof n=="object"&&n&&t&&n.constructor===Object&&t.constructor===Object){for(var r in n)if(n.hasOwnProperty(r)&&!i.areEqual(n[r],t[r]))return!1;for(r in t)if(t.hasOwnProperty(r)&&!i.areEqual(n[r],t[r]))return!1;return!0}return n===t},i._lerp=function(n,t,r){if(typeof n==typeof t)switch(typeof n){case"object":var f={};for(var u in n)n.hasOwnProperty(u)&&(f[u]=i._lerp(n[u],t[u],r));return f;case"number":return n+(t-n)*r;case"boolean":return r<.5?n:t}},i.cancelAnimation=function(n,t){var r=n[i._animationPrefix+t];r&&(r.onStop&&r.onStop(),r.abort(),n[i._animationPrefix+t]=null)},i.hasAnimation=function(n,t){return!!n[i._animationPrefix+t]},i.animate=function(r,u,f){function w(n){for(var i,t=0;t<e.length;t++)if(i=e[t],i.time>=o*n){l=t===0?p:e[t-1];h=i;c=l.time/o;a=h.time/o;break}}function k(n,t){t=t.value;e&&(t<c||t>a)&&w(t);var o=(t-c)/(a-c),s;s=typeof h.value=="function"?h.value(o):i._lerp(l.value,h.value,o);i.setValue(r,u,s,!0);f.frameCallback&&f.frameCallback(t)}function d(){r[i._animationPrefix+u]=null;f.repeat?s.begin():f.autoReverse?s.reverse():(f.onStop&&f.onStop(),f.onComplete&&f.onComplete())}var y,s;t.assertNotNull(r,"obj");t.assertNotNullOrEmpty(u,"prop");t.assertNotNull(f,"options");t.assertNotNull(f.to===0||f.to||f.keyframes,"options.to or options.keyframes");var b=f.from||i.getValue(r,u),v=f.to,e=f.keyframes,o=f.duration>=0?f.duration:e&&e[e.length-1].time||300;if(i.cancelAnimation(r,u),o===0){i.setValue(r,u,v);return}y=f.easing&&i._easingFuncs[f.easing]||f.easing||i._easingFuncs.basic;s=n.Effects.Storyboard.create([r],{value:0},{value:1},k,o,null,d,y);r[i._animationPrefix+u]=s;s.begin();var p={time:0,value:b},l=p,h={time:o,value:v},c=0,a=1;e&&w(0)},i.addPropertyValue=function(n,t,r){var u=i.getValue(n,t)||"",o,f,s,e;if(r&&typeof u=="string"){for(o=r.split(/\s+/),f=0,s=o.length;f<s;f++)e=o[f],i._propertyContainsValues(u,[e])||(u===""?u=e:u+=" "+e);i.setValue(n,t,u)}},i.propertyHasValues=function(n,t,r){var u=i.getValue(n,t);return!r||!u||typeof u!="string"?!1:i._propertyContainsValues(u,r.split(/\s+/))},i.removePropertyValue=function(n,t,r){i.swapPropertyValue(n,t,r,"$1")},i.swapPropertyValue=function(n,t,r,u){var f=i.getValue(n,t),o,e,s,h;if(r&&u&&typeof f=="string"){for(u!=="$1"&&(u=" "+u+" "),o=r.split(/\s+/),e=0,s=o.length;e<s;e++)h=new RegExp("(^| )"+o[e]+"( |$)"),f=f.replace(h,u);i.setValue(n,t,f.replace(/^\s+|\s+$/g,""))}},i._propertyContainsValues=function(n,t){var r,i,u;if(!n)return!1;for(r=" "+n+" ",i=0,u=t.length;i<u;i++)if(r.indexOf(" "+t[i]+" ")===-1)return!1;return!0},i._animationPrefix="__animation_",i._gimmeConstructor=n("").constructor,i._easingFuncs={linear:function(n){return n},basic:function(n){return n},exponentialOut:function(t){return n.Effects.Easing.Exponential.ease_out(t,4)},exponentialInOut:function(t){return n.Effects.Easing.Exponential.ease_in_out(t,16)}},i}();String.prototype.endsWith||(String.prototype.endsWith=function(n,t){return(t===undefined||t>this.length)&&(t=this.length),this.substring(t-n.length,t)===n});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.replaceAll||(String.prototype.replaceAll=function(n,t){for(var i=this,r=i.indexOf(n);r!==-1;)i=i.replace(n,t),r=i.indexOf(n);return i}),function(u){function wt(n,t,i){return Math.min(Math.max(n,t),i)}function bt(n){for(var i,r={},u=Object.keys(n),t=0,f=u.length;t<f;t++)i=u[t],r[i]=n[i];return r}function kt(t){var i=document.createElement(t);return n(i)}function dt(n){return typeof n=="string"?n.toLowerCase()==="true":!!n}function gt(n){var t=n*720;return Math.ceil(t)}function ni(n){for(var i=0,t=n.length;t--;)n[t]=i+=n[t]}function ti(n){for(var i,r=["imageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","webkitImageSmoothingEnabled"],t=0,u=r.length;t<u;t++)if(i=r[t],n[i]){n[i]=!1;break}}function ii(t,i,u){var f,e,o;return u=u||{},f=new r,e=function(n){var i;if(u.preventDefault&&n.preventDefault(),u.stopPropagation&&n.stopPropagation(),i={},typeof n.pageX=="number"){var r=t.get_absolute_pos(),e=n.pageX-r.x,o=n.pageY-r.y;i.point={x:e,y:o}}typeof n.wheelDelta=="number"?i.wheelDelta=n.wheelDelta/120:typeof n.detail=="number"&&(i.wheelDelta=-n.detail);typeof n.keyCode=="number"&&(i.keyCode=n.keyCode);i.target=n.target;u.argBuilder&&u.argBuilder(i,n);f.invoke(i)},t.add_event(i,e),o="jsEvent"+i+"_"+n.Helper.get_guid(e),t[0]&&(t[0][o]=e),f.id=o,f}function ri(n,t,i){var r=n[0];r&&(n.remove_event(t,r[i]),delete r[i])}function f(n){return typeof Array.isArray=="function"?Array.isArray(n):Object.prototype.toString.call(n)==="[object Array]"}function ui(n,t){var r=[],i,u;if(!n)return r;for(i=0,u=n.length;i<u;i++)n[i]===t&&r.push(i);return r}function fi(n){return n}function ut(n,t,i,r){var u,o;r===void 0&&(r=v.getValue);for(var s=r(t,i),e=0,f=n.length-1,h=-1;e<=f;)u=(e+f)/2|0,o=r(n[u],i),o===s?(h=u,f=u-1):o>s?f=u-1:e=u+1;return h}function ft(n,t,i,r){var f,o;r===void 0&&(r=v.getValue);for(var s=r(t,i),u=0,e=n.length;e>u;)f=(u+e)/2|0,o=r(n[f],i),o<=s?u=f+1:e=f;return u}function ei(n,t,i,r){var u,f,e;if(r===void 0&&(r=v.getValue),u=ut(n,t,i,r),f=n.length,u>=0)for(e=r(t,i);u<f;)if(t===n[u])n.splice(u,1),f--;else if(r(n[u],i)!==e)break;else u++}function oi(n,t,i,r){r===void 0&&(r=v.getValue);var u=ft(n,t,i,r);return n.splice(u,0,t),u}function si(n){for(var t,i,f=[],r=1;r<arguments.length;r++)f[r-1]=arguments[r];if(n&&f){var e=/\d+/g,u=n.match(/{\d+}/g);if(u)for(t=0;t<u.length;t++)i=f[Number(u[t].match(e)[0])],(i===null||typeof i=="undefined")&&(i=""),n=n.replace(u[t],i)}return n}function hi(n,t){var r=n,u,i,f;if(r&&t)for(u=Object.keys(t),i=0,f=u.length;i<f;i++)r=r.replace(u[i],t[u[i]]);return r}function ci(t){var i=u._createElement("img")[0],e=window.document.body,r,f,o;return e&&(i.className=t,i.style.display="none",e.appendChild(i),r=n(i).get_style("background-image"),e.removeChild(i),r==="none"&&(f=u._createElement("div")[0],f.className="MicrosoftMap",f.style.display="none",e.appendChild(f),f.appendChild(i),r=n(i).get_style("background-image"),e.removeChild(f)),r&&(o=r.substring(4,r.length-1),i.src=o.replace(/"/g,"")),i.className=""),i}function li(n,t,i){var f=i||y.L_AreaFieldString,r=y.L_FormatFieldString.replace("{0}",f),u;return n<0?r.replace("{1}",y.L_IncorrectValue_text):(u=et(n,t),r.replace("{1}",u))}function et(n,t){var i=n/1e6;return t||(i*=.385641),ot(i,t)}function ot(n,t){var i,r=1;return t?n<.1?(n*=1e6,i=y.L_DistanceUnitMetersSquare_Text,r=0):i=y.L_DistanceUnitKmSquare_Text:n<.1?(n*=27878400,i=y.L_DistanceUnitFeetSquareShort_Text,r=0):i=y.L_DistanceUnitMilesSquareShortText_Text,u._formatString(y.L_Distance_Format,u._toFixed(n,r),i)}function ai(n,t,i){var f=i||y.L_LengthFieldString,r=y.L_FormatFieldString.replace("{0}",f),u;return n<0?r.replace("{1}",y.L_IncorrectValue_text):(u=st(n,t),r.replace("{1}",u))}function st(n,t){return n/=t?1e3:1609.34,ht(n,t)}function ht(n,t,i){var r,f=1,e=n>=50&&i;return n=n&&e?Math.round(n):n,t?n<.1?(n*=1e3,r=y.L_DistanceUnitMeters_Text,f=0):r=y.L_DistanceUnitKm_Text:n<.1?(n*=5280,r=y.L_DistanceUnitFeetShort_Text,f=0):r=y.L_DistanceUnitMilesShortText_Text,u._formatString(y.L_Distance_Format,u._toFixed(n,e?0:f),r)}function vi(n,t){return u._formatString(y.L_LatLon_Format,u._toFixed(n,6),u._toFixed(t,6))}function yi(n,t){return n.toFixed(t).replace(".",e.GlobalConfig.dynamicProperties.cultureData.numberDecimalSeparator)}function pi(){return window.xD&&window.xD.now?window.xD.now():Date&&Date.now?Date.now():(new Date).getTime()}function p(n,t,i){var r=t+t;return n.indexOf(r)<0?n.replace(t,i):n.replace(r,(i<10?"0":"")+i)}function wi(n,t){return a(n,i.dynamicProperties.cultureData.shortDatePattern,t)}function bi(n){return a(n,i.dynamicProperties.cultureData.longDatePattern)}function ki(n){var t=i.dynamicProperties.cultureData.longDatePattern;return t=t.replace("dddd","ddd"),t=t.replace("MMMM","MMM"),a(n,t)}function di(n){return a(n,i.dynamicProperties.cultureData.yearMonthPattern,!1,!0)}function gi(n){return a(n,i.dynamicProperties.cultureData.weekMonthDayPattern)}function nr(n,t){t===void 0&&(t=!1);var f=t?Math.ceil(n/60):Math.round(n/60),i=f%60,r=Math.floor(f/60);return r===0?u._formatString(y.L_Duration_Min,i):i===0?u._formatString(y.L_Duration_NoMin,r):u._formatString(y.L_Duration,r,i)}function tr(n){return u._formatShortTimeString(n.getHours(),n.getMinutes(),n.getSeconds())}function ir(n){return u._formatShortTimeString(n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds())}function rr(n,t,i){var u=e.GlobalConfig.dynamicProperties.cultureData,f,o,r=u.shortTimePattern,s=r.indexOf("H")<0;return s?(o=n>=12,n=rf(n),f="h"):f="H",r=p(r,f,n),r=p(r,"m",t),r=p(r,"s",i),s&&(r=r.replace("tt",o?u.pmDesignator:u.amDesignator)),r.replace(/:/g,u.timeSeparator)}function ur(n){return u._formatUTCTimeString(new Date(u._getTime(n)))}function fr(n){var t=n.match(/\((\d+)([-,+]?)(\d{2})?(\d{2})?\)/),i;if(t&&t[1]&&(i=parseInt(t[1],10),t[2]&&t[3]&&t[4])){var f=t[2]==="-"?-1:1,r=parseInt(t[3],10),u=parseInt(t[4],10);isNaN(r)||isNaN(u)||(i+=f*(r*60+u)*6e4)}return i}function er(){function n(){return((1+Math.random())*65536|0).toString(16).substr(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function o(n,t,i){i===void 0&&(i=!0);var f=encodeURI(t).replace(/[\.\(\)\*\+]/g,"\\$&"),e="^(?:.*[&\\?]"+f+"=([^&]*))?.*$",r=new RegExp(e,"i").exec(n.search),u=r&&r[1]||"";return i?decodeURIComponent(u):u}function d(n){var t=n.bounds||n.b;return f(t)}function g(n){var t=n.bounds||n.b;return f(t)?f(n.x)?f(n.y)?!0:!1:!1:!1}function nt(n){var u=n.bounds||n.b,t,i,r;if(!f(u)||(t=n.rings||n.r,!f(t)))return!1;for(i=t.length-1;i>=0;){if(r=t[i],!f(r.x)||!f(r.y))return!1;--i}return!0}function h(n,t){if(n===t)return!0;if(!n||!t||n.length!==t.length)return!1;for(var i=n.length-1;i>=0;){if(n[i]!==t[i])return!1;--i}return!0}function or(n,i,r){var y,p,o,s,c,l,a,v,f,e,u,w,b,k,tt;if(n===i)return!0;if(!n||!i||(y=n.bounds||n.b,p=i.bounds||i.b,!h(y,p)))return!1;switch(r){case 1:if(o=n,s=i,t.assert(d(o),"Invalid point geometry"),t.assert(d(s),"Invalid point geometry"),o.x!==s.x||o.y!==s.y)return!1;break;case 2:if((c=n,l=i,t.assert(g(c),"Invalid line geometry"),t.assert(g(l),"Invalid line geometry"),!h(c.x,l.x))||!h(c.y,l.y))return!1;break;case 3:if(a=n,v=i,t.assert(nt(a),"Invalid area geometry"),t.assert(nt(v),"Invalid area geometry"),f=a.rings||a.r,e=v.rings||v.r,!f||!e)throw Error("Invalid area geometry - no rings property");if(f.length!==e.length)return!1;for(u=f.length-1;u>=0;){if((w=f[u].x,b=e[u].x,!h(w,b))||(k=f[u].y,tt=e[u].y,!h(k,tt)))return!1;--u}break;case 0:default:throw Error("Cannot compare geometries - Invalid geometry type");}return!0}function sr(n,t){return n===t?!0:!n||!t?!1:n.id===t.id}function hr(n,t){return n===t}function cr(){return o(window.location,"stlVersion")}function lr(){var n=o(window.location,"perftest");return n==="true"||n==="1"}function ar(){var n=o(window.location,"lowmem");return n==="true"||n==="1"}function vr(){var n=o(window.location,"polygon");return n?parseInt(n):null}function yr(){return["A78CB71D-32CA-4F6D-8827-09680717E455","377378F5-A47F-44B6-A250-D36ED9875A08","5DC8415C-7423-485A-A383-2A5235ECB201"]}function ct(){if(!i.isMapsVertical)return!1;var n=i.features.seasonal,t=pt("sads","sade",n.seasonalAvailableDateStart,n.seasonalAvailableDateEnd);return t&&uf()}function pr(){if(!i.isMapsVertical)return!1;var n=i.features.seasonal,t=pt("sdds","sdde",n.seasonalDefaultDateStart,n.seasonalDefaultDateEnd);return t&&ct()}function wr(){var n=parseFloat(o(window.location,"dpr"));return n||window.devicePixelRatio||1}function br(){return window.matchMedia("(-ms-high-contrast:active)").matches}function kr(n,t){if(n&&n!==16777215&&n!==4294967295){for(var i=n.toString(16);i.length<6;)i="0"+i;return i.length===8&&(i=i.substr(2)),"#"+i}return t||""}function dr(n){var t=(n&16711680)>>16,i=(n&65280)>>8,r=n&255;return(t*.299+i*.587+r*.114)/256}function gr(){var n=s();return n&&n.dynamicProperties?n.isMapsAnswer&&n.dynamicProperties.largeMapShownOnSerp:!1}function nu(){var n=s();return n&&n.dynamicProperties?n.isMapsAnswer&&!n.dynamicProperties.largeMapShownOnSerp:!1}function tu(){var n=s(),t=n&&n.dynamicProperties;return t?n.isMapsAnswer&&t.localOverlayOnSerp&&t.localOverlayOnSerp.visible:!1}function iu(){var n=s(),t=n&&n.dynamicProperties;return t?n.isMapsAnswer&&t.realEstateOverlayOnSerp&&t.realEstateOverlayOnSerp.visible:!1}function ru(){var n=s(),t=n&&n.dynamicProperties;return t?n.isMapsAnswer&&t.localOverlayOnSerp&&t.localOverlayOnSerp.isNearbyScenario:!1}function uu(){var n=s(),t=n&&n.dynamicProperties;return t?n.isMapsAnswer&&t.travelOverlayOnSerp&&t.travelOverlayOnSerp.visible:!1}function fu(){var t=!0,n=s();return n&&(n.isMapsAnswer||n.isMapsVertical)&&(t=!1),t}function eu(){return u._isLocalOverlayShownOnSerp()||u._isRealEstateOverlayShownOnSerp()}function ou(){return i.features.taskFramework.renderNewCardHeaderStyle}function su(n){var r,f,t,u,i;if(n)if(Array.isArray(n)){for(r=n,t=0,u=r.length;t<u;t++)i=r[t],i&&i.dispose&&i.dispose();r.length=0}else for(f=Object.keys(n),t=0,u=f.length;t<u;t++)i=n[f[t]],i&&i.dispose&&i.dispose(),delete n[f[t]]}function hu(n){if(n)for(var t in n)n.hasOwnProperty(t)&&n[t]instanceof r&&(n[t].dispose&&n[t].dispose(),delete n[t])}function cu(n){var t,i,r;if(n)for(t in n)n.hasOwnProperty(t)&&(i=n[t],i&&(r=typeof i,r!=="function"&&(f(i)?n[t]=[]:r==="object"&&(n[t]=null))))}function lu(n){var t=n.charAt(n.length-1),i=parseInt(t)%2;return i!==NaN&&(t=i.toString()),t}function au(){var t=Microsoft.Maps.GlobalConfig.features.taskFramework;return typeof u._isSlideCardEnabled=="undefined"&&(u._isSlideCardEnabled=t&&t.slideoutEnabled&&n("body")[0].clientWidth>=t.slideoutMinWidth),u._isSlideCardEnabled}function lt(n){var t=Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig;return t&&t.features[n]&&t.features[n].isEnabled}function vu(n){var i=Microsoft&&Microsoft.Maps&&Microsoft.Maps.Internal,t;return i?(t=i._CoreConfig(),n.replace("{protocol}",t.urlProtocol).replace("{tfeDomainDynamic}",t.tfeDomainDynamic).replace("{tfeDomainStatic}",t.tfeDomainStatic)):n}function yu(n,t){var i=n,r;return t&&(r=t.searchQueryCategory||t.selectedCategoryId||t.category,n==="LocalListingTask"?Microsoft.Maps.GlobalConfig.features.localSearch.enableCustomHotelsExperience&&it(r)?i="HotelsListingTask":tt(r)?i="HouseListingTask":Microsoft.Maps.GlobalConfig.features.localSearch.enableCustomRestaurantsExperience&&rt(r)?i="RestaurantsListingTask":lt("verticalZipcode")&&at(r)&&(i="PolygonListingTask"):n==="LocalDetailsTask"&&(Microsoft.Maps.GlobalConfig.features.localSearch.enableCustomHotelsExperience&&it(r)?i="HotelsDetailsTask":tt(r)?i="HouseDetailsTask":Microsoft.Maps.GlobalConfig.features.localSearch.enableCustomRestaurantsExperience&&rt(r)&&(i="RestaurantDetailsTask"))),i}function tt(n){return w(n,["house"])}function it(n){return w(n,["91572","13344","hotel"])}function rt(n){return w(n,["90287","90232","restaurant","food & drink","food & dining"])}function at(n){return w(n,["zipcode","ZipCode"])}function pu(n){var t=tf();return t&&t[n]}function wu(n){for(var t,r,u=f(n)?n:[n],e=[],i=0;i<u.length;i++)t=u[i],r=t&&t.entity&&t.entity.id,r&&e.push(r);return e}function bu(n){for(var r=0,t=0,i=0;i<n.length;i++)r+=n.charCodeAt(i)<<t,t++,t>6&&(t=0);return r.toString(16)}function ku(n){var t,r,u;return i.isMapsAnswer?t=!1:(vt(),r=n&&n.bucket,u=n&&n.entity&&n.entity.poiType,t=l[u]||c[r]),t}function du(){return i.isMapsAnswer?!1:(vt(),b||k)}function gu(){c={};l={};b=k=!1}function nf(t){var i=n("#id_h"),r;i.length>0&&(r=i.get_style("display"),t&&r==="none"?i.set_style({display:""}):t||r==="none"||i.set_style({display:"none"}))}function vt(){var t,r,n,u;if((!c||!l)&&(c={},l={},t=i.features.labels,t)){if(t.glRenderingBuckets)for(r=t.glRenderingBuckets.split(","),n=0;n<r.length;n++)r[n]&&(c[r[n]]=!0,b=!0);if(t.glRenderingPoiTypes)for(u=t.glRenderingPoiTypes.split(","),n=0;n<u.length;n++)u[n]&&(l[u[n]]=!0,k=!0)}}function tf(){var n=Microsoft&&Microsoft.Maps&&Microsoft.Maps.Internal;return n&&n._CoreConfig&&n._CoreConfig()}function rf(n){return n>12?n-=12:n||(n=12),n}function a(n,t,r,u){for(var e,v=i.dynamicProperties.cultureData,o=[],s=-1,h=t.length,f=0;f<h;f++){var l=t.charAt(f),c="'/dMy".indexOf(l),a=c>=0;if(s<0&&!a&&(s=f),s>=0&&(a||f===h-1)&&(o.push(t.substring(s,a?f:f+1)),s=-1),c===0){for(e=f+1;e<h&&t.charAt(e)!=="'";e++);o.push(t.substring(f+1,e));f=e}else if(c===1)o.push(v.dateSeparator);else if(c>1){for(e=f+1;e<h&&t.charAt(e)===l;e++);o.push(ff(l,e-f,n,r,u));f=e-1}}return o.join("")}function s(){return Microsoft&&Microsoft.Maps&&Microsoft.Maps.GlobalConfig}function w(n,t){var i,r,u;if(n&&t&&(i=n.split("."),i&&i.length))for(r=0,u=i.length;r<u;r++)if(i[r]&&t.indexOf(i[r].toLowerCase())>-1)return!0;return!1}function uf(){var n=o(window.location,"seasonal");return n==="true"||n==="1"||!!i.features.seasonal.isEnabled}function yt(n,t){return!(isNaN(n)||isNaN(t)||t<=n)}function ff(n,t,r,u,f){var o=i.dynamicProperties.cultureData,e,c,s,h;switch(n){case"d":t>3?e=o.dayNames[u?r.getUTCDay():r.getDay()]:t===3?e=o.abbreviatedDayNames[u?r.getUTCDay():r.getDay()]:(c=u?r.getUTCDate():r.getDate(),e=(c<10&&t>1?"0":"")+c);break;case"M":s=u?r.getUTCMonth():r.getMonth();t>3?(o.monthGenitiveNames&&!f&&(e=o.monthGenitiveNames[s]),e&&e.length||(e=o.monthNames[s])):t===3?(o.abbreviatedMonthGenitiveNames&&!f&&(e=o.abbreviatedMonthGenitiveNames[s]),e&&e.length||(e=o.abbreviatedMonthNames[s])):(++s,e=(s<10&&t>1?"0":"")+s);break;case"y":h=u?r.getUTCFullYear():r.getFullYear();t>2?e=h.toString():(h%=100,e=(h<10&&t>1?"0":"")+h);break;default:e=""}return e}function pt(n,t,i,r){var u=Date.parse(o(window.location,n)),f=Date.parse(o(window.location,t)),e=yt(u,f),h,s;return(e||(u=Date.parse(i),f=Date.parse(r),e=yt(u,f)),!e)?!1:(h=new Date,s=h.getTimezoneOffset()*6e4,Date.now()>=u+s&&Date.now()<f+s)}var c=null,l=null,b=!1,k=!1;u._clamp=wt;u._copyObject=bt;u._createElement=kt;u._convertToBool=dt;u._distanceToWalkTime=gt;u._deltaDecode=ni;u._disableSmoothing=ti;u._defineJSEventForDomEvent=ii;u._undefineJSEventForDomEvent=ri;u._isArray=f;u._allIndexesOf=ui;u._identityKey=fi;u._getFirstIndex=ut;u._getInsertionIndex=ft;u._orderedDelete=ei;u._orderedInsert=oi;u._formatString=si;u._replaceValues=hi;u._getImageFromCss=ci;u._createAreaText=li;u._readableTextFromArea=et;u._formatAreaString=ot;u._createLengthText=ai;u._readableTextFromDistance=st;u._formatDistanceString=ht;u._formatLatLonString=vi;u._toFixed=yi;u._getCurrentTimeStamp=pi;u._format2Digit=p;u._formatShortDateString=wi;u._formatLongDateString=bi;u._formatAbbrevLongDateString=ki;u._formatYearMonthString=di;u._formatWeekMonthDayString=gi;u._formatDurationString=nr;u._formatTimeString=tr;u._formatUTCTimeString=ir;u._formatShortTimeString=rr;u._getTimeString=ur;u._getTime=fr;u._generateRandomKey=er;u._getUrlParam=o;u._isValidPointGeometry=d;u._isValidLineGeometry=g;u._isValidAreaGeometry=nt;u._areArraysEqual=h;u._areGeometriesEqual=or;u._areEntitiesEqual=sr;u._arePrimitivesEqual=hr;u._getStlVersion=cr;u._isPerformanceTest=lr;u._lowMem=ar;u._getPolygonId=vr;u._getUserstudyStyles=yr;u._isMapTypeSeasonalAvailable=ct;u._isMapTypeSeasonalDefault=pr;u._getDpr=wr;u._isHighContrastMode=br;u._formatHexColorString=kr;u._calcLuminance=dr;u._isLargeMapShownOnSerp=gr;u._isSmallMapShownOnSerp=nu;u._isLocalOverlayShownOnSerp=tu;u._isRealEstateOverlayShownOnSerp=iu;u._isNearbyScenarioForLocalOverlayOnSerp=ru;u._isTravelOverlayShownOnSerp=uu;u._isMapsSDK=fu;u._isLocalOrRealEstateScenarioOverlayShownOnSerp=eu;u._isNewCardHeaderStyleEnabled=ou;u._clearDisposables=su;u._disposeEvents=hu;u._nullifyClass=cu;u._getTileSubDomain=lu;u._getIsSlideCardEnabled=au;u._isFeatureEnabled=lt;u._updateTfeUrlDomain=vu;u._overrideTasktypeBasedOnCategory=yu;u._isHouseCategory=tt;u._isHotelsCategory=it;u._isRestaurantCategory=rt;u._isZipCodeCategory=at;u._isCoreConfigSettingEnabled=pu;u._getPrimitiveIds=wu;u._getHash=bu;u._renderGL=ku;u._renderGLEnabled=du;u._disableRenderGL=gu;u._showOrHideOverlayMenu=nf}(u||(u={}));var st=function(){function n(n,t,i){this.position=n;this.value=t;this.tangentOutType=i}return n}(),ht=function(){function n(){this._CurveEpsilon=1192093e-13;this._keys=[]}return n.prototype.addKey=function(n){this._keys.push(n);this._tangentCalculated=!1},n.prototype.computeTangents=function(){if(!this._tangentCalculated){for(var n=0;n<this._keys.length;n++)this.computeTangent(n);this._tangentCalculated=!0}},n.prototype.computeTangent=function(n){var r,u,s,h;if(this._keys.length<=n||n<0)throw"Index out of range";var t=this._keys[n],c=t.tangentOutType,l=n>0?this._keys[n-1].tangentOutType:c,f=h=u=t.position,e,o=s=r=t.value,i;n>0&&(f=this._keys[n-1].position,o=this._keys[n-1].value);n+1<this._keys.length&&(u=this._keys[n+1].position,r=this._keys[n+1].value);l===1?(e=u-f,i=r-o,t.tangentInValue=Math.abs(i)<this._CurveEpsilon?0:i*Math.abs(f-h)/e):t.tangentInValue=l===0?s-o:0;c===1?(e=u-f,i=r-o,t.tangentOutValue=Math.abs(i)<this._CurveEpsilon?0:i*Math.abs(u-h)/e):t.tangentOutValue=c===0?r-s:0},n.prototype.evaluate=function(n){if(this._keys.length===0)return 0;if(this._keys.length===1)return this._keys[0].value;if(!this._tangentCalculated)throw"Curve tangents have not been precalculated.";if(this._lastValue&&this._lastValue.position===n)return this._lastValue.value;var i=this._keys[0],r=this._keys[this._keys.length-1],t;return t=n<i.position?i.value:r.position<n?r.value:0+this.hermite(n),this._lastValue={position:n,value:t},t},n.prototype.hasValueAt=function(n){return this._keys.length===0?!1:this._keys.length===1?this._keys[0].position===n:this._keys[0].position<=n&&n<=this._keys[this._keys.length-1].position},n.prototype.getHasValue=function(){return this._keys.length>0},n.prototype.hermite=function(n){var u,o,s;if(this._keys.length<2)throw"More than one value is required";var e=n,i=this._keys[0],t=null;for(u=1;u<this._keys.length;u++){if(t=this._keys[u],t.position>=n){o=i.position;s=t.position-o;e=0;s>1e-10&&(e=(n-o)/s);n=e;break}i=t}if(i.tangentOutType===2)return n>=1?t.value:i.value;var r=n*n,f=r*n,h=i.value,c=i.tangentOutValue,l=t.tangentInValue;return h*(2*f-3*r+1)+t.value*(-2*f+3*r)+c*(f-2*r+n)+l*(f-r)},n}(),bt=function(){function n(n,t){if(n instanceof Array)this._populateColorComponents(n);else switch(t){case 1:case 2:this._parseHex(n,t);break;case 0:this._parseRgba(n);break;case 3:this._unpackColor(n)}}return n.parse=function(t,i){var u,r=n._getColorFormat(t);return r!==undefined?(r===1&&i===2&&(r=2),u=new n(t,r)):u=n._parseViaBrowser(t),u},n.prototype.toRgba=function(){return this.alpha<1?"rgba("+this.red+","+this.green+","+this.blue+","+d.roundToInterval(this.alpha,.01)+")":"rgb("+this.red+","+this.green+","+this.blue+")"},n._getColorFormat=function(t){var i;return t=t||"",t[0]!=="#"||t.length!==7&&t.length!==9||isNaN(parseInt(t.slice(1),16))?t.match(n.rgbRegex)&&(i=0):i=1,i},n._parseViaBrowser=function(t){var u,i,r;return t&&(i=document.createElement("div"),r=document.body,i.style.display="none",i.style.color=t,i.style.color&&(r.appendChild(i),t=getComputedStyle(i).color,r.removeChild(i),t&&t.match(n.rgbRegex)&&(u=new n(t,0)))),u},n.prototype._parseHex=function(n,i){var r=parseInt(n.slice(1),16);n.length===9?i===2?this.alpha=(r>>24&255)/255:(this.alpha=(r&255)/255,r=r>>8):this.alpha=1;this.red=r>>16&255;this.green=r>>8&255;this.blue=r&255;t.assert(!isNaN(this.red),"red color is not as expected");t.assert(!isNaN(this.green),"green color is not as expected");t.assert(!isNaN(this.blue),"blue color is not as expected")},n.prototype._parseRgba=function(t){var i=t&&t.match&&t.match(n.rgbRegex);i&&i.length>4&&this._populateColorComponents(i.slice(1))},n.prototype._populateColorComponents=function(n){n&&n.length>=3&&(this.red=parseInt(n[0]),t.assert(!isNaN(this.red),"red color is not as expected"),this.green=parseInt(n[1]),t.assert(!isNaN(this.green),"green color is not as expected"),this.blue=parseInt(n[2]),t.assert(!isNaN(this.blue),"blue color is not as expected"),n.length>3&&n[3]!==undefined?(this.alpha=parseFloat(n[3]),t.assert(!isNaN(this.alpha),"alpha color is not as expected")):this.alpha=1)},n.prototype._unpackColor=function(n){var t=parseInt(n);this.red=t>>16&255;this.green=t>>8&255;this.blue=t&255;this.alpha=d.roundToInterval((t>>24&255)/255,.01)},n.transparent="rgba(255, 255, 255, 0.0)",n.white="rgb(255, 255, 255)",n.black="rgb(0, 0, 0)",n.rgbRegex=/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/,n}(),dr=function(){function n(n,t,i,r){this.x=n;this.y=t;this.z=i;this.w=r}return n}(),ki=function(){function n(){this._curveX=new ht;this._curveY=new ht;this._curveZ=new ht;this._curveW=new ht}return n.prototype.addKey=function(n,t,i,r,u,f){this._curveX.addKey(new st(n,t,f));this._curveY.addKey(new st(n,i,f));this._curveZ.addKey(new st(n,r,f));this._curveW.addKey(new st(n,u,f))},n.prototype.computeTangents=function(){this._curveX.computeTangents();this._curveY.computeTangents();this._curveZ.computeTangents();this._curveW.computeTangents()},n.prototype.evaluateCurve=function(n){return new dr(this._curveX.evaluate(n),this._curveY.evaluate(n),this._curveZ.evaluate(n),this._curveW.evaluate(n))},n}(),gr=function(n){function t(){return n.call(this)||this}return k(t,n),t.prototype.addKey=function(t,i,r,u,f,e){var l=i/255,h=r/255,c=u/255,p=f,a=0,y=0,v=0,o=Math.max(c,Math.max(l,h)),s=Math.min(c,Math.min(l,h));o===s?a=0:o===l&&h>=c?a=60*((h-c)/(o-s)):o===l&&h<c?a=60*((h-c)/(o-s))+360:o===h?a=60*((c-l)/(o-s))+120:o===c&&(a=60*((l-h)/(o-s))+240);v=.5*(o+s);o===s?y=0:v<=.5?y=(o-s)/(2*v):v>.5&&(y=(o-s)/(2-2*v));n.prototype.addKey.call(this,t,a/360,ct.clamp(y,0,1),ct.clamp(v,0,1),ct.clamp(p,0,1),e)},t.prototype.evaluate=function(t){var i=n.prototype.evaluateCurve.call(this,t);return ct.hslaTorgba(i.x,i.y,i.z,i.w)},t.prototype.evaluateHsla=function(t){return n.prototype.evaluateCurve.call(this,t)},t}(ki),ct=function(){function n(){}return n.getComponent=function(n,t,i){return n<1/6?t+(i-t)*6*n:n<.5?i:n<2/3?t+(i-t)*6*(2/3-n):t},n.normalize=function(n){return n<0&&(n+=1),n>1&&(n-=1),n},n.clamp=function(n,t,i){return n<t?t:n>i?i:n},n.applyHslaTransform=function(t,i){var r=t.x+i.x;r>1&&(r-=1);var u=n.clamp(t.y+i.y,0,1),f=n.clamp(t.z+i.z,0,1),e=n.clamp(t.w+i.w,0,1);return{x:r,y:u,z:f,w:e}},n.hslaTorgba=function(t,i,r,u){var f=r<.5?r*(1+i):r+i-r*i;var e=2*r-f,o=n.getComponent(n.normalize(t+1/3),e,f),s=n.getComponent(n.normalize(t),e,f),h=n.getComponent(n.normalize(t-1/3),e,f);return new bt([n.clamp(Math.round(o*255),0,255),n.clamp(Math.round(s*255),0,255),n.clamp(Math.round(h*255),0,255),n.clamp(u,0,1)])},n.convertPackedTorgba=function(n){var t=new bt(n,3);return t.toRgba()},n}(),nu=function(){function n(n,t,i){this.start=n;this.end=t;this.value=i}return n}(),tu=function(){function n(){this._ranges=[]}return n.prototype.addRange=function(n,t,i){this._ranges.push(new nu(n,t,i))},n.prototype.evaluate=function(n){for(var i,t=0;t<this._ranges.length;t++)if(i=this._ranges[t],i.start<=n&&i.end>=n)return i.value;return null},n.prototype.hasValueAt=function(n){for(var i,t=0;t<this._ranges.length;t++)if(i=this._ranges[t],i.start<=n&&i.end>=n)return!0;return!1},n.prototype.getHasValue=function(){return this._ranges.length>0},n}(),di=function(){function n(n,t,i,r,u,f){this._values=[n,t,i,r,u,f]}return n.prototype.invert=function(){var i=this._values,r=i[0],u=i[1],f=i[2],e=i[3],o=i[4],s=i[5],t=r*e-u*f;if(t===0)throw"Determinant is zero";return new n(e/t,-u/t,-f/t,r/t,(f*s-e*o)/t,(u*o-r*s)/t)},n.prototype.multiply=function(t){var i=this._values,r=i[0],u=i[1],f=i[2],e=i[3],v=i[4],y=i[5];i=t.getValues();var o=i[0],s=i[1],h=i[2],c=i[3],l=i[4],a=i[5];return new n(r*o+f*s,u*o+e*s,r*h+f*c,u*h+e*c,v+r*l+f*a,y+u*l+e*a)},n.prototype.transform=function(n){return new c(this.projectX(n.x,n.y),this.projectY(n.x,n.y))},n.prototype.projectX=function(n,t){var i=this._values;return n*i[0]+t*i[2]+i[4]},n.prototype.projectY=function(n,t){var i=this._values;return n*i[1]+t*i[3]+i[5]},n.prototype.scale=function(t,i){var r=this._values;return new n(r[0]*t,r[1]*i,r[2]*t,r[3]*i,r[4]*t,r[5]*i)},n.prototype.translate=function(t,i){var r=this._values;return new n(r[0],r[1],r[2],r[3],r[4]+t,r[5]+i)},n.prototype.rotate=function(t){if(t===0)return this;var i=this._values,r=Math.cos(t),u=Math.sin(t),f=i[0],e=i[2],o=i[4],s=f*r-i[1]*u,h=f*u+i[1]*r,c=e*r-i[3]*u,l=e*u+i[3]*r,a=o*r-i[5]*u,v=o*u+i[5]*r;return new n(s,h,c,l,a,v)},n.prototype.getValues=function(){var n=this._values;return[n[0],n[1],n[2],n[3],n[4],n[5]]},n.prototype.equals=function(n){var i=n&&n.getValues(),t;if(i&&i.length===6){for(t=0;t<6;t++)if(this._values[t]!==i[t])return!1;return!0}return!1},n.prototype.nearlyEquals=function(n,t){var r=n&&n.getValues(),i;if(r&&r.length===6){for(i=0;i<6;i++)if(Math.abs(this._values[i]-r[i])>t)return!1;return!0}return!1},n.prototype.getZoomDirection=function(){var n=this.getValues();return n[0]<.9999||n[3]<.9999?-1:n[0]>1.0001||n[3]>1.0001?1:0},n.identity=new n(1,0,0,1,0,0),n}(),it=function(){function n(n){this.revision=0;this.changed=new r;n&&Array.prototype.push.apply(this,n)}return n.prototype._invokeChanged=function(n,t,i,r,u){this.revision++;this.changed&&this.changed.invoke({addedIndex:n,added:t,removedIndex:i,removed:r,reset:u===!0})},n.prototype.insert=function(n,t){this.insertAll([n],t)},n.prototype.insertAll=function(n,t){if(n&&n.length){(typeof t!="number"||t<0||t>=this.length)&&(t=this.length);var i=[t,0];i=i.concat(n);Array.prototype.splice.apply(this,i);this._invokeChanged(t,n,null,null)}},n.prototype.remove=function(n){this.removeAt(this.indexOf(n))},n.prototype.removeAt=function(n,t){if(t===void 0&&(t=1),n>=0&&t>=1&&n+t<=this.length){var i=Array.prototype.splice.call(this,n,t);this._invokeChanged(null,null,n,i,this.length===0)}},n.prototype.clear=function(){var n=Array.prototype.splice.call(this,0,this.length);this._invokeChanged(null,null,0,n,!0)},n.prototype.indexOf=function(n,t){return t===void 0&&(t=0),Array.prototype.indexOf.call(this,n,t)},n.prototype.lastIndexOf=function(n,t){return t===void 0&&(t=this.length),Array.prototype.lastIndexOf.call(this,n,t)},n.prototype.slice=function(n,t){return n===void 0&&(n=0),t===void 0&&(t=this.length),Array.prototype.slice.call(this,n,t)},n.prototype.setValue=function(n,t){if(!(n<0)){var i=this[n];this[n]=t;this.length=Math.max(this.length,n+1);this._invokeChanged(n,[t],n,[i])}},n.prototype.find=function(n){for(var i,t=0;t<this.length;t++)if(i=this[t],n(i))return i;return null},n.prototype.dispose=function(){u._clearDisposables(this.slice());u._disposeEvents(this);this.clear()},n}();it.prototype.length=Array.prototype.length;var kt=function(){function n(n){function e(n,t){var r=u[n];u[n]=t;v.areEqual(r,t)||(i.revision++,f[n]&&f[n].call(i,r,t),i.changed&&i.changed.invoke(new lt(i,n,r,t)))}function o(r,o,s,h){function p(){return u[r]}function y(n){s&&(n=s(n,u[r]));e(r,n)}var c,a,l;t.assertNotNullOrEmpty(r,"name");o&&t.assertIsFunction(o,"onChanged");s&&t.assertIsFunction(s,"typeConverter");c=h&&h.defaultValue;a=h&&h.isPrivate?n:i;typeof c!="undefined"&&y(c);l=v.capitalizeProp(r);o&&(f[r]=o);i["get"+l]=p;a["set"+l]=y}function s(){function h(){return null}function c(){}var o=Object.keys(u),t,s,e,r;for(f={},t=0,s=o.length;t<s;t++)e=o[t],r=v.capitalizeProp(e),i["get"+r]=h,i["set"+r]=n["set"+r]=c,u[e]=null;i.changed&&i.changed.dispose()}var i=this,u,f;this.revision=0;n=n||this;this._privates=n;u={};this.changed=new r;f={};n.defineProperty=o;n.undefineProperties=s}return n.prototype.dispose=function(){this._privates&&this._privates.undefineProperties&&this._privates.undefineProperties();this._privates={}},n.fromObject=function(t){var f,r,i,u;if(t instanceof Array){for(f=new it,r=0;r<t.length;r++)f.insert(n.fromObject(t[r]));return f}if(!t||typeof t!="object"||t instanceof n)return t;u=new n;for(i in t)t.hasOwnProperty(i)&&(u.defineProperty(i),v.setValue(u,i,n.fromObject(t[i])));return u},n}(),lt=function(){function n(n,t,i,r){this.sender=n;this.name=t;this.oldValue=i;this.newValue=r}return n}(),oi=function(n){function t(u,f,e,o,s,h,c){var l,a,v;return h===void 0&&(h=!1),c===void 0&&(c=""),l=this,a={},l=n.call(this,a)||this,l._id=u?u:"UserLayer_"+t._id++,l.logWhenAddedOrRemoved=h,l.logId=c,l.isCritical=o,l._disposables=[],v=i.tileRefactoringEnabled,a.defineProperty("zIndex",v?null:function(n,t){return l._invalidateTiles(n,t)},null,{defaultValue:f||0}),a.defineProperty("visible",v?null:function(n,t){return l._invalidateTiles(n,t)},null,{defaultValue:typeof s=="boolean"?s:!0}),a.defineProperty("opacity",v?null:function(n,t){return l._invalidateTiles(n,t)},null,{defaultValue:typeof e=="number"?e:1}),a.defineProperty("renderTarget",v?null:function(n,t){return l._invalidateTiles(n,t)},null,{defaultValue:0}),a.defineProperty("iconOnlyLimit",null,null,{defaultValue:0}),a.defineProperty("highlighted"),a.defineProperty("templateSelector",v?null:function(n,t){return l._onTemplateChanged(n,t)}),l.defineProperty=a.defineProperty,l._disposables.push(l.primitiveTapped=new r,l.primitiveDoubleTapped=new r,l.primitiveHoverStarted=new r,l.primitiveHoverStopped=new r,l.primitiveMoveStarted=new r,l.primitiveMoveContinued=new r,l.primitiveMoveStopped=new r,l.primitiveManipulationStarted=new r,l.primitiveManipulationContinued=new r,l.primitiveManipulationStopped=new r,l.contextMenuInvoked=new r,l.primitivePointerPressed=new r,l.primitivePointerReleased=new r),l.data=[],l.setVisible(!0),l.overlayEvent=1,l}return k(t,n),t.prototype.getId=function(){return this._id},t.prototype.getFrameManager=function(){return this._frameManager},t.prototype.setFrameManager=function(n){this._frameManager=n;this._coreMap=n.getMap()},t.prototype.feed=function(){throw"derived classes to provide implementation";},t.prototype.dispose=function(){this._coreMap&&(this._coreMap.getLayers().remove(this),this._coreMap=null);n.prototype.dispose.call(this);u._clearDisposables(this._disposables);this._frameManager=null;this.data=[];u._disposeEvents(this)},t.prototype._invalidateTiles=function(n,t){var i,u,r;if(n!==t)for(i=0,u=this.data.length;i<u;i++)r=this.data[i],r.getEnabled()&&this.getRenderTarget()===0&&r.tile.invalidateRender()},t.prototype._onTemplateChanged=function(n,t){var i,u,r;if(n!==t)for(i=0,u=this.data.length;i<u;i++)r=this.data[i],r.getEnabled()&&r.setTemplateSelector(t)},t._id=1,t}(kt),gi=function(){function n(t,i,r){var f,o,e,u;if(this._rect=t,this._rotation=i=i||0,this.corners=n._computeCorners(t,i),r)for(f=0,o=this.corners.length;f<o;f++)e=this.corners[f],e.x+=r.x,e.y+=r.y;this.bbox=l.computeBoundingBox(this.corners);u=[l.getVectorDifference2D(this.corners[1],this.corners[0]),l.getVectorDifference2D(this.corners[2],this.corners[1])];this._normals=[l.normalizeVector2D(new c(-u[0].y,u[0].x)),l.normalizeVector2D(new c(-u[1].y,u[1].x))];this._projections=[l.projectOntoAxis(this._normals[0],this.corners),l.projectOntoAxis(this._normals[1],this.corners)]}return n.prototype.intersects=function(n){return this.bbox.intersects(n.bbox)&&this._intersectsOneWay(n)&&n._intersectsOneWay(this)},n.prototype._intersectsOneWay=function(n){for(var i,r,t=0,u=this._normals.length;t<u;t++)if(i=this._projections[t],r=l.projectOntoAxis(this._normals[t],n.corners),i.min>r.max||i.max<r.min)return!1;return!0},n._computeCorners=function(n,t){var r=n.getCorners(),u,i,f;if(t!==0)for(u=di.identity.rotate(t),i=0,f=r.length;i<f;i++)r[i]=u.transform(r[i]);return r},n}(),dt=function(){function n(n,t){this.minPoint=n;this.maxPoint=t}return n.empty=function(){return new n(null,null)},n.fromPoints=function(){for(var e,l,i,a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];var h=(u._isArray(arguments[0])?arguments[0]:arguments)||[],t=Number.MAX_VALUE,f=t,o=-t,s=-f;for(e=0,l=h.length;e<l;e++)(i=h[e],i)&&(t=Math.min(t,i.x),f=Math.min(f,i.y),o=Math.max(o,i.x),s=Math.max(s,i.y));return t===Number.MAX_VALUE?n.empty():new n(new c(t,f),new c(o,s))},n.fromSides=function(t,i,r,u){var f=Math.min(t,i),e=Math.max(t,i),o=Math.min(r,u),s=Math.max(r,u),h=new c(f,o),l=new c(e,s);return new n(h,l)},n.prototype.clone=function(){var t=this.minPoint&&this.minPoint.clone(),i=this.maxPoint&&this.maxPoint.clone();return new n(t,i)},n.prototype.equals=function(n,t){if(n){var i=this.isEmpty(),r=n.isEmpty();return i&&r?!0:i||r?!1:t>0?this.minPoint.equals(n.minPoint,t)&&this.maxPoint.equals(n.maxPoint,t):this.minPoint.equals(n.minPoint)&&this.maxPoint.equals(n.maxPoint)}return!1},n.prototype.getCorners=function(){t.assert(!this.isEmpty(),"Calling rect.corners on an empty rect is a coding error");var n=this.minPoint.x,i=this.maxPoint.x,r=this.minPoint.y,u=this.maxPoint.y;return[new c(n,r),new c(i,r),new c(i,u),new c(n,u)]},n.prototype.getSize=function(){return this.isEmpty()?new nt(0,0):new nt(this.maxPoint.x-this.minPoint.x,this.maxPoint.y-this.minPoint.y)},n.prototype.buffer=function(n,i){t.assert(!this.isEmpty(),"Calling rect.buffer on an empty rect is a coding error");this.minPoint.x=this.minPoint.x-n;this.minPoint.y=this.minPoint.y-i;this.maxPoint.x=this.maxPoint.x+n;this.maxPoint.y=this.maxPoint.y+i;var r;this.minPoint.x>this.maxPoint.x&&(r=this.minPoint.x,this.minPoint.x=this.maxPoint.x,this.maxPoint.x=r);this.minPoint.y>this.maxPoint.y&&(r=this.minPoint.y,this.minPoint.y=this.maxPoint.y,this.maxPoint.y=r)},n.prototype.intersect=function(n){return this.intersects(n)?(this.minPoint=new c(Math.max(this.minPoint.x,n.minPoint.x),Math.max(this.minPoint.y,n.minPoint.y)),this.maxPoint=new c(Math.min(this.maxPoint.x,n.maxPoint.x),Math.min(this.maxPoint.y,n.maxPoint.y))):this.minPoint=this.maxPoint=null,this},n.prototype.intersects=function(n){return!this.isEmpty()&&!n.isEmpty()&&this.minPoint.x<=n.maxPoint.x&&this.minPoint.y<=n.maxPoint.y&&this.maxPoint.x>=n.minPoint.x&&this.maxPoint.y>=n.minPoint.y},n.prototype.isEmpty=function(){return!this.minPoint||!this.maxPoint},n.prototype.isInside=function(n){return!this.isEmpty()&&!n.isEmpty()&&this.minPoint.x>=n.minPoint.x&&this.minPoint.y>=n.minPoint.y&&this.maxPoint.x<=n.maxPoint.x&&this.maxPoint.y<=n.maxPoint.y},n.prototype.pointInRect=function(n){return!this.isEmpty()&&n.x>=this.minPoint.x&&n.x<=this.maxPoint.x&&n.y>=this.minPoint.y&&n.y<=this.maxPoint.y},n.prototype.rotate=function(n){return t.assert(!this.isEmpty(),"Calling rect.rotate on an empty rect is a coding error"),new gi(this,n)},n.prototype.union=function(n){return n.isEmpty()||(this.isEmpty()?(this.minPoint=n.minPoint.clone(),this.maxPoint=n.maxPoint.clone()):(this.minPoint.x=Math.min(this.minPoint.x,n.minPoint.x),this.minPoint.y=Math.min(this.minPoint.y,n.minPoint.y),this.maxPoint.x=Math.max(this.maxPoint.x,n.maxPoint.x),this.maxPoint.y=Math.max(this.maxPoint.y,n.maxPoint.y))),this},n.prototype.unionPoint=function(n){return this.isEmpty()?(this.minPoint=n.clone(),this.maxPoint=n.clone()):(this.minPoint.x=Math.min(this.minPoint.x,n.x),this.minPoint.y=Math.min(this.minPoint.y,n.y),this.maxPoint.x=Math.max(this.maxPoint.x,n.x),this.maxPoint.y=Math.max(this.maxPoint.y,n.y)),this},n}(),l=function(){function n(){}return n.trySolve=function(n,t,i,r){var e=i-n,u,f;return e!==0?(u=(r-t)/(i-n),f=t-u*n,[u,f]):null},n.degreesToRadians=function(t){return t*n.radiansPerDegree},n.radiansToDegrees=function(t){return t*n.degreesPerRadian},n.normalizeRadian=function(t){while(t<0)t+=n.twoPI;while(t>=n.twoPI)t-=n.twoPI;return t},n.normalizeDegrees=function(n){return(360+n)%360},n.log2=function(t){return Math.log(t)/n.loge2},n.rotatePoint=function(n,t,i){var r=Math.cos(i),u=Math.sin(i);return new c(n*r-t*u,n*u+t*r)},n.getPointFromAngleAndRadius=function(n,t){var i=Math.sin(n)*t,r=Math.cos(n)*t;return new c(i,r)},n.getVector2DFromMagnitudeAndDirection=function(n,t){var i=n*Math.cos(t),r=n*Math.sin(t);return new c(i,r)},n.getAngleOfVector2D=function(n){return Math.atan2(n.y,n.x)},n.getAngleOfSegment2D=function(n,t){return Math.atan2(t.y-n.y,t.x-n.x)},n.getMagnitudeOfVector2D=function(n){return Math.sqrt(n.x*n.x+n.y*n.y)},n.getMidpoint2D=function(n,t){var i=(n.x+t.x)/2,r=(n.y+t.y)/2;return new c(i,r)},n.getVectorSum2D=function(n,t){var i=n.x+t.x,r=n.y+t.y;return new c(i,r)},n.getVectorDifference2D=function(n,t){var i=n.x-t.x,r=n.y-t.y;return new c(i,r)},n.getEuclideanDistance2D=function(n,t){var i=t.x-n.x,r=t.y-n.y;return Math.sqrt(i*i+r*r)},n.mod=function(n,t){return t===0?n:t===n?0:n-Math.floor(n/t)*t},n.dotProduct2D=function(n,t){return n.x*t.x+n.y*t.y},n.normalizeVector2D=function(t){var i=n.getMagnitudeOfVector2D(t),r=t.x,u=t.y;return i!==0&&(r/=i,u/=i),new c(r,u)},n.projectOntoAxis=function(t,i){for(var r,u=Number.MAX_VALUE,f=-u,e=0,o=i.length;e<o;e++)r=n.dotProduct2D(t,i[e]),r<u&&(u=r),r>f&&(f=r);return{min:u,max:f}},n.wrap=function(n,t,i){if(i<=t)throw"invalid argument exception";for(var r=i-t;n<t;)n+=r;while(n>i)n-=r;return n},n.calculateStyleScaleForLod=function(t){return(t-1)/(n.MAX_ZOOM_LEVEL-1)},n.calculateZoomforStyleScale=function(t){return t*(n.MAX_ZOOM_LEVEL-1)+1},n.computeBoundingBox=function(n){var t,i,r;if(n&&n.length>0){var u=n[0].x,e=u,f=n[0].y,o=f;for(t=1;t<n.length;t++)i=n[t].x,r=n[t].y,i<u&&(u=i),i>e&&(e=i),r<f&&(f=r),r>o&&(o=r);return new dt(new c(u,f),new c(e,o))}return null},n.getAngleBetween=function(n,t,i){if(!n||!t||!i)return NaN;var r=t.x-n.x,u=t.y-n.y,f=i.x-n.x,e=i.y-n.y,o=r*f+u*e,s=Math.sqrt(r*r+u*u)*Math.sqrt(f*f+e*e);return Math.acos(o/s)},n.getAngleDifference=function(n,t,i,r){var f=i||180,e=r||360,u=Math.abs(n-t);return u>f&&(u=Math.abs(Math.min(n,t)+e-Math.max(n,t))),u},n.getAngleDifferenceInRadians=function(t,i){return n.getAngleDifference(t,i,Math.PI,n.twoPI)},n.pointInCircle=function(n,t,i){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))<i},n.matrixMultiply=function(n,t){var i,r,u;if(n&&t&&n[0].length===t.length){var e=n.length,o=t[0].length,f=new Array(e),s=t.length;for(i=0;i<e;i++)for(f[i]=new Array(o),r=0;r<o;r++)for(f[i][r]=0,u=0;u<s;u++)f[i][r]+=n[i][u]*t[u][r];return f}},n.degreesPerRadian=180/Math.PI,n.radiansPerDegree=Math.PI/180,n.loge2=Math.log(2),n.twoPI=Math.PI*2,n.thirtyDegreesInRadians=Math.PI/6,n.MAX_ZOOM_LEVEL=23,n.zoomDeltaBetweenLods=1/(n.MAX_ZOOM_LEVEL-1),n.markupVisible=0,n.markupInvisible=255,n}(),d=function(){function n(){}return n.greatCircleDistance=function(t,i){var r=l.degreesToRadians(i.latitude),u=l.degreesToRadians(t.latitude),o=l.degreesToRadians(i.longitude),s=l.degreesToRadians(t.longitude),h=Math.abs(r-u),c=Math.abs(o-s),f=Math.sin(h/2),e=Math.sin(c/2),a=2*Math.asin(Math.sqrt(f*f+Math.cos(u)*Math.cos(r)*e*e));return n.earthRadiusMajorAxis*a},n.getMapLocationFromLocationHeadingAndDistance=function(t,i,r){if(!t||typeof i=="undefined"||i===null||typeof r=="undefined"||r===null)throw"location, headingInRadians and distanceInMeters must all be defined.";var u=r/n.earthRadiusMajorAxis,f=l.degreesToRadians(t.latitude),s=l.degreesToRadians(t.longitude),e=Math.asin(Math.sin(f)*Math.cos(u)+Math.cos(f)*Math.sin(u)*Math.cos(i)),h=s+Math.atan2(Math.sin(i)*Math.sin(u)*Math.cos(f),Math.cos(u)-Math.sin(f)*Math.sin(e));return new o(l.radiansToDegrees(e),o.normalizeLongitude(l.radiansToDegrees(h)))},n.isValidNumber=function(n){return typeof n=="number"&&isFinite(n)},n.isValidAltitudeReference=function(n){return n===-1||n===0},n.metersToDegrees=function(t){var i=t/n._metersPerMile,r=Math.PI/10800*i;return l.radiansToDegrees(r)},n.latitudeDegreesToMeters=function(n){return Math.sin(l.degreesToRadians(n))*this.earthRadiusMajorAxis},n.longitudeDegreesToMeters=function(n){return l.degreesToRadians(n)*this.earthRadiusMajorAxis},n.metersToLatitudeDegrees=function(n){return l.radiansToDegrees(Math.asin(n/this.earthRadiusMajorAxis))},n.metersToLongitudeDegrees=function(n){return l.radiansToDegrees(n/this.earthRadiusMajorAxis)},n.getAngleBetweenTwoLocations=function(n,t){return l.radiansToDegrees(l.normalizeRadian(Math.atan2(o.normalizeLongitude(t.longitude-n.longitude),t.latitude-n.latitude)))},n.roundToInterval=function(n,t){if(t){var i=1/t;n=Math.round(n*i)/i}return n},n.getMetersPerDegreeOfLatitude=function(n){var t=n*Math.PI/180;return 111132.92+-559.82*Math.cos(2*t)+1.175*Math.cos(4*t)+-.0023*Math.cos(6*t)},n.getMetersPerDegreeOfLongitude=function(n){var t=n*Math.PI/180;return 111412.84*Math.cos(t)+-93.5*Math.cos(3*t)+.118*Math.cos(5*t)},n.earthRadiusMajorAxis=6378137,n.earthRadiusMinorAxis=6356752.314245,n.earthCircumference=2*Math.PI*n.earthRadiusMajorAxis,n.metersPerLongtitudeDegree=111319.4908,n._metersPerMile=1852,n}(),o=function(){function n(n,t,i,r){var u=typeof n!="number"?parseFloat(n):n,f;if(isNaN(u)||u<-90||u>90)throw Error("Invalid latitude");if(this.latitude=u,f=typeof t!="number"?parseFloat(t):t,isNaN(f))throw Error("Invalid longitude");this.longitude=f;this.altitude=i||0;this.altitudeReference=d.isValidAltitudeReference(r)?r:-1}return n.prototype.clone=function(){return n.cloneFrom(this)},n.cloneFrom=function(t){return new n(t.latitude,t.longitude,t.altitude,t.altitudeReference)},n.prototype.toString=function(){return"[MapLocation ("+this.latitude+", "+this.longitude+")]"},n.normalizeLongitude=function(n){return n<-180||n>180?n-Math.floor((n+180)/360)*360:n},n.areEqual=function(n,t,i,r){return r=r||0,n&&t&&Math.abs(n.latitude-t.latitude)<=r&&Math.abs(n.longitude-t.longitude)<=r&&(i||n.altitudeReference===-1&&t.altitudeReference===-1||n.altitudeReference===t.altitudeReference&&Math.abs(n.altitude-t.altitude)<=r)},n.parseLatLong=function(t){var i,r,u;return t&&(i=t.split(","),i.length===2&&(r=parseFloat(i[0]),u=parseFloat(i[1]),isFinite(r)&&isFinite(u)))?new n(r,u):null},n}(),nr=function(){function t(t,i){i===void 0&&(i=1e3);this._interval=i;this._elements=t;this._window=n(window);this.resize=new r;this.startMonitoring()}return t.prototype.getSize=function(){var n=this._elements[0];return new nt(n.offsetWidth,n.offsetHeight)},t.prototype.getSizes=function(){var n=[];return this._elements.for_each(function(t){return n.push(new nt(t.offsetWidth,t.offsetHeight))}),n},t.prototype.startMonitoring=function(n){var t=this;n&&(this._lastSizes=this.getSizes());this._pollSizeHandler||(this._pollSizeHandler=function(){return t.pollSize()},!this._intervalId&&this._interval>0&&(this._intervalId=Microsoft.Maps.setInterval(this._pollSizeHandler,this._interval)),this._window.add_event("resize",this._pollSizeHandler))},t.prototype.stopMonitoring=function(){this._pollSizeHandler&&(this._window.remove_event("resize",this._pollSizeHandler),this._pollSizeHandler=null);this._intervalId&&(window.clearInterval(this._intervalId),this._intervalId=null)},t.prototype.dispose=function(){this.stopMonitoring();this._elements&&this._elements.clear();this._window&&this._window.clear()},t.prototype.pollSize=function(){var i=this._lastSizes,t=this.getSizes(),r=!1,n,u;if(i&&i.length==t.length){for(n=0,u=i.length;n<u;n++)if(i[n].width!==t[n].width&&t[n].width>0||i[n].height!==t[n].height&&t[n].height>0){r=!0;break}}else r=!0;r&&(this._lastSizes=t,this.resize.invoke(t))},t}(),rt=function(){function n(n){this._activator=n}return n.prototype.getObjectAsync=function(n){var t=this;this._isObjectLoaded?n(this._object):this._workCallbacks?this._workCallbacks.push(n):(this._workCallbacks=[n],this._activator(function(n){return t._onObjectLoaded(n)}))},n.prototype._onObjectLoaded=function(n){this._object=n;for(var t=0;t<this._workCallbacks.length;t++)this._workCallbacks[t](n);this._activator=null;this._workCallbacks=null;this._isObjectLoaded=!0},n}(),iu=function(){function n(n,t,i){this._key=n;this._timestamp=t;this._perfManager=i}return n.prototype.end=function(n){this._logged||(this._perfManager.end(this,n),this._logged=!0)},n.prototype.timestamp=function(){return this._timestamp},n.prototype.key=function(){return this._key},n}(),b=function(){function n(){}return n.Activated="A",n.CenterPoint="CP",n.Deactivated="D",n.Clicked="C",n.Reactivated="RE",n.Removed="R",n.Focused="F",n.Hovered="H",n.Collapsed="CL",n.ClientInstNamespace="CI",n.Submitted="S",n.Selected="SE",n.EntryPoint="EP",n.Expanded="EX",n.Impression="I",n.Error="ERR",n.Warning="WRN",n.Perf="PRF",n}(),ru=function(){function n(){}return n.ContextMenu="ContextMenu",n.LocalSearch="LocalSearch",n.LocalListing="LocalListing",n.LocalListingAlongRoute="LocalListingAlongRoute",n.LocalDetails="LocalDetails",n.Collections="Collections",n.MyPlacesNew="MyPlacesNew",n.POI="POI",n.POIAlongRoute="POIAlongRoute",n.Landmarks="Landmarks",n.SearchBox="SearchBox",n.SearchButton="SearchButton",n.TaskBar="TaskBar",n.CategoriesBar="CategoriesBar",n.Autosuggest="Autosuggest",n.Feedback="Feedback",n.DirectionsWaypointSearch="DirectionsWaypointSearch",n.DirectionsRouteList="DirectionsRouteList",n.TaskCard="TaskCard",n.TransitStop="TransitStop",n.TransitLine="TransitLine",n.NearbyParking="NearbyParking",n.Geochain="Geochain",n.Permalink="Permalink",n.FallbackRequery="FallbackRequery",n.ItineraryListings="ItineraryListings",n.ItineraryDetails="ItineraryDetails",n.ItineraryPOI="ItineraryPOI",n.TravelL2="TravelL2",n.VenueMap="VenueMap",n.SerpAnswer="SerpAnswer",n.ServerPagination="ServerPagination",n}(),tt=function(){function n(){}return n.ContextMenu="CM",n.TaskManager="TM",n.TaskBar="TB",n.CategoriesBar="CB",n.FiltersBar="FSB",n.MapControl="MC",n.POI="POI",n.DetailsCard="DC",n.ListingCard="LC",n.Landmarks="L",n.CardModel="CD",n.NearbyControl="NBC",n.NearbySearch="NBS",n.RecommendedSearch="RS",n.ISDK="IS",n.Network="NW",n.BaseMapData="BD",n.ShowMeCategoryLayers="SMC",n.SDK="SDK",n}(),uu=function(){function n(){}return n.Autosuggest="AS",n.Collections="CX",n.Directions="DD",n.Print="PRT",n.Share="SH",n.Search="SR",n.Streetside="SS",n.Traffic="T",n.LocateMe="LM",n.Feedback="FB",n.TaskManager="TM",n.Tips="TP",n.Fullscreen="FS",n.Overlay="OV",n.BirdseyeV2="B2",n.VenueMap="VM",n.Commutability="CMT",n}(),fu=function(n){function t(t){return n.call(this,"Event.ClientPerf",t)||this}return k(t,n),t.prototype.log=function(i,r){i&&r&&n.prototype.logObject.call(this,t.getPerfLogDataObject(i,r))},t.prototype.start=function(n){return n?new iu(n,this._getTimestamp(),this):null},t.prototype.end=function(n,i){if(n){var r=n.key(),u=i?r+t.KeySeparator+i:r;this.logObject(t.getPerfLogDataObject(u,this._getTimestamp().getTime()-n.timestamp().getTime()))}},t.prototype.checkpoint=function(n){n&&this.logObject(t.getPerfLogDataObject(n,this._getTimestamp()))},t.prototype._getTimestamp=function(){return new Date},t.getPerfLogDataObject=function(n,t){return{T:"CI.ClientPerf",FID:b.ClientInstNamespace,key:n,value:t}},t.KeySeparator=".",t}(InstrumentationBase),eu=function(){function n(){this._logger=e.logger}return n.prototype.logObject=function(n,t,i){this._logger.logObject(n,t,i)},n.prototype.flush=function(){this._logger.flush()},n.prototype.clear=function(){this._logger.clear()},n}(),ou=function(){function n(n){this.duration=n}return n.prototype.interpolate=function(n,i,r){var e=this._lerp(n.cameraLocation.latitude,i.cameraLocation.latitude,r),s=this._lerp(n.cameraLocation.longitude,i.cameraLocation.longitude,r),c=this._lerp(n.cameraLocation.altitude,i.cameraLocation.altitude,r),u=n.heading,f=i.heading,h;return Math.abs(f-u)>180&&(f<u?f+=360:u+=360),t.log(null,"Interpolate to latitude: {0}, longitude: {1}",e.toString(),s.toString()),h=this._lerp(u,f,r),new p(new o(e,s,c,i.cameraLocation.altitudeReference),h)},n.prototype._lerp=function(n,t,i){return(t-n)*i+n},n.defaultAnimation=new n(300),n}(),su=function(){function n(n){var t=this;this._userLayerZIndexChangedEventHandlers={};this.revision=0;this.length=0;this.changed=new r;this.layerChanged=new r;this._userLayers=n.getLayers();this._userLayersChangeHandler=this._userLayers.changed.add(function(n){return t._onLayersChanged(n,!0)});this.setBaseLayers(n.getBaseLayers())}return n.prototype.hasUserLayers=function(){return this._userLayers.length>=1},n.prototype.isBaseLayer=function(n){return this._baseLayers&&this._baseLayers.indexOf(n)!==-1},n.prototype.setBaseLayers=function(n){var t=this;this._baseLayersChangeHandler&&this._baseLayersChangeHandler.dispose();this._baseLayers=n;this._onLayersChanged({reset:!0});this._baseLayersChangeHandler=this._baseLayers&&this._baseLayers.changed.add(function(n){return t._onLayersChanged(n,!1)})},n.prototype.dispose=function(){this._baseLayersChangeHandler&&this._baseLayersChangeHandler.dispose();this._userLayerZIndexChangedEventHandlers&&this._userLayersChangeHandler.dispose();u._clearDisposables(this._userLayerZIndexChangedEventHandlers);u._disposeEvents(this);u._nullifyClass(this)},n.prototype._onLayersChanged=function(n,i){var h=this,e=i&&this._baseLayers?this._baseLayers.length:0,f,r,u,o,s;if(n.reset){if(Array.prototype.splice.call(this,0,this.length),this._baseLayers)for(r=0,u=this._baseLayers.length;r<u;r++)Array.prototype.push.call(this,this._baseLayers[r]);for(r=0,u=this._userLayers.length;r<u;r++)Array.prototype.push.call(this,this._userLayers[r]);this._invokeChanged(0,null,0,null,!0)}else{if(n.removed){if(i)for(r=0,u=n.removed.length;r<u;r++)f=n.removed[r],o=this._userLayerZIndexChangedEventHandlers[f.getId()],o&&(o.dispose(),o=null,delete this._userLayerZIndexChangedEventHandlers[f.getId()]);Array.prototype.splice.call(this,e+n.removedIndex,n.removed.length);this._invokeChanged(0,null,e+n.removedIndex,n.removed)}if(n.added){if(i)for(r=0,u=n.added.length;r<u;r++)f=n.added[r],this._userLayerZIndexChangedEventHandlers[f.getId()]=f.changed.add(function(n){h._onUserLayerChanged(n)});s=[e+n.addedIndex,0];s.push.apply(s,n.added);Array.prototype.splice.apply(this,s);this._invokeChanged(e+n.addedIndex,n.added)}}i&&t.logLayersChanged(n)},n.prototype._onUserLayerChanged=function(n){var t=n.name;(t==="zIndex"||t==="opacity"||t==="visible"||t==="iconOnlyLimit"||t==="highlighted")&&(this.revision++,this.layerChanged.invoke(n.sender))},n.prototype._invokeChanged=function(n,t,i,r,u){this.revision++;this.changed.invoke({addedIndex:n,added:t,removedIndex:i,removed:r,reset:u===!0})},n}(),hu=function(){function n(n,t){this.view=n;this.cancel=!1;this.cause=t}return n}(),tr=function(){function n(){this._sets=[]}return n.prototype.addSet=function(n){this._sets.push(n)},n.prototype.getSets=function(){return this._sets},n.prototype.getPrimitives=function(){var n,t;if(!this._allPrimitives)for(this._allPrimitives=[],n=0;n<this._sets.length;n++)t=this._sets[n].getPrimitives(),this._allPrimitives=Array.prototype.concat.apply(this._allPrimitives,t);return this._allPrimitives},n.prototype.dispose=function(){this._sets=[];this._allPrimitives=[]},n}(),ir=function(){function n(n,i,r){t.assertNotNull(n,"frame");t.assertNotNull(i,"layer");t.assertNotNull(r,"primitiveSet");this.frame=n;this.layer=i;this._unclippedPrimitiveSet=r}return n.prototype.getUnclippedPrimitiveSet=function(){return this._unclippedPrimitiveSet},n.prototype.getPrimitives=function(n,t){var r;if(n===1)return i.tileRefactoringEnabled?t?(this._exactlyScreenSpaceClippedPrimitives||(r=this._unclippedPrimitiveSet.getPrimitives(),this._exactlyScreenSpaceClippedPrimitives=this.frame.viewport?si.clip(this._getScreenSpacePrimitives(r),this.frame.viewport,1):r),this._exactlyScreenSpaceClippedPrimitives):(this._exactlyWorldSpaceClippedPrimitives||(r=this._unclippedPrimitiveSet.getPrimitives(),this._exactlyWorldSpaceClippedPrimitives=this.frame.viewport?si.clip(this._getWorldSpacePrimitives(r),this.frame.viewport,1):r),this._exactlyWorldSpaceClippedPrimitives):(this._exactlyClippedPrimitives||(this._exactlyClippedPrimitives=this.frame.viewport?si.clip(this._unclippedPrimitiveSet.getPrimitives(),this.frame.viewport,1):this._unclippedPrimitiveSet.getPrimitives()),this._exactlyClippedPrimitives);if(n===2)return this._unclippedPrimitiveSet.getPrimitives();throw"Unsupported clippingMode";},n.prototype.dispose=function(){this.frame=null;this.layer=null;this._unclippedPrimitiveSet&&this._unclippedPrimitiveSet.dispose();this._exactlyScreenSpaceClippedPrimitives=[];this._exactlyWorldSpaceClippedPrimitives=[];this._exactlyClippedPrimitives=[]},n.prototype._getScreenSpacePrimitives=function(n){var u=[],i,t,r,f;if(this.layer.getRenderTarget()===1)return n;if(this.layer.getRenderTarget()===2)for(i=0;i<n.length;i++)t=n[i],t.geometryType===1||t.geometryType===0?u.push(t):t.entity&&(r=Microsoft.Maps.Internal._EntityHelper,f=r&&r.getDisplayName(t.entity),(!r||f)&&u.push(t));return u},n.prototype._getWorldSpacePrimitives=function(n){var u=this.layer.getRenderTarget(),i,t,r;if(u===1)return[];for(i=[],t=0;t<n.length;t++)r=n[t],(u===0||r.geometryType!==1)&&i.push(r);return i},n}(),si=function(){function n(){}return n.clip=function(i,r,u){switch(u){case 1:i=n._clipExact(i,r);break;case 2:i=i;break;default:t.assert(!1,"Invalid ClippingMode")}return i},n._clipExact=function(n,t){for(var l=[],a={},f=w.fromRegionId(t).splitByInternationalDateLine(),o=[],s=[],h=[],c=[],r,e,i,u=0;u<f.length;u++)o.push(f[u].getNorth()),s.push(f[u].getSouth()),h.push(f[u].getEast()),c.push(f[u].getWest());for(u=0;u<n.length;++u){if(r=n[u],e=a[r.crs.id],!e){for(e=[],i=0;i<f.length;i++){var y=r.crs.projectToY(o[i],c[i]),p=r.crs.projectToY(s[i],h[i]),b=r.crs.projectToX(o[i],c[i]),k=r.crs.projectToX(s[i],h[i]);e.push(dt.fromSides(b,k,y,p))}a[r.crs.id]=e}var d=r.geometry.bounds[0],g=r.geometry.bounds[1],nt=r.geometry.bounds[2],tt=r.geometry.bounds[3],it=dt.fromSides(tt,g,d,nt),v=!1;for(i=0;i<f.length;i++)if(it.intersects(e[i])){v=!0;break}v&&l.push(r)}return l},n}(),cu=function(){function n(n,i,r){t.assertNotNull(n,"id");t.assertNotNull(i,"primitives");this._id=n;this._primitives=i;r&&(this._revisions=this._primitives.map(function(n){return n.revision}))}return n.prototype.getId=function(){return this._id},n.prototype.getPrimitives=function(){return this._primitives},n.prototype.getRevisions=function(){return this._revisions},n}(),rr=function(){function n(n,i,u){t.assertNotNull(n,"layer");t.assertNotNull(u,"frame");this._layer=n;this._isBaseLayer=i;this._frame=u;this._state=1;this._compositeSet=new tr;this.completed=new r;this.cancelled=new r;this.failed=new r}return n.prototype.getLayer=function(){return this._layer},n.prototype.getFrame=function(){return this._frame},n.prototype.hasCompleted=function(){return this._state===3},n.prototype.hasFailed=function(){return this._state===5},n.prototype.getCompositeSet=function(){if(this._state!==3)throw"The 'getCompositeSet' may not be called until the 'completed' event is raised.";return this._compositeSet},n.prototype.beginLoad=function(){var t=this,n;if(this._state!==1)throw"The 'beginLoad' method has already been called on this object.";if(this._state=2,n=this._layer.getDataSource(),n)this._loadOnDataSourceAvailability(n);else if(i.tileRefactoringEnabled)this._layerChangeHandler=this._layer.changed.add(function(n){n.name==="dataSource"&&(t._layerChangeHandler.dispose(),t._loadOnDataSourceAvailability(n.newValue))});else{this._state=3;this.completed.invoke();return}},n.prototype.cancelLoad=function(){this._state=4;this._cancelOutstandingRequests();this.cancelled.invoke()},n.prototype.dispose=function(){this._layer=null;this._frame=null;this._requestRegionIds=[];this._layerChangeHandler&&this._layerChangeHandler.dispose();this._compositeSet.dispose();this.completed.dispose();this.cancelled.dispose();this.failed.dispose()},n.prototype._loadOnDataSourceAvailability=function(t){var i,r,u,e,o,f;if(this._state!==4)for(i=this._frame.viewport,r=w.fromRegionId(i),t.spatialIndex?(u=i.crs,u.getScale?(e=u.getScale(i),this._requestRegionIds=t.spatialIndex.getRegionsInBounds(r,e)):(o=Math.max(n._minGroundResolution,u.getGroundResolution(i)),this._requestRegionIds=t.spatialIndex.getRegions(r,o))):this._requestRegionIds=[r],this._pendingSetCount=this._requestRegionIds.length,f=0;f<this._requestRegionIds.length;f++)this._requestPrimitives(this._requestRegionIds[f],t)},n.prototype._requestPrimitives=function(i,r){var f=this,u;t.assertNotNull(this.getFrame().view,"view");u=a.fromLocation(this.getFrame().view.cameraLocation,!0);r.getPrimitives(i,function(n){return f._onDataSourceResponse(i,n)},n._dataSourceRequestorId,u)},n.prototype._getSetId=function(n){var t=this._layer.getDataSource(),i=t.getDataUniquenessKey;return i?this._layer.getId()+"_"+i.call(t,n):this._layer.getId()+"_DV"+this._layer.dataVersion},n.prototype._cancelOutstandingRequests=function(){var i=this._layer.getDataSource(),r=this._requestRegionIds,t,u;if(r&&i&&i.cancelPrimitivesRequest)for(t=0;t<r.length;t++)u=r[t],i.cancelPrimitivesRequest(u,n._dataSourceRequestorId)},n.prototype._onDataSourceResponse=function(n,t){var f,i,r,e,u,s,o;if(this._state===2){if(t){if(f=this._getSetId(n),i=t.primitives||[],this._isBaseLayer)for(r=0,e=i.length;r<e;r++)u=i[r],s=u.entity,u.layer=this._layer;o=new cu(f,i,!this._layer.getDataSource().getDataUniquenessKey);this._compositeSet.addSet(o);t.requestFailed&&!t.requestAborted&&(this._cancelOutstandingRequests(),this._state=5,this.failed.invoke())}this._pendingSetCount--;this._pendingSetCount===0&&(this._state=3,this.completed.invoke())}},n._dataSourceRequestorId="FrameManager",n._minGroundResolution=.01,n}(),ur=function(){function n(n,t,u){var f=this,o,e;this._map=n;this._layer=t;this._isBaseLayer=u;this._latestLayerFrameData=this._getFrameZeroData();i.tileRefactoringEnabled||(this._previousLayerFrameData=this._getFrameZeroData(),this._previousLayerTargetFrameData=this._getFrameZeroData());this._disposables=[];o=t.getDataSource();e={layerId:t?t.getId():null};o&&o.invalidated&&this._disposables.push(t.getDataSource().invalidated.add(function(n){e.entityIds=n&&n.entityIds;f._onLayerInvalidated(e)}));i.tileRefactoringEnabled&&(this._disposables.push(t.changed.add(function(n){(n.name==="dataSource"&&n.oldValue!==undefined||n.name==="visible")&&(n.newValue&&n.newValue.invalidated&&f._disposables.push(n.newValue.invalidated.add(function(){return f._onLayerInvalidated(e)})),f._onLayerInvalidated(e))})),this._disposables.push(this._map.viewChanging.add(function(){f._isViewChanging||f._cancelPendingRequests();f._isViewChanging=!0})),this._disposables.push(this._map.viewChanged.add(function(){return f._isViewChanging=!1})));this.dataLoaded=new r;this.dataLoadFailed=new r;this.layerInvalidated=new r}return n.prototype.frameChangeStarted=function(n){this._map.getMode()&&(n.frameNumber!==this._currentFrame.frameNumber||!this._currentDataLoader||this._currentDataLoader.hasCompleted()||this._currentDataLoader.hasFailed()||this._currentDataLoader.cancelLoad())},n.prototype.setFrame=function(n){var t=this,r;this._map.getMode()&&(i.tileRefactoringEnabled?this._lastViewChangeFrameNumber!==n.lastViewChangeFrameNumber||this._cachedDataVersion!==this._layer.dataVersion?(this._lastViewChangeFrameNumber=n.lastViewChangeFrameNumber,this._layer.dataVersion++,!this._currentDataLoader||this._currentDataLoader.hasCompleted()||this._currentDataLoader.hasFailed()||this._currentDataLoader.cancelLoad(),this._currentFrame=n,this._currentDataLoaderCompletedHandler&&this._currentDataLoaderCompletedHandler.dispose(),this._currentDataLoaderFailedHandler&&this._currentDataLoaderFailedHandler.dispose(),this._currentDataLoader&&this._currentDataLoader.dispose(),this._currentDataLoader=new rr(this._layer,this._isBaseLayer,n),this._currentDataLoaderCompletedHandler=this._currentDataLoader.completed.addOne(function(){return t._onDataLoaderCompleted()}),this._currentDataLoaderFailedHandler=this._currentDataLoader.failed.addOne(function(){return t._onDataLoaderFailed()}),this._currentDataLoader.beginLoad()):(this._latestLayerFrameData.frame=n,r={frame:n},this.dataLoaded.invoke(r)):(!this._currentDataLoader||this._currentDataLoader.hasCompleted()||this._currentDataLoader.hasFailed()||this._currentDataLoader.cancelLoad(),this._currentFrame=n,this._currentDataLoaderCompletedHandler&&this._currentDataLoaderCompletedHandler.dispose(),this._currentDataLoaderFailedHandler&&this._currentDataLoaderFailedHandler.dispose(),this._currentDataLoader&&this._currentDataLoader.dispose(),this._currentDataLoader=new rr(this._layer,this._isBaseLayer,n),this._currentDataLoaderCompletedHandler=this._currentDataLoader.completed.addOne(function(){return t._onDataLoaderCompleted()}),this._currentDataLoaderFailedHandler=this._currentDataLoader.failed.addOne(function(){return t._onDataLoaderFailed()}),this._currentDataLoader.beginLoad()))},n.prototype.getPreviousFrameData=function(){return this._previousLayerFrameData},n.prototype.getPreviousTargetFrameData=function(){return this._previousLayerTargetFrameData},n.prototype.getLatestFrameData=function(){return this._latestLayerFrameData},n.prototype._getFrameZeroData=function(){return new ir(ni.frameZero,this._layer,new tr)},n.prototype.dispose=function(){u._clearDisposables(this._disposables);!this._currentDataLoader||this._currentDataLoader.hasCompleted()||this._currentDataLoader.hasFailed()||this._currentDataLoader.cancelLoad();this._currentDataLoaderCompletedHandler&&this._currentDataLoaderCompletedHandler.dispose();this._currentDataLoaderFailedHandler&&this._currentDataLoaderFailedHandler.dispose();this._currentDataLoader&&this._currentDataLoader.dispose();this._latestLayerFrameData&&this._latestLayerFrameData.dispose();this._previousLayerFrameData&&this._previousLayerFrameData.dispose();this._previousLayerTargetFrameData&&this._previousLayerTargetFrameData.dispose()},n.prototype._onDataLoaderCompleted=function(){var r=this._currentDataLoader.getFrame().frameNumber,n=this._currentDataLoader.getCompositeSet(),t;(i.tileRefactoringEnabled&&(this._cachedDataVersion=this._layer.dataVersion),r===this._currentFrame.frameNumber&&n)&&(i.tileRefactoringEnabled||(this._previousLayerFrameData=this._latestLayerFrameData,this._latestLayerFrameData.frame.purpose===2&&(this._previousLayerTargetFrameData=this._latestLayerFrameData)),this._latestLayerFrameData=new ir(this._currentFrame,this._layer,n),t={frame:this._latestLayerFrameData.frame},this.dataLoaded.invoke(t))},n.prototype._onDataLoaderFailed=function(){var i=this._currentDataLoader.getFrame().frameNumber,n=this._currentDataLoader.getFrame(),t={frame:n,layer:this._layer,reason:2,errorMessage:"Failed to get primitives for layer '"+this._layer.getId()+"'"};this.dataLoadFailed.invoke(t)},n.prototype._onLayerInvalidated=function(n){var t=this;i.tileRefactoringEnabled?(this._layer.dataVersion++,Microsoft.Maps.setTimeout(function(){t._isViewChanging||t.layerInvalidated.invoke(n)},0)):this.layerInvalidated.invoke(n)},n.prototype._cancelPendingRequests=function(){!this._currentDataLoader||this._currentDataLoader.hasCompleted()||this._currentDataLoader.hasFailed()||this._currentDataLoader.cancelLoad()},n}(),lu=function(){function n(n,t,u){var f=this,e;this._map=n;this._layer=t;this._disposables=[];t instanceof ti&&i.tileRefactoringEnabled?this._dataMonitor=t:(this._dataMonitor=new ur(n,t,u),this._disposables.push(this._dataMonitor));this._frame=ni.frameZero;this._disposables.push(n.changed.add(function(n){return f._onMapChanged(n)}));e=n.getMode();e&&(this._modeFrameRenderedHandler=e.onFrameRendered.add(function(n){return f._onModeFrameRendered(n)}),this._modeFrameFailedHandler=e.onFrameFailed&&e.onFrameFailed.add(function(n){return f._onModeFrameFailed(n)}));t instanceof ti&&i.tileRefactoringEnabled?t.crsReady.add(function(n){return f._onDataMonitorDataLoaded(n)}):t instanceof ii&&(this._disposables.push(this._dataMonitor.dataLoaded.add(function(n){return f._onDataMonitorDataLoaded(n)})),this._disposables.push(this._dataMonitor.dataLoadFailed.add(function(n){return f._onDataMonitorDataLoadFailed(n)})));this._disposables.push(this._dataMonitor.layerInvalidated.add(function(n){return f._onDataMonitorLayerInvalidated(n)}));u&&n.getConfig().clickBasemapPrimitives&&this._disposables.push(t.primitiveHoverStarted.add(function(n){return f._onPrimitiveHoverStarted(n)}),t.primitiveHoverStopped.add(function(n){return f._onPrimitiveHoverStopped(n)}),t.primitiveTapped.add(function(n){return f._onPrimitiveTapped(n)}));this.frameSet=new r;this.dataLoaded=new r;this.primitivesRendered=new r;this.labelsRendered=new r;this.frameRendered=new r;this.frameFailed=new r;this.layerInvalidated=new r}return n.prototype.getMap=function(){return this._map},n.prototype.getLayer=function(){return this._layer},n.prototype.getFrame=function(){return{frameNumber:this._frame.frameNumber,purpose:this._frame.purpose,view:this._frame.view,viewport:this._frame.viewport,lastViewChangeFrameNumber:this._frame.lastViewChangeFrameNumber,cause:this._frame.cause,causeEntityIds:this._frame.causeEntityIds,causeLayerIds:this._frame.causeLayerIds}},n.prototype.isCurrent=function(n){return n.frameNumber===this._frame.frameNumber},n.prototype.getFrameData=function(){return i.tileRefactoringEnabled?this._dataMonitor instanceof ur?this._dataMonitor.getLatestFrameData():null:this._dataMonitor.getLatestFrameData()},n.prototype.getPreviousFrameData=function(){return this._dataMonitor.getPreviousFrameData()},n.prototype.getPreviousTargetFrameData=function(){return this._dataMonitor.getPreviousTargetFrameData()},n.prototype.setFrame=function(n){this._frame=n;this._loadingDataState=1;this._renderingPrimitivesState=1;this._renderingLabelsState=1;this._isFrameComplete=!1;this._hasFrameFailed=!1;(i.tileRefactoringEnabled||window.location.href.toUpperCase().indexOf("DELAYVT")===-1)&&this._dataMonitor.setFrame(n,this._map)},n.prototype.frameChangeStarted=function(n){this._dataMonitor.frameChangeStarted(n)},n.prototype.completeDataLoadingPhase=function(n){this.isCurrent(n)&&(t.assert(this._loadingDataState===1,"loadingDataState("+this._loadingDataState+"): Should be in 'awaiting' state."),this._loadingDataState=2,this._invokePendingEvents())},n.prototype.completePrimitiveRenderingPhase=function(n){this.isCurrent(n)&&(this._renderingPrimitivesState===1&&(this._renderingPrimitivesState=2),this._invokePendingEvents())},n.prototype.completeLabelRenderingPhase=function(n){this.isCurrent(n)&&this._renderingLabelsState===1&&(this._renderingLabelsState=2,this._invokePendingEvents())},n.prototype.failFrame=function(n,t,i){this.isCurrent(n)&&(this.frameFailed.invoke({frame:this.getFrame(),layer:this._layer,reason:t,errorMessage:i}),this._hasFrameFailed=!0)},n.prototype.dispose=function(){this._modeFrameRenderedHandler&&this._modeFrameRenderedHandler.dispose();this._modeFrameFailedHandler&&this._modeFrameFailedHandler.dispose();for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose()},n.prototype._invokePendingEvents=function(){this._hasFrameFailed||(this._loadingDataState===2?(this.dataLoaded.invoke({frame:this._frame,layer:this._layer}),this._loadingDataState=3,this._invokePendingEvents()):this._loadingDataState===3&&this._renderingPrimitivesState===2?(this._renderingPrimitivesState=3,this.primitivesRendered.invoke({frame:this._frame,layer:this._layer}),this._invokePendingEvents()):this._loadingDataState===3&&this._renderingLabelsState===2&&(this.labelsRendered.invoke({frame:this._frame,layer:this._layer}),this._renderingLabelsState=3,this._invokePendingEvents()),this._loadingDataState!==3||this._renderingPrimitivesState!==3||this._renderingLabelsState!==3||this._isFrameComplete||(this.frameRendered.invoke({frame:this._frame,layer:this._layer}),this._isFrameComplete=!0))},n.prototype._onMapChanged=function(n){var i=this,t;n.name==="mode"&&(this._modeFrameRenderedHandler&&this._modeFrameRenderedHandler.dispose(),this._modeFrameFailedHandler&&this._modeFrameFailedHandler.dispose(),t=n.newValue,this._modeFrameRenderedHandler=t.onFrameRendered.add(function(n){return i._onModeFrameRendered(n)}),this._modeFrameFailedHandler=t.onFrameFailed&&t.onFrameFailed.add(function(n){return i._onModeFrameFailed(n)}))},n.prototype._onModeFrameRendered=function(n){this.completePrimitiveRenderingPhase(n.frame);!i.tileRefactoringEnabled&&window.location.href.toUpperCase().indexOf("DELAYVT")>-1&&this._dataMonitor.setFrame(n.frame)},n.prototype._onModeFrameFailed=function(n){this.failFrame(n.frame,n.reason,n.errorMessage)},n.prototype._onDataMonitorDataLoaded=function(n){this.completeDataLoadingPhase(n.frame)},n.prototype._onDataMonitorDataLoadFailed=function(n){this.failFrame(n.frame,n.reason,n.errorMessage)},n.prototype._onDataMonitorLayerInvalidated=function(n){this.layerInvalidated.invoke(n)},n.prototype._setPrimitiveViewState=function(n,t){var i=n.entity;n.viewState=t;i&&i.changed&&i.changed.invoke()},n.prototype._onPrimitiveHoverStarted=function(n){var t=n.primitive;t&&t.viewState!==2&&t.viewState!==3&&this._setPrimitiveViewState(t,1)},n.prototype._onPrimitiveHoverStopped=function(n){var t=n.primitive;t&&t.viewState===1&&this._setPrimitiveViewState(t,0)},n.prototype._onPrimitiveTapped=function(n){var i=n.primitive,t=i&&i.entity,r=e.GlobalDataEventHandler,u=e.DataHandlerKeys,f=e.TaskTypes;r&&t&&t.id&&r.invokeHandler(u.taskDataHandlerKey,{type:f.polygonEntityDetailsTask,state:{id:"vdpid:"+t.id,taskTitle:t.name}})},n}(),hi=function(){function n(){this._goal=0;this._count=0}return n.prototype.getGoal=function(){return this._goal},n.prototype.setGoal=function(n){this._goal=n},n.prototype.getCount=function(){return this._count},n.prototype.resetCount=function(){this._count=0},n.prototype.incrementCount=function(){this._count++},n.prototype.hasReachedGoal=function(){return this._count>=this._goal},n}(),au=function(){function n(){this._dataLoadedGoalCounter=new hi;this._primitivesRenderedGoalCounter=new hi;this._labelsRenderedGoalCounter=new hi}return n.prototype.setLayerCount=function(n){this._dataLoadedGoalCounter.setGoal(n);this._primitivesRenderedGoalCounter.setGoal(n);this._labelsRenderedGoalCounter.setGoal(n)},n.prototype.resetEventCounts=function(){this._dataLoadedGoalCounter.resetCount();this._primitivesRenderedGoalCounter.resetCount();this._labelsRenderedGoalCounter.resetCount()},n.prototype.incrementDataLoadedCount=function(){this._dataLoadedGoalCounter.incrementCount()},n.prototype.incrementPrimitivesRenderedCount=function(){this._primitivesRenderedGoalCounter.incrementCount()},n.prototype.incrementLabelsRenderedCount=function(){this._labelsRenderedGoalCounter.incrementCount()},n.prototype.haveAllLayersLoadedData=function(){return this._dataLoadedGoalCounter.hasReachedGoal()},n.prototype.haveAllLayersRenderedPrimitives=function(){return this._primitivesRenderedGoalCounter.hasReachedGoal()},n.prototype.haveAllLayersRenderedLabels=function(){return this._labelsRenderedGoalCounter.hasReachedGoal()},n.prototype.haveAllLayersCompleted=function(){return this.haveAllLayersLoadedData()&&this.haveAllLayersRenderedPrimitives()&&this.haveAllLayersRenderedLabels()},n}(),gt=function(){function n(n,t){this.frame=n;this._layerData=t}return n.prototype.getLayerFrameData=function(){return this._layerData},n.prototype.getLayerFrameDataByLayer=function(n){for(var t=0;t<this._layerData.length;t++)if(this._layerData[t].layer===n)return this._layerData[t];return null},n.prototype.getPrimitives=function(n,t){return i.tileRefactoringEnabled?t?(this._allScreenSpacePrimitives||(this._allScreenSpacePrimitives=this._getFilteredPrimitives(n,t)),this._allScreenSpacePrimitives):(this._allWorldSpacePrimitives||(this._allWorldSpacePrimitives=this._getFilteredPrimitives(n,t)),this._allWorldSpacePrimitives):(this._allPrimitives||(this._allPrimitives=this._getFilteredPrimitives(n)),this._allPrimitives)},n.prototype._getFilteredPrimitives=function(n,t){for(var i,u=[],e=this._layerData.length,r=0;r<e;r++){var o=this._layerData[r],f=o.getPrimitives(n,t),s=f.length;for(i=0;i<s;i++)u.push(f[i])}return u},n}(),ni=function(){function n(n,t){var u=this;this._tileRefactoringEnabled=i.tileRefactoringEnabled;this._map=n;this._allLayers=t;this._currentFrameNumber=this._lastViewChangeFrameNumber=0;this._currentFramePurpose=2;this._currentFrameView=null;this._currentFrameViewport=null;this._disposables=[];this._layerFrameManagers=[];this._layerFrameManagersDisposables=[];this._hiddenLayers=[];this._hiddenLayersDisposables=[];this._frameEventAggregator=new au;this._layerInfoDictionary={};this._disposables.push(n.changed.add(function(n){return u._onMapChanged(n)}));this._disposables.push(t.changed.add(function(n){return u._onMapLayersCollectionChanged(n)}));this._disposables.push(n.getAllLayers().layerChanged.add(function(n){var t=n?n.getId():null;u._setFrame(4,[t],null,2)}));this._disposables.push(n.mapPanStopped.add(function(n){return u._onMapPanStopped(n)}));this._disposables.push(n.mapZoomStopped.add(function(n){return u._onMapZoomStopped(n)}));this._disposables.push(n.mapManipulationStopped.add(function(n){return u._onMapManipulationStopped(n)}));this._tileRefactoringEnabled||(this._disposables.push(n.mapZoomStarted.add(function(){return u._frameChangeStarted()})),this._disposables.push(n.mapPanStarted.add(function(){return u._frameChangeStarted()})));this._disposables.push(this.frameSet=new r,this.dataLoaded=new r,this.primitivesRendered=new r,this.labelsRendered=new r,this.frameRendered=new r,this.frameFailed=new r,this.mapReady=new r,this.layerDataLoaded=new r,this.layerPrimitivesRendered=new r,this.layerLabelsRendered=new r,this.layerFrameRendered=new r,this.layerFrameFailed=new r)}return n.prototype.initializeLayers=function(){for(var i,r,t=0;t<this._allLayers.length;t++)this._tileRefactoringEnabled?this._addLayer(this._allLayers[t]):(i=n._asVectorMapLayer(this._allLayers[t]),i&&this._addLayer(i));r=this._map.getMode();r&&this._setFrame(0,null,null,2)},n.prototype.getFrame=function(){return this._currentFrameNumber===0?null:{frameNumber:this._currentFrameNumber,purpose:this._currentFramePurpose,view:this._currentFrameView,viewport:this._currentFrameViewport,lastViewChangeFrameNumber:this._lastViewChangeFrameNumber,cause:this._lastFrameChangeCause,causeEntityIds:this._lastFrameChangeEntityIds,causeLayerIds:this._lastFrameChangeLayerIds}},n.prototype.getFrameData=function(){var t,n,i;if(this._currentFrameNumber===0)return null;if(!this._currentFrameData){for(t=[],n=0;n<this._layerFrameManagers.length;n++)i=this._layerInfoDictionary[this._layerFrameManagers[n].getLayer().getId()],i.currentFrameData&&t.push(i.currentFrameData);this._currentFrameData=new gt(this.getFrame(),t)}return this._currentFrameData},n.prototype.getPreviousFrameData=function(){var r,i,n,t;if(this._currentFrameNumber===0)return null;if(!this._previousFrameData){for(i=[],n=0;n<this._layerFrameManagers.length;n++)t=this._layerInfoDictionary[this._layerFrameManagers[n].getLayer().getId()],t.previousFrameData&&(r=t.previousFrameData.frame,i.push(t.previousFrameData));this._previousFrameData=new gt(r,i)}return this._previousFrameData},n.prototype.getPreviousTargetFrameData=function(){var r,i,n,t;if(this._currentFrameNumber===0)return null;if(!this._previousTargetFrameData){for(i=[],n=0;n<this._layerFrameManagers.length;n++)t=this._layerInfoDictionary[this._layerFrameManagers[n].getLayer().getId()],t.previousTargetFrameData&&(r=t.previousTargetFrameData.frame,i.push(t.previousTargetFrameData));this._previousTargetFrameData=new gt(r,i)}return this._previousTargetFrameData},n.prototype.isCurrent=function(n){return n.frameNumber===this._currentFrameNumber},n.prototype.hasCurrentFrameCompletedDataLoadingPhase=function(){return this._frameEventAggregator.haveAllLayersLoadedData()},n.prototype.hasCurrentFrameCompletedPrimitiveRenderingPhase=function(){return this._frameEventAggregator.haveAllLayersRenderedPrimitives()},n.prototype.hasCurrentFrameCompletedLabelRenderingPhase=function(){return this._frameEventAggregator.haveAllLayersRenderedLabels()},n.prototype.hasCurrentFrameRendered=function(){return this._frameEventAggregator.haveAllLayersCompleted()},n.prototype.hasCurrentFrameFailed=function(){return!this._isCurrentFramePending()&&!this._frameEventAggregator.haveAllLayersCompleted()},n.prototype.isMapReady=function(){return this._isMapReady},n.prototype.completePrimitiveRenderingPhase=function(n){if(this.isCurrent(n))for(var t=0;t<this._layerFrameManagers.length;t++)this._layerFrameManagers[t].completePrimitiveRenderingPhase(n)},n.prototype.completeLabelRenderingPhase=function(n){if(this.isCurrent(n))for(var t=0;t<this._layerFrameManagers.length;t++)this._layerFrameManagers[t].completeLabelRenderingPhase(n)},n.prototype.dispose=function(){var n,t,i;for(this._stopTimeoutTimer(),u._clearDisposables(this._disposables),n=0,t=this._layerFrameManagersDisposables.length;n<t;n++)i=this._layerFrameManagersDisposables[n],u._clearDisposables(i);u._clearDisposables(this._layerFrameManagers);this._map=null;this._layerInfoDictionary=null;this._currentFrameViewport=null;this._frameEventAggregator=null;this._currentFrameView=null;this._lastUpdatedView=null;this._lastUpdatedViewport=null},n.prototype.hackHackSetFrame=function(){this._setFrame(99)},n.prototype._frameChangeStarted=function(){var t,n;if(this._map.getMode()&&(this._map.getActualSize().width!==0||this._map.getActualSize().height!==0))for(t=this.getFrame(),n=0;n<this._layerFrameManagers.length;n++)this._layerFrameManagers[n].frameChangeStarted(t)},n.prototype._setFrame=function(n,t,i,r){var u,f;if(this._map&&!this._map.isDisposed()&&this._map.getMode()&&(!this._tileRefactoringEnabled||this._map.getActualSize().width!==0)&&this._map.getActualSize().height!==0&&(this._tileRefactoringEnabled||this._map.getActualSize().width!==0||this._map.getActualSize().height!==0)){for(u=this.getFrame(),this._isCurrentFramePending()&&this._failFrame(u,1,null),this._lastFrameChangeCause=n,this._lastFrameChangeEntityIds=i,this._lastFrameChangeLayerIds=t,this._currentFrameNumber++,this._currentFramePurpose=r?r:this._currentFramePurpose,this._currentFrameView=this._map.getView(),this._currentFrameViewport=this._map.getViewport(),this._tileRefactoringEnabled?p.areEqual(this._currentFrameView,this._lastUpdatedView)?this._currentFrameViewport.areEqual(this._lastUpdatedViewport)||(this._lastUpdatedViewport=this._currentFrameViewport,this._lastViewChangeFrameNumber=this._currentFrameNumber):(this._lastUpdatedView=this._currentFrameView,this._lastViewChangeFrameNumber=this._currentFrameNumber):(this._previousFrameData=null,this._previousTargetFrameData=null),this._currentFrameData=null,this._frameEventAggregator.resetEventCounts(),this._startTimeoutTimer(),u=this.getFrame(),f=0;f<this._layerFrameManagers.length;f++)this._layerFrameManagers[f].setFrame(u);this.frameSet.invoke({frame:u});this._layerFrameManagers.length===0&&(this.dataLoaded.invoke({frame:u}),this.primitivesRendered.invoke({frame:u}),this.labelsRendered.invoke({frame:u}),this._checkIfFrameIsFullyRendered())}},n.prototype._failFrame=function(n,t,r){this.isCurrent(n)&&(this._stopTimeoutTimer(),this.frameFailed.invoke({frame:n,reason:t,errorMessage:r}),this._isMapReady||t!==1&&(this._isMapReady=!0,this.mapReady.invoke()),i.tileRefactoringEnabled&&t===5&&this._setFrame(8))},n.prototype._addLayer=function(n){var r=this,t=new lu(this._map,n,this._allLayers.isBaseLayer(n)),i;n.setFrameManager(t);this._layerFrameManagers.push(t);this._layerInfoDictionary[n.getId()]={layer:n,currentFrameData:null,previousFrameData:null,previousTargetFrameData:null};this._frameEventAggregator.setLayerCount(this._layerFrameManagers.length);i=[];i.push(t.dataLoaded.add(function(n){return r._onLayerDataLoaded(n)}));i.push(t.primitivesRendered.add(function(n){return r._onLayerPrimitivesRendered(n)}));i.push(t.labelsRendered.add(function(n){return r._onLayerLabelsRendered(n)}));i.push(t.frameFailed.add(function(n){return r._onLayerFailed(n)}));i.push(t.layerInvalidated.add(function(n){return r._onLayerInvalidated(n)}));this._layerFrameManagersDisposables.push(i)},n.prototype._removeLayer=function(n){var r=n.getFrameManager(),t,u,i;if(r)for(r.dispose(),t=this._layerFrameManagers.indexOf(r),this._layerFrameManagers.splice(t,1),this._frameEventAggregator.setLayerCount(this._layerFrameManagers.length),u=this._layerFrameManagersDisposables[t],this._layerFrameManagersDisposables.splice(t,1),i=0;i<u.length;i++)u[i].dispose();delete this._layerInfoDictionary[n.getId()]},n.prototype._checkIfFrameIsFullyRendered=function(){this._frameEventAggregator.haveAllLayersCompleted()&&(this._stopTimeoutTimer(),this.frameRendered.invoke({frame:this.getFrame()}),this._isMapReady||(this._isMapReady=!0,this.mapReady.invoke()))},n.prototype._updateMapFrameData=function(){for(var n,r,i=Object.keys(this._layerInfoDictionary),t=0,u=i.length;t<u;t++)n=this._layerInfoDictionary[i[t]],r=n.layer.getFrameManager(),n.previousFrameData=n.currentFrameData,n.currentFrameData&&n.currentFrameData.frame.purpose===2&&(n.previousTargetFrameData=n.currentFrameData),n.currentFrameData=r.getFrameData();this._currentFrameData=null},n.prototype._startTimeoutTimer=function(){var t=this;this._intervalId&&window.clearInterval(this._intervalId);this._intervalId=Microsoft.Maps.setInterval(function(){t._onFrameTimedOut()},n._timeoutDuration)},n.prototype._stopTimeoutTimer=function(){this._intervalId&&window.clearInterval(this._intervalId);this._intervalId=0},n.prototype._isCurrentFramePending=function(){return!!this._intervalId},n._asVectorMapLayer=function(n){return n instanceof ii?n:null},n.prototype._onMapChanged=function(n){var i=this,t=null;n.name==="actualSize"?t=3:n.name==="mode"&&(t=5);t!==null&&Microsoft.Maps.setTimeout(function(){return i._setFrame(t)},0)},n.prototype._onMapLayersCollectionChanged=function(t){var r,f=[],u,i;if(t.reset){for(i=this._layerFrameManagers.length;i--;)this._tileRefactoringEnabled?(u=this._layerFrameManagers[i].getLayer(),f.push(u.getId()),this._removeLayer(u)):(r=n._asVectorMapLayer(this._layerFrameManagers[i].getLayer()),r&&this._removeLayer(r));for(i=0;i<this._allLayers.length;i++)this._tileRefactoringEnabled?(u=this._allLayers[i],f.push(u.getId()),this._addLayer(u)):(r=n._asVectorMapLayer(this._allLayers[i]),r&&this._addLayer(r))}if(t.added)for(i=0;i<t.added.length;i++)this._tileRefactoringEnabled?(u=t.added[i],f.push(u.getId()),this._addLayer(u)):(r=n._asVectorMapLayer(t.added[i]),r&&this._addLayer(r));if(t.removed)for(i=0;i<t.removed.length;i++)this._tileRefactoringEnabled?(u=t.removed[i],f.push(u.getId()),this._removeLayer(u)):(r=n._asVectorMapLayer(t.removed[i]),r&&this._removeLayer(r));this._setFrame(4,f)},n.prototype._onMapViewChanging=function(){this._setFrame(7,null,null,1)},n.prototype._onMapViewChanged=function(){this._setFrame(6,null,null,2)},n.prototype._onMapPanStopped=function(){this._setFrame(1,null,null,2)},n.prototype._onMapZoomStopped=function(){this._setFrame(1,null,null,2)},n.prototype._onMapManipulationStopped=function(){this._setFrame(6,null,null,2)},n.prototype._onLayerDataLoaded=function(n){(this.layerDataLoaded.invoke(n),this.isCurrent(n.frame))&&(this._frameEventAggregator.incrementDataLoadedCount(),this._frameEventAggregator.haveAllLayersLoadedData()&&(this._updateMapFrameData(),this.dataLoaded.invoke({frame:n.frame})),this._checkIfFrameIsFullyRendered())},n.prototype._onLayerPrimitivesRendered=function(n){(this.layerPrimitivesRendered.invoke(n),this.isCurrent(n.frame))&&(this._frameEventAggregator.incrementPrimitivesRenderedCount(),this._frameEventAggregator.haveAllLayersRenderedPrimitives()&&this.primitivesRendered.invoke({frame:n.frame}),this._checkIfFrameIsFullyRendered())},n.prototype._onLayerLabelsRendered=function(n){(this.layerLabelsRendered.invoke(n),this.isCurrent(n.frame))&&(this._frameEventAggregator.incrementLabelsRenderedCount(),this._frameEventAggregator.haveAllLayersRenderedLabels()&&this.labelsRendered.invoke({frame:n.frame}),this._checkIfFrameIsFullyRendered())},n.prototype._onLayerFailed=function(n){var t,i;(this.layerFrameFailed.invoke(n),this._isCurrentFramePending())&&(t=e.logger,t&&(i={feature:tt.MapControl,action:b.Error,data:{}},n&&(i.data={layerId:n.layer?n.layer.getId():"",reason:n.reason,errorMessage:"Layer failed; "+n.errorMessage}),t.logCriticalError(null,i,!0)),this._failFrame(n.frame,n.reason,n.errorMessage),this._stopTimeoutTimer())},n.prototype._onLayerInvalidated=function(n){var t,i;n&&(t=n.entityIds,i=[n.layerId]);this._setFrame(4,i,t)},n.prototype._onFrameTimedOut=function(){var i,n,r;t.assert(this._isCurrentFramePending(),"A timeout cannot occur unless the current frame is pending.");this._stopTimeoutTimer();i=this.getFrame();n=e.logger;n&&(r={feature:tt.MapControl,action:b.Error,data:{errorMessage:"Frame timed out."}},n.logCriticalError(null,r,!0));this._failFrame(i,5,null)},n.frameZero={frameNumber:0,purpose:2,view:null,viewport:null,lastViewChangeFrameNumber:0,cause:0},n._timeoutDuration=2e4,n}(),p=function(){function n(n,t){this.cameraLocation=n;this.heading=((t||0)%360+360)%360;this.heading=this.heading>315?this.heading-360:this.heading}return n.prototype.clone=function(){var t=new n(this.cameraLocation.clone(),this.heading);return t.pitch=this.pitch,t.verticalFov=this.verticalFov,t},n.areEqual=function(t,i){return t===i?!0:!t||!i?!1:n.areNumbersEqual(t.heading,i.heading)?n.areNumbersEqual(t.pitch,i.pitch)?n.areNumbersEqual(t.verticalFov,i.verticalFov)?o.areEqual(t.cameraLocation,i.cameraLocation)?!0:!1:!1:!1:!1},n.areCameraAltitudesEqual=function(n,t){return n.cameraLocation.altitude===t.cameraLocation.altitude&&n.cameraLocation.altitudeReference===t.cameraLocation.altitudeReference},n.areNumbersEqual=function(n,t){if(n===t)return!0;if(n===undefined||n===null||t===undefined||t===null)return!1;return Math.abs(n-t)<=1e-6},n}(),fr=function(){function n(){}return n.zoomIn="ZoomIn",n.zoomOut="ZoomOut",n}(),h=function(){function n(){}return n.viewChangedLogKey="MC_SV",n.zoomLogKey="MC_Z",n.panLogKey="MC_P",n.bootstrapLogKey="MC_BSP",n.mapZoomActionName="MapZoom",n.mapLayerAdded="MapLayerAdded",n.mapLayerRemoved="MapLayerRemoved",n.mapPanActionName="MapPan",n.mapSetViewActionName="SetView",n.mapTypeChangedActionName="MapTypeChanged",n.styleNeworkLatencyLogkey="ST_NL",n.rasterNeworkLatencyLogkey="RT_NL",n.vectorNeworkLatencyLogkey="VT_NL",n.bootstrapPerceivedPerfLogKey="$bsperf",n.ppltLogKey="PPLT",n.tppltLogKey="TPPLT",n.mapControlPageNameKey="mc",n}(),vu=function(){function n(n,t,r,u,f){var e=this;this._disposables=[];this._map=n;this._clientPerf=t;this._logger=r;this._state=0;this._currentPerfObject=null;this._tickTimeCapture=[];this._lastTickTime=0;this._timetoFirstPaint=0;this._tickMax=0;this._scenario=f;this._overhead="";this._totalTicks=0;i.enableInstrumentation&&this._disposables.push(new yr(this._map,u));this._disposables.push(this._map.frameManagerLoaded.add(function(){return e._onMapFrameManagerLoaded()}));this._disposables.push(this._map.labelControllerLoaded.add(function(){return e._onMapLabelControllerLoaded()}));this._disposables.push(this._map.mapZoomStarted.add(function(n){return e._onMapZoomStarted(n)}));this._disposables.push(this._map.mapZoomStopped.add(function(n){return e._onMapZoomStopped(n)}));this._disposables.push(this._map.mapPanStarted.add(function(n){return e._onMapPanStarted(n)}));this._disposables.push(this._map.mapPanStopped.add(function(n){return e._onMapPanStopped(n)}));this._disposables.push(this._map.getAllLayers().changed.add(function(n){return e._onMapLayersChanged(n)}));this._disposables.push(u.tickRaised.add(function(){return e._onDispatcherTickRaised()}));this._disposables.push(this._map.viewChanged.add(function(n){return e._onMapViewChanged(n)}));this._disposables.push(this._map.mapTypeChanged.add(function(n){return e._onMapTypeChanged(n)}));this._viewChangingHandler=this._map.viewChanging.add(function(n){return e._onMapViewChanging(n)})}return n.prototype._onMapFrameManagerLoaded=function(){var n=this;this._disposables.push(this._map.getFrameManager().frameSet.add(function(t){return n._onFrameManagerFrameSet(t)}));this._disposables.push(this._map.getFrameManager().frameFailed.add(function(t){return n._onFrameManagerFrameFailed(t)}));this._disposables.push(this._map.getFrameManager().frameRendered.add(function(t){return n._onFrameRendered(t)}));this._disposables.push(this._map.getFrameManager().dataLoaded.add(function(t){return n._onFrameManagerDataLoaded(t)}));this._logPerfTiming()},n.prototype._onMapLabelControllerLoaded=function(){var n=this;this._disposables.push(this._map.getLabelController().instrumentLabelingPass.add(function(t){return n._onInstrumentLabelingPass(t)}))},n.prototype.setMapMode=function(n){var i=this,t;n.mapModeType===0?(this._disposables.push(n.onPaint.add(function(n){return i._onCompositeModePaint(n)})),this._disposables.push(n.onFrameRendered.add(function(n){return i._onCompositeModeFrameRendered(n)})),t=this._map.getMapOptions().mapTypeId,t===f.ordnanceSurvey&&this._logMapTypeChangedInst(t)):this._resetInstrumentationState()},n.prototype._onInstrumentLabelingPass=function(n){var r=this._getCorePerfObject(),i,t,u;r&&(i={},i.CLT=n.collisionTime,i.SRT=n.collisionSortTime,t=r.LETX,t.FN=n.frameNumber,t.CLN=i,t.TT=n.totalLabelingTime,t.AST=n.timeToAddStyles,t.LDP=n.labelDataProcessingTime,t.RT=n.renderingTime,t.DRT=n.delayedRenderingTime,t.PCPT=n.primitiveChangeProcessingTime,t.CRT=n.computeRenderablesTime,t.IPT=n.initializePositionTime,t.FRT=n.fullRenderTime,t.PC=n.primitiveCount,t.LC=n.labelCount);n.landmarksCount&&(u={feature:tt.Landmarks,action:b.Activated,data:{CT:n.landmarksCount}},this._logger.logObject(u,null,!0))},n.prototype._setOverhead=function(n){this._overhead=n},n.prototype._onDispatcherTickRaised=function(){if(this._state!==0){var n=u._getCurrentTimeStamp(),t=n-this._lastTickTime;t>this._tickMax&&(this._tickMax=t);this._totalTicks++;this._lastTickTime=n}},n.prototype._onFrameManagerFrameSet=function(n){t.log(null,"Frame set {0}",u._getCurrentTimeStamp());t.logResourceLoadOrder(null,"FrameSet");this._targetFrameNumber=n.frame.frameNumber;this._state===0&&n.frame.purpose===2&&this._createViewChangedPerfObject()},n.prototype._onMapLayersChanged=function(n){var t=[],u=!0,i,r;for(n.added?(this._createViewChangedPerfObject(),t=n.added):n.removed&&(t=n.removed,u=!1),i=0;i<t.length;i++)r=t[i],r.logWhenAddedOrRemoved&&this._logLayerChangedInst(u,r.logId)},n.prototype._onMapViewChanging=function(n){n.cause===3&&(this._state=3,this._createBootstrapPerfObject())},n.prototype._onMapViewChanged=function(n){n&&n.cause===0&&(this._createViewChangedPerfObject(),this._logClientInst(h.mapSetViewActionName))},n.prototype._onMapTypeChanged=function(n){n&&this._logMapTypeChangedInst(n.newMapTypeId)},n.prototype._onMapPanStarted=function(n){var t;switch(this._state){case 0:this._createPanPerfObject(n);break;case 2:t=this._getCorePerfObject();t&&(t.STS=1,t.E=u._getCurrentTimeStamp(),this._logClientPerf(h.panLogKey),this._logClientInst(h.mapPanActionName));this._createPanPerfObject(n);break;case 1:t=this._getCorePerfObject();t&&(t.STS=1,t.E=u._getCurrentTimeStamp(),this._logClientPerf(h.zoomLogKey),this._logClientInst(h.mapZoomActionName));this._createPanPerfObject(n);break;case 4:t=this._getCorePerfObject();t&&(t.STS=1,t.E=u._getCurrentTimeStamp(),this._logClientPerf(h.viewChangedLogKey));this._createPanPerfObject(n)}},n.prototype._onMapPanStopped=function(n){switch(this._state){case 0:this._handleInvalidStateTransition();break;case 2:var t=this._currentPerfObject;t.DESTX=n.point.x;t.DESTY=n.point.y;this._panTTGStartTime=u._getCurrentTimeStamp();break;case 1:this._handleInvalidStateTransition();break;case 4:this._handleInvalidStateTransition()}},n.prototype._onMapZoomStarted=function(n){var t,i;switch(this._state){case 0:this._createZoomPerfObject(n);break;case 2:t=this._getCorePerfObject();t&&(t.STS=1,t.E=u._getCurrentTimeStamp(),this._logClientPerf(h.panLogKey),this._logClientInst(h.mapPanActionName));this._createZoomPerfObject(n);break;case 1:i=this._currentPerfObject;i&&i.ZDEST&&(i.PRF.STS=1,i.PRF.E=u._getCurrentTimeStamp(),this._logClientPerf(h.zoomLogKey),this._logClientInst(h.mapZoomActionName));this._createZoomPerfObject(n);break;case 4:t=this._getCorePerfObject();t&&(t.STS=1,t.E=u._getCurrentTimeStamp(),this._logClientPerf(h.viewChangedLogKey));this._createZoomPerfObject(n)}},n.prototype._onMapZoomStopped=function(n){switch(this._state){case 0:this._handleInvalidStateTransition();break;case 2:this._handleInvalidStateTransition();break;case 4:this._handleInvalidStateTransition();break;case 1:var t=this._currentPerfObject;t&&(t.ZDEST=n.zoom.toFixed(3))}},n.prototype._onFrameManagerDataLoaded=function(n){var t,i;n.frame.frameNumber===this._targetFrameNumber&&(t=this._getCorePerfObject(),t&&(i=t.METX,i.DL=u._getCurrentTimeStamp()-t.S,t.STS=3))},n.prototype._onFrameRendered=function(n){var i,r,f;if(t.log(null,"Frame Rendered {0}",u._getCurrentTimeStamp()),t.logResourceLoadOrder(null,"FrameRendered"),n.frame.frameNumber===this._targetFrameNumber&&(i=this._getCorePerfObject(),i&&(i.E=u._getCurrentTimeStamp(),i.STS=4,i.FRN=n.frame.frameNumber,this._isCurrentOperationComplete()))){r="";f=null;switch(this._state){case 3:r=h.bootstrapLogKey;f=b.Activated;break;case 2:r=h.panLogKey;f=h.mapPanActionName;i.LFT=u._getCurrentTimeStamp()-this._panTTGStartTime;break;case 1:r=h.zoomLogKey;f=h.mapZoomActionName;break;case 4:r=h.viewChangedLogKey}this._logClientPerf(r);f&&this._logClientInst(f);this._lastZoomLevel=this._map.getMercatorZoomLevel()}},n.prototype._onFrameManagerFrameFailed=function(n){n.reason!==1&&this._resetInstrumentationState()},n.prototype._onCompositeModePaint=function(n){var t=this._getCorePerfObject();t&&n.percentComplete>0&&this._timetoFirstPaint===0&&(this._timetoFirstPaint=u._getCurrentTimeStamp())},n.prototype._onCompositeModeFrameRendered=function(){var n=this._getCorePerfObject();n&&(n.METX.PRD=u._getCurrentTimeStamp()-n.S,n.STS=2)},n.prototype._createBootstrapPerfObject=function(){var n=this._createCorePerObject();n.STS=0;window[h.bootstrapPerceivedPerfLogKey]&&window[h.bootstrapPerceivedPerfLogKey][h.ppltLogKey]&&(n.PPLT=window[h.bootstrapPerceivedPerfLogKey][h.ppltLogKey],n.TPPLT=window[h.bootstrapPerceivedPerfLogKey][h.tppltLogKey],typeof performance!="undefined"&&performance.timing&&(n.BST=(new Date).getTime()-performance.timing.navigationStart-n.TPPLT));this._currentPerfObject=n},n.prototype._createViewChangedPerfObject=function(){var n=this._createCorePerObject();this._currentPerfObject=n;this._state=4},n.prototype._createPanPerfObject=function(n){var t={};t.PRF=this._createCorePerObject();t.SRCX=n.point.x;t.SRCY=n.point.y;this._currentPerfObject=t;this._state=2},n.prototype._createZoomPerfObject=function(n){var t={};t.PRF=this._createCorePerObject();t.ZSRC=n.zoom.toFixed(3);this._currentPerfObject=t;this._state=1},n.prototype._createCorePerObject=function(){var n={};return n.METX={},n.LETX={},this._scenario&&(n.SCN=this._scenario),this._overhead&&(n.OVD=this._overhead),n.S=u._getCurrentTimeStamp(),n.PLS=0,this._lastTickTime=n.S,n},n.prototype._getCorePerfObject=function(){if(this._currentPerfObject){if(this._state===3||this._state===4)return this._currentPerfObject;if(this._state===2||this._state===1)return this._currentPerfObject.PRF}return null},n.prototype._constructMapInstrumentationData=function(n){var i=this._map,f=i.isDisposed(),t=!f&&i.getView(),e=!f&&i.getMode(),r={CP:t&&t.cameraLocation,H:t&&t.heading,A:t&&t.cameraLocation.altitude,MM:e&&e.getDisplayName()},o;return(n===b.Activated||n===b.Deactivated)&&(r.T=u._getCurrentTimeStamp()),n===h.mapZoomActionName&&this._lastZoomLevel&&(o=this._map.getMercatorZoomLevel(),r.ZD=o>this._lastZoomLevel?fr.zoomIn:fr.zoomOut),r},n.prototype._logClientPerf=function(n){var r=this._getCorePerfObject(),i;r&&(this._calculatePerfMetrics(),typeof JSON!="undefined"&&typeof JSON.stringify!="undefined"&&(i={key:n,value:this._currentPerfObject},t.logPerfInstrumentation(null,JSON.stringify(i))),this._clientPerf.log(n,this._currentPerfObject),this._state===3&&this._logSnrPageNameForMapControl(),this._resetInstrumentationState())},n.prototype._logLayerChangedInst=function(n,t){var r=n?h.mapLayerAdded:h.mapLayerRemoved,i=this._createLogData(r);i.data.ID=t;this._logger.logObject(i,null,!1)},n.prototype._logMapTypeChangedInst=function(n){var t=this._createLogData(h.mapTypeChangedActionName),r;t.data.MS=n;this._logger.logObject(t,null,!1);i.features.localSearch.sendMoreInstrumentationForOverlay&&i.dynamicProperties.serpIG&&this._logger.logObject(t,i.dynamicProperties.serpIG,!1);n===f.ordnanceSurvey&&(r=this._map.getConfig().logServiceUrlFormat.replace(/{credentials}/,this._map.getMapOptions().credentials).replace(/{name}/,"imageryOS").replace(/{mkt}/,i.dynamicProperties.market),ut.downloadJsonp(r,"ordnanceSurvey",null,null,null,null,null,3))},n.prototype._logClientInst=function(n){var r=n===b.Activated||n===h.mapSetViewActionName,t=this._createLogData(n);this._logger.logObject(t,null,r);i.features.localSearch.sendMoreInstrumentationForOverlay&&i.dynamicProperties.serpIG&&(n===h.mapZoomActionName||n===h.mapPanActionName)&&this._logger.logObject(t,i.dynamicProperties.serpIG,!1)},n.prototype._createLogData=function(n){var t=this._constructMapInstrumentationData(n);return{feature:tt.MapControl,action:n,data:t}},n.prototype._handleInvalidStateTransition=function(){this._resetInstrumentationState()},n.prototype._resetInstrumentationState=function(){this._state=0;this._currentPerfObject=null;this._tickTimeCapture=[];this._targetFrameNumber=0;this._timetoFirstPaint=0;this._totalTicks=0;this._lastTickTime=0;this._tickMax=0;this._overhead="";this._panTTGStartTime=0},n.prototype._calculatePerfMetrics=function(){var t=this._getCorePerfObject(),n,i;t&&(n=t.METX,i=[],n.TTG=t.E-t.S,this._timetoFirstPaint>0&&(n.TTC=this._timetoFirstPaint-t.S),n.AFT=(n.TTG/this._totalTicks).toFixed(2),n.MFT=this._tickMax.toFixed(2),n.FPS=(this._totalTicks/(n.TTG/1e3)).toFixed(2),window.performance&&window.performance.hasOwnProperty("memory")&&(n.MEM=window.performance.memory))},n.prototype._isCurrentOperationComplete=function(){var t=!0,i,n;return this._state===1?(i=this._currentPerfObject,i&&!i.ZDEST&&(t=!1)):this._state===2&&(n=this._currentPerfObject,n&&n.DESTX===0&&n.DESTY===0&&(t=!1)),t},n.prototype._logNetworkLatencies=function(){var i,r,u,f,e,s,t,o;if(window.performance&&window.performance.getEntriesByType){if(r=window.performance.getEntriesByType("resource"),r&&r.length>0){for(u={},f={},e=0,s=r.length;e<s;e++)t=r[e],t.name.indexOf(n._styleResourceKey)>-1?this._clientPerf.log(h.styleNeworkLatencyLogkey,t.duration.toFixed(2)):t.name.indexOf(n._imageryResourceKey)>-1?t.startTime>=n._lastKnownRasterTileStartime&&(i=this._extractQuadKeyFromResourceName(t.name),u[i]||(u[i]=t.duration.toFixed(2)),n._lastKnownRasterTileStartime=t.startTime):t.name.indexOf(n._vectorResourceKey)>-1&&t.startTime>=n._lastKnownVectorTileStartime&&(i=this._extractQuadKeyFromResourceName(t.name),f[i]||(f[i]=t.duration.toFixed(2)),n._lastKnownVectorTileStartime=t.startTime);this._clientPerf.log(h.rasterNeworkLatencyLogkey,u);this._clientPerf.log(h.vectorNeworkLatencyLogkey,f)}o=window.performance.clearResourceTimings||window.performance.webkitClearResourceTimings;o&&o.call(window.performance)}},n.prototype._logSnrPageNameForMapControl=function(){if(i.enableInstrumentation){var n=this._map.getConfig().serverInstrumentationUrlFormat.replace("{origin}",i.dynamicProperties.origin).replace("{q}","").replace("{f}",h.mapControlPageNameKey),t="MONITR";window.location.href.toUpperCase().indexOf(t)>-1&&(n+="&FORM="+t);ut.downloadGeneric(n,"pagename",function(){},null,null,null,3)}},n.prototype._extractQuadKeyFromResourceName=function(n){var t=n.lastIndexOf("/")+1,i=n.lastIndexOf("?");return n.substring(t,i)},n.prototype._logPerfTiming=function(){if(!i.isMapsAnswer&&!i.isMapsVertical&&this._map.getConfig()&&this._map.getConfig().enableSDKLogging){var n=window.performance&&window.performance.timing;n&&this._logger.logObject({T:"CI.ClientPerf",FID:b.ClientInstNamespace,feature:tt.SDK,action:b.Perf,data:n})}},n.prototype.dispose=function(){this._logger&&this._logClientInst(b.Deactivated);u._clearDisposables(this._disposables);this._map=null;this._logger=null;this._clientPerf=null},n._imageryResourceKey="/comp/ch",n._vectorResourceKey="/vector/vh",n._styleResourceKey="/vector/stl",n._lastKnownRasterTileStartime=0,n._lastKnownVectorTileStartime=0,n}(),a=function(){function n(){}return n.fromScaleMarker=function(n){if(n<this.scaleMarkers[this.maxZoom-1])return this.maxZoom;if(n>this.scaleMarkers[0])return 1;for(var t=0;t<this.maxZoom;t++)if(n>=this.scaleMarkers[t])return t+1;throw"Invalid operation exception";},n.fromLocation=function(t,i){var r=t.altitude*n._tanHalfFieldOfView;return n._getZoomFromMetersPerPixel(i?0:t.latitude,r/n._halfViewportWidth)},n.toLocation=function(t,i,r){var u=n.toAltitude(t,i,r);return new o(t.latitude,t.longitude,u,0)},n.toAltitude=function(t,i,r){var u=n._getMetersPerPixel(r?0:t.latitude,i)*n._halfViewportWidth;return u/n._tanHalfFieldOfView},n.toScale=function(t,i,r){return n._getMetersPerPixel(r?0:t.latitude,i)},n.fromScale=function(t,i,r){return n._getZoomFromMetersPerPixel(r?0:t.latitude,i)},n._getMetersPerPixel=function(t,i){return Math.cos(l.degreesToRadians(t))*d.earthCircumference/(n._tileSize*Math.pow(2,i))},n._getZoomFromMetersPerPixel=function(t,i){return l.log2(Math.cos(l.degreesToRadians(t))*d.earthCircumference/(n._tileSize*i))},n._tileSize=256,n._halfViewportWidth=500,n._tanHalfFieldOfView=Math.tan(l.degreesToRadians(25)),n.maxZoom=23,n.scaleMarkers=[295824261.1,147912130.6,73956065.28,36978032.64,18489016.32,9244508.16,4622254.08,2311127.04,1155563.52,577781.76,288890.88,144445.44,72222.72,36111.36,18055.68,9027.84,4513.92,2256.96,1128.48,564.24,282.12,141.06,70.53],n}(),yu=function(){function n(n,t,i,r,u,f,e){this.priority=n;this._scene=t;this._minHeading=i||0;this._maxHeading=r||0;this._minScale=u||a.toScale(null,23,!0);this._maxScale=f||a.toScale(null,1,!0);this._bounds=e}return n.prototype.getScene=function(n,t,i,r){var u;return n?n===this._scene.crs&&(!this._bounds||this._isIntersecting(this._bounds,t))&&r>=this._minHeading&&r<=this._maxHeading&&(i>=this._minScale||n.sceneMetadata)&&i<=this._maxScale&&(u=this._scene):(!this._bounds||this._isIntersecting(this._bounds,t))&&r>=this._minHeading&&r<=this._maxHeading&&i>=this._minScale&&i<=this._maxScale&&(u=this._scene),u},n.prototype.dispose=function(){this._scene&&this._scene.dispose();this._bounds=null},n.prototype._isIntersecting=function(n,t){return t instanceof o?n.contains(t):n.intersects(t)},n}(),ti=function(n){function e(t,f,e,o,s,h,c,l,a,v){c===void 0&&(c=18e5);a===void 0&&(a=!1);v===void 0&&(v="");var y=n.call(this,t,f,e,o,s,a,v)||this;return y._minCriticalDataLoadedPercentage=80,y._networkPriority=h,y._sceneContributors=[],y._pendingCriticalDataLoadedResolves=[],y._cacheDuration=c,i.tileRefactoringEnabled&&(y.setRenderTarget(0),y._rasterTiles=[],y._disposables.push(y.tileDownloaded=new r),y._disposables.push(y.dataLoaded=new r),y._disposables.push(y.crsReady=new r),y._disposables.push(y.crsUpdateCompleted=new r),y._disposables.push(y.dataLoadFailed=new r),y._disposables.push(y.layerInvalidated=new r)),l===undefined&&(l=(i.isMapsVertical||i.isMapsAnswer)&&!u._isFeatureEnabled("disableImageCORS")),y._enableCORS=l,y}return k(e,n),e.prototype.addScene=function(n,t,r,u,f,e,o){var s=this;i.tileRefactoringEnabled&&this._disposables.push(t.tileUrlTemplateChanged.add(function(n){s._currentScene===n&&(s._lastViewChangeFrameNumber=-1,s.layerInvalidated.invoke({layerId:s.getId()}))}));this.addSceneContributor(new yu(n,t,r,u,f,e,o))},e.prototype.addSceneContributor=function(n){this._sceneContributors.push(n);this._sceneContributors.sort(function(n,t){return t.priority-n.priority})},e.prototype.getScene=function(n,t,i,r){for(var o,f,u=0,e=this._sceneContributors.length;u<e;u++)if(o=this._sceneContributors[u],f=o.getScene(n,t,i,r),f&&(!n||f.crs===n))return f;return null},e.prototype.getAvailableRasterTiles=function(){if(this._currentScene&&this._currentScene.getPercentCompleted()<100){var n=[];return n.push.apply(n,this._currentScene.getAllPendingRequestsBackgroundTiles(this._coreMap.getMapOptions().liteMode)),n.push.apply(n,this._rasterTiles),n}return this._rasterTiles},e.prototype.getPercentComplete=function(){return this._currentScene?this._currentScene.getPercentCompleted():100},e.prototype.getCurrentCrs=function(){return this._currentScene?this._currentScene.crs:null},e.prototype.getCurrentScene=function(){return this._currentScene},e.prototype.getTileSize=function(){return this._currentScene?this._currentScene.getTileSize():TileSystemHelper.tileLength},e.prototype.getLastViewChangeFrameNumber=function(){return this._lastViewChangeFrameNumber},e.prototype.setFrame=function(n,t){var i=this;this._currentFrame=n;var u=n.view,e=a.fromLocation(u.cameraLocation,!0),o=a.toScale(u.cameraLocation,e,!0),r=this.getScene(null,t.getBounds(),o,u.heading);this._currentScene=r;r&&(this._lastViewChangeFrameNumber!==n.lastViewChangeFrameNumber||t.getMapType().id===f.birdseyeV2||r.getPercentCompleted()<100)?(this._lastViewChangeFrameNumber=n.lastViewChangeFrameNumber,this._rasterTiles=[],r.setFrame(n),r.crs.update?r.crs.update(t,function(){i._currentFrame.frameNumber===n.frameNumber&&(i.crsUpdateCompleted.invoke({layer:i,state:0}),n.view.cameraLocation=t.getView().cameraLocation,i._getAllTiles(i._currentFrame))},function(){i._currentFrame.frameNumber===n.frameNumber&&(i.crsUpdateCompleted.invoke({layer:i,state:1}),n.view.cameraLocation=t.getView().cameraLocation,i._getAllTiles(i._currentFrame))},function(){i._currentFrame.frameNumber===n.frameNumber&&i.crsUpdateCompleted.invoke({layer:i,state:2})}):this._getAllTiles(n)):(r||(this._rasterTiles=null),this.crsReady.invoke({frame:n}),this._raiseEventsOnDataLoad())},e.prototype.feed=function(n){t.groupCollapsed(null,"Layer instance of ImageryMapLayer");var i=n.tile.tileId,r=i.crs,f=w.fromRegionId(i),e=r.getScale(i),u=this.getScene(r,f,e,r.heading||0);u&&(n.rasterImage&&!n.hasError&&(!this._cacheDuration||Date.now()-n.dataLoadTimestamp<this._cacheDuration)?n.tile.isDirty()&&n.tile.invalidateRender():(n.clearRasterImage(),n.requestId=u.getTile(i,function(t,i,r){n.rasterImage=i;n.rasterTileId=r;n.requestId=null;n.hasError=!t;n.dataLoadTimestamp=Date.now();n.layer&&(t||n.layer.isCritical)&&n.tile&&n.tile.invalidateRender()},n.isBaseLayer,this._networkPriority,this._enableCORS,this._useCredentialsForCORS,this._downloadTimeoutInMS)));n.scene=u;t.groupEnd()},e.prototype.onCriticalDataLoaded=function(){var n=this;return new Promise(function(t){if(n._currentScene){var i=n._currentScene.getPercentCompleted();i>n._minCriticalDataLoadedPercentage?t(i):n._pendingCriticalDataLoadedResolves.push(t)}else n._pendingCriticalDataLoadedResolves.push(t)})},e.prototype.dispose=function(){u._clearDisposables(this._sceneContributors);this._pendingCriticalDataLoadedResolves=[];this._rasterTiles=null;n.prototype.dispose.call(this)},e.prototype._raiseEventsOnDataLoad=function(){var n=this._currentScene?this._currentScene.getPercentCompleted():100,t=this._currentScene?this._currentScene.getPercentFailed():0;n>this._minCriticalDataLoadedPercentage&&(this._pendingCriticalDataLoadedResolves.forEach(function(t){t(n)}),this._pendingCriticalDataLoadedResolves=[]);n===100&&(t===100?this.dataLoadFailed.invoke():this.dataLoaded.invoke({frame:this._currentFrame}))},e.prototype.getAllTilesForAnimation=function(n,t,i,r){this._currentScene.getAllTiles(n,[t],r,this.isCritical,!0,!1,i,this._coreMap.getDpiScale(),this._coreMap.getMapOptions().liteMode,this._networkPriority,this._enableCORS,this._useCredentialsForCORS,this._downloadTimeoutInMS)},e.prototype.refreshBackgroundTiles=function(n,t){this._currentScene.getAllTiles(n,t,null,this.isCritical,!1,!0,!0,this._coreMap.getDpiScale(),this._coreMap.getMapOptions().liteMode,this._networkPriority,this._enableCORS,this._useCredentialsForCORS,this._downloadTimeoutInMS)},e.prototype._getAllTiles=function(n){var t=this;this._lastViewChangeFrameNumber===n.lastViewChangeFrameNumber&&(this._currentCrs=this._currentScene.crs,this.crsReady.invoke({frame:n}),this._currentScene.getAllTiles(this._currentFrame.viewport,[this._currentFrame.view],function(n){t.tileDownloaded.invoke(n);t._rasterTiles.push(n);t._raiseEventsOnDataLoad()},this.isCritical,!1,!1,!0,this._coreMap.getDpiScale(),this._coreMap.getMapOptions().liteMode,this._networkPriority,this._enableCORS,this._useCredentialsForCORS,this._downloadTimeoutInMS))},e}(oi),er=function(){function n(i,r,u,f,e,o){var h=this,s;if(t.assertNotNullOrEmpty(r,"fromExpression"),t.assertNotNull(u,"toObj"),t.assertNotNullOrEmpty(f,"toProperty"),o=o||"OneWay",s=r.split("."),this._source=null,this._sourceChangedHandler=null,this._destChangedHandler=null,this._sourceProperty=s[0],this._value=null,this._childBinding=null,this._paused=!1,this._twoWay=!1,this._converter=e,this._toObj=u,this._toProperty=f,this._isIdentity=r===n._identityMarker,s.length>1)s.splice(0,1),this._childBinding=new n(null,s.join("."),u,f,e,o);else if(o==="TwoWay"){if(this._isIdentity)throw"Two-way binding on entire data context is not allowed.";this._twoWay=!0;this._destChangedHandler=this._attachChangeHandler(u,function(){return h._updateSourceFromDest()})}this._setSource(i)}return n.prototype._setSource=function(n){var t=this;this._sourceChangedHandler&&this._sourceChangedHandler.dispose();this._source=n;this._sourceChangedHandler=this._source&&this._attachChangeHandler(this._source,function(){return t._checkForValueChange()});this._checkForValueChange();this._twoWay&&this._updateSourceFromDest()},n.prototype._attachChangeHandler=function(n,t){if(n.changed)return n.changed.add(t);if(n.add_event){n.add_event("change",t);var i=n[0];return i.tagName.toUpperCase()==="INPUT"&&i.type.toUpperCase()==="TEXT"&&n.add_event("keyup",t),{dispose:function(){n.remove_event("change",t);n.remove_event("keyup",t)}}}},n.prototype._checkForValueChange=function(){var n=this._getValue();!this._childBinding&&this._converter&&(n=this._converter(n));n===undefined&&(n=null);v.areEqual(this._value,n)||(this._value=n,this._updateDestination())},n.prototype._getValue=function(){return this._source?this._isIdentity?this._source:v.getValue(this._source,this._sourceProperty):null},n.prototype._updateSourceFromDest=function(){this._source&&(this._paused=!0,v.setValue(this._source,this._sourceProperty,v.getValue(this._toObj,this._toProperty)),this._paused=!1)},n.prototype._updateDestination=function(){this._paused||(this._paused=!0,this._childBinding?this._childBinding._setSource(this._value):v.setValue(this._toObj,this._toProperty,this._value),this._paused=!1)},n.prototype.dispose=function(){this._sourceChangedHandler&&this._sourceChangedHandler.dispose();this._sourceChangedHandler=null;this._source=null;this._childBinding&&this._childBinding.dispose();this._childBinding=null;this._destChangedHandler&&this._destChangedHandler.dispose();this._destChangedHandler=null;this._value=null},n._identityMarker="$self$",n}(),pu=function(){function n(n,i,r){t.assertNotNull(n,"fromObj");t.assertNotNullOrEmpty(i,"fromExpression");t.assertIsFunction(r,"handler");this._eventHandle=null;this._handler=r;this._binding=new er(n,i,this,"value")}return n.prototype.setValue=function(n){this._eventHandle&&this._eventHandle.dispose();n&&(t.assertInstanceOf(n,r,"jsEvent"),this._eventHandle=n.add(this._handler))},n.prototype.dispose=function(){this._eventHandle&&this._eventHandle.dispose();this._binding&&this._binding.dispose()},n}(),ii=function(n){function r(t,r,u,f){var e=n.call(this,t,f)||this;return i.tileRefactoringEnabled?e.defineProperty("dataSource"):(e._primitiveCache=new ui(1024),e.defineProperty("dataSource",function(n,t){return e._onDataSourceChanged(n,t)})),r&&e.setDataSource(r),u&&e.setTemplateSelector(u),e.dataVersion=0,e}return k(r,n),r.prototype.feed=function(n){var i,r;t.groupCollapsed(null,"Layer instance of VectorMapLayer");i=this._getRequestorKey(n);n.setTemplateSelector(this.getTemplateSelector());n.primitives||(r=!n.isBaseLayer&&n.tile.getIsBackground(),this.getPrimitives(n.tile.tileId,function(t){return n.onPrimitivesAvailable(t)},!1,r,i));t.groupEnd()},r.prototype.cancelRequestForPrimitives=function(n){var t=n.tile.tileId,o=this._getRequestorKey(n),i=this.getDataSource(),f,u,e,r;if(i&&i.cancelPrimitivesRequest){if(f=w.fromRegionId(t),this.getDataSource().spatialIndex)e=t.crs.getScale(t),u=t.crs.sceneMetadata?[]:i.spatialIndex.getRegionsInBounds(f,e);else throw"VectorMapLayer dataSource must implement Spatial Indexing";for(r=0;r<u.length;r++)i.cancelPrimitivesRequest(u[r],o)}},r.prototype.getPrimitives=function(n,t,i,r,u){this._getPrimitivesInternal(this.getDataSource(),n,t,i,r,u)},r.prototype.dispose=function(){n.prototype.dispose.call(this);this._dataSourceInvalidatedHandler&&(this._dataSourceInvalidatedHandler.dispose(),this._dataSourceInvalidatedHandler=null);this._primitiveCache&&(this._primitiveCache.clear(),this._primitiveCache=null)},r.prototype._getRequestorKey=function(n){return n.tile.tileId.quadKey+"_DM"},r.prototype._update=function(n){var i,r,u;for(this._primitiveCache.clear(),t.clearTestHooksLog(t.TileLogTag),i=0,r=this.data.length;i<r;i++)u=this.data[i],this._getPrimitivesForVectorTileData(n,u)},r.prototype._getPrimitivesForVectorTileData=function(n,t){if(t.getEnabled()){var i=!t.isBaseLayer&&t.tile.getIsBackground();t.primitives=null;this._getPrimitivesInternal(n,t.tile.tileId,function(n){return t.onPrimitivesAvailable(n)},!1,i,this._getRequestorKey(t))}},r.prototype._onDataSourceChanged=function(n,t){var i=this;n!==t&&(this._dataSourceInvalidatedHandler&&(this._dataSourceInvalidatedHandler.dispose(),this._dataSourceInvalidatedHandler=null),this._update(t),t&&t.invalidated&&(this._dataSourceInvalidatedHandler=t.invalidated.add(function(n){return i._onDataSourceInvalidated(n)})))},r.prototype._onDataSourceInvalidated=function(){this.dataVersion++;this._update(this.getDataSource())},r.prototype._getPrimitivesInternal=function(n,t,i,r,u,f){function k(n){n&&Array.prototype.push.apply(o.primitives,n.primitives);p--;p||(!r&&l._dataSourceInvalidatedHandler&&l._primitiveCache.addItem(t.toString(),o),i(o))}var l=this,o,s,e,h,v,y,p,b,c;if(n)if(o=!r&&l._primitiveCache.getItem(t.toString()),o)i(o);else if(u)i(null);else if(o={primitives:[]},s=w.fromRegionId(t),this.getDataSource().inflateRegionOnDataFetch&&s.buffer(),n.spatialIndex?t.pixelWidth!==0&&t.pixelHeight!==0&&(h=t.crs,h.getScale?(v=h.getScale(t),h.sceneMetadata?e=[]:v>0&&(e=n.spatialIndex.getRegionsInBounds(s,v))):(y=h.getGroundResolution(t),y>0&&(e=n.spatialIndex.getRegions(s,y)))):e=[s],e&&e.length>0)for(p=e.length,b=a.fromScale(null,t.crs.getScale(t),!0),c=0;c<e.length;c++)n.getPrimitives(e[c],k,f,b,t);else i(o);else i(null)},r}(oi),or=function(n){function t(t,i){var r=n.call(this)||this;r.id=t.mapType;r.minZoom=t.minZoom;r.maxZoom=t.maxZoom-i;r._templateSelectorPromise=new Promise(function(n){r._resolveBaseMapTemplateSelector=n});r.backgroundTileColor="#f3f2ed";switch(r.id){case"be":case"be2":r.displayName="BirdsEye";r.backgroundTileColor="#626963";break;case"r":r.displayName="Road";break;case"rv1":r.displayName="RoadVector1";break;case"rv2":r.displayName="RoadVector2";break;case"a":r.displayName="Aerial";r.backgroundTileColor="#011422";break;case"os":r.displayName="OrdnanceSurvey";break;case"e":r.displayName="Seasonal"}return r}return k(t,n),t.prototype.getTemplateSelector=function(){return this._templateSelectorPromise},t.prototype.setTemplateSelector=function(n){this._resolveBaseMapTemplateSelector&&this._resolveBaseMapTemplateSelector(n)},t.prototype.dispose=function(){this.clear();this._templateSelectorPromise.then(function(n){n.dispose()})},t}(it),sr=function(){function n(n,t){this._objectPool=[];this._objectConstructor=n;this._constructorArguments=t}return n.prototype._create=function(){function n(n,t){n.apply(this,t)}n.prototype=this._objectConstructor.prototype;this._objectPool.push(new n(this._objectConstructor,this._constructorArguments))},n.prototype.acquire=function(){return this._objectPool.length===0&&this._create(),this._objectPool.pop()},n.prototype.release=function(n){this._objectPool.push(n)},n.prototype.dispose=function(){for(var t=this._objectPool.length,n;t--;)n=this._objectPool[t],n.dispose&&n.dispose();this._objectPool=null},n}(),et=function(){function n(){if(n.instance)return n.instance;this.id="LatLon";this.bounds=[90,180,-90,-180]}return n.prototype.toLatitude=function(n,t){return t},n.prototype.toLongitude=function(n){return n},n.prototype.projectToX=function(n,t){return t},n.prototype.projectToY=function(n){return n},n.prototype.getScale=function(n){var t=w.fromRegionId(n),f=t.height,r=t.width,i=d.greatCircleDistance(new o(0,t.getWest()),new o(0,t.getEast())),u;return r>=360?i=d.earthCircumference:r>180&&(i=d.earthCircumference-i),u=n.pixelWidth,i/u},n.prototype.getGroundResolution=function(n){var t=w.fromRegionId(n),f=t.height,r=t.width,i=d.greatCircleDistance(t.getNorthwest(),t.getSoutheast()),u;return r>=360?i=d.earthCircumference:r>180&&t.getNorth()>0&&t.getSouth()<0&&(i=d.earthCircumference-i),u=Math.sqrt(n.pixelWidth*n.pixelWidth+n.pixelHeight*n.pixelHeight),i/u},n.instance=new n,n}(),w=function(){function n(n,t,i,r){this.center=n;this.width=t;this.height=i;this.crs=et.instance;this.bounds=[this.getNorth(),this.getEast(),this.getSouth(),this.getWest()];this.originalBounds=r&&r.slice()}return n.prototype.buffer=function(n){n===void 0&&(n=.1);this._northWest=this._southEast=null;this.width+=n*this.width;this.height+=n*this.height;this.bounds=[this.getNorth(),this.getEast(),this.getSouth(),this.getWest()]},n.prototype.getNorthwest=function(){return this._northWest||(this._northWest=new o(this.getNorth(),this.getWest(),this.center.altitude)),this._northWest},n.prototype.getSoutheast=function(){return this._southEast||(this._southEast=new o(this.getSouth(),this.getEast(),this.center.altitude)),this._southEast},n.prototype.getNorth=function(){return this.center.latitude+this.height/2},n.prototype.getSouth=function(){return this.center.latitude-this.height/2},n.prototype.getWest=function(){return this.width>=360?-180:o.normalizeLongitude(this.center.longitude-this.width/2)},n.prototype.getEast=function(){return this.width>=360?180:o.normalizeLongitude(this.center.longitude+this.width/2)},n.prototype.toString=function(){return this.getNorth()+","+this.getWest()+","+this.getSouth()+","+this.getEast()},n.prototype.clone=function(){return new n(this.center.clone(),this.width,this.height)},n.prototype.containsLatLong=function(n,t){var r=1e-8,u,i;return t=o.normalizeLongitude(t),u=Math.abs(this.center.latitude-n),i=Math.abs(this.center.longitude-t),i>180&&(i=360-i),u<=this.height/2+r&&i<=this.width/2+r},n.prototype.contains=function(n){return this.containsLatLong(n.latitude,n.longitude)},n.prototype.intersects=function(n,t){t===void 0&&(t=0);var r=Math.abs(this.center.latitude-n.center.latitude),i=Math.abs(this.center.longitude-n.center.longitude);return i>180&&(i=360-i),r<=this.height*(1+t)/2+n.height/2&&i<=this.width*(1+t)/2+n.width/2},n.prototype.crossesInternationalDateLine=function(){return this.getEast()<this.getWest()||this.originalBounds&&Math.abs(this.originalBounds[1]-this.originalBounds[3])>360},n.prototype.splitByInternationalDateLine=function(){var t;if(this.crossesInternationalDateLine()){var i=this.getNorth(),u=this.getWest(),r=this.getSouth(),f=this.getEast(),e=n.fromEdges(i,u,r,180),o=n.fromEdges(i,-180,r,f);t=[e,o]}else t=[this];return t},n.merge=function(t,i){var s=null,o,u,e,h,a;if(t&&i){for(var f=[],p=Math.max(t.getNorth(),i.getNorth()),w=Math.min(t.getSouth(),i.getSouth()),r=0,v=[t,i],r=0;r<v.length;r++)o=v[r],o.crossesInternationalDateLine()?(f.push([o.getWest(),180]),f.push([-180,o.getEast()])):f.push([o.getWest(),o.getEast()]);for(f.sort(function(n,t){return n[0]===t[0]?n[1]-t[1]:n[0]-t[0]}),u=[],e=f[0],r=1;r<f.length;)h=f[r],e[1]>=h[0]?e[1]=Math.max(e[1],h[1]):(u.push(e),e=h),r++;u.push(e);var c=u.length,y=u[0][0]+360-u[c-1][1],l=[u[c-1][1],u[0][0]];for(r=1;r<c;r++)a=u[r][0]-u[r-1][1],a>y&&(y=a,l=[u[r-1][1],u[r][0]]);s=n.fromEdges(p,l[1],w,l[0])}else t?i||(s=t):s=i;return s},n.fromEdges=function(t,i,r,u,f,e,s){var c,h;return s&&(c=[t,u,r,i]),Math.abs(u-i)>360&&(i=-180,u=180),i=o.normalizeLongitude(i),u=o.normalizeLongitude(u),i>u&&(u+=360),h=(i+u)/2,h=o.normalizeLongitude(h),new n(new o((r+t)/2,h,f,e),u-i,t-r,c)},n.fromCorners=function(t,i){return n.fromEdges(t.latitude,t.longitude,i.latitude,i.longitude,t.altitude)},n.fromLocations=function(){for(var c,b,p,k,nt=[],a=0;a<arguments.length;a++)nt[a]=arguments[a];c=u._isArray(arguments[0])?arguments[0]:arguments;c=c||[];for(var v,y,r,f,d,g,e,t=c.length,i=new Array(t),s=0,l,h,w;t--;)e=c[t],h=e.latitude,w=e.longitude,isFinite(h)&&isFinite(w)&&(v=v===undefined?h:Math.max(v,h),y=y===undefined?h:Math.min(y,h),i[s++]=l=o.normalizeLongitude(w),f=f===undefined?l:Math.max(f,l),r=r===undefined?l:Math.min(r,l),e.altitudeReference!==-1&&(d=e.altitude,g=e.altitudeReference));if(s&&f-r>180){for(i.length=s,i.sort(function(n,t){return n-t}),b=i[0]+360-i[s-1],p=0,t=1;t<s;t++)k=i[t]-i[t-1],k>b&&(b=k,p=t);r=i[p];f=i[(p||s)-1]}return n.fromEdges(v,r,y,f,d,g)},n.fromShapes=function(t){var i=null,f,r,e,u;if(t)if(t instanceof Array)for(r=0,e=t.length;r<e;r++)f=n.fromShapes(t[r]),i=n.merge(i,f);else t instanceof pi?i=new n(t.getLocation(),0,0):t instanceof pr?(u=t.getRings(),u&&u.length>=1&&(i=n.fromLocations(u[0]))):t instanceof bi?i=n.fromLocations(t.getLocations()):t.geometry&&t.geometry.boundingBox&&(i=t.geometry.boundingBox);return i},n.fromString=function(t){var r=null,i=t.split(",");if(i&&i.length===4){var u=parseFloat(i[0]),f=parseFloat(i[1]),e=parseFloat(i[2]),o=parseFloat(i[3]);r=n.fromEdges(u,f,e,o)}return r},n.fromRegionId=function(i,r){var h,u,c,l;if(t.assert(i&&i.bounds&&i.bounds.length===4,"Invalid regionId"),h=i.boundingBox,h)r||(h=h.clone());else{u=i.crs;n._createMapLocationObjectPool();var f=n._mapLocationObjectPool.acquire(),e=n._mapLocationObjectPool.acquire(),o=n._mapLocationObjectPool.acquire(),s=n._mapLocationObjectPool.acquire();f.latitude=u.toLatitude(i.bounds[3],i.bounds[0]);f.longitude=u.toLongitude(i.bounds[3],i.bounds[0]);e.latitude=u.toLatitude(i.bounds[1],i.bounds[0]);e.longitude=u.toLongitude(i.bounds[1],i.bounds[0]);o.latitude=u.toLatitude(i.bounds[1],i.bounds[2]);o.longitude=u.toLongitude(i.bounds[1],i.bounds[2]);s.latitude=u.toLatitude(i.bounds[3],i.bounds[2]);s.longitude=u.toLongitude(i.bounds[3],i.bounds[2]);try{if(c=f,l=o,i.crs&&i.crs.heading)switch(i.crs.heading){case 0:break;case 90:c=s;l=e;break;case 180:c=o;l=f;break;case 270:c=e;l=s;break;default:t.assert(!1,"custom crs heading not implemented")}u.sceneMetadata&&(c.latitude=Math.max(f.latitude,e.latitude,o.latitude,s.latitude),c.longitude=Math.min(f.longitude,e.longitude,o.longitude,s.longitude),l.latitude=Math.min(f.latitude,e.latitude,o.latitude,s.latitude),l.longitude=Math.max(f.longitude,e.longitude,o.longitude,s.longitude));h=n.fromCorners(c,l);i.boundingBox=h}finally{n._mapLocationObjectPool.release(f);n._mapLocationObjectPool.release(e);n._mapLocationObjectPool.release(o);n._mapLocationObjectPool.release(s)}}return h},n.areEqual=function(n,t,i){var r=!1;if(n&&t){var u=n.getNorthwest(),f=n.getSoutheast(),e=t.getNorthwest(),s=t.getSoutheast();r=o.areEqual(u,e,!0,i)&&o.areEqual(f,s,!0,i)}return r},n._createMapLocationObjectPool=function(){n._mapLocationObjectPool||(n._mapLocationObjectPool=new af(4,o,[0,0]))},n}(),ut=function(){function r(){}return r._setTimeoutWatch=function(n){r._timeoutTimerId===-1&&(r._timeoutTimerId=Microsoft.Maps.setTimeout(function(){var i,n,u;r._timeoutTimerId=-1;var e=Date.now(),f=!1,t=r._requestTimeoutPeriodinMs;for(i in r._requests)r._requests.hasOwnProperty(i)&&(n=r._requests[i],n.status===1&&(u=n.timeoutDuration-(e-n.startTime),u<=0?n.abortCallback(null,5):(t=Math.min(t,u),f=!0)));f&&r._setTimeoutWatch(Math.min(t,r._minImageRequestTimeoutPeriodinMs))},Math.max(1e3,n)))},r._downloadGeneric=function(n,t,u,f,e,o,s,h,c,l,a,v,y){t=t.replace("{credentials}",r.credentials);t=r._appendClientApiParameter(t);var p=y&&v?r._requests[v]:r._requests[t];return i.tileRefactoringEnabled&&r._setTimeoutWatch(Math.min(r._minImageRequestTimeoutPeriodinMs,r._requestTimeoutPeriodinMs)),p||(p={sourceUrl:n,url:t,status:0,successCallbacks:{},errorCallbacks:{},parseResponseCallback:o,callbackStates:{},executor:e,priority:h,hostname:r._getHostname(t),jsonso:v,callerId:c,startTime:Date.now(),timeoutDuration:a},v&&(r._requests[v]=p),y||(r._requests[t]=p)),p.successCallbacks[l]=u,f&&(p.errorCallbacks[l]=f),s&&(p.callbackStates[l]=s),h===0&&i.tileRefactoringEnabled?r._initiateRequest():Microsoft.Maps.setTimeout(function(){return r._initiateRequest()},5),p},r.downloadGeneric=function(n,t,i,u,f,e,o,s){var h=(r._uniqueCallbackId++).toString(),c=r._getDispatchKey(h,n);return r._downloadGeneric(n,n,i,f,function(n){r._createXHR(n,u?u:"text",null,null,s).send()},null,e,o?o:1,t,h,r._requestTimeoutPeriodinMs),r._requests[n].abortCallback=function(t,i){r._networkCallback(null,n,null,i)},c},r.downloadImage=function(n,t,u,f,e,o,s,h,c){c===void 0&&(c=r._imageRequestTimeoutPeriodinMs);r._minImageRequestTimeoutPeriodinMs=Math.min(r._minImageRequestTimeoutPeriodinMs,c);var l=(r._uniqueImageRequestId++).toString(),a=(r._uniqueCallbackId++).toString(),v=r._getDispatchKey(a,l);return r._downloadGeneric(n,n,u,f,function(n){var t=r._getPooledImage(s,h),u=t.image;i.tileRefactoringEnabled||(n.timerId=Microsoft.Maps.setTimeout(function(){n.abortCallback&&n.abortCallback(null,5)},c));u.onload=function(){var n=r._requests[l];n&&n.status===1&&r._onImageRequestComplete(2,l,t)};u.onerror=function(){var n=r._requests[l],i;n&&n.status===1&&(i=!u.complete||u.naturalWidth===0,r._onImageRequestComplete(i?3:2,l,t))};n.abortCallback=function(n,i){r._onImageRequestComplete(i,l,t)};u.onabort=function(){n.abortCallback&&n.abortCallback(null,3)};t.image.src=n.url},null,e,o?o:0,t,a,c,l,!0),r._requests[l].abortCallback=function(n,t){r._onImageRequestComplete(t,l,null)},v},r.downloadJson=function(t,i,u,f,e,o,s,h,c){h===void 0&&(h=!0);var l=(r._uniqueCallbackId++).toString(),a=r._getDispatchKey(l,t);return c=c||{},h&&!c["Content-Type"]&&(c["Content-Type"]="application/json; charset=utf-8"),r._downloadGeneric(t,t,u,f,function(n){r._createXHR(n,null,c,o).send()},function(t){var i={succeeded:!1};try{i.response=n.Internals.parseJSON(t);i.succeeded=!0}catch(r){}return i},e,s?s:1,i,l,r._requestTimeoutPeriodinMs),r._requests[t].abortCallback=function(n,i){r._networkCallback(null,t,null,i)},a},r.downloadJsonp=function(n,u,f,e,o,s,h,c){var p=!0,g=(r._uniqueCallbackId++).toString(),nt=n,tt,l,w,b,k,a,v,it,y,d;return o=o||r._getJsonStateObject(nt),tt=r._getDispatchKey(g,o),n.indexOf(r._callbackReplacementString)<0&&(p=!1),w=!1,/\{jsonso}/ig.test(n)?(l=s?r._reverseCallbackName:r._normalCallbackName,n=n.replace(/\{jsonso}/ig,o)):n.indexOf(r._mockJsonsoString)>=0?(b=n.indexOf(r._mockJsonsoString),b>=0&&(a=n.indexOf("&",b),a<0&&(a=n.length),v=b+r._mockJsonsoString.length,o=n.substr(v,a-v))):(p||(k=n.indexOf("jsonp="),k>=0&&(a=n.indexOf("&",k),a<0&&(a=n.length),v=k+6,l=n.substr(v,a-v))),l||(l="f"+o),w=!0),p&&(it=r._callbacksPrefix+l,n=n.replace(r._callbackReplacementString,it)),y=r._downloadGeneric(nt,n,f,e,function(n){i.tileRefactoringEnabled||(n.timerId=Microsoft.Maps.setTimeout(function(){return n.abortCallback(null,5)},r._requestTimeoutPeriodinMs));r._downloadScript(n)},null,h,c?c:1,u,g,r._requestTimeoutPeriodinMs,o),w&&(r._jsonpRequestsCounts[o]?r._jsonpRequestsCounts[o]++:r._jsonpRequestsCounts[o]=1,d=r._requests[o],p?r.callbacks[l]=function(n,i,u,f){t.assert(i===o||!i,"If specified, the jsonsoInner parameter must equal jsonso.");f!==4&&f!==3&&(r._jsonpRequestsCounts[o]-=Object.keys(d.successCallbacks).length);r._networkCallback(n,o,u,f);r._jsonpRequestsCounts[o]===0&&(delete r.callbacks[l],delete r._jsonpRequestsCounts[o])}:window[l]=function(n,t,i,u){u!==4&&u!==3&&(r._jsonpRequestsCounts[o]-=Object.keys(d.successCallbacks).length);r._networkCallback(n,o,i,u);r._jsonpRequestsCounts[o]===0&&(delete window[l],delete r._jsonpRequestsCounts[o])}),y&&y===r._requests[o]?y.abortCallback=function(i,u){var f=window[l]?window[l]:r.callbacks[w?l:r._normalCallbackName];f&&f(null,o,504,u);t.logNetworkData(n,u===3?"error":"aborted")}:r._logNetworkError(y,0,"downloadJsonp mismatch"),tt},r.abortRequest=function(n){var f,i,e,u;n&&(f=r._getParsedDispatchedKey(n),i=r._requests[f.requestId],i&&(e=Object.keys(i.successCallbacks).length,u=f.callbackId,t.assert(!!u,"Abort request should return back valid dispatchKey"),i.successCallbacks[u]&&(e>1?(i.errorCallbacks[u]&&i.errorCallbacks[u](i.callbackStates[u],4),delete i.errorCallbacks[u],delete i.callbackStates[u],delete i.successCallbacks[u]):i.abortCallback&&i.abortCallback(null,4))))},r._createXHR=function(n,t,u,f,e){var o=r._createBareXHRObject(),h,s,c;if(n.abortCallback=function(){o.abort()},i.tileRefactoringEnabled||(n.timerId=Microsoft.Maps.setTimeout(n.abortCallback,r._requestTimeoutPeriodinMs)),o.onreadystatechange=function(){if(e&&e(o),o.readyState===4){var t=o.response||o.responseText;r._networkCallback(t,n.sourceUrl,o.status,2)}},o.open("GET",n.url),f&&(o.withCredentials=!0),u)for(h=Object.keys(u),s=0,c=h.length;s<c;s++)o.setRequestHeader(h[s],u[h[s]]);return t&&(o.responseType=t),o},r._createBareXHRObject=function(){var n=null,t=e.Internal.originalXMLHttpRequest;return typeof t!="undefined"?n=new t:typeof ActiveXObject!="undefined"&&(n=new ActiveXObject("Microsoft.XMLHTTP")),n},r._downloadScript=function(n){var t=document.createElement("script");t.type="text/javascript";t.src=n.url;t.async=!0;t.onerror=function(){Microsoft.Maps.setTimeout(function(){n.abortCallback&&n.abortCallback(null,3)},0)};n.scriptElement=t;document.getElementsByTagName("head")[0].appendChild(t)},r._networkCallback=function(n,t,u,f){var e=r._requests[t],l,s,a,y,o,h;if(!e){window[t]===t&&(l="XsrPrefetchCallback",window[l]?window[l](n,t):window[t]=n);return}e.abortCallback=null;e.status===1&&(r._currentActiveRequests--,r._currentActiveRequestsByHostname[e.hostname]--);e.status=f||2;e.scriptElement&&e.scriptElement.parentNode&&e.scriptElement.parentNode.removeChild(e.scriptElement);e.scriptElement=null;i.tileRefactoringEnabled||e.timerId&&window.clearTimeout(e.timerId);t!==e.url&&delete r._requests[t];delete r._requests[e.url];s=e.status===2;s&&typeof u!="undefined"&&(s=u>=200&&u<300,s||(e.status=3));s&&e.parseResponseCallback&&u!==204&&(a=e.parseResponseCallback(n),s=a.succeeded,s||(e.status=3),n=a.response);var c=e.successCallbacks,v=e.callbackStates,p=e.errorCallbacks;if(e.successCallbacks={},e.callbackStates={},e.errorCallbacks={},s)if(i.tileRefactoringEnabled)for(o=0,h=Object.keys(c);o<h.length;o++)y=c[h[o]],y&&y(n,v[h[o]]);else Microsoft.Maps.setTimeout(function(){for(var r,t=0,i=Object.keys(c);t<i.length;t++)r=c[i[t]],r&&r(n,v[i[t]])},0);else for(r._logNetworkError(e,u),o=0,h=Object.keys(p);o<h.length;o++)p[h[o]](v[h[o]],e.status);r._initiateRequest()},r._logNetworkError=function(n,i,r){var u=e.logger,f;n=n||{};u&&(r||n.status===3||n.status===5)&&(t.logNetworkData(n.url,"error"),f={feature:tt.Network,action:b.Error,data:{httpStatus:""+(i||""),status:""+n.status,cid:n.callerId||"",url:n.url||"",msg:r||""}},u.logCriticalError(null,f))},r._networkCallbackReverse=function(n,t){r._networkCallback(t,n)},r.doPost=function(n,t,i){var u=r._createBareXHRObject(),s=i.headers||{},f=i.onError||function(){},h=i.onSuccess||function(){},c=n,e,o;if(i.queryParameters){n.indexOf("?")<0&&(n+="?");for(e in i.queryParameters)i.queryParameters.hasOwnProperty(e)&&(n+="&"+encodeURIComponent(e)+"="+encodeURIComponent(i.queryParameters[e]))}u.open("POST",n,!0);u.timeout=r._requestTimeoutPeriodinMs;u.ontimeout=f;for(o in s)s.hasOwnProperty(o)&&u.setRequestHeader(o,s[o]);u.onabort=f;u.onerror=f;u.onreadystatechange=function(){u.readyState==4&&(u.status==200?h(u.responseText):f(u.responseText,u.status,u.statusText))};u.send(t)},r._getHostname=function(n){return n?(r._anchorElement||(r._anchorElement=document.createElement("a")),r._anchorElement.href=n,r._anchorElement.hostname):""},r._getNextRequest=function(){var i=-1,f=null,e,n,t,u;for(e in r._requests)n=r._requests[e],n.status===0&&(t=n.priority*1e3,u=r._currentActiveRequestsByHostname[n.hostname]?r._currentActiveRequestsByHostname[n.hostname]:0,t+=u>=r._maxConcurrentRequestPerDomain?1e4:u,(t<i||i===-1)&&(i=t,f=n));return f},r._initiateRequest=function(){var t,n;for(r._maxConcurrentRequest===-1&&(t=e.Internal._CoreConfig(),r._maxConcurrentRequest=t.maxConcurrentNetworkRequest,r._maxConcurrentRequestPerDomain=t.maxConcurrentNetworkRequestPerDomain);r._currentActiveRequests<r._maxConcurrentRequest;){if(n=r._getNextRequest(),!n)break;r._currentActiveRequests++;r._currentActiveRequestsByHostname[n.hostname]||(r._currentActiveRequestsByHostname[n.hostname]=0);r._currentActiveRequestsByHostname[n.hostname]++;n.status=1;n.executor(n)}},r._onImageRequestComplete=function(n,t,i){var u,f;i&&(u=i.image,u&&(u.onload=u.onerror=u.onabort=null),(n===4||n===5)&&(f=r._requests[t],f&&(f.isAborted=!0),i.release(),i=null));r._networkCallback(i,t,n===2?200:n===5?504:n===3?500:null,n)},r._getPooledImage=function(n,t){return lr.getPooledImage(n,t)},r._getJsonStateObject=function(n){for(var t=parseInt(u._getHash(n),16),i=r._requests[t.toString(16)];i&&i.sourceUrl!==n;)t++,i=r._requests[t.toString(16)];return t.toString(16)},r._getDispatchKey=function(n,t){return n+r._dispatchKeySeparator+t},r._getParsedDispatchedKey=function(n){var i,u,t;return n&&(t=n.toString().split(r._dispatchKeySeparator),t.length===1?i=t[0]:(u=t[0],i=t[1])),{requestId:i,callbackId:u}},r._appendClientApiParameter=function(n){var i=n.toLowerCase(),t=n;return e.ClientApi&&e.ClientApi.length>0&&(i.indexOf("dev.virtualearth.net/rest")>-1||i.indexOf("dev.ditu.live.com/rest")>-1)&&(t+=n.indexOf("?")>-1?"&":"?",t+="clientApi="+encodeURIComponent(e.ClientApi)),t},r._requests={},r._jsonpRequestsCounts={},r._currentActiveRequests=0,r._uniqueImageRequestId=0,r._uniqueCallbackId=0,r._timeoutTimerId=-1,r._currentActiveRequestsByHostname={},r._callbacksPrefix=window.$MicrosoftMaps8.toString()+".NetworkCallbacks.",r._callbackReplacementString="{callback}",r._dispatchKeySeparator="~DispatchKey~",r._mockJsonsoString="jsonso=",r._normalCallbackName="normal",r._reverseCallbackName="reverse",r._requestTimeoutPeriodinMs=25e3,r._imageRequestTimeoutPeriodinMs=15e3,r._minImageRequestTimeoutPeriodinMs=15e3,r._maxConcurrentRequestPerDomain=-1,r._maxConcurrentRequest=-1,r.credentials="",r.callbacks={normal:r._networkCallback,reverse:r._networkCallbackReverse},r}(),wu=function(){function n(){if(n.instance)return n.instance}return n.prototype.getCopyrights=function(n,r,u,f,e,o,s,h,c){if(t.assertNotNull(r,"imageryId"),o=o||0,e=Math.round(e),r&&f&&e&&s){var l=n.replace(/{imagerySet}/,r).replace(/{productId}/,u).replace(/{zoom}/,e.toString()).replace(/{minLat}/,f[2].toString()).replace(/{minLon}/,f[3].toString()).replace(/{maxLat}/,f[0].toString()).replace(/{maxLon}/,f[1].toString()).replace(/{heading}/,o.toString()).replace(/{credentials}/,s).replace(/{mkt}/,i.dynamicProperties.market).replace(/{ml}/,h.getConfig().copyrightMapLayers);this._downloadCopyright(l,h,c)}},n.prototype._copyrightServiceCallback=function(n,t,r,u){var o,e;if(!t.isDisposed()){if(o=[],n)if(e=n.resourceSets&&n.resourceSets.length>0&&n.resourceSets[0]&&n.resourceSets[0].resources[0]&&n.resourceSets[0].resources[0].imageryProviders,e&&e.length>0&&e[0]!=="")Array.prototype.push.apply(o,e);else if(u&&t.getMapType().id===f.ordnanceSurvey&&u.indexOf("OrdnanceSurvey")>-1){u=u.replace("OrdnanceSurvey","RoadOnDemand");this._downloadCopyright(u,t,r);return}i.isMapsVertical||i.isMapsAnswer||o.push(this._getDefaultCopyright());r(o)}},n.prototype._downloadCopyright=function(n,t,i){var r=this,u=Math.floor(Math.random()*1e6).toString();ut.downloadJsonp(n,"copyright",function(u){return r._copyrightServiceCallback(u,t,i,n)},function(){return r._copyrightServiceCallback(null,t,i)},u.toString(),null,null,3)},n.prototype._getDefaultCopyright=function(){return String.fromCharCode(169)+" "+(new Date).getFullYear()+" Microsoft Corporation"},n.instance=new n,n}(),ci=function(){function n(n,t,i){this._imageryId=n;this._map=t;this._imageryCopyrightUrlFormat=i}return n.prototype.getCopyrights=function(n,t,i,r,u){var f=this;ri.instance.authenticateClientAndRetrieveSessionId(function(e){!f._map.isDisposed()&&e&&e.sessionId&&wu.instance.getCopyrights(f._imageryCopyrightUrlFormat,f._getImageryId(i),n,t,i,r,e.sessionId,f._map,u)})},n.prototype._getImageryId=function(n){var t=this._imageryId,i=this._map.getLabelController();return t==="Aerial"&&i&&i.getIsLabelsEnabled()&&(t+="WithLabels"),(t==="AerialWithLabels"||t==="Road")&&(t+="OnDemand"),(t==="Seasonal"||t==="OrdnanceSurvey"&&(n>18||n<12))&&(t="RoadOnDemand"),t},n}(),bu=function(n){function t(t,r,e,o,s,h){var c=n.call(this)||this,tt,v,it,k,rt,l,y,ut,d,p,w,a,g,ft,nt,et,ot;c._map=t;c._mapTemplateUrlFormat=r.mapTemplateUrlFormat;c._mapLiteTemplateUrlFormat=r.mapLiteTemplateUrlFormat;c._container=e;c._coreConfig=r;c._templateSelectorCache=new ui(50);c._miscCache=new ui(25);c._completionCallback=h;c._tileDomainName=s;c._pendingCount=r.mapTypeDefinitions.length;tt=c._customMapStyleManager=e.instance("CustomMapStyleManager");v=c._map.getMapOptions();v.customMapStyle&&(tt.update(v.customMapStyle),tt.useLiteMode&&(v.liteMode=!0));it=!!v.liteMode;c._dpiParam=t.getDpiScale()===2?"d2":"";var st=t.getZoomOffset(),ht=u._getUrlParam(window.location,"loadallstyles")==="1",b=r.mapTypeDefinitions;for(u._isFeatureEnabled("supportedMaps")&&(b=c._getSupportedMapTypeDefs(b,o)),k=0,rt=b.length;k<rt;k++)if(l=b[k],l&&l.mapTypeEnabled&&c._isMapTypeAvailable(l.mapType)){if(y=l.data,ut=l.liteModeAware,!i.isMapsAnswer&&!i.isMapsVertical&&!i.isMobile&&l.mapType===f.aerial)for(l.maxZoom=20,d=0;d<y.length;d++)if(p=y[d],p.imageryScenes)for(w=0;w<p.imageryScenes.length;w++)p.imageryScenes[w].imageryId==="Aerial"&&(p.imageryScenes[w].maxZoom=20);if(u._getUserstudyStyles&&u._getUserstudyStyles().indexOf(l.templateName)===-1||l.mapType===o){for(a=new or(l,st),g=0,ft=y.length;g<ft;g++)(nt=y[g],et=!!nt.liteMode,nt.tilePrimer)||ut&&it!==et||a.insert(c._loadLayer(nt,a.id));ot=ht||a.id===o;c._loadTemplateAsync(l.templateName,it,a,ot);c[a.id]=a;c.insert(a)}}return c}return k(t,n),t.prototype.dispose=function(){for(var n=0,t=this.length;n<t;n++)this[n].dispose();this._miscCache.clear();this._templateSelectorCache.clear();window.clearTimeout(this._timerId);this.clear();this._map=null},t.prototype.updateCustomMapStyle=function(n){this._customMapStyleManager.update(n)},t.prototype._getSupportedMapTypeDefs=function(n,t){var h=this._map.getMapOptions(),i=h.supportedMapTypes,c=[],l,a,u,v,o,y,s,p,e,r;if(i&&i.length!==0){if(l=[f.birdseye,f.birdseyeV2,f.streetside],a=i.length,l.indexOf(i[0])>-1){for(u=1;u<a;){if(e=i[u],l.indexOf(e)===-1){i[u]=i[0];i[0]=e;break}u++}u>=a&&(i=[f.road].concat(i))}for(this._coreConfig.defaultMapType=i[0],t&&h.mapType===t&&i.indexOf(t)<0&&(h.mapType=i[0]),v={},o=0,y=n;o<y.length;o++)r=y[o],r.mapTypeEnabled&&i.indexOf(r.mapType)>=0&&(v[r.mapType]=r);for(s=0,p=i;s<p.length;s++)e=p[s],r=v[e],r&&c.push(r)}else c=n;return c},t.prototype._isMapTypeAvailable=function(n){var r=this._map.getMapOptions(),t;switch(n){case f.birdseye:case f.birdseyeV2:return!r.disableBirdseye;case f.streetside:return t=i.features.streetside,!r.disableStreetside&&t&&t.isEnabled&&t.isCoverageLayerEntryPointEnabled;case f.ordnanceSurvey:return i.features.ordnanceSurvey.isEnabled;case f.seasonal:case f.getTilePrimerId(f.seasonal):return u._isMapTypeSeasonalAvailable();case f.grayscale:case f.canvasDark:case f.canvasLight:case f.getTilePrimerId(f.grayscale):case f.getTilePrimerId(f.canvasDark):case f.getTilePrimerId(f.canvasLight):return!i.isMapsVertical;case f.symbolicNight:return i.features.symbolicNight.isEnabled&&(i.isMapsVertical||i.isMapsAnswer);case f.symbolicWinter:return i.features.symbolicWinter.isEnabled&&(i.isMapsVertical||i.isMapsAnswer);default:return!0}},t.prototype._loadLayer=function(n,t){var i,o,r,e,s,u;if(n.imageryScenes&&n.imageryScenes.length>0)for(o=i=new ti(n.id,n.zIndex,1,!0,undefined,undefined,undefined,this._map.getMapOptions().enableCORS),r=0,e=n.imageryScenes.length;r<e;r++)s=n.imageryScenes[r],this._addScene(e-r,o,s);else u=i=new ii(n.id,null,null,n.zIndex),n.id.indexOf("Microsoft.Maps.OS")===0?this._getDelayLoadedBaseMapOSDataSource().getObjectAsync(function(t){u.setDataSource(t.getLayerDataSource(n.vectorLayerId))}):n.id.indexOf("Microsoft.Maps.Seasonal")===0?this._getDelayLoadedBaseMapSeasonalDataSource().getObjectAsync(function(t){u.setDataSource(t.getLayerDataSource(n.vectorLayerId))}):t===f.streetside?this._getDelayLoadedBaseMapStreetsideDataSource().getObjectAsync(function(t){u.setDataSource(t.getLayerDataSource(n.vectorLayerId))}):this._getDelayLoadedBaseMapDataSource().getObjectAsync(function(t){u.setDataSource(t.getLayerDataSource(n.vectorLayerId))});return i.setVisible(n.visible?!0:!1),i.setRenderTarget(1),i},t.prototype._addScene=function(n,t,r){var s=this,f={},e=this._map,k=e.getMapOptions(),v=this._coreConfig,h,y,c,b,l;f["{protocol}"]=v.urlProtocol;f["{tfeDomainDynamic}"]=v.tfeDomainDynamic;f["{tfeDomainStatic}"]=v.tfeDomainStatic;f["{tileUrlParam}"]=r.tileUrlParam;f["{tileUrlWithoutLabelParam}"]=r.tileUrlWithoutLabelParam;f["{domain}"]=this._tileDomainName;f["{dpi}"]=this._dpiParam;h=k.allTileFeatures||i.isMapsVertical?r.tileFeaturesMapsVertical:r.tileFeaturesSDK;h=this._filterTileFeatures(h);h&&(f["{it}"]=h);r.tileFeaturesWithoutLabel&&(y=this._filterTileFeatures(r.tileFeaturesWithoutLabel),y&&(f["{it2}"]=y));c=u._replaceValues(r.tileUrl,f);b=k.backgroundColor;r.imageryId==="Mercator"&&b&&(c=this._getMercatorBackgroundTileUrl(b));l=u._replaceValues(r.tileUrlWithoutLabel,f);this._container.instanceAsyncAll([{name:"RasterImageryScene"},{name:"BirdseyeV2ImageryScene"},{name:"BirdseyeV2Crs"},{name:"EnhancedBirdseyeCrs"}],function(i){var h,y=r.maxZoom&&a.toScale(null,r.maxZoom,!0),b=r.minZoom&&a.toScale(null,r.minZoom,!0),v,k,u,nt,tt,it,rt;switch(r.imageryId){case"Synth":case"SynthWithLabels":for(k=["dir_n","dir_e","dir_s","dir_w"],u=0;u<4;u++){var f=u*90,d=f-45,g=f+45;v=new ci(r.imageryId,e,s._coreConfig.imageryCopyrightUrlFormat);nt=c.replace("{dir}",k[u]);tt=l.replace("{dir}",k[u]);h=new i.RasterImageryScene(e,new p(a.toLocation(new o(0,0),0,!0)),new i.EnhancedBirdseyeCrs(f,s._coreConfig.elevationServiceUrl),r.imageryId,nt,v,tt);t.addScene(n,h,d,g,y,b,r.bounds&&w.fromString(r.bounds))}break;case"BirdseyeV2":for(it=["N","E","S","W"],rt=e.getMapOptions().birdseyeTransitionPaddingPtg,u=0;u<4;u++)f=u*90,d=f-45,g=f+45,v=new ci(r.imageryId,e,s._coreConfig.beV2ImageryCopyrightUrlFormat),h=new i.BirdseyeV2ImageryScene(e,new p(a.toLocation(new o(0,0),0,!0)),new i.BirdseyeV2Crs(f,s._coreConfig.birdseyeV2MetadataUrl.replace("{dir}",it[u]),rt),r.imageryId,c,v,l),t.addScene(n,h,d,g,y,b,r.bounds&&w.fromString(r.bounds));break;default:v=new ci(r.imageryId,e,s._coreConfig.imageryCopyrightUrlFormat);h=i.RasterImageryScene.createMercatorImageryScene(r.imageryId,c,v,e,l,s._customMapStyleManager);t.addScene(n,h,0,360,y,b,r.bounds&&w.fromString(r.bounds))}},!i.isMapsVertical)},t.prototype._getDelayLoadedBaseMapTemplateSelector=function(n,t){var r=this,u=n,f=t?this._mapLiteTemplateUrlFormat:this._mapTemplateUrlFormat,i=this._templateSelectorCache.getItem(u);return i||(i=new rt(function(t){r._container.instanceAsync("BaseMapTemplateSelector",t,{mapTemplateUrlFormat:f,stlVersion:r._map.getConfig().stlVersion,templateName:n,hitTest:r._map.getIsMapHitTestable()})}),this._templateSelectorCache.addItem(u,i)),i},t.prototype._getDelayLoadedBaseMapDataSource=function(){var t=this,n=this._miscCache.getItem("BaseMapDataSource");return n||(n=new rt(function(n){t._container.instanceAsync("BaseMapDataSource",n,t._coreConfig)})),n},t.prototype._getDelayLoadedBaseMapOSDataSource=function(){var t=this,n=this._miscCache.getItem("BaseMapOSDataSource");return n||(n=new rt(function(n){t._container.instanceAsync("BaseMapOSDataSource",n,t._coreConfig)})),n},t.prototype._getDelayLoadedBaseMapSeasonalDataSource=function(){var t=this,n=this._miscCache.getItem("BaseMapSeasonalDataSource");return n||(n=new rt(function(n){t._container.instanceAsync("BaseMapSeasonalDataSource",n,t._coreConfig)})),n},t.prototype._getDelayLoadedBaseMapStreetsideDataSource=function(){var t=this,n=this._miscCache.getItem("BaseMapStreetsideDataSource");return n||(n=new rt(function(n){t._container.instanceAsync("BaseMapStreetsideDataSource",n,t._coreConfig)})),n},t.prototype._getDelayLoadedLandmarksDataSource=function(){var t=this,n=this._miscCache.getItem("LandmarksDataSource");return n||(n=new rt(function(n){t._container.instanceAsync("LandmarksDataSource",n,t._coreConfig)})),n},t.prototype._loadTemplateAsync=function(n,t,i,r){var u=this;if(!n)throw"_loadTemplateAsync called with null templateName";this._getDelayLoadedBaseMapTemplateSelector(n,t).getObjectAsync(function(n){r&&n.selectorReady();u._setTemplateSelector(n,i)})},t.prototype._setTemplateSelector=function(n,t){if(!n)throw"MapTypeCollection._setTemplateSelector called with null templateSelector";t.setTemplateSelector(n);for(var i=0;i<t.length;i++)t[i].setTemplateSelector(n);--this._pendingCount==0&&this._completionCallback&&(this._timerId=Microsoft.Maps.setTimeout(this._completionCallback,0,this))},t.prototype._getMercatorBackgroundTileUrl=function(n){var i=256,t=document.createElement("canvas"),r;return t.width=t.height=i,r=t.getContext("2d"),r.fillStyle=n,r.fillRect(0,0,i,i),t.toDataURL()},t.prototype._filterTileFeatures=function(n){var t=n.split(","),i=[],r=this._customMapStyleManager&&!this._customMapStyleManager.buildingVisible;return r&&(i.push("BX"),i.push("OBX")),t=t.filter(function(n){return i.indexOf(n)<0}),t.join(",")},t}(it),ku=function(){function n(){}return n.prototype.attach=function(n){var i=this;t.assert(!this._eventHandlers,"A map has already been attached to this overlay behavior");this._map=n;this._eventHandlers=[];this._eventHandlers.push(n.primitiveTapped.add(function(n){return i._onPrimitiveTapped(n)}));this._eventHandlers.push(n.primitiveHoverStarted.add(function(n){return i._onPrimitiveHoverStarted(n)}));this._eventHandlers.push(n.primitiveHoverStopped.add(function(n){return i._onPrimitiveHoverStopped(n)}));this._eventHandlers.push(n.mapTapped.add(function(){return i._hideOverlay()}));this._eventHandlers.push(n.mapZoomStarted.add(function(){return i._hideOverlay()}));this._eventHandlers.push(n.mapZoomChanged.add(function(){return i._hideOverlay()}));this._eventHandlers.push(n.mapModeChanged.add(function(){return i._hideOverlay()}));this._eventHandlers.push(n.contextMenuInvoked.add(function(){return i._hideOverlay()}))},n.prototype.detach=function(){t.assertNotNull(this._eventHandlers,"This overlay behavior is not currently attached to a map");this._hideOverlay();this._eventHandlers.forEach(function(n){n.dispose();n=null});this._eventHandlers=null;this._map=null},n.prototype._onPrimitiveHoverStarted=function(n){var t=n.layer;t&&2===t.overlayEvent&&this._showOverlay(t,n.primitive)},n.prototype._onPrimitiveHoverStopped=function(n){var t=n.layer;t&&2===t.overlayEvent&&this._hideOverlay()},n.prototype._onPrimitiveTapped=function(n){var t=n.layer;t&&1===t.overlayEvent&&(this._overlayPrimitive&&this._hideOverlay(),this._showOverlay(t,n.primitive))},n.prototype._showOverlay=function(n,t){wi.showOverlay(this._map,n,t);this._overlayPrimitive=t},n.prototype._hideOverlay=function(){wi.hideOverlay(this._map,this._overlayPrimitive);this._overlayPrimitive=null},n}(),du=function(){function n(n,t){this.cause=n;this.animation=t}return n}(),gu=function(){function n(n,t){this.oldMapTypeId=n;this.newMapTypeId=t}return n}(),at=function(){function n(n,t){this.cause=n;this.isInAnimation=t||!1}return n}(),hr=function(){function n(n,t,i,r){this._map=n;this._location=t;this._point=i;this.duration=r?r:225}return n.prototype.getLocation=function(){return this._location},n.prototype.getPoint=function(){return this._point},n.prototype.interpolate=function(n,r,u){var h,f;t.assert(n.cameraLocation.altitudeReference===r.cameraLocation.altitudeReference,"Can't interpolate between different altitude references");var c=n.cameraLocation.altitude,l=r.cameraLocation.altitude,e=(l-c)*u+c,o,s=this._map.getMode();return s.mapModeType===0?i.tileRefactoringEnabled?(h=s.getTileSize(),this._updateMapView(s.getCurrentCrs(),h.width,h.height,this._map.getActualSize(),r.heading,e,r.cameraLocation.altitudeReference)):(f=this._map.getMode().getTilePyramid(),this._updateMapView(f.getCrs(),f.getTileWidth(),f.getTileHeight(),f.getViewportSize(),r.heading,e,r.cameraLocation.altitudeReference)):(o=this._map.getMode().getCameraForLocationToPoint(this._location,this._point,e,r.cameraLocation.altitudeReference),this._mapView?(this._mapView.cameraLocation=o,this._mapView.heading=r.heading):this._mapView=new p(o,r.heading)),this._mapView},n.prototype._updateMapView=function(n,t,i,r,u,f,e){var l;this._location.altitude=f;var c=Math.pow(2,a.fromLocation(this._location,!0)),v=c*t,y=c*i,w=n.projectToX(this._location.latitude,this._location.longitude),b=n.projectToY(this._location.latitude,this._location.longitude),s=w-(this._point.x-r.width/2)/v,h=b-(this._point.y-r.height/2)/y;this._mapView?(this._mapView.cameraLocation.latitude=n.toLatitude(s,h),this._mapView.cameraLocation.longitude=n.toLongitude(s,h),this._mapView.cameraLocation.altitude=f,this._mapView.cameraLocation.altitudeReference=e,this._mapView.heading=u):(l=new o(n.toLatitude(s,h),n.toLongitude(s,h),f,e),this._mapView=new p(l,u))},n}(),li=function(){function n(n,t){this.zoom=a.fromLocation(n.getView().cameraLocation,!0);this.location=t.getLocation();this.point=t.getPoint()}return n}(),ri=function(){function n(t,i,r,u,f){this._validAuthenticationResultCode="ValidCredentials";this._invalidCredentialsMessage="The specified credentials are invalid. You can sign up for a free developer account at ";this._devSignUpUrl="http://www.bingmapsportal.com";var e;return n.instance?(e=n.instance,t&&e._hasValidCredentials===!1&&(e._map=f,e._credentials=t,e._logServiceResponse=null,e._hasValidCredentials=undefined)):(this._map=f,this._credentials=t,this._logServiceUriFormat=i,this._logger=r,this._callbackPool=[],this._logServiceResponse=null,this._hasValidCredentials=undefined,this._authFailureCount=0,n.instance=e=this),u?e._credentials||(e._hasValidCredentials=!1):e.authenticateClientAndRetrieveSessionId(null,f),e}return n.prototype.authenticateClientAndRetrieveSessionId=function(t,r){var u=this,f;this._logServiceResponse?t&&t(this._logServiceResponse):this._credentials?this._authFailureCount<=n._maxAuthenticationRetries&&(this._callbackPool.push(t),(this._callbackPool.length===1||this._authenticationFailed)&&(this._authenticationFailed=!1,f=this._logServiceUriFormat.replace(/{credentials}/,this._credentials).replace(/{mkt}/,i.dynamicProperties.market).replace(/{name}/,"MVC"),ut.downloadJsonp(f,"auth",function(n){return u._logServiceSuccessCallback(n,r)},function(){return u._logServiceErrorCallback(r)},"_logCallbackRequest"))):(this._hasValidCredentials=!1,this._showInvalidCredentialsError(r))},n.prototype.getInvalidCredentialsMessage=function(){return this._invalidCredentialsMessage+this._devSignUpUrl},n.prototype.getSessionId=function(){var n;return this._logServiceResponse&&this._logServiceResponse.authenticationResultCode===this._validAuthenticationResultCode&&(n=this._logServiceResponse.sessionId),n},n.prototype.hasValidCredentials=function(){return this._hasValidCredentials!==!1},n.prototype._logServiceSuccessCallback=function(n,i){t.assertNotNull(n,"response");this._hasValidCredentials=n.authenticationResultCode===this._validAuthenticationResultCode;this._logServiceResponse=n;this._hasValidCredentials||this._showInvalidCredentialsError(i);this._callbackPool.forEach(function(t){try{t&&t(n)}catch(i){}});this._callbackPool=[];this._instrumentAuthCall(this._hasValidCredentials)},n.prototype._logServiceErrorCallback=function(t){var f=this,r,u;this._authenticationFailed=!0;this._authFailureCount++;this._authFailureCount<n._maxAuthenticationRetries?Microsoft.Maps.setTimeout(function(){return f.authenticateClientAndRetrieveSessionId(null,t)},this._authFailureCount*100):(i.isMapsAnswer||i.isMapsVertical||(this._hasValidCredentials=!1,this._showInvalidCredentialsError(t)),r=e.logger,r&&(u={feature:tt.MapControl,action:b.Error,data:{errorMessage:"MapAuthentication failed after "+this._authFailureCount+" tries."}},r.logCriticalError(null,u)))},n.prototype._showInvalidCredentialsError=function(n){var i=n||this._map;if(i){var t=u._createElement("div").set_attr("aria-label",this.getInvalidCredentialsMessage()),f=u._createElement("div").appendTo(t).set_text(this._invalidCredentialsMessage).set_style({background:"#f8f7f5",padding:"10px",color:"#000",fontSize:"14px"}),e=u._createElement("a").appendTo(f).set_attr("href",this._devSignUpUrl).set_text(this._devSignUpUrl),r=i.getRootElement();r[0].insertBefore(t[0],r[0].firstChild);t.set_style({position:"absolute",overflow:"hidden",width:"100%",top:"50%",textAlign:"center",zIndex:9999}).set_attr("tabindex","0").set_attr("role","alert")}else console.error(this.getInvalidCredentialsMessage())},n.prototype._instrumentAuthCall=function(n){if(this._logger&&(i.isMapsAnswer||!i.isMapsVertical&&this._map&&this._map.getConfig()&&this._map.getConfig().enableSDKLogging)){var t={feature:tt.SDK,action:"Auth",data:{success:n,credentials:this._credentials,version:Microsoft.Maps.Internal._CoreConfig().mapcontrolVersion}};this._logger.logObject(t,null,!0);this._logger.flush()}},n._maxAuthenticationRetries=5,n}(),nf=function(){function n(){}return n.getMercatorZoomLevel=function(n){return n.getMercatorZoomLevel()},n.getMapBounds=function(n,t){return n.getBounds(t)},n.getViewportCenter=function(n,t,i){var r=t||n.getViewportPadding(),i=i||n.getActualSize();return new c(r.left+(i.width-r.left-r.right)/2,r.top+(i.height-r.top-r.bottom)/2)},n.getViewportCenterOffset=function(t){var i=n.getViewportCenter(t),r=t.getActualSize();return new nt(i.x-r.width/2,i.y-r.height/2)},n.getMapCenter=function(t){var i=n.getViewportCenter(t);return t.getMode().tryPointToLocation(i)},n.setMapCenter=function(t,i,r,u,f,e,o,s,h){var c=n.constructView(t,i,r,u,o,s,h);return t.setView(c,f,e),c},n.constructView=function(t,i,r,u,f,e,o){typeof r!="number"&&(r=n.getMercatorZoomLevel(t));f!==!0&&(r=Math.floor(r));(typeof u=="undefined"||u===null)&&(u=t.getView().heading);var s=t.getMode(),h=n.getViewportCenter(t,e,o),c=s.getCameraForLocationToPoint(i,h,a.toAltitude(i,r,!0),0,o);return new p(c,u)},n.setZoomLevel=function(t,i,r,u){var f=n.getMapCenter(t);n.setMapCenter(t,f,i,null,r,u)},n.zoomAroundLocation=function(n,t,i,r,u,f){var e=n.getMapOptions().navigationOptions;if((!e||!e.lockCameraAltitude)&&n.canZoom(i)){var o=n.getMode(),s=o.tryLocationToPoint(t),h=o.getMapViewZoomedAboutLocation(n.getTargetView(),t,i,f),c=r?new hr(n,t,s):null;n.setView(h,c,u)}},n.centerMapIfPrimitiveOutOfView=function(t,i){var f=n.getMapBounds(t,!0),r=i.geometry,u=new o(r.y,r.x);f.contains(u)||n.setMapCenter(t,u,t.getMercatorZoomLevel())},n.getZoomLevelForLocationsToBecomeVisible=function(t,i,r,u){var h,v;if(!i||i.length===0)return null;var e=0,s=0,c,l,f=r||n.getMapCenter(t);for(h=0,v=i.length;h<v;h++)c=Math.abs(f.latitude-i[h].latitude),c>e&&(e=c),l=Math.abs(f.longitude-i[h].longitude),l>s&&(s=l);try{var p=new o(f.latitude-e,f.longitude+s),w=new o(f.latitude+e,f.longitude+s),b=new o(f.latitude+e,f.longitude-s),k=new o(f.latitude-e,f.longitude-s),d=t.getMode().getMapViewForLocationsInView([b,k,p,w],u),y=a.fromLocation(d.cameraLocation,!0);return y<3?NaN:y}catch(g){return NaN}},n._getColorMapping=function(n){switch(n){case 1:case 2:case 3:return n-1;case 7:return 3;case 4:return 4;case 8:return 5;default:return 0}},n}(),tf=function(s){function h(e,o,c,l,v,y,w,b){var k=this,rt,g,et,ot,st,at,ft,tt,ht,ct,d,kt,lt;if(o=o||{credentials:null},rt=o.labelOptions=o.labelOptions||{},g=o.navigationOptions=o.navigationOptions||{},o.trafficOptions=o.trafficOptions||{},o.showCopyright=typeof o.showCopyright=="boolean"?o.showCopyright:!0,o.liteMode=typeof o.liteMode=="boolean"?o.liteMode:l.liteMode,i.isMapsVertical||(l.clickBasemapPrimitives=!1),typeof g.minZoomFraming=="number"||(g.minZoomFraming=3),typeof g.lockCameraHeading!="boolean"&&(g.lockCameraHeading=!0),(typeof o.disableStreetside=="undefined"||o.supportedMapTypes===null)&&(o.disableStreetside=!1),o.showDashboard=typeof o.showDashboard=="boolean"?o.showDashboard:!0,o.showScalebar=typeof o.showScalebar=="boolean"?o.showScalebar:!0,o.mapType===f.road&&u._isMapTypeSeasonalDefault()&&(window.location.search.indexOf("testhooks")===-1&&window.location.search.indexOf("excelsior")===-1?o.mapType=f.seasonal:window.location.search.indexOf("sdds")>=0&&window.location.search.indexOf("sdde")>=0&&(o.mapType=f.seasonal)),et={},k=s.call(this,et)||this,ot={position:"absolute",overflow:"hidden",width:"100%",height:"100%",top:"0",left:"0"},k._privates=et,k._disposables=[],k._disposables.push(k._workDispatcher=b),st=null,o.testHooksOptions&&(o.testHooksOptions.perfRun&&t.setPerfRun(!0,!0),o.testHooksOptions.debugRun&&t.setDebugRun(!0),o.testHooksOptions.enableFunctionalTestHooks&&t.setTestHook(e,l),o.testHooksOptions.perfTest&&(st="perfTest")),u._getUrlParam(window.location,"labelTest")&&(at=u._createElement("div").set_attr("id","labelTestHook").appendTo(e),t.setLabelLogElement(at)),o.mapType&&!f.isValid(o.mapType))throw"Invalid map type";ut.credentials=o.credentials;typeof rt.labelVisibility=="undefined"&&(rt.labelVisibility=vt.visible);o.liteMode||(rt.testRenderStyles=!1);o.tileDomainName=o.tileDomainName||l.tfeDomainDynamic;k._id=h._nextMapId++;k._container=c;k._disposables.push(k._container);k._mapOptions=o;k._coreConfig=l;k._processDpiOptions();e=k._parentElement=n(e);ft=k._rootElement=u._createElement("div").appendTo(e).add_class(br).set_style({"-ms-touch-action":"none"});k._sizeHelper=new nr(ft);k._disposables.push(k._sizeHelper);k._disposables.push(k._sizeHelper.resize.add(function(n){k._privates.setActualSize(n[0]);k.mapResized.invoke()}));k._modeElement=u._createElement("div").appendTo(ft).set_style(ot);k._overlayElement=u._createElement("div").appendTo(ft).set_style(ot).set_style({pointerEvents:"none",transform:"scale(1)"});o.allowInfoboxOverflow&&k._overlayElement.set_style({overflow:"visible"});k._disposables.push(k.copyrightControlLoaded=new r,k.frameManagerLoaded=new r,k.labelControllerLoaded=new r,k.overlayManagerLoaded=new r,k.navigationBarLoaded=new r,k.mapTypeButtonClicked=new r,k.constrainView=new r,k.viewChanging=new r,k.viewChanged=new r,k.targetViewChanged=new r,k.mapResized=new r,k.primitiveTapped=new r,k.primitiveDoubleTapped=new r,k.primitiveHoverStarted=new r,k.primitiveHoverStopped=new r,k.primitiveMoveStarted=new r,k.primitiveMoveContinued=new r,k.primitiveMoveStopped=new r,k.primitiveManipulationStarted=new r,k.primitiveManipulationContinued=new r,k.primitiveManipulationStopped=new r,k.boxZoomStarted=new r,k.boxZoomContinued=new r,k.boxZoomStopped=new r,k.boxZoomCancelled=new r,k.mapPanStarted=new r,k.mapPanContinued=new r,k.mapPanStopped=new r,k.mapZoomStarted=new r,k.mapZoomContinued=new r,k.mapZoomStopped=new r,k.mapManipulationStarted=new r,k.mapManipulationContinued=new r,k.mapManipulationStopped=new r,k.mapTapped=new r,k.mapDoubleTapped=new r,k.keyPressed=new r,k.keyReleased=new r,k.pointerMoved=new r,k.pointerEntered=new r,k.pointerExited=new r,k.pointerWheelChanged=new r,k.pointerPressed=new r,k.pointerReleased=new r,k.contextMenuInvoked=new r,k.copyrightChanged=new r,k.mapTypeChanged=new r,k.mapModeChanged=new r,k.actualSizeChanged=new r,k.mapZoomChanged=new r,k.mapRadialMenuChanged=new r,k.setViewInvoked=new r,k.interactionModeUpdated=new r,k.mapOptionsChanged=new r,k.viewChangingAfterPaint=new r,k.birdseyeV2SceneTransitioned=new r);k._disposables.push(k.mapOptionsChanged.add(function(n){k.updateMapOptions(k._mapOptions,n)}),k.mapPanStarted.add(function(){k._isPanning=!0}),k.mapPanStopped.add(function(){k._isPanning=!1}));k._mapOverlayBehavior=new ku;k._mapOverlayBehavior.attach(k);var yt=k._getDefaultSize(e),wt=yt.width,bt=yt.height;k._privates.defineProperty("baseLayers",function(n,t){return k._onMapTypeChanged(n,t)},function(n,t){return k._resolveMapType(n,t)});k._privates.defineProperty("mode",function(n,t){return k._onModeChanged(n,t)});k._privates.defineProperty("actualSize",function(n,t){return k._onActualSizeChanged(n,t)},null,{isPrivate:!0});k._privates.defineProperty("desiredSize",function(n,t){return k._onDesiredSizeChanged(n,t)},null,{defaultValue:new nt(wt,bt)});k._privates.defineProperty("viewportPadding",null,function(n){return k._setViewportPadding(n)},{defaultValue:{left:0,top:0,right:0,bottom:0}});o.supportedMapTypes||(o.supportedMapTypes=[f.road,f.aerial,f.birdseye,f.streetside,f.ordnanceSurvey,f.seasonal],u._isFeatureEnabled("birdseyeV2UI")&&o.supportedMapTypes.splice(2,1,f.birdseyeV2));k._disposables.push(k._mapTypes=new bu(k,l,c,o.mapType,o.tileDomainName),k._layers=new it);o.center?(tt={center:o.center,zoom:undefined},o.center.altitude&&(tt.zoom=a.fromLocation(o.center,!0))):tt=h._getBootstrapLocation();t.assert(l.defaultZoomLevel>0,"defaultZoomLevel in config is set to incorrect value. coreConfig.defaultZoomLevel = "+l.defaultZoomLevel);(!l.defaultZoomLevel||l.defaultZoomLevel<=0)&&(l.defaultZoomLevel=11);ht=typeof o.zoom=="number"?o.zoom:tt.zoom||l.defaultZoomLevel;ct=l.defaultMapType||f.road;d=o&&o.mapType||ct;d===f.birdseye&&(k.getMapOptions().disableBirdseye||ht<=k._coreConfig.aerialCutOffZoom)&&(d=f.aerial);o.disableStreetside&&(d===f.streetside&&(d=ct),o.disableStreetsideAutoCoverage=!0);o.liteMode&&(o.showLandmarks=!1);k._disposables.push(k._allLayers=new su(k));k.setBaseLayers(k._resolveMapType(d,k.getMapTypes()[f.road]));c.registerInstance("Map",k);c.registerInstance("allLayers",k._allLayers);kt=new ri(k._mapOptions&&k._mapOptions.credentials,k._coreConfig.logServiceUrlFormat,y,!1,k);kt.authenticateClientAndRetrieveSessionId(null,k);k._instrumentationManager=new vu(k,v,y,w,st);k._landmarksManagerPromise=new pt;k._cityPolygonManagerPromise=new pt;k._birdseyeV2ManagerPromise=new pt;k._disposables.push(k._instrumentationManager);var dt=o.heading||0,gt=o.pitch||0,ni=o.streetsideOptions||{};return typeof k._mapOptions.minZoom=="number"&&k.setMinZoom(k._mapOptions.minZoom,!1),typeof k._mapOptions.maxZoom=="number"&&k.setMaxZoom(k._mapOptions.maxZoom,!1),k._mapOptions.constrainBirdseyeView&&(k._mapOptions.constrainBirdseyeView=!0),k.setDesiredSize(new nt(wt,bt)),t.setMap(k),k._bootstrapState=0,lt=k.getView()||new p(a.toLocation(tt.center,ht,!0),dt),d===f.streetside?k._instantiateMapInStreetsideMapMode(lt):k._instantiateMapInCompositeMapMode(lt),k._processNavigationBarMapOptions(),(n.Browser.is_ie||n.Browser.is_edge)&&(n(window).add_event("beforeunload",k._beforeUnloadDummyHandler),k.pageHideHandler=function(){k.dispose()},n(window).add_event("pagehide",k.pageHideHandler)),k}return k(h,s),h.prototype.getCopyrightControl=function(){return this._coreConfig.useOverlayQuadrants&&this._mapOverlayManager?this._mapOverlayManager.getCopyrightControl():this._copyrightControl},h.prototype.getLogoControl=function(){return this._coreConfig.useOverlayQuadrants&&this._mapOverlayManager?this._mapOverlayManager.getLogoControl():this._logoControl},h.prototype.getSizeHelper=function(){return this._sizeHelper},h.prototype.getDefaultAerialZoomCutOffForBirdsEyeMode=function(){return this._coreConfig.aerialCutOffZoom},h.prototype.getId=function(){return this._id},h.prototype.getConfig=function(){return this._coreConfig},h.prototype.getDpiScale=function(){return this._tileDpiScale},h.prototype.getLabelDpiScale=function(){return this._labelDpiScale},h.prototype.getZoomOffset=function(){var n=this.getDpiScale();return n>1?Math.floor(l.log2(n)):0},h.prototype.getLabelController=function(){return this._labelController},h.prototype.getNavigationBar=function(){return this._navigationBar},h.prototype.getScaleBar=function(){return this._coreConfig.useOverlayQuadrants&&this._mapOverlayManager?this._mapOverlayManager.getScaleBar():this._scaleBarControl},h.prototype.getMapOptions=function(){return this._mapOptions},h.prototype.getLayers=function(){return this._layers},h.prototype.getAllLayers=function(){return this._allLayers},h.prototype.getOverlays=function(){return this._overlayCollection},h.prototype.getMapOverlayManager=function(){return this._mapOverlayManager},h.prototype.getRootElement=function(){return this._rootElement},h.prototype.getContainer=function(){return this._container},h.prototype.getMapTypes=function(){return this._mapTypes},h.prototype.getLandmarksManager=function(){return this._landmarksManagerPromise},h.prototype.getCityPolygonManager=function(){return this._cityPolygonManagerPromise},h.prototype.getBirdseyeV2Manager=function(){return this._birdseyeV2ManagerPromise},h.prototype.isLocationInView=function(n){var i=this.getMode(),t;return n&&i?(t=i.tryLocationToPoint(n),t&&t.x>=0&&t.x<=this.getActualSize().width&&t.y>=0&&t.y<=this.getActualSize().height):!1},h.prototype.getFrameManager=function(){return this._frameManager},h.prototype.isDisposed=function(){return this._isDisposed},h.prototype.isPanning=function(){return this._isPanning},h.prototype.dispose=function(){if(!this._isDisposed){this._isDisposed=!0;s.prototype.dispose.call(this);this._viewStoryboard&&this._viewStoryboard.abort();this._mapOverlayBehavior&&this._mapOverlayBehavior.detach();var t=this.getMode();t&&t.dispose();this._overlayElement.clear()&&this._overlayElement.removeFromParent();this._modeElement.clear()&&this._modeElement.removeFromParent();this._rootElement.clear()&&this._rootElement.removeFromParent();this._parentElement.clear();(n.Browser.is_ie||n.Browser.is_edge)&&(n(window).remove_event("beforeunload",this._beforeUnloadDummyHandler),n(window).remove_event("pagehide",this.pageHideHandler));u._clearDisposables(this._disposables);u._nullifyClass(this)}},h.prototype.getSessionId=function(){return ri.instance.getSessionId()},h.prototype.getAuthKey=function(){return this.getSessionId()||this._mapOptions&&this._mapOptions.credentials},h.prototype.getView=function(){return this._view},h.prototype.getTargetView=function(){return this._targetView},h.prototype.getViewport=function(){var n=this.getBounds(),t=this.getActualSize()||{width:0,height:0},i=t.width,r=t.height;return new e.Viewport(i,r,n.bounds,n.crs)},h.prototype.getMercatorZoomLevel=function(){return this._view?a.fromLocation(this._view.cameraLocation,!0):0},h.prototype.getBounds=function(n,t){var e=t?t:this.getView(),f,v,y,p,h,g;if(!e)return new w(new o(0,0),0,0);f=n?this.getViewportPadding():{left:0,right:0,top:0,bottom:0};var s=this.getActualSize(),l=new c(f.left,f.top),nt=new c(s.width-f.right,f.top),a=new c(s.width-f.right,s.height-f.bottom),tt=new c(f.left,s.height-f.bottom),r,u=this.getMode();if(e.heading===0?(v=u.tryPointToLocation(l,e),y=u.tryPointToLocation(a,e),r=w.fromCorners(v,y)):(p=new ei,r=p.accumulateLocations([u.tryPointToLocation(l,e),u.tryPointToLocation(nt,e),u.tryPointToLocation(a,e),u.tryPointToLocation(tt,e)])),i.tileRefactoringEnabled){if(u.getTileSize){var b=this.getMercatorZoomLevel(),k=Math.pow(2,b),d=k*u.getTileSize().width;s.width>d&&(r=w.fromEdges(r.getNorth(),-180,r.getSouth(),180))}}else if(h=u.getTilePyramid&&u.getTilePyramid(),h){var b=h.getZoom(),k=Math.pow(2,b),d=k*h.getTileWidth();s.width>d&&(r=w.fromEdges(r.getNorth(),-180,r.getSouth(),180))}return g=1e-9,r.width<=g&&(r=w.fromEdges(r.getNorth(),-180,r.getSouth(),180)),r},h.prototype.getCopyrights=function(n){var t=this.getMode();t&&t.getCopyrights(n)},h.prototype.getIsMapHitTestable=function(){return this._mapOptions&&this._mapOptions.testHooksOptions&&this._mapOptions.testHooksOptions.hitTest},h._getBootstrapLocation=function(){var r=i.dynamicProperties,n=r.location,e,h;if((!n||n==="0,0")&&(n=r.reverseIPLocation,!n)){var s=fi,u=parseFloat(s.getItem("centerLatitude")),f=parseFloat(s.getItem("centerLongitude"));if(isFinite(u)&&isFinite(f)){if(e=parseFloat(s.getItem("zoom")),isFinite(e))return h=a.toAltitude(new o(u,f),e,!0),{center:new o(u,f,h),zoom:e};n=u+","+f}else n=r.marketLocation,t.assert(!!n,"unable to determine bootstrap location"),n||(n="47.603569,-122.329453")}return{center:o.parseLatLong(n),zoom:r.zoom}},h.prototype.setView=function(r,u,f,o){function rt(n,i){t.groupCollapsed(null,"Animation frame: {0}",i.percent.toString());var r=u.interpolate(l,c,i.percent),e=s._view;s._view=r;s._raiseViewChangingEvent(new at(f,!0));nt(u)&&s.mapZoomContinued.hasHandlersRegistered()&&s.mapZoomContinued.invoke(new li(s,u));t.groupEnd()}function ut(){var n=function(){var t=s._view,n;s._view=s._targetView;s._saveView();s.changed.invoke(new lt(s,"view",t,s._view));s.viewChanged.invoke(new at(f));nt(u)&&s.mapZoomStopped.hasHandlersRegistered()?s.mapZoomStopped.invoke(new li(s,u)):(n=s.getFrameManager(),n&&n.hackHackSetFrame());s.copyrightChanged&&s.copyrightChanged.invoke()};s._workDispatcher.dispatch(n,h._animationFrameWorkDispatcherKey,0)}function nt(n){return e.ZoomAroundLocationAnimator?n instanceof e.ZoomAroundLocationAnimator:!1}var s,b,k,l,c,d,a,y,it,g;if(!this._isDisposed&&(t.assertNotNull(r,"mapView"),t.assertNotNull(r.cameraLocation,"mapView.cameraLocation"),t.assert(r.cameraLocation.altitudeReference!==-1,"Invalid AltitudeReference"),s=this,f=f||0,(f===1||f===2)&&this._mapOptions&&this._mapOptions.navigationOptions&&(b=this._mapOptions.navigationOptions,b.lockCameraAltitude&&(r.cameraLocation.altitude=this._targetView.cameraLocation.altitude,r.cameraLocation.altitudeReference=this._targetView.cameraLocation.altitudeReference),this._enforceMinMaxAltitude(r),b.lockCameraHeading&&(r.heading=this._targetView.heading)),o||!p.areEqual(r,this._targetView))&&(this._view=this._view||r,k=this._getConstrainViewArgs(r,f),!k.cancel)){l=this._view;c=r;u&&(i.tileRefactoringEnabled&&this._workDispatcher&&this._workDispatcher.cancelAllDispatch(),l=l.clone(),c=c.clone(),d=l.cameraLocation.longitude,a=c.cameraLocation.longitude,Math.abs(d-a)>180&&(d<0?a-=360:a+=360,c.cameraLocation.longitude=a));this._workDispatcher&&this._workDispatcher.cancelDispatchWithKey(h._animationFrameWorkDispatcherKey,0);var w=this._viewStoryboard,tt=0,v=0;w&&(v=w.get_duration(),tt=(1-w.get_position())*v,w.abort(),this._viewStoryboard=null);r=k.view;y=this._targetView;this._targetView=r;y&&r&&y.cameraLocation&&r.cameraLocation&&(p.areCameraAltitudesEqual(y,r)||this.mapZoomChanged.invoke());this.changed.invoke(new lt(this,"targetView",y,r));this.targetViewChanged.invoke(new du(f,u));u?(v=Math.max(v,h._viewChangeMaxPercent*u.duration),this._viewStoryboard=n.Effects.Storyboard.create([this],{percent:0},{percent:1},rt,Math.min(tt+u.duration,v),null,ut,function(n){return n},h._animationInterval),this._viewStoryboard.begin(),nt(u)&&this.mapZoomStarted.hasHandlersRegistered()&&this.mapZoomStarted.invoke(new li(this,u))):(it=this._view,this._view=r,this.changed.invoke(new lt(this,"view",it,r)),this._raiseViewChangingEvent(new at(f,!0)),this.viewChanged.invoke(new at(f)),this.copyrightChanged&&this.copyrightChanged.invoke(),f!==2&&(this._saveView(),g=this.getFrameManager(),g&&g.hackHackSetFrame()))}},h.prototype.canZoom=function(n){if(this._isDisposed)return!1;var r=this.getMode(),i=this.getTargetView(),u=i.cameraLocation,t=r.getMapViewZoomedAboutLocation(i,u,n);return t=this._getConstrainViewArgs(t).view,this._enforceMinMaxAltitude(t),!p.areCameraAltitudesEqual(i,t)},h.prototype.getMapType=function(){return this._mapType},h.prototype.setMapType=function(n){if(!this._isDisposed&&n!==this._mapType){var t=this._mapType;this.setBaseLayers(this._resolveMapType(n));this._onMapTypeChanged(t,n)}},h.prototype.createMapType=function(n){return this._resolveMapType(n)},h.prototype.getTemplateSelector=function(){return this._mapType&&this._mapType.getTemplateSelector()},h.prototype.setMinZoom=function(n,t,i){var r,u,f;if(t!==!1&&(t=!0),r=a.toAltitude(new o(0,0),n,!0),u=this._mapOptions.navigationOptions.minCameraAltitude,typeof u=="number"&&r<u)throw"minZoom to set is greater than map's currently allowed maximum zoom level";i!==!1&&(this._mapOptions.minZoom=n);this._mapOptions.navigationOptions.maxCameraAltitude=r;t&&this._targetView.cameraLocation.altitude>r&&(f=this._targetView.cameraLocation.clone(),f.altitude=r,this.setView(new p(f)))},h.prototype.setMaxZoom=function(n,t){var i,r,u;if(t!==!1&&(t=!0),i=a.toAltitude(new o(0,0),n,!0),r=this._mapOptions.navigationOptions.maxCameraAltitude,typeof r=="number"&&i>r)throw"maxZoom to set is smaller than map's currently allowed minimal zoom level";this._mapOptions.maxZoom=n;this._mapOptions.navigationOptions.minCameraAltitude=i;t&&this._targetView.cameraLocation.altitude<i&&(u=this._targetView.cameraLocation.clone(),u.altitude=i,this.setView(new p(u)))},h.prototype.setMaxBounds=function(n,t){var i,r;t!==!1&&(t=!0);i=this.getMode().getMapViewForLocationsInView([new o(n.getNorth(),n.getEast()),new o(n.getSouth(),n.getWest())]);typeof this._mapOptions.minZoom!="number"&&this.setMinZoom(a.fromLocation(i.cameraLocation,!0),!1,!1);this._mapOptions.maxBounds=n;t&&(this._view?(r=this._getConstrainViewArgs(this._view.clone(),0),this.setView(r.view)):this.setView(i))},h.prototype.setMapLayerHighlight=function(n,t){for(var r,u=!1,i=0;i<this._layers.length;i++)if(r=this._layers[i],r.getId()===n){u=!0;r.setHighlighted(t);break}return u},h.prototype._raiseViewChangingEvent=function(n){this.viewChanging.invoke(n);this._previousViewChangeArg=n;this._onPaintEventHandler||this._raiseViewChangingAfterPaintEvent()},h.prototype._raiseViewChangingAfterPaintEvent=function(){this._previousViewChangeArg&&(this.viewChangingAfterPaint.invoke(this._previousViewChangeArg),this._previousViewChangeArg=null)},h.prototype._getDefaultSize=function(n){var r,u,t,f,e;if(i.isMapsVertical)return new nt(-1,-1);for(t=n;t.length>0;){if(t[0].tagName==="HTML"||r===-1&&u===-1)break;typeof Element=="function"&&t[0]instanceof Element?(f=parseFloat(t.get_style("width")),e=parseFloat(t.get_style("height")),f>0&&(r=-1),e>0&&(u=-1)):(t.get_size().width>0&&(r=-1),t.get_size().height>0&&(u=-1));t=t.parent()}return r=r===-1?r:-2,u=u===-1?u:-2,new nt(r,u)},h.prototype._resolveMapType=function(n,t){var r,e;return this._isDisposed?null:(t||(t=this.getMapTypes()[f.road]),r=t,typeof n=="string"?(e=this._mapTypes[n],e&&(n===f.ordnanceSurvey&&!!i.features.ordnanceSurvey.isEnabled||n===f.seasonal&&u._isMapTypeSeasonalAvailable()||n!==f.ordnanceSurvey&&n!==f.seasonal)&&(r=e)):r=n,r)},h.prototype._setViewportPadding=function(n){n=n||{};return{left:n.left||0,top:n.top||0,right:n.right||0,bottom:n.bottom||0}},h.prototype._saveView=function(){if(!this._isDisposed){var t=this.getView().cameraLocation,n=this._coreConfig.locateMeViewExpirationDays;fi.setItem("centerLatitude",t.latitude.toString(),n);fi.setItem("centerLongitude",t.longitude.toString(),n);fi.setItem("zoom",this.getMercatorZoomLevel().toString(),n)}},h.prototype._onMapTypeChanged=function(n,t){var v=this,e,s,c,l;if(!t||!f.isValid(t.id))throw"Map._onMapTypeChanged trying to set map type to unsupported value";if(t.id===f.road&&u._isHighContrastMode()&&(e=this.getMapTypes().find(function(n){return n.id===f.highContrast}),e&&(t=e)),this._mapType=t,s=this._mapType.getTemplateSelector(),s.then(function(n){var t=v._mapType.id==="rv1";n.setProcessDrawOrder(t)}),this._allLayers.setBaseLayers(t),n&&t&&n.id&&t.id&&this.mapTypeChanged.invoke(new gu(n.id,t.id)),this._view){var h=this.getMercatorZoomLevel(),r=null,i=this._view.cameraLocation;h<this._mapType.minZoom?r=a.toAltitude(i,this._mapType.minZoom,!0):h>this._mapType.maxZoom&&(r=a.toAltitude(i,this._mapType.maxZoom,!0));r&&(c=new o(i.latitude,i.longitude,r,i.altitudeReference),l=new p(c,this._view.heading),this.setView(l))}},h.prototype._onMapModePaint=function(n){var r=this,u;t.logDebugData("Map - onMapModePaint");i.features.performance.initializationSeqVerification||i.tileRefactoringEnabled?(u=function(){r._modePaintHandler&&(r._modeElement.fadeToChild(r.getMode().getRootElement()),r._modePaintHandler.dispose(),r._modePaintHandler=null,r._frameRenderedHandler&&r._frameRenderedHandler.dispose(),r._frameFailedHandler&&r._frameFailedHandler.dispose())},this._frameManager&&(this._frameManager.frameRendered.isPreviouslyInvoked||this._frameManager.frameFailed.isPreviouslyInvoked?u():this._frameRenderedHandler||(this._frameRenderedHandler=this._frameManager.frameRendered.addOne(u),this._frameFailedHandler=this._frameManager.frameFailed.addOne(u)))):this._bootstrapState===0&&n.percentComplete>=.8&&(this._instantiateFrameManager(),this._modeElement.fadeToChild(this.getMode().getRootElement()),this._modePaintHandler.dispose(),this._modePaintHandler=null)},h.prototype._instantiateMapInCompositeMapMode=function(n){var r=this;this.getContainer().instanceAsync("CompositeMapMode",function(u){if(r._instrumentationManager.setMapMode(u),t.logDebugData("Map - Composite Map mode ctor: mapMode.onPaint "+u.onPaint),r.setMode(u),i.tileRefactoringEnabled){r._view=r._view||n;var e=new Microsoft.Maps.BirdseyeV2Manager(r);if(r._disposables.push(r._birdseyeV2Manager=e),r._birdseyeV2ManagerPromise.resolve(e),r.getMapType().id===f.birdseyeV2)e.onMapTypeChanged({oldMapTypeId:null,newMapTypeId:f.birdseyeV2})}(i.features.performance.initializationSeqVerification||i.tileRefactoringEnabled)&&r._instantiateFrameManager();i.tileRefactoringEnabled&&r._disposables.push(r._modePaintHandler=u.onFrameRendered.addOne(function(){return r._onMapModePaint()}));r._targetView||r.setView(n,null,3);u.onPaint&&!i.tileRefactoringEnabled&&r._disposables.push(r._modePaintHandler=u.onPaint.add(function(n){return r._onMapModePaint(n)}))},undefined,!i.isMapsVertical)},h.prototype._instantiateMapInStreetsideMapMode=function(n){var t=this;this._view=this._targetView=n;this.getContainer().instanceAsync("StreetsideModeBootstrapper",function(r){var u=t._mapOptions.streetsideOptions||{},e=function(){t._mapOptions.mapTypeId=f.road;t.setBaseLayers(t._resolveMapType(f.road,t.getMapTypes()[f.road]));t._instantiateMapInCompositeMapMode(n);u.onErrorLoading&&u.onErrorLoading()},o=t._mapOptions.streetsideOptions&&t._mapOptions.streetsideOptions.panoramaInfo;r.isAvailable(o||t.getView().cameraLocation,function(n){var u=t._mapOptions.streetsideOptions||{},e=new or({mapType:f.streetside,templateName:"097A0D85-2585-425A-8471-60BDD3C5B7C3",data:[],minZoom:18,maxZoom:23,mapTypeEnabled:!0},0);t._disposables.push(e);t._mapType=e;t._instantiateFrameManager();u.zoomIn=!0;u.entryPoint=i.isMapsVertical?"Permalink":"SDK";u.perfClickToImmersionTimeSource="SS_PCI";u.heading=t._mapOptions.heading;u.pitch=t._mapOptions.pitch;r.show(n,u)},e,u)},undefined,!i.isMapsVertical)},h.prototype._instantiateFrameManager=function(){var n=this,r;this._bootstrapState===0&&(i.tileRefactoringEnabled&&this._onFrameManagerLoaded(new ni(this,this._allLayers)),r=i.features.labels.glRenderingBuckets?"LabelControllerGL":"LabelController",this._container.instanceAsync(r,function(r){var u,e;n._isDisposed||(i.tileRefactoringEnabled||n._container.instanceAsync("MapFrameManager",function(t){return n._onFrameManagerLoaded(t)}),n._labelController=r,n._disposables.push(n._labelController),n._labelController.attach(n),n.labelControllerLoaded.invoke(),u=n._mapOptions.labelOptions.labelVisibility===vt.visible||n.getMapType().id===f.road&&!n._mapOptions.allowHidingLabelsOfRoad?!0:!1,n._labelController.setIsLabelsEnabled(u),e=n.getNavigationBar(),e?e.getHelper().setLabelVisible(u):n.navigationBarLoaded.addOne(function(){return n.getNavigationBar().getHelper().setLabelVisible(u)}),t.logDebugData("Map - onMapModePaint - LabelController created"))},{CoreConfig:this._coreConfig},!1,function(n,t){console.log(t)}),this._bootstrapState=1)},h.prototype._onFrameManagerLoaded=function(n){var r=this,u;this._isDisposed||(this._frameManager=n,this._disposables.push(this._frameManager),this.frameManagerLoaded.invoke(this._frameManager),this._disposables.push(this._frameManager.frameRendered.addOne(function(){return r._postInit()})),i.tileRefactoringEnabled?u=this._frameManager.frameFailed.add(function(n){n.reason!==1&&(u.dispose(),r._postInit())}):this._disposables.push(this._frameManager.frameFailed.addOne(function(){return r._postInit()})),this._frameManager.initializeLayers(),t.logDebugData("Map - onMapModePaint - MapFrameManager created"),i.isMapsVertical?this._container.downloadDependencyAsync("TransientLens"):this._disposables.push(this._frameManager.dataLoaded.addOne(function(){r._container.downloadDependencyAsync("MapInteraction")})))},h.prototype._postInit=function(){var n=this;t.logDebugData("Map - postInit");this._bootstrapState!==2&&(this._container.instanceAsync("BrowserKeyProvider",function(t){n._disposables.push(t)}),this._container.instanceAsync("BrowserPointerProvider",function(t){n._disposables.push(t)}),this._container.instanceAsync("GlobalDataEventHandler",function(){var t=i.features.streetside;!n.getMapOptions().disableStreetsideAutoCoverage&&t&&t.isEnabled&&t.isCoverageLayerEntryPointEnabled&&n._container.instanceAsync("StreetsideAutoEntryBehavior",null,{Map:n})}),this._overlayCollection=new it,this._container.instanceAsync("OverlayManager",function(i){i.getRootElement().appendTo(n._overlayElement);t.logDebugData("Map - postInit - Overlay Manager created");n.overlayManagerLoaded.invoke()}),this._mapOptions&&this._mapOptions.showLandmarks&&(i.isMapsAnswer||i.isMapsVertical)&&this._container.instanceAsync("LandmarksManager",function(t){n._isDisposed||(t.selectorReady(),n._disposables.push(n._landmarksManager=t),n._landmarksManagerPromise.resolve(t))},{map:this,coreConfig:this._coreConfig,container:this._container}),this._bootstrapState=2,this.getMode().mapModeType===0&&this._postInitForCompositeMode(),this._container.instanceAsync("CityPolygonManager",function(t){if(!n._isDisposed){n._disposables.push(n._cityPolygonManager=t);n._cityPolygonManagerPromise.resolve(t);var i=u._getPolygonId();i&&n._cityPolygonManager.addLayer(i,7,17);n._disposables.push(t)}},{map:this,coreConfig:this._coreConfig}))},h.prototype._postInitForCompositeMode=function(){var n=this,t;this._haveCalledPostInitForCompositeMode||(this._haveCalledPostInitForCompositeMode=!0,this._mapOptions.maxBounds&&this.setMaxBounds(this._mapOptions.maxBounds),i.tileRefactoringEnabled||this.getContainer().instanceAsync("BirdseyeV2Manager",function(t){if(n._disposables.push(n._birdseyeV2Manager=t),n._birdseyeV2ManagerPromise.resolve(t),n.getMapType().id===f.birdseyeV2)t.onMapTypeChanged({oldMapTypeId:null,newMapTypeId:f.birdseyeV2})}),this._createNavigationBar(),this._coreConfig.useOverlayQuadrants?this._container.instanceAsync("MapOverlayManager",function(t){n._disposables.push(n._mapOverlayManager=t)},{Map:this,RootElement:this._overlayElement}):(this._mapOptions&&this._mapOptions.showLogo&&(t=typeof this._mapOptions.enableClickableLogo!="undefined"?this._mapOptions.enableClickableLogo:!0,this._container.instanceAsync("LogoControl",function(t){n._logoControl=t;n._disposables.push(t);n._container.instanceAsync("LogoOverlay",function(t){n.getOverlays().insert(t)},{LogoControl:t})},{Map:this,Clickable:t})),this._createCopyrightControl(),this._createScaleBar()))},h.prototype._createNavigationBar=function(){var n=this;this._container.instanceAsync("NavigationBar",function(i){t.logDebugData("Map - postInit - Navigation Bar created");n._navigationBar=i;n._disposables.push(n._navigationBar,i.mapTypeButtonClicked.add(function(t){return n.mapTypeButtonClicked.invoke(t)}));n.navigationBarLoaded.invoke();n._mapOptions.showBreadcrumb!==!1&&n._container.instanceAsync("GeochainControl",function(t){var i=n._navigationBar.getLocateMeControl();i&&(i.setGeochainControl(t),i.setGeochainVisibility(n._mapType.id!==f.birdseyeV2));n._disposables.push(t)});n._container.instanceAsync("NavigationBarOverlay",function(t){n.getOverlays().insert(t)},{NavigationBar:i})},{Map:this,CoreConfig:this._coreConfig,DragonflyContainer:this._container})},h.prototype._createCopyrightControl=function(){var n=this,t;this._mapOptions.showCopyright&&(t=this._mapOptions&&this._mapOptions.showTermsLink?this._mapOptions.showTermsLink:!1,this._container.instanceAsync("CopyrightControl",function(t){n._copyrightControl=t;n._disposables.push(t);n._container.instanceAsync("CopyrightOverlay",function(t){n.getOverlays().insert(t);n.copyrightControlLoaded.invoke(n._copyrightControl)},{CopyrightControl:t})},{Map:this,CoreConfig:this._coreConfig,ShowTermsLink:t}))},h.prototype._createScaleBar=function(){var n=this;this._mapOptions.showScalebar&&this._container.instanceAsync("ScaleBar",function(t){n._scaleBarControl=t;n._disposables.push(n._scaleBarControl);n._container.instanceAsync("ScaleBarOverlay",function(t){n.getOverlays().insert(t)},{ScaleBar:t})},{Map:this})},h.prototype._onModeChanged=function(n,i){var e=this,r=null,u=n&&n.mapModeType,f=i&&i.mapModeType;u!==f&&(r={oldMode:u,newMode:f});r&&this.mapModeChanged.invoke(r);n&&n.deactivated&&n.deactivated();t.logDebugData("Map - onModeChanged event");this._bootstrapState!==0&&this._modeElement.fadeToChild(i.getRootElement());i&&i.activated&&i.activated();this.copyrightChanged&&this.copyrightChanged.invoke();this._onPaintEventHandler&&(this._onPaintEventHandler.dispose(),this._onPaintEventHandler=null);i&&i.onPaint&&(this._onPaintEventHandler=i.onPaint.add(function(){return e._raiseViewChangingAfterPaintEvent()}));i.mapModeType===0&&this._bootstrapState===2&&this._postInitForCompositeMode();i.mapModeType===2?this._overlayElement&&this._overlayElement.set_style({transform:""}):this._overlayElement&&this._overlayElement.set_style({transform:"scale(1)"})},h.prototype._onActualSizeChanged=function(n,t){var i=this,r=t&&t.width,u=t&&t.height;r>0&&u>0&&Microsoft.Maps.setTimeout(function(){if(i._targetView){i._mapOptions.maxBounds&&i.setMaxBounds(i._mapOptions.maxBounds,!1);var n=i._getConstrainViewArgs(i._targetView,1);i.setView(n.view);i.actualSizeChanged.invoke()}},0)},h.prototype._onDesiredSizeChanged=function(n,t){var r=t&&t.width,u=t&&t.height,s,h,e,o,f;if(i.isMapsVertical||(this._parentElement.length>0&&typeof Element=="function"&&this._parentElement[0]instanceof Element?(s=parseFloat(this._parentElement.get_style("width")),h=parseFloat(this._parentElement.get_style("height")),s===0&&this._parentElement.set_style({width:"100%"}),h===0&&this._parentElement.set_style({height:"100%"})):(e=this._parentElement.get_size(),e.width===0&&this._parentElement.set_style({width:"100%"}),e.height===0&&this._parentElement.set_style({height:"100%"}))),o=r===-1||u===-1,f={position:o?"absolute":"relative",width:r===-1?"100%":r===-2?"100vw":r+"px",height:u===-1?"100%":u===-2?"100vh":u+"px"},o){switch(this._parentElement.get_style("position")){case"relative":case"absolute":break;default:this._parentElement.set_style({position:"relative"})}f.top=f.left=0}this._rootElement.set_style(f);this._sizeHelper.pollSize()},h.prototype._getConstrainViewArgs=function(n,t){var i=new hu(n,t);return this.constrainView.invoke(i),i},h.prototype._enforceMinMaxAltitude=function(n){var t=this._mapOptions.navigationOptions;typeof t.minCameraAltitude=="number"&&(n.cameraLocation.altitude=Math.max(t.minCameraAltitude,n.cameraLocation.altitude));typeof t.maxCameraAltitude=="number"&&(n.cameraLocation.altitude=Math.min(t.maxCameraAltitude,n.cameraLocation.altitude))},h.prototype._onDisplayTileBoundariesChanged=function(){var n=this},h.prototype.getLogoEnd=function(){var t=0,n;return this._logoControl&&(n=this._logoControl.getRootElement(),n&&(t=n.get_relative_pos().x+n.get_size().width)),t},h.prototype.updateMapOptions=function(n,t){for(var r,u,e,s,c=Object.keys(t),o=0,v=c.length;o<v;o++)(r=c[o],u=t[r],r==="disableStreetside"&&this._containsOption(n,r))||(u&&typeof u=="object"?(n[r]||(n[r]={}),this.updateMapOptions(n[r],u)):n[r]=t[r],r==="customMapStyle"&&(this._mapTypes.updateCustomMapStyle(u),n[r]=t[r],e=this.getMode(),e&&(i.tileRefactoringEnabled?this.setView(new p(this._view.cameraLocation),null,0,!0):(s=e.getTilePyramid&&e.getTilePyramid(),s&&(s.clearTileCache(!0),this.setView(new p(this._view.cameraLocation),null,0,!0))))));if(this._navigationBar){var h=!1,l=!1,a=!1;n.showDashboard!==!1&&(h=n.disableZooming?!1:typeof n.showZoomButtons=="boolean"?n.showZoomButtons:!0,l=n.showMapTypeSelector!==!1,a=this._mapType.id!==f.birdseyeV2&&n.showLocateMeButton!==!1);this._navigationBar.setZoomInButtonVisible(h);this._navigationBar.setZoomOutButtonVisible(h);this._navigationBar.setMapStyleSelectorControlVisible(l);this._navigationBar.setLocateMeButtonVisible(a)}(typeof t.disableScrollWheelZoom=="boolean"||typeof t.disableKeyboardInput=="boolean")&&this.interactionModeUpdated.invoke()},h.prototype._containsOption=function(n,t){return typeof n[t]!="undefined"},h.prototype._processNavigationBarMapOptions=function(){var n=this.getMapOptions();n.navigationBarMode=typeof n.navigationBarMode=="undefined"?i.isMobile?ft.compact:ft["default"]:n.navigationBarMode;n.showMapTypeSelector=typeof n.showMapTypeSelector=="undefined"?!0:n.showMapTypeSelector;var t=typeof n.showLocateMeButton=="undefined",r=typeof n.showTrafficButton=="undefined",u=typeof n.navigationBarOrientation=="undefined";switch(n.navigationBarMode){case ft.compact:n.showLocateMeButton=t?!1:n.showLocateMeButton;n.showTrafficButton=r?!1:n.showTrafficButton;n.navigationBarOrientation=u?ot.horizontal:n.navigationBarOrientation;break;case ft.minified:n.showLocateMeButton=t?!1:n.showLocateMeButton;n.showTrafficButton=r?!0:n.showTrafficButton;n.navigationBarOrientation=u?ot.vertical:n.navigationBarOrientation;break;default:n.showLocateMeButton=t?!0:n.showLocateMeButton;n.showTrafficButton=r?!1:n.showTrafficButton;n.navigationBarOrientation=u?ot.vertical:n.navigationBarOrientation}n.disableBirdseye=typeof n.disableBirdseye=="undefined"?!1:n.disableBirdseye;this._processTrafficOptions()},h.prototype._processTrafficOptions=function(){var n=this.getMapOptions().trafficOptions,t=i.features.traffic;n&&t&&(n.opacity=typeof n.opacity=="undefined"?this.getConfig().liteMode?t.defaultTrafficLayerOpacityLiteMode:t.defaultTrafficLayerOpacity:n.opacity,n.incidentsVisible=typeof n.incidentsVisible=="undefined"?!0:n.incidentsVisible,n.flowVisible=typeof n.flowVisible=="undefined"?!0:n.flowVisible,n.legendVisible=typeof n.legendVisible=="undefined"?!1:n.legendVisible)},h.prototype._processDpiOptions=function(){var t=1,r=1,n;(this._coreConfig.allowHighDpi||this._coreConfig.allowHybridHighDpi)&&(n=this._mapOptions.enableHighDpi,typeof n!="boolean"&&(n=u._getDpr()>=1.5),n&&(r=this._coreConfig.allowHighDpi?t=2:2));this._tileDpiScale=t;this._labelDpiScale=i.tileRefactoringEnabled?1:r},h.prototype._beforeUnloadDummyHandler=function(){},h.DEFAULT_ZOOM_CUT_OFF_FOR_AERIAL_MODE=21,h._nextMapId=1,h._animationInterval=15,h._animationFrameWorkDispatcherKey="animationFrame",h._viewChangeMaxPercent=1.5,h}(kt),vt;(function(n){n[n.hidden=0]="hidden";n[n.visible=1]="visible"})(vt||(vt={})),function(n){n[n["default"]=0]="default";n[n.compact=1]="compact";n[n.minified=2]="minified"}(ft||(ft={})),function(n){n[n.vertical=0]="vertical";n[n.horizontal=1]="horizontal"}(ot||(ot={}));cr=function(){function n(){}return n.minimized=0,n.expanded=1,n.hidden=2,n}(),function(n){n[n.topLeft=0]="topLeft";n[n.TopLeft=0]="TopLeft";n[n.bottomLeft=1]="bottomLeft";n[n.BottomLeft=1]="BottomLeft";n[n.topRight=2]="topRight";n[n.TopRight=2]="TopRight";n[n.bottomRight=3]="bottomRight";n[n.BottomRight=3]="BottomRight";n[n.none=4]="none";n[n.None=4]="None"}(ai||(ai={}));var rf=function(){function n(n){this._multiplier=n}return n.prototype.hasValueAt=function(n){return this._multiplier.hasValueAt(n)},n.prototype.getHasValue=function(){return this._multiplier.getHasValue()},n.prototype.evaluate=function(n){return this._multiplier.evaluate(n)},n}(),uf=function(){function n(n,t,i,r){this._hue=n;this._saturation=t;this._luminance=i;this._alpha=r}return n.prototype.hasValueAt=function(n){return this.getHasValue()&&(this._hue.hasValueAt(n)||this._saturation.hasValueAt(n)||this._luminance.hasValueAt(n)||this._alpha.hasValueAt(n))},n.prototype.getHasValue=function(){return this._hue&&this._hue.getHasValue()||this._saturation&&this._saturation.getHasValue()||this._luminance&&this._luminance.getHasValue()||this._alpha&&this._alpha.getHasValue()},n.prototype.evaluate=function(n){return{x:this._hue?this._hue.evaluate(n)/360:0,y:this._saturation?this._saturation.evaluate(n):0,z:this._luminance?this._luminance.evaluate(n):0,w:this._alpha?this._alpha.evaluate(n):0}},n}(),t=function(){function t(){}return t.assertNotNull=function(n,i){t.assert(n===0||n||n===!1,i+" cannot be null")},t.assertNotNullOrEmpty=function(n,i){t.assertNotNull(n,i);t.assertIsString(n,i);t.assert(n.length>0,i+" cannot be an empty string")},t.assertInstanceOf=function(n,i,r){t.assertNotNull(i,"ctor");t.assert(n instanceof i,r+" must be an instance of "+t.getName(i))},t.assertIsString=function(n,i){t.assert(typeof n=="string",i+" must be a string")},t.assertIsFunction=function(n,i){t.assert(typeof n=="function",i+" must be a function")},t.assertIsInteger=function(n,i){t.assert(typeof n=="number"&&n%1==0,i+" must be an integer")},t.assert=function(){},t.logObject=function(n,i,r){var f,u,e;if(t.isDebugRun)try{console&&typeof console.log!="undefined"&&(u=i,u+=": %O",console.log.apply(console,[u,r]))}catch(o){}window.perfRun&&(f=t._getCurrentGroupinMainStack(),f&&(u=null,u=window.verbose?t._formatLogString(i):t._formatLogString(n),e=t._getLogKey(f),f[e+"__"+u]=r))},t.log=function(n){for(var r,i,e,o=[],f=2;f<arguments.length;f++)o[f-2]=arguments[f];if(t.isDebugRun)try{console&&typeof console.log!="undefined"&&(i=u._formatString.apply(null,Array.prototype.slice.call(arguments,1)),console.log.apply(console,[i]))}catch(s){}window.perfRun&&(r=t._getCurrentGroupinMainStack(),r&&(i=null,window.verbose?(i=u._formatString.apply(null,Array.prototype.slice.call(arguments,1)),i=t._formatLogString(i),e=t._getLogKey(r),r[e]=i):n&&(Array.prototype.splice.call(arguments,1,1),i=u._formatString.apply(null,arguments),i=t._formatLogString(i),e=t._getLogKey(r),r[e]=i)))},t.throwException=function(n){throw n;},t.trace=function(){if(t.isDebugRun)try{var n=window.console;n&&typeof n.trace!="undefined"&&n.trace.apply(n)}catch(i){}},t.profile=function(n){if(t.isDebugRun||window.perfRun)try{console&&typeof console.profile!="undefined"&&console.profile.apply(console,[n])}catch(i){}},t.profileEnd=function(){if(t.isDebugRun||window.perfRun)try{console&&typeof console.profileEnd!="undefined"&&console.profileEnd.apply(console)}catch(n){}},t.time=function(n){if(t.isDebugRun||window.perfRun)try{var i=window.console;(i&&typeof i.time=="undefined"||window.perfRun)&&(i.time=function(r){var u,f;n&&(u=t._getEpochTime(),i.timeHash||(i.timeHash={}),f="timeKey_"+r.toString(),i.timeHash[f]=u)});i.time.apply(i,[n])}catch(r){}},t.timeEnd=function(n){if(t.isDebugRun||window.perfRun)try{var i=window.console;(i&&typeof i.timeEnd=="undefined"||window.perfRun)&&(i.timeEnd=function(n){var o=t._getEpochTime(),u,r,f,e;i.timeHash&&(u="timeKey_"+n.toString(),r=i.timeHash[u],r&&(f=o-r,e=n+": "+f+"ms",t.logString(e)))});i.timeEnd.apply(i,[n])}catch(r){}},t.timeStamp=function(n){if(t.isDebugRun||window.perfRun)try{var i=window.console;i&&typeof i.timeStamp!="undefined"&&i.timeStamp.apply(i,[n])}catch(r){}},t.group=function(n){for(var s,f,i,h,e,c=[],o=2;o<arguments.length;o++)c[o-2]=arguments[o];if(t.isDebugRun)try{var r=window.console,l=t._getEpochTime().toString(),i=u._formatString.call(null,Array.prototype.slice.call(arguments,1));r&&typeof r.group!="undefined"?(r.group.apply(r,[i]),t.logString("Group start Timestamp: "+l)):r.log.apply(r,[i])}catch(a){}window.perfRun&&(s=t._getMainPerfStack(),f=t._getCurrentGroupinMainStack(),f&&(i=null,window.verbose?(i=u._formatString.apply(null,Array.prototype.slice.call(arguments,1)),i=t._formatLogString(i),h=t._getLogKey(f),i=h+"__"+i,e={},f[i]=e,s.push(e)):n?(Array.prototype.splice.call(arguments,1,1),i=u._formatString.apply(null,arguments),i=t._formatLogString(i),h=t._getLogKey(f),i=h+"__"+i,e={},f[i]=e,s.push(e)):s.push(null)))},t.groupEnd=function(){var n,r,i;if(t.isDebugRun)try{i=t._getEpochTime().toString();n=window.console;n&&typeof n.groupEnd!="undefined"&&(t.logString("Group End Timestamp: "+i),n.groupEnd.apply(n))}catch(u){}window.perfRun&&(r=t._getMainPerfStack(),r&&t._getLastElement(r)&&window.verbose&&(i=t._getEpochTime().toString(),t.logString("Group End Timestamp: "+i)),r.pop())},t.groupCollapsed=function(n){for(var c,e,s,r,i,h,f,l=[],o=2;o<arguments.length;o++)l[o-2]=arguments[o];if(t.isDebugRun)try{c=t._getEpochTime().toString();e=window.console;e&&typeof e.groupCollapsed!="undefined"&&(i=u._formatString.apply(null,Array.prototype.slice.call(arguments,1)),e.groupCollapsed.apply(e,[i]),t.logString("Group start Timestamp: "+c))}catch(a){}window.perfRun&&(s=t._getMainPerfStack(),r=t._getCurrentGroupinMainStack(),r&&(i=null,window.verbose?(i=u._formatString.apply(null,Array.prototype.slice.call(arguments,1)),i=t._formatLogString(i),h=t._getLogKey(r),i=h+"__"+i,f={},r[i]=f,s.push(f)):n?(Array.prototype.splice.call(arguments,1,1),i=u._formatString.apply(null,arguments),i=t._formatLogString(i),h=t._getLogKey(r),i=h+"__"+i,f={},r[i]=f,s.push(f)):s.push(null)))},t.setPerfRun=function(n,i){window.perfRun=n;window.verbose=i;t.setupPerfObject()},t.setDebugRun=function(n){t.isDebugRun=n},t.getName=function(n){var t=/function (.{1,})\(/.exec(n.toString());return t&&t.length>1?t[1]:"Unknown"},t.setTestHook=function(n,t){this._logElement=u._createElement("div").set_attr("id","testHook").appendTo(n);this._debugElement=u._createElement("div").set_attr("id","debugHook").appendTo(n);this._perfTestHookElement=u._createElement("div").set_attr("id","perfTestHook").appendTo(n);this.enableFunctionalTestHooks=!0;FunctionalTestHooks.setTestHookSettings(e,t,u._getUrlParam,ar.fromString)},t.setMap=function(n){this.enableFunctionalTestHooks&&(window.$map?n.getMapOptions().navigationOptions&&n.getMapOptions().navigationOptions.lockCameraAltitude&&(window.$overviewMap=n):(t._map=window.$map=n,window.$map.frameManagerLoaded.addOne(function(){var n=window.$map.getFrameManager();n.primitivesRendered.addOne(function(){window.$mapLoaded=!0})})))},t.setLabelLogElement=function(n){this._labelLogElement=n},t.logPoiLayerStyleStart=function(){this.enableFunctionalTestHooks&&(this._poiLayerStyle=t._poiLayerStyleStart)},t.logPoiLayerStyleEnd=function(n){if(this.enableFunctionalTestHooks&&n){var i=this._poiLayerStyle;i!==t._poiLayerStyleStart&&(i+="}",this.logTestData(n,i));this._poiLayerStyle=""}},t.logVectorImageTemplate=function(n,t){function r(n){var t=n&&n.vectorType,i="";if(typeof t=="number"){var r=n.style||{},u=r.fillStyle||"nofill",f=r.strokeStyle||"nostroke";i="VR{Type: "+t+", FillStyle: "+u+", StrokeStyle: "+f+"}"}return i}var i,u;this.enableFunctionalTestHooks&&this._poiLayerStyle&&(i=[],n&&(i=i.concat(n.map(r))),t&&(i=i.concat(t.map(r))),u="VT{"+i.join("")+"}",this._poiLayerStyle+=u)},t.logLabelData=function(n){var u,r,f,i;if(n&&(this.enableFunctionalTestHooks||this._labelLogElement))for(u=Object.keys(n),r=0,f=u.length;r<f;r++)if(i=n[u[r]],i&&i.region&&i.region.anchor&&i.region.bounds&&i.region.bounds.bbox&&i.region.bounds.bbox.minPoint&&i.region.bounds.bbox.maxPoint){var e=i.region.bounds.bbox.minPoint,o=i.region.bounds.bbox.maxPoint,s=i.region.anchor,h=i.style.styleStatic.showBackground,c="Label::text:"+i.text+(i.secondaryText?" secondaryText:"+i.secondaryText:"")+" type:"+i.type+" minPoint:("+e.x+","+e.y+") maxPoint:("+o.x+","+o.y+") anchorPoint:("+s.x+","+s.y+") showBackground:"+(h?1:0);this.enableFunctionalTestHooks&&this.logTestData(t.UserLogTag,c);this._labelLogElement&&this.logLabelText(i.text)}},t.logResourceLoadOrder=function(n,i){if(this.enableFunctionalTestHooks){n||(n=t.LoadOrderTag);var r;r=i;this.logPerfTestData(n,r)}},t.logPerfInstrumentation=function(n,i){if(this.enableFunctionalTestHooks){n||(n=t.PerfLogTag);var r="PerfLog::";r+=i;this.logPerfTestData(n,r)}},t.logPushpinPrimitive=function(n,i){var u,e,l,r,s;if(this.enableFunctionalTestHooks&&n&&i){var a=i.entity?v.getValue(i.entity,"name"):null,y=i.entity?v.getValue(i.entity,"title")||"":"",h=i.entity?i.entity.id:null,p=v.getValue(i,"taskDisplayState"),f=-1;if(p&&(f=v.getValue(i,"viewState"),f||(f=0)),u=i.geometry,u&&i.geometryType===1){if(e=new o(i.crs.toLatitude(u.x,u.y),i.crs.toLongitude(u.x,u.y)),!t._map||!t._map.getMode||!t._map.getMode()||!t._map.getMode().tryLocationToPoint)return;l=t._map.getMode();l.mapModeType!==2?(r=l.tryLocationToPoint(e),r.x=Math.ceil(r.x),r.y=Math.ceil(r.y)):r=new c(0,0);s=a&&h&&h.indexOf("rs")===0?"RoadShield::name:"+a:"Pushpin::title:"+y+" id:"+h;i.entity&&v.getValue(i.entity,"tj")&&(s+=" [TRANSIT]");s+=" viewState:"+f+" location:("+e.latitude+","+e.longitude+")"+(r?" Point:("+r.x+","+r.y+")":"");this.logTestData(n,s)}}},t.logLayersChanged=function(n){var i;this.enableFunctionalTestHooks&&n&&(n.added&&(i=n.added[0],this.logTestData(t.TileLogTag,"UserLayer::"+i.getId()+"::added")),n.removed&&(i=n.removed[0],this.logTestData(t.TileLogTag,"UserLayer::"+i.getId()+"::removed")))},t.logTileRendering=function(n,i,r,u){var c;if(this.enableFunctionalTestHooks&&n){var o=n.tileId.quadKey,s="["+o+":p"+n.renderedPrimitivesCount+"_gc"+r+"_tc"+u+"_v"+i+"]",h="data-"+t.TileRenderLogTag,f=this._logElement.get_attr(h),e=f.indexOf("["+o+":");e>-1&&(c=f.indexOf("]",e),f=f.substring(0,e-1)+f.substring(c+(e===0?2:1)));f=f?f+","+s:s;this._logElement.set_attr(h,f)}},t.logShapePrimitive=function(n){var r,i,e,o,f,u;if(this.enableFunctionalTestHooks&&n){if(r="",n.geometryType==2&&n._options)i=n.geometry,r="Directions::Geometry::Line length: "+i.y.length+" locations:[("+i.y[0]+","+i.x[0]+") ("+i.y[i.y.length-1]+","+i.x[i.x.length-1]+")]";else if(n.geometryType==2)i=n.geometry,e=n.entity?v.getValue(n.entity,"title"):"",r="Polyline::title:"+e+"Line length: "+i.y.length+" locations:[("+i.y[0]+","+i.x[0]+")]";else if(n.geometryType==3)for(o=n.geometry,f=o.rings,r="Geometry::Area::Rings Count: "+f.length,u=0;u<f.length;u++)r+=" [Ring #:"+(u+1).toString()+", X vertex length:"+f[u].x.length+",Y vertex length:"+f[u].y.length+"]";this.logTestData(t.TileLogTag,r)}},t.logNetworkData=function(n,i){t.enableFunctionalTestHooks&&n&&t.logTestData(t.NetworkLogTag,n+":"+i)},t.clearTestHooksLog=function(n){this.enableFunctionalTestHooks&&this._logElement.set_attr("data-"+n,"");this._labelLogElement&&n===t.UserLogTag&&this._labelLogElement.set_attr("data-label","")},t.getFunctionalTestHooksEnabled=function(){return this.enableFunctionalTestHooks},t.addDataTag=function(n,t){n.set_attr("data-tag",t)},t.addStreetsideArrowTesthook=function(n,t,i,r){if(this.enableFunctionalTestHooks&&n&&t&&i){var f=u._createElement("a");f.set_attr("href","#");f.set_attr("class",t);f.set_attr("data-tag",t);n.append(f);i&&f.set_text(i);r&&f.add_event("click",r);f.set_style({pointerEvents:"auto",position:"relative",opacity:0})}},t.removeStreetsideArrowTesthooks=function(t){if(this.enableFunctionalTestHooks)for(var i=0;i<t.length;i++)n("."+t[i].replace(".","\\.")).removeFromParent()},t.logDebugData=function(n){this.enableFunctionalTestHooks&&this.logDataToTestElement(this._debugElement,"tag",n)},t.logLabelDrawOrder=function(n){t.enableFunctionalTestHooks&&n&&t.logTestData(t.LabelDrawOrderTag,n)},t.logTestData=function(n,t){this.logDataToTestElement(this._logElement,n,t)},t.logLabelText=function(n){this.logDataToTestElement(this._labelLogElement,"label",n)},t.logPerfTestData=function(n,t){this.logDataToTestElement(this._perfTestHookElement,n,t)},t.logDataToTestElement=function(n,t,i){var u="data-"+t,r=n.get_attr(u);r.indexOf(i)==-1&&(r=r?r+","+i:i);n.set_attr(u,r)},t.logString=function(n){var i,r;if(t.isDebugRun)try{console&&typeof console.log!="undefined"&&console.log.apply(console,[n])}catch(u){}window.perfRun&&(i=t._getCurrentGroupinMainStack(),i&&(n=t._formatLogString(n),r=t._getLogKey(i),i[r]=n))},t.setupPerfObject=function(){window.perf={};var n=[];n.push(window.perf);window.mainPerfStack=n},t._getEpochTime=function(){return(new Date).getTime()},t._getPropertyCount=function(n){var t=0,i;if(n)for(i in n)n.hasOwnProperty(i)&&++t;return t},t._formatLogString=function(n){if(n)return n=n.replaceAll(" ","_"),n=n.replaceAll(":","$"),n=n.replaceAll(",","_"),n.replaceAll(".","#")},t._getLogKey=function(n){var i=t._getEpochTime().toString(),r=t._getPropertyCount(n);return"__"+i+"__"+(r+1).toString()},t._getCurrentGroupinMainStack=function(){var n=t._getMainPerfStack();return t._getLastElement(n)},t._getMainPerfStack=function(){return window.mainPerfStack},t._getLastElement=function(n){if(n){var t=n.length;if(t>0)return n[t-1]}return null},t.TileLogTag="tile",t.TileRenderLogTag="tileRender",t.UserLogTag="user",t.NetworkLogTag="network",t.LoadOrderTag="loadOrder",t.LabelDrawOrderTag="LabelDrawOrder",t.PerfLogTag="perfLogs",t._poiLayerStyleStart="PLS{",t}(),ui=function(){function n(n){t.assert(n>0,"The capacity must be a positive integer.");this._capacity=n;this._count=0;this._dictionary={}}return n.prototype.addItem=function(n,i){if(t.assertNotNull(n,"key"),i){var r=this._dictionary[n];r?v.areEqual(r.item,i)||(this._dictionary[n].item=i,this._moveNodeToHead(r)):this._addNewItem(n,i)}},n.prototype.getItem=function(n){t.assertNotNull(n,"key");var i,r=this._dictionary[n];return r?(i=r.item,this._moveNodeToHead(r)):i=null,i},n.prototype.clear=function(){this._headNode=null;this._tailNode=null;this._dictionary={};this._count=0},n.prototype.getCount=function(){return this._count},n.prototype.getInternalDictionary=function(){return this._dictionary},n.prototype.setCapacity=function(n){var i,t;if(n>0){if(this._capacity>n&&this._count>n)for(i=this._count-n,t=0;t<i;t++)this._deleteTailNode();this._capacity=n}},n.prototype._addNewItem=function(n,i){t.assertNotNull(n,"key");t.assertNotNull(i,"item");t.assert(!this._dictionary[n],"An item using the specified key already exists in this cache.");t.assert(this._count<=this._capacity,"The count should never exceed the capacity.");this._count===this._capacity&&this._deleteTailNode();var r={key:n,item:i};this._count===0?this._headNode=this._tailNode=r:(r.next=this._headNode,this._headNode.previous=r,this._headNode=r);this._dictionary[n]=r;this._count++},n.prototype._removeNode=function(n){if(t.assertNotNull(n,"node"),this._count===1){t.assert(n===this._headNode,"The only node must be the head node.");t.assert(n===this._tailNode,"The only node must be the tail node.");this._headNode=null;this._tailNode=null;return}var i=n.previous,r=n.next;i?i.next=r:(t.assert(n===this._headNode,"Only the head node can have null previous."),this._headNode=r);r?r.previous=i:(t.assert(n===this._tailNode,"Only the tail node can have null next."),this._tailNode=i)},n.prototype._moveNodeToHead=function(n){(t.assertNotNull(n,"node"),n!==this._headNode)&&(this._removeNode(n),this._headNode&&(this._headNode.previous=n),n.previous=null,n.next=this._headNode,this._headNode=n)},n.prototype._deleteTailNode=function(){var n,t;this._tailNode&&(n=this._tailNode,this._removeNode(n),delete this._dictionary[n.key],this._count--,t=n.item,t.dispose&&t.dispose())},n}(),ff=function(n){function t(t,i,r){r===void 0&&(r=1);var u=n.call(this,t,i)||this;return u.units=r,u}return k(t,n),t}(c),ef=function(){function i(){this._dispatchedQuery=[];this._runningQuery=[];this.tickRaised=new r}return i.prototype.dispatch=function(n,r,u){if(!this._disposed){t.assertIsFunction(n,"f");n[i._orderAttributeKey]=u||0;n[i._dispatchKey]=r||"";for(var f=this._dispatchedQuery.length;f--;)if(this._dispatchedQuery[f]===n)return;this._dispatchedQuery.push(n);this._ensureTimer()}},i.prototype.cancelDispatch=function(n){for(var t=this._dispatchedQuery.length;t--;)this._dispatchedQuery[t]===n&&this._dispatchedQuery.splice(t,1);for(t=this._runningQuery.length;t--;)this._runningQuery[t]===n&&this._runningQuery.splice(t,1)},i.prototype.cancelDispatchWithKey=function(n){t.assertNotNullOrEmpty(n,"Key cannot be empty or null");for(var r=this._dispatchedQuery.length;r--;)this._dispatchedQuery[r]&&this._dispatchedQuery[r][i._dispatchKey]===n&&this._dispatchedQuery.splice(r,1);for(r=this._runningQuery.length;r--;)this._runningQuery[r]&&this._runningQuery[r][i._dispatchKey]===n&&this._runningQuery.splice(r,1)},i.prototype.dispose=function(){this.tickRaised.dispose();this._runningQuery=[];this._dispatchedQuery=[];this._disposed=!0},i.prototype._tick=function(){var r,u,n;if(!this._disposed)for(this.tickRaised.invoke(),r=(new Date).getTime(),this._tickTimeoutId=null,this._dispatchedQuery.length&&this._ensureTimer(),u=this._dispatchedQuery,this._dispatchedQuery=this._runningQuery,this._runningQuery=u,this._runningQuery.sort(this._sortByOrder),n=!1;this._runningQuery.length;)n?this._dispatchedQuery.push(this._runningQuery.shift()):(t.groupCollapsed(null,"Dispatcher Tick"),this._runningQuery.shift()(),t.groupEnd(),(new Date).getTime()-r>i.MaxDispatchTime&&(n=!0))},i.prototype._sortByOrder=function(n,t){return n[i._orderAttributeKey]-t[i._orderAttributeKey]},i.prototype._ensureTimer=function(){var n=this;this._tickTimeoutId||(this._tickTimeoutId=i._requestAnimFrame(function(){try{n._tick()}catch(t){if(e.logger)e.logger.logCriticalError(t);else throw t;}}))},i.MaxDispatchTime=50,i._orderAttributeKey="$mm$dispatchOrder",i._dispatchKey="$mm$dispatchkey",i._requestAnimFrame=n.Effects.Animation.requestAnimationFrame,i}(),of=function(n){function t(i,r,u){u===void 0&&(u=t._defaultCapacity);var f=n.call(this,i,r)||this;return f._capacity=u,f}return k(t,n),t.prototype.release=function(t){if(this._objectPool.length===this._capacity){var i=t;i.dispose&&i.dispose()}else n.prototype.release.call(this,t)},t._defaultCapacity=256,t}(sr),sf=function(){function n(){this._dispatchedQueryWithPriority={}}return n.prototype.dispatch=function(n,i,r){var u,f;if(r===void 0&&(r=5),!this._disposed){for(t.assertIsFunction(n,"f"),u=this._dispatchedQueryWithPriority[r],u||(u=[],this._dispatchedQueryWithPriority[r]=u),f=u.length;f--;)if(u[f].action===n)return;u.push({action:n,dispatchGroupKey:i});this._ensureTimer()}},n.prototype.cancelDispatch=function(n,i){t.assertNotNull(n,"f:action cannot be empty");this._cancel(n,null,i)},n.prototype.cancelAllDispatch=function(){this._dispatchedQueryWithPriority={}},n.prototype.cancelDispatchWithKey=function(n,i){t.assertNotNullOrEmpty(n,"Key cannot be empty or null");this._cancel(null,n,i)},n.prototype.dispose=function(){this._disposed=!0;this._dispatchedQueryWithPriority={}},n.prototype._cancel=function(n,t,i){var r,u;if(typeof i!="undefined"&&i>=0)r=this._dispatchedQueryWithPriority[i],this._cancelActionInWorkCollection(r,n,t);else for(u=0;u<=5;u++)r=this._dispatchedQueryWithPriority[u],this._cancelActionInWorkCollection(r,n,t)},n.prototype._cancelActionInWorkCollection=function(n,t,i){for(var r=n&&n.length||0;r--;)n[r]&&(i?n[r].dispatchGroupKey===i&&n.splice(r,1):t&&n[r].action===t&&n.splice(r,1))},n.prototype._tick=function(){var i,f;this._tickTimeoutId=null;var r=0,e=u._getCurrentTimeStamp(),t=null;for(i=0;i<=5;i++){for(t=this._dispatchedQueryWithPriority[i];r<n._throttleElapseTime&&t&&t.length>0;)f=t.shift(),f.action(),r=u._getCurrentTimeStamp()-e;if(t&&t.length>0){this._ensureTimer();break}}},n.prototype._ensureTimer=function(){var n=this;this._tickTimeoutId||(this._tickTimeoutId=Microsoft.Maps.setTimeout(function(){n._tick()},0))},n._throttleElapseTime=5,n}(),hf=function(){function n(n,t,i,r,u){var f=this;this._workDispatcher=n;this._index=0;this._items=t;this._iterationCallback=i;this._completionCallback=r;this._priority=u;this._action=function(){f._iterate()}}return n.prototype._next=function(){return this._items[this._index++]},n.prototype.hasNext=function(){return this._index<this._items.length},n.prototype.isRunning=function(){return this._isRunning},n.prototype.run=function(){this._isRunning||(this._isRunning=!0,this._totalRunningTime=0,this._iterate())},n.prototype.stop=function(){this._workDispatcher&&this._workDispatcher.cancelDispatch(this._action,this._priority);this._isRunning=!1},n.prototype.reset=function(){this.stop();this._index=0},n.prototype._iterate=function(){for(var t=u._getCurrentTimeStamp(),i;this._isRunning&&this.hasNext()&&u._getCurrentTimeStamp()-t<n._yieldThreshold;)i=this._next(),this._iterationCallback(i,this._index-1);this._totalRunningTime+=u._getCurrentTimeStamp()-t;this.hasNext()?this._isRunning&&this._workDispatcher&&this._workDispatcher.dispatch(this._action,null,this._priority):(this._completionCallback&&this._completionCallback(this._index,this._totalRunningTime),this._isRunning=!1)},n._yieldThreshold=30,n}(),cf=function(){function n(){this.id=(n._idCounter++).toString()}return n._idCounter=0,n}(),lf=function(){function n(){this.clear()}return n.prototype.clear=function(){this._dictionary={};this._order=[]},n.prototype.getCount=function(){return this._order.length},n.prototype.addItem=function(n,t){this._dictionary[n]||this._order.push(n);this._dictionary[n]=t},n.prototype.getAt=function(n){var t;return n>=0&&n<this.getCount()&&(t=this.getItem(this._order[n])),t},n.prototype.getItem=function(n){return this._dictionary[n]},n.prototype.removeItem=function(n){this._dictionary[n]&&(delete this._dictionary[n],this._order.splice(this._order.indexOf(n),1))},n}(),lr=function(){function t(){this.image=document.createElement("img")}return t.getPooledImage=function(n,i){t._imagePool||(t._imagePool=new of(t));var r=t._imagePool.acquire();return r.image||(r.image=document.createElement("img")),n?r.image.crossOrigin=i?"use-credentials":"anonymous":delete r.image.crossOrigin,r},t.prototype.release=function(){var i=this;this.image&&(this.image.src="");n.Browser.is_ie?Microsoft.Maps.setTimeout(function(){t._imagePool.release(i)},1e3):t._imagePool.release(this)},t}(),vi=function(){function n(){}return n.init=function(t,i){n[t]||(n[t]=new n);var u=n[t];for(var r in i)i.hasOwnProperty(r)&&(u[r]=i[r])},n}();vi.init("MapCore",e.ResourcesObject);e.ResourcesObject=null;var y=vi.MapCore,fi=wt.LocalStorageCache,af=function(n){function t(t,i,r){var u=n.call(this,i,r)||this,f;for(u._capacity=t,f=0;f<t;f++)n.prototype._create.call(u);return u}return k(t,n),t.prototype.acquire=function(){if(this._objectPool.length===0)throw"Pooled objects have been allocated already";return n.prototype.acquire.call(this)},t.prototype.release=function(t){if(this._objectPool.length===this._capacity)throw"Object pool is already full";n.prototype.release.call(this,t)},t}(sr),ar=function(){function n(){}return n.prototype.toString=function(n){var t="",r,i;if(this.protocol&&(t+=this.protocol+":",(this.protocol==="http"||this.protocol==="https"||this.protocol==="ftp")&&(t+="//")),this.host&&(t+=this.host),this.port&&(t+=":"+this.port),this.path&&(t+="/"+this.path),this.queryStringParameters){r=!0;for(i in this.queryStringParameters)this.queryStringParameters.hasOwnProperty(i)&&(r?(t+="?",r=!1):t+="&"),t+=n?i+"="+this.queryStringParameters[i]:encodeURIComponent(i)+"="+encodeURIComponent(this.queryStringParameters[i])}return this.fragment&&(t+="#"+encodeURI(this.fragment)),t},n.prototype.toStringPreservingCurlyBracketsVariables=function(){return this.toString().replace(/%7B/gi,"{").replace(/%7D/gi,"}")},n.fromString=function(t){var s,f,e,h,c,o;if(!t)throw"Input should be a well-formed url";var u=new n,r=t,i=r.split("#");if(i.length>2)throw"More than one fragment is found in the input";if(i.length===2&&(r=i[0],u.fragment=decodeURIComponent(i[1])),i=r.split("?"),i.length>2)throw"More than one query param identifier ('?') is found in the input";if(i.length===2)for(r=i[0],u.queryStringParameters={},s=i[1],i=s.split("&"),f=0;f<i.length;f++)e=i[f].split("="),e.length>1&&(h=decodeURIComponent(e[0]),c=decodeURIComponent(e[1]),u.queryStringParameters[h]=c);if(i=r.split("://"),i.length>2)throw"More than one protocol identifier ('://') is found in the input";if(i.length===2&&(r=i[1],u.protocol=i[0]),i=r.split("/"),i.length>1&&(r=i[0],u.path=i.slice(1).join("/")),r.indexOf("@")>=0)throw"Unsupported url";if(i=r.split(":"),i.length>2)throw"More than one port identifier (':') is found in the input";if(u.host=i[0],i.length===2){if(o=parseInt(i[1]),isNaN(o))throw"port number should be an integer";u.port=o}return u},n}();function yt(){}yi=function(){function n(n){var t=this;this._state=0;this._continuations=[];try{n(function(n){t._resolve(n)},function(n){t._reject(n)})}catch(i){this._reject(i)}}return n.prototype.then=function(t,i){typeof t!="function"&&(t=null);typeof i!="function"&&(i=null);var r=new n(yt);return this._addContinuation({child:r,fulfill:t,reject:i}),r},n.resolve=function(t){if(t instanceof n)return t;var i=new n(yt);return i._resolve(t),i},n.reject=function(t){var i=new n(yt);return i._reject(t),i},n.all=function(t){var u=t.length,r=[],i=new n(yt);return t.length?t.forEach(function(t,f){n.resolve(t).then(function(n){r[f]=n;--u==0&&i._fulfill(r)},function(t){n._isSettled(i._state)||i._reject(t)})}):i._fulfill(r),i},n.race=function(t){var r=t.length,i=new n(yt);return t.length?t.forEach(function(t){n.resolve(t).then(function(t){n._isSettled(i._state)||i._fulfill(t)},function(t){n._isSettled(i._state)||i._reject(t)})}):i._fulfill(null),i},n._dispatchQueue=function(){var i=n._asyncQueue,t,r;for(n._asyncQueue=[],n._asyncTimerId=0,t=0,r=i.length;t<r;t++)i[t]()},n._queueAction=function(t){n._asyncQueue.push(t);n._asyncTimerId||(n._asyncTimerId=Microsoft.Maps.setTimeout(n._dispatchQueue,0))},n._isSettled=function(n){return n!==0},n.prototype._fulfill=function(t){n._isSettled(this._state)||(this._value=t,this._state=1,this._execContinuations())},n.prototype._reject=function(t){n._isSettled(this._state)||(this._value=t,this._state=2,this._execContinuations())},n.prototype._addContinuation=function(t){var i=this;this._continuations?this._continuations.push(t):n._queueAction(function(){return i._execContinuation(t)})},n.prototype._execContinuations=function(){var t=this;n._isSettled(this._state)&&n._queueAction(function(){var i=t._continuations,n,r;for(t._continuations=null,n=0,r=i.length;n<r;n++)t._execContinuation(i[n])})},n.prototype._isObjectOrFunction=function(n){return n&&(typeof n=="function"||typeof n=="object")},n.prototype._isObject=function(n){return n&&typeof n=="object"},n.prototype._isFunction=function(n){return typeof n=="function"},n.prototype._resolve=function(n){var r=this,t,i;if(n===this)this._reject(new TypeError);else if(this._isObjectOrFunction(n))if(t=n,t.constructor===this.constructor)t.then(function(n){return r._resolve(n)},function(n){return r._reject(n)});else{try{i=t.then}catch(u){this._reject(u)}this._isFunction(i)?this._resolveThenable(t,i):this._fulfill(n)}else this._fulfill(n)},n.prototype._resolveThenable=function(n,t){var u=this,i,r;try{t.call(n,function(n){i||r||(i=!0,u._resolve(n))},function(n){i||r||(r=!0,u._reject(n))})}catch(f){i||r||this._reject(f)}},n.prototype._resolveOrReject=function(n,t){try{this._resolve(n(t))}catch(i){this._reject(i)}},n.prototype._execContinuation=function(t){var i,r,u,f;if(n._isSettled(this._state)){i=t.child;r=this._value;switch(this._state){case 1:u=t.fulfill;u?i._resolveOrReject(u,r):i._fulfill(r);break;case 2:f=t.reject;f?i._resolveOrReject(f,r):i._reject(r)}}},n._asyncQueue=[],n}(),function(){var n=yi.prototype;n["catch"]=function(n){return this.then(null,n)}}(),function(){var i=typeof global!="undefined"?global:self,r=i.Promise,u=["resolve","reject","all","race"],t=!!r,n,f;if(t)for(n=0,f=u.length;n<f;n++)if(!(u[n]in r)){t=!1;break}t||(i.Promise=yi)}();pt=function(){function n(){var n=this;this._promise=new Promise(function(t,i){n.resolve=t;n.reject=i})}return n.prototype.then=function(n,t){return this._promise.then(n,t)},n}(),function(){function l(n,t,r){for(var f,b,l={},v={},y=[],k={},o=0,h=0,d=t.length;h<d;h++){var u=t[h],c=u.property,p=u.from,e=u.duration,w=u.delay||0;e===undefined&&(e=s);p&&(l[c]=p);v[c]=u.to;a(y,k,c,e,w,u.ease);o=Math.max(o,e+w)}f={};f[i]=y.join(",");n.set_style(l);n.get_native_prop("offsetHeight");b=function(){f[i]="";n.set_style(f);r&&r()};n.set_style(f).set_style(v);Microsoft.Maps.setTimeout(b,o)}function a(n,i,e,s,c,l){if(!i[e]){typeof l=="undefined"&&(l=h);l in u&&(l=u[l]);e=o(r(e,t));var a=e+" "+f(s,"ms")+" "+l;c>0&&(a=a+" "+f(c,"ms"));i[e]=!0;n.push(a)}}function f(n,t){return(typeof n!="string"||n.match(/^[\-\.0-9]+$/))&&(n=""+n+t),n}function v(t,i){n(t).set_style(i)}function y(t,i,r){for(var h,c,w,b,l=[],e=0,o=0,k=i.length;o<k;o++){var u=i[o],a=u.delay||0,y=u.duration||0,s=u.property,f=u.from,p=u.to;(f===undefined&&(f=t.get_style(s)),typeof f=="number"&&typeof p=="number")&&(h={},h[s]=f,c={},c[s]=p,w=new n.Effects.Animation({elements:t,duration:y,startTime:a,from:h,to:c,animate:v,easing:null}),l.push(w),e=Math.max(e,a+y))}b=new n.Effects.Storyboard({duration:e,completed:r,animations:l});b.begin()}var e=n.Transition=n.Transition||{},r=n.Style.get_camelized_style_name,o=n.Style.get_dasherized_style_name,s=500,u={"default":"ease",line:"linear","in":"ease-in",out:"ease-out","in-out":"ease-in-out","in-sine":"cubic-bezier(0.47,0,0.745,0.715)","out-sine":"cubic-bezier(0.39,0.575,0.565,1)","in-out-sine":"cubic-bezier(0.445,0.05,0.55,0.95)","in-quad":"cubic-bezier(0.55,0.085,0.68,0.53)","out-quad":"cubic-bezier(0.25,0.46,0.45,0.94)","in-out-quad":"cubic-bezier(0.455,0.03,0.515,0.955)","in-cubic":"cubic-bezier(0.55,0.055,0.675,0.19)","out-cubic":"cubic-bezier(0.215,0.61,0.355,1)","in-out-cubic":"cubic-bezier(0.645,0.045,0.355,1)","in-quart":"cubic-bezier(0.895,0.03,0.685,0.22)","out-quart":"cubic-bezier(0.165,0.84,0.44,1)","in-out-quart":"cubic-bezier(0.77,0,0.175,1)","in-back":"cubic-bezier(0.6,-0.28,0.735,0.045)","out-back":"cubic-bezier(0.175,0.885,0.32,1.275)","in-out-back":"cubic-bezier(0.68,-0.55,0.265,1.55)"},h="ease",t=document.createElement("div"),i=r("transition",t),c=t.style[i]!==undefined;e.run=function(n,t,i){if(!n||!n.length||!t||!t.length){i&&i();return}c?l(n,t,i):y(n,t,i)}}(),function(){var t=n.Internals;t.parseJSON=function(n){var t=JSON&&JSON.parse||(n="("+n+")")&&eval;return t(n)}}();var vf=function(){function n(n){this._value=n}return n.prototype.then=function(t){typeof t!="function"&&(t=null);var i=this._value;if(t)try{i=t(i)}catch(r){}return new n(i)},n}(),ei=function(){function n(){}return n.prototype.accumulate=function(n,i){var u,r;for(t.assertNotNull(n,"bounds"),t.assert(n.length===4,"The 'bounds' parameter must always be of length 4."),t.assertNotNull(i,"crs"),u=this._getCorners(i,n),r=0;r<u.length;r++)this._accumulateLocation(u[r].latitude,u[r].longitude)},n.prototype.accumulateLocations=function(n){for(var t=0;t<n.length;t++)this._accumulateLocation(n[t].latitude,n[t].longitude);return this.getBounds()},n.prototype.accumulateLocationRect=function(n){for(var t,i=0;i<n.length;i++)t=n[i],this._accumulateLocation(t.getNorth(),t.getWest()),this._accumulateLocation(t.getSouth(),t.getEast());return this.getBounds()},n.prototype.accumulateLatLon=function(n,t){for(var i=0;i<n.length;i++)this._accumulateLocation(n[i],t[i]);return this.getBounds()},n.prototype.getBounds=function(){var n=this._bounds;return n?w.fromEdges(n[0],n[1],n[2],n[3],null,null,!0):null},n.prototype._getCorners=function(n,t){if(t[0]===t[2]&&t[1]===t[3])return[new o(n.toLatitude(t[1],t[0]),n.toLongitude(t[1],t[0]))];var i=[];return i[0]=new o(n.toLatitude(t[3],t[0]),n.toLongitude(t[3],t[0])),i[1]=new o(n.toLatitude(t[1],t[0]),n.toLongitude(t[1],t[0])),i[2]=new o(n.toLatitude(t[3],t[2]),n.toLongitude(t[3],t[2])),i[3]=new o(n.toLatitude(t[1],t[2]),n.toLongitude(t[1],t[2])),i},n.prototype._accumulateLocation=function(n,t){this._bounds?(this._bounds[0]=Math.max(this._bounds[0],n),this._bounds[1]=Math.min(this._bounds[1],t),this._bounds[2]=Math.min(this._bounds[2],n),this._bounds[3]=Math.max(this._bounds[3],t)):this._bounds=[n,t,n,t]},n}(),yf=function(){function n(n){n=n||{};this._customMapStylesEnabled=n.customMapStylesEnabled;this._customClientStylesEnabled=this._customMapStylesEnabled&&n.customClientStylesEnabled;this.customMapStyleVersion=0;this.update(null)}return n._camelCase=function(n){return typeof n!="string"?n:n.charAt(0).toLowerCase()+n.substring(1)},n.initialize=function(t,i){var r,u;if(!n._elementHierarchy)for(n._elementHierarchy={},r=0,u=t.length;r<u;r++){var f=t[r]||{},e=i[f.nameId],o=t[f.parentId]||{},s=i[o.nameId];e&&(n._elementHierarchy[n._camelCase(e)]=n._camelCase(s))}},n.prototype.update=function(n){n&&this._customMapStylesEnabled?this._initiate(n):(this._customSettings=null,this._elementStyles=null,this._hasClientRenderedStyles=!1,this.useLiteMode=!1,this.styleString="",this.customMapStyleVersion++,this.buildingVisible=!0)},n.prototype.settingHasValue=function(n,t){return this._customSettings&&this._customSettings[n]===t},n.prototype.getElementStyle=function(t,i){var r,f,u;if(this._customClientStylesEnabled&&this._hasClientRenderedStyles&&t&&i)for(t=n._camelCase(t),i=n._camelCase(i);t;){if(f=n._elementMapping[t],u=this._elementStyles[f],r=u&&u[i],r!==undefined)break;t=n._elementHierarchy[t]}return typeof r=="object"?r&&r.value:r},n.prototype._initiate=function(n){n=n||{};n.elements=n.elements||{};n.settings=n.settings||{};this._customSettings=n.settings;this._elementStyles={};this._hasClientRenderedStyles=!1;this.buildingVisible=!0;this._parseCustomMapStyle(n);this.useLiteMode=this._hasClientRenderedStyles&&!this._customClientStylesEnabled;this.customMapStyleVersion++},n.prototype._parseCustomMapStyle=function(t){var u,f,i,r;for(this.styleString="",u=t.elements,f=Object.keys(u),r=0;r<f.length;r++){var s=f[r],e=n._elementMapping[s],o=u[s];e&&o&&(this._elementStyles[e]=o,i=this._parseProperties(e,o),i&&(this.styleString+=i+"_"))}i=this._parseProperties("g",t.settings);i&&(this.styleString+=i);this.styleString.charAt(this.styleString.length-1)==="_"&&(this.styleString=this.styleString.substring(0,this.styleString.length-1))},n.prototype._parseProperties=function(t,i){var o,s,h,e,l,u,a,c;if(!i||!t)return"";var r,f="",v=!1,y=Object.keys(i);for(o=0;o<y.length;o++)if(s=y[o],h=n._propertyMapping[s],r=i[s],h&&typeof r!="undefined"&&r!==null){e=void 0;l=n._clientRenderedProperties[h];this._hasClientRenderedStyles=this._hasClientRenderedStyles||!!l;u=void 0;a=!1;typeof r=="object"?(u=r.value,a=r.ignoreTransform):u=r;switch(typeof u){case"boolean":e=u?"1":"0";break;case"string":c=bt.parse(u,2);c&&(e=this._convertColorToHex(c).slice(1),l&&(i[s]=c.toRgba()))}e&&(f+=v?";":t+"|",f+=h+":"+e,a&&(f+=",it:1"),v=!0)}return t==="bld"&&f.indexOf("v:0")>=0&&(this.buildingVisible=!1),f},n.prototype._convertColorToHex=function(n){var t="";return n.alpha<1&&(t=this._convertNumberToHex(Math.round(n.alpha*255))),"#"+t+this._convertNumberToHex(n.red)+this._convertNumberToHex(n.green)+this._convertNumberToHex(n.blue)},n.prototype._convertNumberToHex=function(n){var t=n.toString(16);return t.length<2?"0"+t:t},n._elementMapping={activityZone:"az",adminDistrict:"ad",adminDistrictCapital:"adc",airport:"ap",archipelago:"arc",area:"ar",arterialRoad:"ard",bare:"br",building:"bld",buildingLine:"bl",business:"bs",camera:"cmr",capital:"cp",cemetery:"cm",continent:"ct",contour:"cn",controlledAccessHighway:"cah",countryRegion:"cr",countryRegionCapital:"crc",district:"ds",education:"ed",educationBuilding:"eb",foodPoint:"fp",foodZone:"fz",forest:"fr",golfCourse:"gc",highSpeedRailway:"hsr",highSpeedRamp:"hsrp",highway:"hg",incident:"in",indigenousPeoplesReserve:"ipr",indoorPoint:"ip",island:"is",military:"ima",majorRoad:"mr",mapElement:"me",mapLine:"ml",medical:"md",medicalBuilding:"mb",metro:"mt",naturalPoint:"np",nautical:"nt",neighborhood:"nh",park:"pr",peak:"pk",playingField:"pf",point:"pt",pointOfInterest:"poi",political:"pl",populatedPlace:"pp",railway:"rl",ramp:"rm",reserve:"rsv",river:"rv",road:"rd",roadExit:"re",roadShield:"rs",runway:"rw",sand:"sn",secureZone:"szn",securityLine:"sl",serviceZone:"sz",settings:"g",shoppingCenter:"sct",stadium:"sta",street:"st",structure:"str",tollRoad:"tr",track:"trk",trail:"trl",transit:"trn",transitBuilding:"tb",transportation:"trs",underground:"ug",unpavedStreet:"us",vegetation:"vg",venueFootprint:"vf",volcanicPeak:"vp",walkway:"wlk",wall:"wl",water:"wt",waterPoint:"wp",waterRoute:"wr",zone:"zn"},n._propertyMapping={borderOutlineColor:"boc",borderStrokeColor:"bsc",borderVisible:"bv",fillColor:"fc",iconColor:"ic",labelColor:"lbc",labelOutlineColor:"loc",labelVisible:"lv",landColor:"lc",shadedReliefVisible:"srv",strokeColor:"sc",visible:"v"},n._clientRenderedProperties={lbc:!0,loc:!0,lv:!0},n}(),pf=function(){function n(){if(n.instance)return n.instance}return n.prototype.getGeneralizations=function(t,i,r){var s=t.generalizable&&t.x.length>n._minimumGeneralizationCoordinates&&i&&i<=n._maximumGeneralizationZoom,f,o,e,u;if(s&&(o=n._getGeneralizationBucketKey(i),f=this._initializeGeneralization(t,o,i,r),f.length===0&&r))for(f.push(0),r.calculateProjectedCoordinates(0,t,0),this._lastRenderableX=r.lastProjectedX,this._lastRenderableY=r.lastProjectedY,e=t.x.length,this._hasNextProjectedCoordinates=!1,u=1;u<e;u++)this._hasNextProjectedCoordinates?(this._currentProjectedX=this._nextProjectedX,this._currentProjectedY=this._nextProjectedY,this._hasNextProjectedCoordinates=!1):(r.calculateProjectedCoordinates(u,t,0),this._currentProjectedX=r.lastProjectedX,this._currentProjectedY=r.lastProjectedY),this._isCoordinateIgnorable(u,u===e-1,t,r)||(f.push(u),this._lastRenderableX=this._currentProjectedX,this._lastRenderableY=this._currentProjectedY);return f},n.prototype._isCoordinateIgnorable=function(t,i,r,u){var y;if(!i){if(this._consecutiveIgnoredCoordinatesCount<n._maxConsecutiveSkippedCoordinates){var s=this._currentProjectedX-this._lastRenderableX,h=this._currentProjectedY-this._lastRenderableY,p=Math.sqrt(s*s+h*h),f=this._totalPerpendicularDistance===0&&p<this._tolerance;if(!f){u.calculateProjectedCoordinates(t+1,r,0);this._nextProjectedX=u.lastProjectedX;this._nextProjectedY=u.lastProjectedY;this._hasNextProjectedCoordinates=!0;var e=this._nextProjectedX-this._lastRenderableX,o=this._nextProjectedY-this._lastRenderableY,a=e*e+o*o,v=(s*e+h*o)/a,c=this._lastRenderableX+v*e,l=this._lastRenderableY+v*o;f=!(c<this._lastRenderableX&&c<this._nextProjectedX||c>this._lastRenderableX&&c>this._nextProjectedX||l<this._lastRenderableY&&l<this._nextProjectedY||l>this._lastRenderableY&&l>this._nextProjectedY);f&&(y=Math.sqrt(a),this._totalPerpendicularDistance+=Math.abs(s*o-h*e)/y,f=this._totalPerpendicularDistance<this._tolerance)}if(f)return this._consecutiveIgnoredCoordinatesCount++,!0}this._consecutiveIgnoredCoordinatesCount=0;this._totalPerpendicularDistance=0}return!1},n.prototype._initializeGeneralization=function(t,i,r,u){u&&t.generalizationCrs!==u.destinationCrs&&(t.generalizations=null,t.generalizationCrs=u.destinationCrs);t.generalizations||(t.generalizations={});var f=t.generalizations[i];return f&&f.length!==0||(t.generalizations[i]=[],f=t.generalizations[i],this._totalPerpendicularDistance=0,this._consecutiveIgnoredCoordinatesCount=0,this._tolerance=n._getPixelTolerance(r)),f},n._getPixelTolerance=function(t){return n._maximumPixelToleranceLimit/Math.pow(2,n._zoomLevelGeneralizationBucketSize-t%n._zoomLevelGeneralizationBucketSize-1)},n._getGeneralizationBucketKey=function(t){return"z"+Math.floor(t/n._zoomLevelGeneralizationBucketSize)},n.instance=new n,n._maximumGeneralizationZoom=17,n._minimumGeneralizationCoordinates=20,n._maximumPixelToleranceLimit=1,n._zoomLevelGeneralizationBucketSize=3,n._maxConsecutiveSkippedCoordinates=100,n}(),f=function(){function n(){this.collinsBart="cb"}return n.getTilePrimerId=function(n){return"tp"+n},n.isValid=function(t){var r,u;switch(t){case n.aerial:case n.birdseye:case n.road:case n.roadVector1:case n.roadVector2:case n.streetside:case n.userStudy2:case n.userStudy3:case n.userStudy4:case n.NGT:case n.ordnanceSurvey:case n.seasonal:case n.mercator:case n.grayscale:case n.canvasDark:case n.canvasLight:case n.highContrast:case n.birdseyeV2:return!0;case n.symbolicNight:return r=i.features.symbolicNight,r&&r.isEnabled;case n.symbolicWinter:return u=i.features.symbolicWinter,u&&u.isEnabled}return!1},n.aerial="a",n.birdseye="be",n.none="",n.ordnanceSurvey="os",n.road="r",n.roadVector1="rv1",n.roadVector2="rv2",n.streetside="x",n.seasonal="e",n.userStudy2="s2",n.userStudy3="s3",n.userStudy4="s4",n.NGT="ngt",n.mercator="m",n.grayscale="cg",n.canvasDark="wd",n.canvasLight="wl",n.highContrast="hc",n.symbolicNight="sn",n.symbolicWinter="w",n.birdseyeV2="be2",n}(),wf=function(){function n(t,i,r,f,o){var v,y,s,h,c,w;if(r===void 0&&(r=2e3),f===void 0&&(f=1200),o===void 0&&(o=50),this.duration=0,this.zoomDelta=0,v=parseInt(u._getUrlParam(window.location,"maxDuration")),f=v?v:f,this._maxAnimationDuration=f,y=parseInt(u._getUrlParam(window.location,"velocity")),r=y?y:r,s=e.Internal.TileSystemHelper,s){h=a.fromLocation(i.cameraLocation,!0);c=a.fromLocation(t.cameraLocation,!0);this.zoomDelta=h-c;var p=Math.min(h,c),b=s.latLongToPixelXY(i.cameraLocation,p),k=s.latLongToPixelXY(t.cameraLocation,p),l=Math.sqrt(Math.pow(b.x-k.x,2)+Math.pow(b.y-k.y,2))+Math.abs(h-c)*n._pixelDistancePerZoom+Math.abs(i.heading-t.heading)*n._pixelDistanceFactorPerHeadingDegree,d=s.getMapSize(p);l>d/2&&(l=Math.max(0,d-l));w=l/r*1e3;this.duration=w>f?0:w;this.duration>0&&this.duration<n._slowAnimationThresholdDuration&&(this.duration=Math.min(this.duration*n._durationMultiplierDuringShortPan,n._slowAnimationThresholdDuration))}}return n.prototype.interpolate=function(n,t,i){var e=this._interpolateProgress(n.cameraLocation.latitude,t.cameraLocation.latitude,i),s=this._interpolateProgress(n.cameraLocation.longitude,t.cameraLocation.longitude,i),h=this._interpolateProgress(n.cameraLocation.altitude,t.cameraLocation.altitude,i,!0),r=n.heading,u=t.heading,f;return Math.abs(u-r)>180&&(u<r?u+=360:r+=360),f=this._interpolateProgress(r,u,i),new p(new o(e,s,h,t.cameraLocation.altitudeReference),f)},n.prototype._interpolateProgress=function(t,i,r,u){if(u===void 0&&(u=!1),this.zoomDelta<0)r=Math.pow(r,2);else if(this.zoomDelta>0)r=1-Math.pow(1-r,2);else if(this.duration>n._minDurationForZoomEffectDuringPan&&u)return Math.sin(r*Math.PI)*t*n._zoomAnimationFactorDuringLongPan*(1+Math.log(this.duration/n._minDurationForZoomEffectDuringPan))+t;return(i-t)*r+t},n._pixelDistancePerZoom=500,n._pixelDistanceFactorPerHeadingDegree=4,n._slowAnimationThresholdDuration=225,n._minDurationForZoomEffectDuringPan=500,n._zoomAnimationFactorDuringLongPan=.4,n._durationMultiplierDuringShortPan=10,n}(),pi=function(){function n(n,t,i,r){this.crs=et.instance;this.geometryType=1;this.setLocation(n);this.entity=t;this.anchor=r;this.image=i}return n.getLocation=function(n,t){var i,r,u;return n&&t&&(r=n.toLatitude(t.x,t.y),u=n.toLongitude(t.x,t.y),i=new o(r,u)),i},n.prototype.getLocation=function(){return n.getLocation(this.crs,this.geometry)},n.prototype.isTapEnabled=function(){return!0},n.prototype.setLocation=function(n){this.geometry={x:n.longitude,y:n.latitude,bounds:[n.latitude,n.longitude,n.latitude,n.longitude]}},n.prototype.dispose=function(){this.isDisposed||(u._nullifyClass(this),this.isDisposed=!0)},n}(),bf=function(n){function t(t,i,r,u){return n.call(this,t,i,r,u)||this}return k(t,n),t.prototype.isHoverEnabled=function(){return!0},t.prototype.isMoveEnabled=function(){return!0},t}(pi),vr=function(n){function t(t,i,r,u){var f=n.call(this)||this;return f.defineProperty("overlayElement"),f.defineProperty("alignment"),f.defineProperty("anchor"),f.defineProperty("primitive"),f.setOverlayElement(t),f.setAlignment(i),f.setAnchor(r),u&&f.setPrimitive(u),f}return k(t,n),t}(kt),wi=function(){function n(){}return n.showOverlay=function(t,i,r){if(!n._primitive){var u=i.overlayTemplate;r.getOverlayTemplate&&(u=r.getOverlayTemplate());n._createOverlay(t,u,r,i)}},n.hideOverlay=function(t,i){if(n._overlay&&n._primitive&&n._primitive===i&&(!i||i===n._overlay.getPrimitive())){var r=t.getOverlays();r&&r.indexOf(n._overlay)!==-1&&(r.remove(n._overlay),n._overlay=null,n._primitive=null)}},n.getOverlay=function(){return n._overlay},n._createOverlay=function(t,i,r,u){if(i&&r.geometryType===1){var e=i.applyDataTemplate({primitive:r}),f=r.geometry,s=typeof u.overlayAlignment=="number"?u.overlayAlignment:new o(r.crs.toLatitude(f.x,f.y),r.crs.toLongitude(f.x,f.y));n._overlay=new vr(e,s,u.overlayAnchor,r);n._primitive=r;t.getOverlays().insert(n._overlay)}},n}(),yr=function(){function n(t,r){var u=this,f,e;this._verticalContentSizeInKB=90;this._longSessionMemoryLoggingDelay=126e4;this._disposables=[];this.ppltLogKey="Maps_PPLT";this.bstLogKey="Maps_BST";this.pltLogKey="Maps_PLT";this.plt1LogKey="Maps_PLT1";this.plt2LogKey="Maps_PLT2";this.cacheMissPercentLogKey="Maps_CM";this.usedJSHeapSizeLogKey="Maps_MEM";this.longSessionUsedJSHeapSizeLogKey="Maps_LMEM";this.totalEncodedResourcesSizeLogKey="Maps_ERS";this.totalTransferredResourcesSizeLogKey="Maps_TRS";this.zoomTimeToGlassLogKey="Maps_ZTTG";this.zoomFramePerSecLogKey="Maps_ZFPS";this.panTimeToGlassLogKey="Maps_PTTG";this.panFramePerSecLogKey="Maps_PFPS";this.viewchangedTimeToGlassLogKey="Maps_VCTTG";this.frameFailedLogKey="Maps_FFAIL";this.frameDataLoadedLogKey="Maps_FDL";this.labelsRenderedLogKey="Maps_LRT";this.primitivesRenderedLogKey="Maps_PRT";this.maxBingDNSTimeLogKey="Maps_BDNST";this.maxTileServerDNSTimeLogKey="Maps_TSDNST";this.maxBingConnectionTimeLogKey="Maps_BCT";this.maxTileConnectionTimeLogKey="Maps_TSCT";this.maxBingSSLConnectionTimeLogKey="Maps_BSSLT";this.maxTileServerSSLConnectionTimeLogKey="Maps_TSSSLT";this.maxBingTimeToFirstByteLogKey="Maps_BTTFB";this.maxTileTimeToFirstByteLogKey="Maps_TSTTFB";this.xsrTimeToFirstByteLogKey="Maps_XSRTTFB";this.maxRMSDownloadTimeLogKey="Maps_BDT";this.maxTileDownloadTimeLogKey="Maps_TSDT";this.xsrDownloadTimeLogKey="Maps_XSRDT";this.estimatedUserConnectionSpeedInKbps="Maps_CS";this.tileServerUrlIdentifier="tiles.virtualearth.net";this.rmsUrlIdentifier="/rms/";this.xsrUrlIdentifier="/stl?";typeof perf=="undefined"||!perf.mark||!perf.record||(this._map=t,this._totalTicks=0,this._framesetStartTime=-1,this._disposables.push(this._map.frameManagerLoaded.addOne(function(){return u._onMapFrameManagerLoaded()})),this._disposables.push(this._map.mapZoomStarted.add(function(){return u._onMapZoomStarted()})),this._disposables.push(this._map.mapZoomStopped.add(function(){return u._onMapZoomStopped()})),this._disposables.push(this._map.mapPanStarted.add(function(){return u._onMapPanStarted()})),this._disposables.push(this._map.mapPanStopped.add(function(){return u._onMapPanStopped()})),i.tileRefactoringEnabled?this._disposables.push(this._map.viewChanging.add(function(){return u._onAnimationTick()})):this._disposables.push(r.tickRaised.add(function(){return u._onAnimationTick()})),this._disposables.push(this._map.viewChanging.addOne(function(){return u._onMapControlInitialized()})),this._disposables.push(this._map.navigationBarLoaded.addOne(function(){return u._onNavigationBarLoaded()})),typeof performance!="undefined"&&(performance.setResourceTimingBufferSize&&performance.setResourceTimingBufferSize(250),f=performance.timing,i.isMapsVertical&&f&&(e=f.responseEnd-f.responseStart,e>0&&!n._logStatus[this.estimatedUserConnectionSpeedInKbps]&&(perf.record(this.estimatedUserConnectionSpeedInKbps,Math.floor(this._verticalContentSizeInKB/e*8e3)),n._logStatus[this.estimatedUserConnectionSpeedInKbps]=!0))))}return n.prototype._onMapFrameManagerLoaded=function(){var n=this;this._disposables.push(this._map.getFrameManager().frameFailed.add(function(t){return n._onFrameFailed(t)}));this._disposables.push(this._map.getFrameManager().frameSet.add(function(){return n._onFrameManagerFrameSet()}));this._disposables.push(this._map.getFrameManager().frameRendered.add(function(){return n._onFrameRendered()}));this._disposables.push(this._map.getFrameManager().primitivesRendered.add(function(){return n._onPrimitivesRendered()}));this._disposables.push(this._map.getFrameManager().labelsRendered.add(function(){return n._onlabelsRendered()}));this._disposables.push(this._map.getFrameManager().dataLoaded.add(function(){return n._onFrameManagerDataLoaded()}))},n.prototype._onAnimationTick=function(){this._totalTicks++},n.prototype._onMapControlInitialized=function(){if(n._logStatus[this.bstLogKey]||(perf.mark(this.bstLogKey),n._logStatus[this.bstLogKey]=!0),window[h.bootstrapPerceivedPerfLogKey]){var t=window[h.bootstrapPerceivedPerfLogKey][h.tppltLogKey];t&&!n._logStatus[this.ppltLogKey]&&(perf.record(this.ppltLogKey,Math.round(t)),n._logStatus[this.ppltLogKey]=!0)}},n.prototype._onNavigationBarLoaded=function(){var g=this,w;if(!n._logStatus[this.pltLogKey]&&(n._logStatus[this.pltLogKey]=!0,perf.mark(this.pltLogKey),typeof performance!="undefined")){if(performance.getEntriesByType){var nt=performance.getEntriesByType("resource"),tt=0,it=0,i=0,r=0,u=0,f=0,e=0,o=0,s=0,h=0,c=0,l=0,a=0,v=0,y=0,p=0;for(w=0;w<nt.length;w++){var t=nt[w],b=t.name?t.name.toLowerCase():"",rt=Math.floor(t.domainLookupEnd-t.domainLookupStart),ut=Math.floor(t.connectEnd-t.connectStart),ft=Math.floor(t.secureConnectionStart>0?t.connectEnd-t.secureConnectionStart:0),k=Math.floor(t.responseStart-t.requestStart),d=t.responseStart>0?Math.floor(t.responseEnd-t.responseStart):0;b.indexOf(this.rmsUrlIdentifier)>-1?(u=Math.max(rt,u),f=Math.max(ut,f),e=Math.max(ft,e),o=Math.max(k,o),p=Math.max(d,p),t.encodedBodySize&&(i++,it+=t.encodedBodySize),t.transferSize&&t.transferSize>0&&(r++,tt+=t.transferSize)):b.indexOf(this.tileServerUrlIdentifier)>-1&&(s=Math.max(rt,s),h=Math.max(ut,h),c=Math.max(ft,c),l=Math.max(k,l),v=Math.max(d,v));b.indexOf(this.xsrUrlIdentifier)>-1&&(a=Math.max(k,a),y=Math.max(d,y))}i>0&&(perf.record(this.cacheMissPercentLogKey,Math.round(r/i*100)),perf.record(this.totalEncodedResourcesSizeLogKey,it),perf.record(this.totalTransferredResourcesSizeLogKey,tt),r===0&&perf.mark(this.plt2LogKey),r===i&&perf.mark(this.plt1LogKey));u&&perf.record(this.maxBingDNSTimeLogKey,u);f&&perf.record(this.maxBingConnectionTimeLogKey,f);e&&perf.record(this.maxBingSSLConnectionTimeLogKey,e);o&&perf.record(this.maxBingTimeToFirstByteLogKey,o);p&&perf.record(this.maxRMSDownloadTimeLogKey,p);s&&perf.record(this.maxTileServerDNSTimeLogKey,s);h&&perf.record(this.maxTileConnectionTimeLogKey,h);c&&perf.record(this.maxTileServerSSLConnectionTimeLogKey,c);l&&perf.record(this.maxTileTimeToFirstByteLogKey,l);a&&perf.record(this.xsrTimeToFirstByteLogKey,a);y&&perf.record(this.xsrDownloadTimeLogKey,y);v&&perf.record(this.maxTileDownloadTimeLogKey,v)}this._logMemory(this.usedJSHeapSizeLogKey);this._timerId=Microsoft.Maps.setTimeout(function(){g._logMemory(g.longSessionUsedJSHeapSizeLogKey)},this._longSessionMemoryLoggingDelay)}},n.prototype._logMemory=function(n){if(typeof performance!="undefined"){var t=performance.memory;t&&t.usedJSHeapSize&&perf.record(n,t.usedJSHeapSize)}},n.prototype._onMapPanStarted=function(){this._panStartTime=Date.now();this._totalTicks=0;this._isPanning=!0},n.prototype._onMapPanStopped=function(){if(this._totalTicks>0){var n=(Date.now()-this._panStartTime)/1e3;perf.record(this.panFramePerSecLogKey,Math.round(this._totalTicks/n))}},n.prototype._onMapZoomStarted=function(){this._zoomStartTime=Date.now();this._totalTicks=0;this._isZooming=!0},n.prototype._onMapZoomStopped=function(){if(this._totalTicks>0){var n=(Date.now()-this._zoomStartTime)/1e3;perf.record(this.zoomFramePerSecLogKey,Math.round(this._totalTicks/n))}},n.prototype._onFrameFailed=function(n){n.reason!==1&&(this._framesetStartTime=-1);perf.record(this.frameFailedLogKey,n.reason)},n.prototype._onFrameManagerFrameSet=function(){this._lastFramesetStartTime=Date.now();this._framesetStartTime===-1&&(this._currentFrameDataLoadTime=0,this._framesetStartTime=Date.now())},n.prototype._onFrameManagerDataLoaded=function(){this._currentFrameDataLoadTime+=Date.now()-this._lastFramesetStartTime},n.prototype._onlabelsRendered=function(){this._currentFrameLabelsRenderedTime=Date.now()-this._framesetStartTime},n.prototype._onPrimitivesRendered=function(){this._currentFramePrimitivesRenderedTime=Date.now()-this._framesetStartTime},n.prototype._onFrameRendered=function(){var n=this._isPanning?this.panTimeToGlassLogKey:this._isZooming?this.zoomTimeToGlassLogKey:this.viewchangedTimeToGlassLogKey;perf.record(n,Date.now()-this._framesetStartTime);perf.record(this.frameDataLoadedLogKey,this._currentFrameDataLoadTime);perf.record(this.primitivesRenderedLogKey,this._currentFramePrimitivesRenderedTime);perf.record(this.labelsRenderedLogKey,this._currentFrameLabelsRenderedTime);this._isPanning=this._isZooming=!1;this._framesetStartTime=-1},n.prototype.dispose=function(){u._clearDisposables(this._disposables);clearTimeout(this._timerId);this._map=null},n.log=function(t,i){if(typeof perf!="undefined"&&!!perf.record&&i>=0){var r=Math.round(Date.now()-i);perf.record(t,r);t===n.serpOverlayPltLogKey&&sj_evt.fire("v8OverlayPLT",r)}},n._logStatus={},n.directionsTimeToGlass="Maps_DTTG",n.localListingTimeToGlass="Maps_LLTTG",n.hotelslocalListingTimeToGlass="Maps_HLLTTG",n.restaurantslocalListingTimeToGlass="Maps_RLLTTG",n.realEstatelocalListingTimeToGlass="Maps_RELLTTG",n.localDetailTimeToGlass="Maps_LDTTG",n.hotelslocalDetailTimeToGlass="Maps_HLDTTG",n.restaurantslocalDetailTimeToGlass="Maps_RLDTTG",n.realEstatelocalDetailTimeToGlass="Maps_RELDTTG",n.permalinkTimeToGlass="Maps_PLTTG",n.serpOverlayPltLogKey="Maps_SOPLT",n.serpOverlayHotelsPltLogKey="Maps_SOHPLT",n.serpOverlayRestaurantsPltLogKey="Maps_SORPLT",n.serpOverlayRealEstatePltLogKey="Maps_SOREPLT",n.serpOverlayTravelPltLogKey="Maps_SOTPLT",n.controlSerpHotelsTTGLogKey="Maps_CSHTTG",n.controlSerpRestaurantsTTGLogKey="Maps_CSRTTG",n.controlSerpRealEstateTTGLogKey="Maps_CSRETTG",n.controlSerpTravelTTGLogKey="Maps_CSTTTG",n}(),pr=function(){function n(n,t,i,r){this.crs=et.instance;this.geometryType=3;this.setArea(n,r);this.entity=t;this._template=i}return n.prototype.isTapEnabled=function(){return!0},n.getRings=function(n,t){var f,u,s,r,e,i,h,c,l;if(!n||!t||t.rings.length<1)return null;for(f=[],u=0,s=t.rings.length;u<s;u++){for(r=t.rings[u],e=[],i=0,h=r.x.length;i<h;i++)c=n.toLatitude(r.x[i],r.y[i]),l=n.toLongitude(r.x[i],r.y[i]),e.push(new o(c,o.normalizeLongitude(l)));f.push(e)}return f},n.prototype.getRings=function(){return n.getRings(this.crs,this.geometry)},n.prototype.setRings=function(n,t){this.setArea(n,t)},n.prototype.getTemplate=function(){return this._template},n.prototype.setTemplate=function(n){this._template=n},n.prototype.setArea=function(n,t){var i,f,r,u,e,c,o,l,h,s;if(n.rings)this.geometry=n;else{for(e=n,e[0]instanceof Array||(e=[e]),r=[],i=0,f=e.length;i<f;i++)c=e[i],r.push(this._getRing(c));this.geometry={rings:r,bounds:null}}for(o=this.geometry,r=o.rings,i=0,f=r.length;i<f;i++)u=r[i],this._closeRing(u),u.generalizable=t,l=bi.worldWrapLongitudes(u.x),l&&(o.bounds=null);if(!o.bounds){for(h=new ei,i=0,f=r.length;i<f;i++)u=r[i],h.accumulateLatLon(u.y,u.x);s=h.getBounds();o.boundingBox=s;o.bounds=s?s.bounds:null}},n.prototype.dispose=function(){this.isDisposed||(u._nullifyClass(this),this.isDisposed=!0)},n.prototype._getRing=function(n){for(var i=[],r=[],t=0;t<n.length;t++)i.push(n[t].longitude),r.push(n[t].latitude);return{x:i,y:r}},n.prototype._closeRing=function(n){var i,t;n&&(n instanceof Array?(i=n,i.length&&(i[0].latitude!==i[i.length-1].latitude||i[0].longitude!==i[i.length-1].longitude)&&i.push(new o(i[0].latitude,i[0].longitude))):(t=n,t.x.length&&t.y.length&&(t.x[0]!==t.x[t.x.length-1]||t.y[0]!==t.y[t.y.length-1])&&(t.x.push(t.x[0]),t.y.push(t.y[0]))))},n}(),bi=function(){function n(n,t,i,r){this.crs=et.instance;this.geometryType=2;this.entity=t;this.disposables=[];this.setLine(n,r);this._template=i}return n.getLocations=function(n,t){var r=[],i,u,f;if(n&&t)for(i=0;i<t.x.length;i++)u=n.toLatitude(t.x[i],t.y[i]),f=n.toLongitude(t.x[i],t.y[i]),r.push(new o(u,o.normalizeLongitude(f)));return r},n.prototype.getLocations=function(){return n.getLocations(this.crs,this.geometry)},n.prototype.getTemplate=function(){return this._template},n.prototype.setTemplate=function(n){this._template=n},n.prototype.setLine=function(t,i){var o=new ei,e;if(t instanceof Array){for(var s=t,r=s.length,u=new Array(r),f=new Array(r);r--;)f[r]=t[r].longitude,u[r]=t[r].latitude;this.geometry={x:f,y:u,bounds:null}}else this.geometry=t;e=n.worldWrapLongitudes(this.geometry.x);(e||!this.geometry.bounds)&&(this.geometry.boundingBox=o.accumulateLatLon(this.geometry.y,this.geometry.x),this.geometry.bounds=this.geometry.boundingBox?this.geometry.boundingBox.bounds:null);this.geometry.generalizable=i},n.prototype.dispose=function(){this.isDisposed||(u._disposeEvents(this),u._nullifyClass(this),this.isDisposed=!0)},n.worldWrapLongitudes=function(n){var r=!1,i,s,t,f;n=n||[];var e=o.normalizeLongitude(n[0]),u=0,h=n.length>1&&n[0]===n[n.length-1];for(i=0,s=n.length;i<s;i++)t=u+o.normalizeLongitude(n[i]),f=t-e,f>180?(u-=360,t-=360):f<-180&&(u+=360,t+=360),t!==n[i]&&(n[i]=t,r=!0),e=t;return r&&h&&(n[n.length-1]=n[0]),r},n}(),kf=function(){function n(n,t){this._weight=1;this.location=n;this.setWeight(t)}return n.prototype.getWeight=function(){return this._weight},n.prototype.setWeight=function(n){typeof n=="number"&&isFinite(n)&&(this._weight=n<0?0:n)},n}(),e=window.$MicrosoftMaps8;e.Anchor=ff;e.BasicMapAnimation=ou;e.ClientPerf=fu;e.ImageryMapLayer=ti;e.LatLonCrs=et;e.Location=o;e.LocationRect=w;e.LabelVisibility=vt;e.NetworkCallbacks=ut.callbacks;e.Matrix2D=di;e.CoreMap=tf;e.MapLayer=oi;e.MapMath=d;e.MapTypeId=f;e.MapQuadrant=ai;e.NavigationBarMode=ft;e.NavigationBarOrientation=ot;e.OverviewMapMode=cr;e.MapView=p;e.MapViewAnimator=wf;e.MoveableSimplePointPrimitive=bf;e.Point=c;e.PooledImage=lr;e.PrimitiveOverlayHelper=wi;e.Rectangle=dt;e.SimplePointPrimitive=pi;e.SimpleLinePrimitive=bi;e.SimpleAreaPrimitive=pr;e.Size=nt;e.ResourceManager=vi;e.VectorMapLayer=ii;e.WeightedLocation=kf;e.ZoomLevel=a;e.ZoomAroundLocationAnimator=hr;s=e.Internal=e.Internal||{};s._BoundsAccumulator=ei;s._ComponentNames=tt;s._CurveKey=st;s._Curve=ht;s._Color=bt;s._CurveVector4=ki;s._CurveColor=gr;s._CurveColorHelper=ct;s.CustomMapStyleManager=yf;s._DiscreteRangeCollectionSpline=tu;s._ElementSizeHelper=nr;s._ExternalPromise=pt;s._EntryPoints=ru;s._FeatureNames=uu;s._Helper=u;s._InstrumentationBase=InstrumentationBase;s.Iterator=hf;s._LocalStorageCache=wt.LocalStorageCache;s._LoggingWrapper=eu;s._LoggerConstants=b;s._MapFrameData=gt;s._ObjectWithId=cf;s._Overlay=vr;s._ObservableObject=kt;s._ObservableCollection=it;s._Observable=v;s._ObservableObjectChangedArgs=lt;s._JSEvent=r;s._Binding=er;s._EventBinding=pu;s._NAARectangle=gi;s._VectorMath=l;s._Dispatcher=ef;s._WorkDispatcher=sf;s._Network=ut;s._Gimme=n;s._Debug=t;s._LatLonCrs=et;s._LruCache=ui;s._TransformCurve=rf;s._HslaTransformCurve=uf;s._Url=ar;s.MapFrameManager=ni;s.MapHelper=nf;s.OrderedDictionary=lf;s.DelayLoadedObject=rt;s.StaticPromise=vf;s._GeometryGeneralizer=pf;s._MapAuthentication=ri;s.ViewChangeArgs=at;s._PerfV2Logger=yr}catch(wr){if(e.logger)e.logger.logCriticalError(wr);else throw wr;}}).call(window)