var Chl;(function(n){function s(n){if(typeof n.placeholder!="undefined"){n.placeholder=n.value;n.value="";return}var t=n.value;sj_be(n,"focus",function(){n.value===t&&(Lib.CssClass.add(n,"active"),n.value="")});sj_be(n,"blur",function(){n.value===""&&(Lib.CssClass.remove(n,"active"),n.value=t)})}function r(n,t){var r=Lib.CssClass.getElementByClassName(_d,n),i;if(r!=null)for(i=0;i<r.length;i++)sj_be(r[i],"click",function(){sj_evt.fire(t,this)}.bind(r[i]))}function h(n,t){n=n||"";e[n]=new o(n,t)}var u=8001,f=8002,i="b_hide",t=UrlLib.AddParam,e=n.changeLocLinks=[],o=function(){function n(n,i){this.id=n;this.autosuggestLocations=i;sj_be(_d,"mousedown",this.dismissPopupIfFocusLeaves.bind(this));sj_be(_d,"focus",this.dismissPopupIfFocusLeaves.bind(this),!0);sj_evt.bind("ChLocLinkClick"+this.id,function(n){var t=n[1];this.loadPopupContent(t)}.bind(this),!0);sj_evt.bind("ChLocCloseClick"+this.id,function(){this.closePopup()}.bind(this));sj_evt.bind("ChLocDetect"+this.id,function(){this.getGpsLocation()}.bind(this));r("sw_detectlnk"+this.id,"ChLocLinkClick"+this.id);r("sw_detectloc"+this.id,"ChLocDetect"+this.id);sj_evt.bind("UserLocation"+this.id,function(){var n=_d.forms.geo_chlocman;n.elements.ru.value=t(location.href,"form","GEOMA3")})}return n.prototype.loadPopupContent=function(n){var r=this,i,t;this.divPopup&&this.closePopup();this.divPopup=sj_ce("div","","wpc_bubPl");n.parentNode.appendChild(this.divPopup);n.className==="sw_detectlnk"?this.divPopup.style.left=Math.max(n.offsetLeft+n.offsetWidth-89,0)+"px":this.id||(this.divPopup.style.left=Math.max(n.offsetLeft+n.offsetWidth-280,0)+"px");this.divPopup.style.top=n.offsetTop+n.offsetHeight+6+"px";this.divPopup.style.zIndex="3001";this.popupHtml?this.updatePopupHtml():(i="/geolocation/popup?id="+encodeURIComponent(this.id)+"&IID="+encodeURIComponent(n.getAttribute("data-iid"))+"&IG="+encodeURIComponent(_G.IG),this.autosuggestLocations&&(i+="&popupas=1"),t=sj_gx(),t.open("GET",i,!0),t.onreadystatechange=function(){t.readyState===4&&t.status===200&&(r.popupHtml=t.responseText,r.updatePopupHtml())},t.send())},n.prototype.displayError=function(n){Lib.CssClass.add(_ge("wpc_chlocpoptxt"+this.id),i);Lib.CssClass.remove(_ge("wpc_chlocpoperr"+this.id),i);Log.Log("Warning","Geolocation","getCurrentPosition",!1,"Code",n&&n.code?n.code:"")},n.prototype.updatePopupHtml=function(){this.divPopup.innerHTML=this.popupHtml;var n=_d.forms["wpc_chlocman"+this.id];n.elements.ru.value=t(location.href,"form","GEOMA1");sb_st(function(){s(n.elements.geoname)},1);sj_evt.fire("chloc_popupLoad"+this.id)},n.prototype.closePopup=function(){this.divPopup.parentNode.removeChild(this.divPopup);this.divPopup=null;Log.Log("ClosePopUp","Geolocation","popup",!1)},n.prototype.dismissPopupIfFocusLeaves=function(n){this.divPopup&&!this.divPopup.contains(n.target)&&this.closePopup()},n.prototype.getGpsLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){var i=sj_gx();i.open("GET","/geolocation/reversegeocode?lat="+n.coords.latitude+"&lon="+n.coords.longitude+"&acc="+n.coords.accuracy,!0);i.onreadystatechange=function(){i.readyState===4&&(i.status===200&&i.responseText==="Ok"?(Log.Log("Success","Geolocation","Detect",!1),location.href=t(location.href,"form","GEOTRI")):this.displayError({code:u}))}.bind(this);i.send()}.bind(this),this.displayError.bind(this),{timeout:1e4}):this.displayError({code:f})},n}();n.init=h;sj_evt.fire("ChlLoad")})(Chl||(Chl={}))