(function(){var w;try{(function(){var n={L_Collections_NotFound_Text:"The original result is no longer available:",L_Collections_TryAgain_Text:"Try searching and saving again.",L_FilterName_AlongARoute:"Along a route",L_FilterName_QueryRep_FilterBy_AllPrices:"All Prices",L_FilterName_QueryRep_FilterBy_AllRatings:"All Ratings",L_FiltersBar_Rating_OptionSuffix:"& up",L_LocalSearch_BackToCollections:"Favorites group",L_LocalSearch_BackToSearchResults:"Search results",L_LocalSearch_ReturnToList:"return to list",L_SearchAlongRouteNoneOptionText:"None",L_SearchNearbyGhostTextFormat:"Search near {query}",L_SearchNearbyTerm_1:"Parking",L_SearchNearbyTerm_2:"Hotels",L_SearchNearbyTerm_3:"Restaurants",L_SearchNearbyTerm_4:"Coffee",L_Menu_ReportProblem_Link_Text:"Report a Problem",L_LocalSearch_SearchAlongYourRouteTitle:"{0} along your route",L_SearchNearbyCategoryId_1:"90925",L_SearchNearbyCategoryId_2:"91572",L_SearchNearbyCategoryId_3:"90287",L_SearchNearbyCategoryId_4:"91649",L_SearchNearbyCategoryId_5:"90089",L_SearchNearbyCategoryId_6:"90738",L_SearchNearbyCategoryId_7:"250",L_SearchNearbyTerm_5:"Gas stations",L_SearchNearbyTerm_6:"Grocery stores",L_SearchNearbyTerm_7:"Nearby Transit",L_FiltersBar_UserRating_SelectionLabel:"Rating: {0} stars & up",L_Menu_SuggestAnEdit_Link_Text:"Suggest an edit",L_FiltersBar_UserRating_SelectionLabel_HighestRating:"Rating: {0} stars",L_FilterName_QueryRep_FilterBy_AllCuisines:"All Cuisines",L_PrintEntityAddress_Text:"Address:",L_PrintEntityPhone_Text:"Phone:",L_PrintEntityTitle_Text:"Title:",L_PrintNotes_Watermark:"Type your notes here.",L_PrintEntityWebsite_Text:"Website:",L_PrintCurrency_Text:"$",L_PrintExtendedArea_Text:"Area:",L_PrintExtendedAt_Text:"Located At:",L_PrintExtendedAvgRate_Text:"Average Rate:",L_PrintExtendedCapitol_Text:"Capital:",L_PrintExtendedCC_Text:"Calling Code:",L_PrintExtendedCounty_Text:"County Seat:",L_PrintExtendedCuisine_Text:"Cuisine:",L_PrintExtendedFounded_Text:"Founded:",L_PrintExtendedGDP_Text:"GDP:",L_PrintExtendedHotelClass_Text:"Hotel Class:",L_PrintExtendedLatLong_Text:"Location:",L_PrintExtendedPopulation_Text:"Population:",L_PrintExtendedPrice_Text:"Price:",L_PrintExtendedTravelTip_Text:"Travel Tip:",L_WikipediaTitle_Text:"Wikipedia",L_HoursLabel_Text:"Hours",L_ReportMissingBusiness_Text:"Add a Missing Business",L_AddMissingBusinessCardTitle:"Add missing business",L_AddMissingBusinessMessage:"Did not find what you are looking for?",L_PrintClinicTitle_Text:"Clinic:",L_PrintHomeFactsTitle_Text:"Home Facts",L_PrintLastSoldTitle_Text:"Last Sold:",L_PrintMoreInfoTitle_Text:"More Info",L_PrintSpecialtyTitle_Text:"Specialty:",L_PrintZestimateTitle_Text:"ZEstimate ",L_PrintExperienceTitle_Text:"Years of experience:",L_FilterName_QueryRep_FilterBy_Price:"Price",L_FilterName_QueryRep_FilterBy_Rating:"Rating",L_FilterName_QueryRep_FilterBy_Cuisine:"Cuisine",L_FilterName_QueryRep_FilterBy_OpenTime:"Open time",L_FilterName_QueryRep_FilterBy_Amenities:"Amenities",L_FilterName_QueryRep_SortBy:"Sort by",L_AddNickNameOption:"Add a nickname",L_AddNoteOption:"Add a description",L_EditNickNameOption:"Edit nickname",L_EditNoteOption:"Edit description",L_DeleteNickNameOption:"Delete nickname",L_DeleteNoteOption:"Delete description",L_AddButton:"Add",L_EditButton:"Save",L_AnnotateToolTip:"Add a nickname or description",L_ReservationTitle:"Your Reservation",L_FlightTitle:"Your Flight",L_EventInfoMessage:"This event was inferred from your Outlook email account or calendar.",L_CheckInText:"Check-in",L_CheckOutText:"Check-out",L_SeeEmailLinkText:"See email for this reservation",L_SeeEmailFlightLinkText:"See email for this flight",L_DepartureText:"Departs ",L_ArrivalText:"Arrives at ",L_AirportFormat:"{0} ({1})",L_AirlineFormat:"{0} Confirmation #{1}",L_SeeMoreFlightsText:"See your other flights",L_VenueMapTaskTitle_Suffix:"Directory - ",L_VenueMapTask_NoEntity_Message:"Detailed directory of this level coming soon",L_VenueMapMobile_Toggle_List:"List",L_VenueMapMobile_Toggle_Map:"Map",L_VenueMapTask_NoCategory_Message:"No business of selected category on this level",L_RichAttributeFeedbackTitle:"Tell Bing about this business",L_PrintTrailInfo_Text:"Trail Data:",L_PrintSeason_Text:"Season:",L_PrintDifficulty_Text:"Difficulty:",L_PrintActivities_Text:"Activities:",L_PrintSeparator_Text:" Â· ",L_PrintAnnualVisitors_Text:"Annual Visitors:",L_PrintArchitects_Text:"Architect(s):",L_PrintArchitectureFirm_Text:"Architecture Firm:",L_PrintArtists_Text:"Artists:",L_PrintAverageStay_Text:"Average Stay:",L_PrintCapacity_Text:"Capacity:",L_PrintDateCompleted_Text:"Date Completed:",L_PrintEstablished_Text:"Established:",L_PrintFloors_Text:"Floors:",L_PrintHeight_Text:"Height:",L_PrintInterests_Text:"Interests:",L_PrintMainSites_Text:"Main Sites: ",L_PrintMedia_Text:"Media:",L_PrintOpened_Text:"Opened:",L_PrintOpen_Text:"Open:",L_PrintRates_Text:"Rates:",L_PrintServiceAreas_Text:"Service Areas:",L_PrintSites_Text:"Sites:",L_PrintSubjects_Text:"Subjects:",L_PrintTeams_Text:"Team(s):",L_PrintElevation_Text:"Elevation:",L_PrintFirstAscender_Text:"First ascender:",L_PrintFirstAscent_Text:"First ascent:",L_PrintLastEruption_Text:"Last eruption:",L_PrintMountainRange_Text:"Mountain range:",L_PrintProminence_Text:"Prominence:",L_PrintCollegesUniversities_Text:"Colleges and universities:",L_PrintNearbyAirport_Text:"Nearby Airport(s):",L_AddToItinerary:"Add to Itinerary"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("LocalSearch",n):window.$MicrosoftMaps8.ResourcesObject=n})();var o=window.$MicrosoftMaps8,l=o.Local=o.Local||{},c=o.Internal=o.Internal||{},dt=c.TaskData=c.TaskData||{},b=c.AdsScenario,vf=o.ButtonGroupViewModel,kr=c._BaseMapTemplateSelector,ot=c.BaseTask,pt=c.BaseTaskViewModel,dr=o.BirdseyeV2Manager,gr=o.BirdseyeV2Metadata,yf=o.BitmapImageTemplate,nu=o.GlobalConfig.features.calendar,tu=o.CalendarSync,iu=c.CanvasDrawingContext,yt=dt.CollectionActions,pf=o.GlobalConfig.features.collections,wf=o.CommonControls.CollectionsListDropdownViewModel,nt=c._ComponentNames,gt=c.ControlTemplate,f=o.DataHandlerKeys,vi=c._Debug,bf=o.DetailsTaskPoiManager,kf=o.CommonControls.DirectionsListDropdownViewModel,fi=dt.DirectionsMode,u=c._EntryPoints,rt=c._FeatureNames,ut=o.GlobalConfig.features.feedback,ru=o.FiltersBarModuleViewModel,df=o.FiltersBarViewModel,gf=o.FiltersStatusBarViewModel,uu=o.FiltersBar,wt=o.FiltersBarItem,st=o.FiltersBarItemData,r=c._Gimme,v=o.GlobalConfig,e=o.GlobalDataEventHandler,ht=o.Heading,i=c._Helper,ei=typeof o.Infobox!="undefined"?o.Infobox:undefined,g=c._JSEvent,ne=c._LatLonCrs,te=o.CommonControls.ListDropdownViewModel,n=v.features.localSearch,oi=o.LocalSearchEntity,ie=c._LocalStorageCache,yi=o.LocationRect,h=c._LoggerConstants,it=c.MapHelper,re=c.MapInteractionBehavior,p=o.Location,si=o.MapTypeId,pi=o.MapView,fu=o.MapViewAnimator,ue=o.MicroPoiManager,eu=o.CommonControls.ModalDialogViewModel,ct=c._Network,bt=c._ObservableObject,fe=c._ObservableObjectChangedArgs,ni=c._ObservableCollection,ee=c._OverlayEntity,oe=o.CommonControls.PopOutButtonViewModel,se=o.CommonControls.PopOutMessageViewModel,he=o.CommonControls.CollectionPopOutMessageViewModel,ce=v.features.parking,wi=o.GlobalConfig.features.print,bi=c.PrintContent,ou=c.PrintManager,tt=c._PerfV2Logger,ki=dt.RecommendationEntity,t=o.ResourceManager.LocalSearch,su=o.ResultsTaskPoiManager,hu=o.CommonControls.SendToMobileDialogViewModel,di=o.SignInState,ti=o.SimplePointPrimitive,cu=c._StreetsidePerfConstants,ft=o.CommonControls.SyndicatedAds,gi=o.CommonControls.ServerSideAds,le=o.TaskBar,ae=o.TaskMapInteractionBehavior,hi=c._TaskDataHandlerHelper,ve=v.features.taskFramework,s=o.TaskTypes,lu=o.VectorImageTemplate,ye=o.VectorMapLayer,pe=c.TipComponents,nr=dt.Waypoint,we=o.CommonControls.SelectionListDropdownViewModel,ut=o.GlobalConfig.features.feedback,tr=o.GlobalConfig.features.streetside,lt=o.GlobalConfig.features.travel,ii=o.ZoomLevel,be=c.TransientLensActions,ke=o.PolygonListingTaskPoiManager,au='<div class="bm_annotationRoot" data-tag="annotationRoot">    <div class="auxillaryButtons">        <a class="annotateButton" data-tag="annotateButton" event:click="onAnnotateClick" href="#"><\/a>    <\/div>    <div class="nameContainer">        <TextBlock Text="{Binding CurrentName}" />    <\/div>    <div class="annotateDropdown popOutTop" style:display="{Binding ShowDropdown Converter=boolToDisplay}">        <a class="annotateEntry dropdownEntry" data-tag="annotateEntry" event:click="onAddNicknameClick" style:display="{Binding IsHomeWork Converter=boolToNotDisplay}" href="#">            <span class="annotateButton annotateIcon"><\/span>            <TextBlock Text="{Binding CurrentName Converter=displayNameChangeMessage}" />        <\/a>        <a class="annotateEntry dropdownEntry" data-tag="annotateEntry" event:click="onAddDescriptionClick" href="#">            <span class="annotateButton annotateIcon"><\/span>            <TextBlock Text="{Binding Description Converter=displayNoteChangeMessage}" />        <\/a>        <a class="annotateEntry dropdownEntry" data-tag="annotateEntry" event:click="onDeleteNicknameClick" style:display="{Binding CurrentName Converter=displayDeleteNickName}" href="#">            <span class="deleteButton annotateIcon"><\/span>            <TextBlock Text="{Binding resources.L_DeleteNickNameOption}" />        <\/a>        <a class="annotateEntry dropdownEntry" data-tag="annotateEntry" event:click="onDeleteDescriptionClick" style:display="{Binding Description Converter=boolToDisplay}" href="#">            <span class="deleteButton annotateIcon"><\/span>            <TextBlock Text="{Binding resources.L_DeleteNoteOption}" />        <\/a>    <\/div>    <div class="annotatePopOut popOutTop nickNamePopOut" style:display="{Binding ShowNickNameEdit Converter=boolToDisplay}">        <a class="deleteButton annotateClose" data-tag="annotateClose" event:click="onCloseClick" href="#"><\/a>        <div>            <TextBlock text="{Binding CurrentName Converter=displayNameChangeMessage}" />        <\/div>        <div class="nameInputContainer">            <input type="text" class="nameEditBox" data-tag="nameEditBox" maxlength="100" value="{Binding TempAnnotation Mode=TwoWay}" event:keydown="onKeyPressName" />            <a href="#" class="annotationAddButton" data-tag="annotationAddButton" event:click="onSaveNickNameClick">                <TextBlock Text="{Binding CurrentName Converter=showAddEditNameButton}" />            <\/a>        <\/div>    <\/div>    <div class="annotatePopOut popOutTop descriptionPopOut" style:display="{Binding ShowDescriptionEdit Converter=boolToDisplay}">        <a class="deleteButton annotateClose" data-tag="annotateClose" event:click="onCloseClick" href="#"><\/a>        <div>            <TextBlock text="{Binding Description Converter=displayNoteChangeMessage}" />        <\/div>        <div class="descriptionInputContainer">            <textarea class="descriptionEditBox" data-tag="descriptionEditBox" contenteditable="true" rows="4" maxlength="1000" value="{Binding TempAnnotation Mode=TwoWay}" event:keydown="onKeyPressNote"><\/textarea>            <a href="#" class="annotationAddButton" data-tag="annotationAddButton" event:click="onSaveDescriptionClick">                <TextBlock Text="{Binding Description Converter=showAddEditNoteButton}" />            <\/a>        <\/div>    <\/div>    <div class="descriptionContainer" style:display="{Binding Description Converter=boolToDisplay}">        <TextBlock Text="{Binding Description}" />    <\/div>    <div class="originalNameContainer" style:display="{Binding CurrentName Converter=displayIfDifferentName}">        <TextBlock Text="{Binding OriginalName}" />    <\/div><\/div>',vu='<ul>    <ItemsControl ItemsSource="{Binding geochainSegments}">        <ItemsControl.ItemTemplate>            <DataTemplate>                <li><TextBlock Text="{Binding displayName}" /><\/li>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl><\/ul>',ci='<div class="localEntitiesPrintText" data-tag="localEntitiesPrintText">    <ul class="localEnititiesList" data-tag="localEntitiesList">        <ItemsControl ItemsSource="{Binding printEntities}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li>                        <div class="printEntity" data-tag="detailPrintEntity">                            <div class="printEntityTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                <div class="localSearchPrintTitle" data-tag="localDetailsPrintTitle">                                    <TextBlock Text="{Binding Title}" />                                <\/div>                            <\/div>                            <div class="printEntityTitle" style:display="{Binding originalName Converter=nullToDisplayNone}">                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintOriginalName">                                    <TextBlock Text="{Binding originalName}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityAddress" style:display="{Binding Address Converter=hideIfMatchedData}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                    <TextBlock Text="{Binding Address}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                    <TextBlock Text="{Binding Phone}" />                                <\/div>                            <\/div>                            <div class="isText showText printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                <div class="localPrintLabel">                                    <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                <\/div>                                <div class="localSearchPrintHeader" data-tag="localDetailsPrintWebsite">                                    <TextBlock Text="{Binding Website}" />                                <\/div>                            <\/div>                        <\/div>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/ul>    <div class="isText showText dataPrintFacts">        <ul class="localPrintFactsList" data-tag="localPrintFactsList">            <ItemsControl ItemsSource="{Binding printFacts}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                    <div class="localPrintFactLabel">                                        <TextBlock Text="{Binding factLabel}" />                                    <\/div>                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                        <div style:display="{Binding factData Converter=nullToDisplayNone}">                                            <TextBlock Text="{Binding factData}" />                                        <\/div>                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                            <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                    <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.length}" />                                                <\/span>                                                <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                    <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                        <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                    <\/span>                                                    <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.elevation}" />                                                <\/span>                                                <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                    <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                        <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                    <\/span>                                                    <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                    <TextBlock Text="{Binding extendedFacts.duration}" />                                                <\/span>                                            <\/div>                                        <\/div>                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                            <\/span>                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                <\/span>                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                            <\/span>                                        <\/div>                                    <\/div>                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                        <div class="localPrintFactLabel trailDifficulty">                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                        <\/div>                                        <span class="{Binding extendedFacts.difficulty}">                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                        <\/span>                                    <\/div>                                <\/div>                            <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/ul>    <\/div>    <div class="isText showText">        <div class="printHours" data-tag="detailPrintHours" style:display="{Binding listHours Converter=emptyToDisplayNone}">            <div class="localPrintLabel">                <TextBlock Text="{Binding resources.L_HoursLabel_Text}" />            <\/div>            <table>                <ItemsControl ItemsSource="{Binding listHours}" panelTagName="tbody">                    <ItemsControl.ItemTemplate>                        <DataTemplate>                            <tr data-tag="hourListing">                                <td class="dayOfTheWeek" data-tag="dayOfTheWeek"><TextBlock Text="{Binding day}" /><\/td>                                <td class="hoursOfTheDay" data-tag="hoursOfTheDay">                                    <ItemsControl ItemsSource="{Binding hourRanges}">                                        <ItemsControl.ItemTemplate>                                            <DataTemplate>                                                <div class="todaysHours" data-tag="todaysHours">                                                    <TextBlock Text="{Binding start}" />                                                    <TextBlock Text=" - " />                                                    <TextBlock Text="{Binding end}" />                                                <\/div>                                            <\/DataTemplate>                                        <\/ItemsControl.ItemTemplate>                                    <\/ItemsControl>                                <\/td>                            <\/tr>                        <\/DataTemplate>                    <\/ItemsControl.ItemTemplate>                <\/ItemsControl>            <\/table>        <\/div>    <\/div><\/div>',yu='<div class="isText showText localListingListPrintText" data-tag="localListingListPrintText">    <div class="entitiesCol1" data-tag="entitiesCol1">        <ul class="localEnititiesList" data-tag="localEntitiesList">            <ItemsControl ItemsSource="{Binding printEntities}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printEntity" data-tag="listingPrintEntity">                                                                <div class="titleHead">                                    <div class="entityIcon">                                        <img class="printIcon" src="{Binding colorIndex Converter=chooseIconSource}" />                                        <span class="entityIndex" data-tag="entityIndex">                                            <TextBlock Text="{Binding iconText}" />                                        <\/span>                                    <\/div>                                    <div class="localEntityPrintTitle" data-tag="localEntityPrintTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding Title}" />                                    <\/div>                                <\/div>                                <div class="supplementalData">                                    <div class="schoolFact" style:display="{Binding schoolInfo Converter=nullToDisplayNone">                                        <TextBlock Text="{Binding schoolInfo}" />                                    <\/div>                                    <div class="printEntityAddress" style:display="{Binding printEntity Converter=hideMatchedData}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                            <TextBlock Text="{Binding Address}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                            <TextBlock Text="{Binding Phone}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader listingWebsite" data-tag="localDetailsPrintWebsite">                                            <TextBlock Text="{Binding Website}" />                                        <\/div>                                    <\/div>                                    <div class="isText showText dataPrintFacts">                                        <ul class="localPrintFactsList" data-tag="localPrintFactsList">                                            <ItemsControl ItemsSource="{Binding printFacts}">                                                <ItemsControl.ItemTemplate>                                                    <DataTemplate>                                                        <li>                                                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                                                    <div class="localPrintFactLabel">                                                                        <TextBlock Text="{Binding factLabel}" />                                                                    <\/div>                                                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                                                        <div style:display="{Binding extendedFacts.type Converter=notNullToDisplayNone}">                                                                            <TextBlock Text="{Binding factData}" />                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                            <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.length}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.elevation}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.duration}" />                                                                            <\/span>                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                                                            <\/span>                                                                                                                                                    <\/div>                                                                    <\/div>                                                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                                        <div class="localPrintFactLabel trailDifficulty">                                                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                                                        <\/div>                                                                        <span class="{Binding extendedFacts.difficulty}">                                                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                                                        <\/span>                                                                    <\/div>                                                                <\/div>                                                            <\/div>                                                        <\/li>                                                    <\/DataTemplate>                                                <\/ItemsControl.ItemTemplate>                                            <\/ItemsControl>                                        <\/ul>                                    <\/div>                                <\/div>                             <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/ul>           <\/div>    <div class="entitiesCol2" style:display="{Binding printEntitiesList2 Converter=nullToDisplayNone}" data-tag="entitiesCol2">        <ul class="localEnititiesList" data-tag="localEntitiesList">            <ItemsControl ItemsSource="{Binding printEntitiesList2}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <li>                            <div class="printEntity" data-tag="listingPrintEntity">                                <div class="titleHead">                                    <div class="entityIcon">                                        <img class="printIcon" src="{Binding colorIndex Converter=chooseIconSource}" />                                        <span class="entityIndex" data-tag="entityIndex">                                            <TextBlock Text="{Binding iconText}" />                                        <\/span>                                    <\/div>                                    <div class="localEntityPrintTitle" data-tag="localEntityPrintTitle" style:display="{Binding Title Converter=nullToDisplayNone}">                                        <TextBlock Text="{Binding Title}" />                                    <\/div>                                <\/div>                                <div class="supplementalData">                                    <div class="printEntityAddress" style:display="{Binding printEntity Converter=hideMatchedData}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityAddress_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintAddress">                                            <TextBlock Text="{Binding Address}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityPhone" style:display="{Binding Phone Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityPhone_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader" data-tag="localDetailsPrintPhone">                                            <TextBlock Text="{Binding Phone}" />                                        <\/div>                                    <\/div>                                    <div class="printEntityWebsite" style:display="{Binding Website Converter=nullToDisplayNone}">                                        <div class="localPrintLabel">                                            <TextBlock Text="{Binding resources.L_PrintEntityWebsite_Text}" />                                        <\/div>                                        <div class="localSearchPrintHeader listingWebsite" data-tag="localDetailsPrintWebsite">                                            <TextBlock Text="{Binding Website}" />                                        <\/div>                                    <\/div>                                    <div class="isText showText dataPrintFacts">                                        <ul class="localPrintFactsList" data-tag="localPrintFactsList">                                            <ItemsControl ItemsSource="{Binding printFacts}">                                                <ItemsControl.ItemTemplate>                                                    <DataTemplate>                                                        <li>                                                            <div class="printFact">                                                                <div style:display="{Binding factLabel Converter=nullToDisplayNone}">                                                                    <div class="localPrintFactLabel">                                                                        <TextBlock Text="{Binding factLabel}" />                                                                    <\/div>                                                                    <div class="localSearchPrintHeader" data-tag="localDetailsPrintDataFact">                                                                        <div style:display="{Binding extendedFacts.type Converter=notNullToDisplayNone}">                                                                            <TextBlock Text="{Binding factData}" />                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                            <span style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.lengthIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.length}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.lengthIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.elevationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.elevation}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.durationIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.elevationIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.durationIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.duration}" />                                                                            <\/span>                                                                        <\/div>                                                                        <div style:display="{Binding extendedFacts.type Converter=displayOnCampgrounds}">                                                                            <span style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                <img src="{Binding extendedFacts.rvIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.rvSites}" />                                                                            <\/span>                                                                            <span style:display="{Binding extendedFacts.tentIcon Converter=nullToDisplayNone}">                                                                                <span class="separator" style:display="{Binding extendedFacts.rvIcon Converter=nullToDisplayNone}">                                                                                    <TextBlock Text="{Binding resources.L_PrintSeparator_Text}" />                                                                                <\/span>                                                                                <img src="{Binding extendedFacts.tentIcon}" class="richPrintIcons" />                                                                                <TextBlock Text="{Binding extendedFacts.tentSites}" />                                                                            <\/span>                                                                        <\/div>                                                                    <\/div>                                                                <\/div>                                                                <div style:display="{Binding extendedFacts.type Converter=displayOnTrails}">                                                                    <div style:display="{Binding extendedFacts.type Converter=nullToDisplayNone}">                                                                        <div class="localPrintFactLabel trailDifficulty">                                                                            <TextBlock Text="{Binding resources.L_PrintDifficulty_Text}" />                                                                        <\/div>                                                                        <span class="{Binding extendedFacts.difficulty}">                                                                            <TextBlock Text="{Binding extendedFacts.difficulty}" />                                                                        <\/span>                                                                    <\/div>                                                                <\/div>                                                            <\/div>                                                        <\/li>                                                    <\/DataTemplate>                                                <\/ItemsControl.ItemTemplate>                                            <\/ItemsControl>                                        <\/ul>                                    <\/div>                                <\/div>                            <\/div>                        <\/li>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/ul>                    <\/div><\/div>',pu='<div class="LocalListingTitlePrint" data-tag="LocalListingTitlePrint">    <div class="printQuery">        <div class="localSearchPrintTitle" data-tag="localSearchPrintTitle">            <TextBlock Text="{Binding query}" />        <\/div>    <\/div><\/div>',ir='<div class="localSearchPrintPanel" data-tag="localSearchPrintPanel">    <div class="localSearchPrintText">        <div>            <table>                <tr>                    <td class="textColumn">                        <Tab TabContent="{Binding printTitleViewModel}" TabTemplate="{Binding titlePrintTemplate}" IsDisplayed="true"><\/Tab>                    <\/td>                    <td class="noteColumn">                        <div class="printNotes localPrintNotes" style:display="{Binding isDetails Converter=boolToDisplay}">                            <div class="searchNotesTableData screenNotes">                                <textarea class="searchNotes" contenteditable="true" placeholder="{Binding resources.L_PrintNotes_Watermark}" maxlength="{Binding notesMaxCharSize}" data-tag="printNotes">                                    <TextBlock Text="{Binding PrintNotes}" />                                <\/textarea>                            <\/div>                            <div class="printedNotes">                            <\/div>                        <\/div>                    <\/td>                                    <\/tr>            <\/table>        <\/div>        <div>            <Tab TabContent="{Binding printListingsViewModel}" TabTemplate="{Binding listingsPrintTemplate}" IsDisplayed="true"><\/Tab>        <\/div>    <\/div>    <div class="localSearchMapPrint isMap showMap taskMapPrintPageBreak" data-tag="localSearchMapPrint">        <div class="printArea" data-tag="printArea">            <div class="printMap" data-tag="printMap">            <\/div>        <\/div>    <\/div>    <div class="detailsAttribution" style:display="{Binding isDetails Converter=boolToDisplay}">        <TextBlock Text="{Binding attributionText}"/>    <\/div><\/div>',wu='<div class="report-missing-business-link-content">    <div class="feedbackCardLabel">        <TextBlock Text="{Binding resources.L_AddMissingBusinessMessage}" />    <\/div>    <div class="feedbackCardText">        <a href="#" class="reportProblemLink" role="button" event:click="addMissingEntityLinkClicked">            <TextBlock Text="{Binding resources.L_ReportMissingBusiness_Text}" />        <\/a>    <\/div><\/div>',bu='<div class="bm_svrpagination">    <ul>        <li>            <a href="#" class="bm_leftChevron" event:click="leftChevronClicked" style:display="{Binding showLeftChevron Converter=boolToDisplay}"><\/a>        <\/li>        <li>            <a href="#" class="bm_rightChevron" event:click="rightChevronClicked" style:display="{Binding showRightChevron Converter=boolToDisplay}"><\/a>        <\/li>    <\/ul><\/div>',ku='<div class="bm_upcomingEventsRoot" data-tag="upcomingEvents">    <div class="infoIcon" event:mouseover="onInfoHovered" event:mouseout="onInfoExited"><\/div>    <div class="upcomingEventPopUp popOutTop" style:display="{Binding ShowPopUp Converter=boolToDisplay}">        <TextBlock Text="{Binding resources.L_EventInfoMessage}" />    <\/div>    <ItemsControl ItemsSource="{Binding Events}">        <ItemsControl.ItemTemplate>            <DataTemplate>                <div style:display="{Binding eventIndex Converter=initiallyHideOtherFlights}">                    <hr class="collectionSeparator flightSeparator" style:display="{Binding eventIndex Converter=displayAfterFirst}" />                    <div class="hotelEventDetails" style:display="{Binding type Converter=hotelToDisplay}">                        <h2>                            <TextBlock Text="{StaticBinding resources.L_ReservationTitle}" />                        <\/h2>                        <div class="checkInDetails">                            <div class="checkInTitle">                                <TextBlock Text="{StaticBinding resources.L_CheckInText}" />                            <\/div>                            <div class="checkInTime">                                <TextBlock Text="{Binding startDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="checkOutDetails">                            <div class="checkOutTitle">                                <TextBlock Text="{StaticBinding resources.L_CheckOutText}" />                            <\/div>                            <div class="checkOutTime">                                <TextBlock Text="{Binding endDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="seeEmailContainer" style:display="{Binding emailLink Converter=nullToDisplayNone}">                            <a class="seeEmailLink" href="{Binding emailLink}" target="_blank">                                <TextBlock Text="{StaticBinding resources.L_SeeEmailLinkText}" />                            <\/a>                        <\/div>                    <\/div>                    <div class="flightEventDetails" style:display="{Binding type Converter=flightToDisplay}">                        <h2 style:display="{Binding eventIndex Converter=hideAfterFirst}">                            <TextBlock Text="{StaticBinding resources.L_FlightTitle}" />                        <\/h2>                        <div class="airlineDetails">                            <TextBlock Text="{Binding $self$ Converter=getAirlineDetails}" />                        <\/div>                        <div class="departureDetails">                            <div class="departureAirport">                                <TextBlock Text="{StaticBinding resources.L_DepartureText}" />                                <a class="airportLink" data-task="{Binding departureAirport.entity Converter=buildEventDataTaskAttribute}" style:display="{Binding departureAirport.entity.businesslistingid Converter=hideIfEntity}" href="#">                                    <TextBlock Text="{Binding departureAirport.entity Converter=getAirportText}" />                                <\/a>                                <div class="airportText" style:display="{Binding departureAirport.entity.businesslistingid Converter=displayIfEntity}">                                    <TextBlock Text="{Binding departureAirport.entity Converter=getAirportText}" />                                <\/div>                            <\/div>                            <div class="departureTime">                                <TextBlock Text="{Binding startDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="arrivalDetails">                            <div class="arrivalAirport">                                <TextBlock Text="{StaticBinding resources.L_ArrivalText}" />                                <a class="airportLink" data-task="{Binding arrivalAirport.entity Converter=buildEventDataTaskAttribute}" style:display="{Binding arrivalAirport.entity.businesslistingid  Converter=hideIfEntity}" href="#">                                    <TextBlock Text="{Binding arrivalAirport.entity Converter=getAirportText}" />                                <\/a>                                <div class="airportText" style:display="{Binding arrivalAirport.entity.businesslistingid Converter=displayIfEntity}">                                    <TextBlock Text="{Binding arrivalAirport.entity Converter=getAirportText}" />                                <\/div>                            <\/div>                            <div class="arrivalTime">                                <TextBlock Text="{Binding endDate Converter=getTimeString}" />                            <\/div>                        <\/div>                        <div class="seeEmailContainer" style:display="{Binding emailLink Converter=nullToDisplayNone}">                            <a class="seeEmailLink" href="{Binding emailLink}" target="_blank">                                <TextBlock Text="{StaticBinding resources.L_SeeEmailFlightLinkText}" />                            <\/a>                        <\/div>                    <\/div>                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="showMoreFlights" style:display="{Binding ShowOtherFlights Converter=showMoreFlightButton}">        <hr class="collectionSeparator flightSeparator" />        <a class="showMoreLink" event:click="onExpandClick" href="#">            <TextBlock Text="{StaticBinding resources.L_SeeMoreFlightsText}" />        <\/a>    <\/div><\/div>',rr='<div>    <div class="bm_filtersBarModule">    <\/div>    <ItemsControl ItemsSource="{Binding entities}" PanelTagName="div" class="bm_venueDirectory">        <ItemsControl.ItemTemplate>            <DataTemplate>                <div class="bm_venueEntity" data-task="{Binding taskInfo}" event:click="onBusinessClick" event:mouseover="onBusinessMouseOver" event:mouseout="onBusinessMouseOut">                    <div class="bm_venueEntityWrapper">                        <div class="bm_entityIcon">                            <img src="{Binding listingIcon}" />                        <\/div>                        <div class="bm_entityDetails">                            <div class="bm_localName">                                <TextBlock Text="{Binding name}"><\/TextBlock>                            <\/div>                            <div class="bm_phoneNumber">                                <TextBlock Text="{Binding phoneNumber}"><\/TextBlock>                            <\/div>                            <div class="bm_floorName">                                <TextBlock Text="{Binding floorName}"><\/TextBlock>                            <\/div>                        <\/div>                    <\/div>                    <div class="bm_entityDivider"><\/div>                <\/div>            <\/DataTemplate>        <\/ItemsControl.ItemTemplate>    <\/ItemsControl>    <div class="bm_noEntityMessage">    <\/div><\/div>',a=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),ur=function(n){function i(i,r,u,f,e,o){var s=this,h={};return s=n.call(this,h)||this,h.defineProperty("currentName"),h.defineProperty("originalName"),h.defineProperty("description"),h.defineProperty("tempAnnotation"),h.defineProperty("isHomeWork"),h.defineProperty("showDropdown",function(n,t){return s._onShowPopOutChanged(n,t)}),h.defineProperty("showNickNameEdit",function(n,t){return s._onShowPopOutChanged(n,t)}),h.defineProperty("showDescriptionEdit",function(n,t){return s._onShowPopOutChanged(n,t)}),s.controlTemplateFactory=i,s._templateName=au,s.disposables=[],s.annotationChanged=new g,s.setCurrentName(f),s.setIsHomeWork((f==="Home"||f==="Work")&&f!==e),s.setOriginalName(e?e:f),s.setDescription(o),s.setShowDropdown(!1),s.setShowNickNameEdit(!1),s.setTempAnnotation(""),s.resources=t,s._map=r,s._isAddress=u,s._windowClickEventHandler=function(n){var t=s._control,i=t.select(".nickNamePopOut"),r=t.select(".descriptionPopOut");i&&i.has(n.target)||r&&r.has(n.target)||(s._hideDropdown(n),s._hideDescriptionPopOut(n),s._hideNickNamePopOut(n))},s}return a(i,n),i.prototype.boolToDisplay=function(n){return n?"":"none"},i.prototype.boolToNotDisplay=function(n){return n?"none":""},i.prototype.displayIfDifferentName=function(n){return n===this.getOriginalName()?"none":""},i.prototype.displayDeleteNickName=function(n){return n===this.getOriginalName()||this.getIsHomeWork()?"none":""},i.prototype.displayNameChangeMessage=function(n){return n===this.getOriginalName()?this.resources.L_AddNickNameOption:this.resources.L_EditNickNameOption},i.prototype.displayNoteChangeMessage=function(n){return n?this.resources.L_EditNoteOption:this.resources.L_AddNoteOption},i.prototype.showAddEditNameButton=function(n){return n===this.getOriginalName()?this.resources.L_AddButton:this.resources.L_EditButton},i.prototype.showAddEditNoteButton=function(n){return n?this.resources.L_EditButton:this.resources.L_AddButton},i.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw"control template factory must be defined.";var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},i.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},i.prototype.onAnnotateClick=function(n){this.setShowDropdown(!0);this._logInstrumentation("Annotate");n.stopPropagation();n.preventDefault()},i.prototype.onAddNicknameClick=function(n){this.setShowDropdown(!1);this.getCurrentName()!==this.getOriginalName()&&this.setTempAnnotation(this.getCurrentName());this.setShowNickNameEdit(!0);var t=r(".nameEditBox",this._control[0]);t&&t.length&&t[0].focus();this._logInstrumentation("EditNickName");n.stopPropagation();n.preventDefault()},i.prototype.onAddDescriptionClick=function(n){var i,t;this.setShowDropdown(!1);i=this.getDescription();i&&this.setTempAnnotation(i);this.setShowDescriptionEdit(!0);t=r(".descriptionEditBox",this._control[0]);t&&t.length&&(t[0].value=this.getTempAnnotation());t&&t.length&&t[0].focus();this._logInstrumentation("EditNotes");n.stopPropagation();n.preventDefault()},i.prototype.onDeleteNicknameClick=function(n){this.setShowDropdown(!1);this.setCurrentName(this.getOriginalName());this.setTempAnnotation("");this.annotationChanged.invoke();this._logInstrumentation("DeleteNickName");n.stopPropagation();n.preventDefault()},i.prototype.onDeleteDescriptionClick=function(n){this.setShowDropdown(!1);this.setDescription(null);this.setTempAnnotation("");var t=r(".descriptionEditBox",this._control[0]);t&&t.length&&(t[0].value="");this.annotationChanged.invoke();this._logInstrumentation("DeleteNotes");n.stopPropagation();n.preventDefault()},i.prototype.onSaveNickNameClick=function(n){this.setShowNickNameEdit(!1);var t=this.getTempAnnotation().trim();t&&(this.setCurrentName(t),this.setTempAnnotation(""),this.annotationChanged.invoke());this._logInstrumentation("SaveNickName");n&&n.stopPropagation();n&&n.preventDefault()},i.prototype.onSaveDescriptionClick=function(n){this.setShowDescriptionEdit(!1);this.setDescription(this.getTempAnnotation());this.setTempAnnotation("");this.annotationChanged.invoke();this._logInstrumentation("SaveNotes");n&&n.stopPropagation();n&&n.preventDefault()},i.prototype.onCloseClick=function(n){this.setShowDescriptionEdit(!1);this.setShowNickNameEdit(!1);this.setTempAnnotation("");var t=r(".descriptionEditBox",this._control[0]);t&&t.length&&(t[0].value="");n.stopPropagation();n.preventDefault()},i.prototype.onKeyPressName=function(n){if(n.keyCode===13)this.onSaveNickNameClick(null)},i.prototype.onKeyPressNote=function(n){if(n.keyCode===13&&!n.shiftKey){var t=r(".descriptionEditBox",this._control[0]);t&&t.length&&t[0].blur();this.onSaveDescriptionClick(null)}},i.prototype.addAuxillaryButton=function(n){var t=this.getControl().select(".auxillaryButtons"),i;t&&t.length>0&&(i=t.select("a"),i&&i.length>0&&t.insertBefore(n,i))},i.prototype._onShowPopOutChanged=function(n,t){var u=this,i=r(window);t?Microsoft.Maps.setTimeout(function(){i.add_event("click,contextmenu",u._windowClickEventHandler)},1):n&&i.remove_event("click,contextmenu",this._windowClickEventHandler)},i.prototype._hideDropdown=function(){this.getShowDropdown()?this.setShowDropdown(!1):r(window).remove_event("click,contextmenu",this._windowClickEventHandler)},i.prototype._hideNickNamePopOut=function(){this.getShowNickNameEdit()?this.setShowNickNameEdit(!1):r(window).remove_event("click,contextmenu",this._windowClickEventHandler)},i.prototype._hideDescriptionPopOut=function(){this.getShowDescriptionEdit()?this.setShowDescriptionEdit(!1):r(window).remove_event("click,contextmenu",this._windowClickEventHandler)},i.prototype._logInstrumentation=function(n){var t={AN:n,EP:u.LocalDetails},i={logData:{feature:nt.DetailsCard,action:h.Clicked,data:t}};e.invokeHandler(f.instrumentationDataHandlerKey,i)},i}(bt),fr=function(){function n(){}return n}(),du=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return a(t,n),t}(fr),de=[new wt("RestaurantPrice","bm_Price",t.L_FilterName_Price,2,1).addAllOptions([1,2,3,4].map(function(n){for(var i="",r=0;r<n;r++)i=i.concat(t.L_FiltersBar_Price_Unit);return new st(n.toString(),i,"RestaurantPrice_RPrice"+(n+1))})),new wt("HotelStarRating","bm_Rating",t.L_FilterName_Rating,1,2,function(n){return i._formatString(t.L_FiltersBar_HotelRating_SelectionLabel,n.getSelectedOptions().map(function(n){return n.value}).join(", "))}).addAllOptions([2,3,4].map(function(n){return new st(n.toString(),t.L_FiltersBar_HotelRating_OptionSuffix,"UserRating_URating"+(2*n-1)+"Up")})).addOption(new st("5","","UserRating_URating9Up")),new wt("CuisineCategory","bm_Cuisine",t.L_FilterName_Cuisine,2,0).addAllOptions(["91210","91216","91221","91223","91225","91229","91238"].map(function(n){return new st(n,t["L_FiltersBar_Cuisine_"+n],"CuisineCategory_"+n)}))],er=function(n){function t(t,i){var r=this,u={};return r=n.call(this,u,i,vu)||this,u.defineProperty("geochainSegments"),r.setGeochainSegments(t),r}return a(t,n),t}(pt),li=function(n){function i(i){var r=n.call(this,i.getTitle(),i.getAddress(),i.id,i.getLocation(),i.getRoutableLocation(),i.getMenuUrl(),i.getImageUrl(),i.entitySource,i.getPrimaryCategoryPath(),i.getPrimaryCategoryName(),i.getVdpId(),i.getLocationType(),i.getDateTime())||this;return i.getPhone()&&n.prototype.setPhone.call(r,i.getPhone()),i.getWebsite()&&n.prototype.setWebsite.call(r,i.getWebsite()),r.factData=null,r.factLabel=null,r.colorIndex=null,r.resources=t,r}return a(i,n),i.prototype.hideIfMatchedData=function(n){var t=n;return t===null||this.getTitle()===t?"none":""},i.prototype.nullToDisplayNone=function(n){return n?"":"none"},i}(oi),ge=function(n){function s(i,r,u,f){var e=this,o={};return e=n.call(this,o)||this,o.defineProperty("events"),o.defineProperty("showPopUp"),o.defineProperty("showOtherFlights"),e.controlTemplateFactory=i,e._templateName=ku,e.disposables=[],e.resources=t,e._map=r,e._id=f,e.setEvents(u),e._logEventShownInstrumentation(),e}return a(s,n),s.prototype.boolToDisplay=function(n){return n?"":"none"},s.prototype.boolToNotDisplay=function(n){return n?"none":""},s.prototype.nullToDisplayNone=function(n){return n?"":"none"},s.prototype.hotelToDisplay=function(n){return n==="Events.HotelEvent"?"":"none"},s.prototype.flightToDisplay=function(n){return n==="Events.FlightEvent"?"":"none"},s.prototype.getTimeString=function(n){if(n){var t=i._formatLongDateString(n),r=i._formatTimeString(n);return"{0}, {1}".replace("{0}",t).replace("{1}",r)}return""},s.prototype.getAirportText=function(n){return n?this.resources.L_AirportFormat.replace("{0}",n.city).replace("{1}",n.airportCode):""},s.prototype.getAirlineDetails=function(n){return n?this.resources.L_AirlineFormat.replace("{0}",n.airline).replace("{1}",n.reservationId):""},s.prototype.initiallyHideOtherFlights=function(n){return!this.getShowOtherFlights()&&n>0?"none":""},s.prototype.displayAfterFirst=function(n){return n>0?"":"none"},s.prototype.hideAfterFirst=function(n){return n>0?"none":""},s.prototype.hideIfEntity=function(n){return n===this._id?"none":""},s.prototype.displayIfEntity=function(n){return n===this._id?"":"none"},s.prototype.showMoreFlightButton=function(n){var t=this.getEvents();return!n&&t&&t[0]&&t[0].type==="Events.FlightEvent"&&t.length>1?"":"none"},s.prototype.onExpandClick=function(n){this.setShowOtherFlights(!0);var t=this.getEvents();this.setEvents([]);this.setEvents(t);n.preventDefault();n.stopPropagation()},s.prototype.onInfoHovered=function(){this.setShowPopUp(!0)},s.prototype.onInfoExited=function(){this.setShowPopUp(!1)},s.prototype.buildEventDataTaskAttribute=function(n){var t=o.CloudGraphDataManager.CollectionEntity.buildEntityDataTaskOptions(n);return t.state.taskTitle="",t.activateOptions={},r.Internals.stringify(t)},s.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw"control template factory must be defined.";var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},s.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},s.prototype._logEventShownInstrumentation=function(){var n={AN:"UE",EP:u.LocalDetails},t={logData:{feature:nt.DetailsCard,action:h.Activated,data:n}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},s}(bt),d;(function(n){n[n.ID=0]="ID";n[n.SB=1]="SB"})(d||(d={})),function(n){n[n.STP=0]="STP";n[n.LLT=1]="LLT";n[n.LDT=2]="LDT";n[n.LDA=3]="LDA";n[n.LLR=4]="LLR";n[n.LSR=5]="LSR";n[n.RAP=6]="RAP";n[n.MBR=7]="MBR";n[n.FLBK=8]="FLBK"}(w||(w={}));var or=function(){function n(n){this._perfLogger=n}return n.prototype.perfStart=function(n){if(d[n]){var t=rt.Search+"_"+d[n];return this._perfLogger.start(t)}return null},n.prototype.log=function(n,t,i){var r={impressionGuid:i,logData:{feature:rt.Search,action:w[n],data:t}};e.invokeHandler(f.instrumentationDataHandlerKey,r)},n.prototype.getMarketFromBingPlacesUrl=function(n){var r=n&&n.select("div.wpc_sfl")[0],u=r&&r.lastElementChild,f=u&&u.href,t=f&&f.split("market="),i=t&&t.length>1?t[1].split("&"):null;return i&&i.length>0?i[0]:""},n}(),sr=function(){function u(n,t,i,r,u,f,e){var s=this,h,o;this.map=n;this.panelRoot=t;this._logHelper=i;this._selector=r;this._attributeName=u;this._pushpins=[];this._entities=[];this._eventHandlers=[];this._transientLensViewModel=f;this._transientLensViewModel&&this._transientLensViewModel.initializeCollections();this.landMarkFilterRule=null;h=v.features.taskFramework;this.changed=new g;this.titleChanged=new g;this.catIdPopulated=new g;this.catIdPopulated.add(function(){return s._assignEntitySearchCategory()});e&&e.selectedCategoryId&&(o=e.selectedCategoryId);this.populateCardCategoryId(o)}return u.getSuggestionIconColor=function(){return i._isHighContrastMode()?u._highContrastSuggestionIconColor:u._suggestionIconColor},u.prototype.selectorReady=function(){var n=this;return this._baseMapTemplateSelector?this._baseMapTemplateSelector.selectorReady():this.map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._baseMapTemplateSelector.selectorReady()})},u.prototype.dispose=function(){this.clear();this._transientLensViewModel.dispose()},u.prototype.setResponseContent=function(n,t){if(n){if(this.clear(),this.panelRoot){this.panelRoot.clear();this.parseEntitiesFromResponse(n,t);this._parseLandMarkMetaData(n);this._parseCategoryData(n);var i=n.length>0&&n[0].innerHTML;i?this.panelRoot.appendHTML(i):this.panelRoot.append(n);this._forceImageRedrawForEdge()}t&&(t.originIG=t.originIG||y.getImpressionGuid(this.panelRoot))}},u.prototype.getResponseContainer=function(){return this.panelRoot},u.prototype.getCardCategoryId=function(){return this._cardCategoryId},u.prototype.getPushpinPrimitives=function(){return this._pushpins},u.prototype.clearPushpinPrimitives=function(){this._pushpins=[]},u.prototype.UpdatePrimitiveState=function(n,t){for(var u,r=!1,i=0,f=this._pushpins.length;i<f;i++)if(this._pushpins[i].entity.id===n){if(u=this._pushpins[i].entity,u&&u.isApproximateLocation)return r;this._pushpins[i].viewState=t;this._pushpins[i].revision=(this._pushpins[i].revision||0)+1;r=!0;break}return r},u.prototype.getEntities=function(){return this._entities},u.prototype.parseEntitiesFromResponse=function(t,i){var f=this,u,e=[],o=t.select(this._selector);return o.for_each(function(t){var k=t.getAttribute(f._attributeName),a,o,v,b,l;if(k){if(a=r.Internals.parseJSON(k),!a)return;if(o=a.entity,!o&&i&&(o={title:i.query}),o&&!o.title&&i&&(o.title=i.query),o&&o.title){var y=a.geometry,w=a.routablePoint,h=null,c=null;if(y&&(h=new p(y.y,y.x)),w&&(c=new p(w.latitude,w.longitude)),h||(h=c),c||(c=h),h&&c){var d=i&&i.directionsTaskId!=null,g=d?1:0,s=new oi(o.title,o.address,o.id,h,c,o.menuUrl,o.imageUrl,g,o.primaryCategoryPath,o.primaryCategoryName,o.vdpId,o.locationType,o.startDateTime,o.endDateTime,o.utcOffset,o.isAllDayEvent,o.segmentTypes);o.phone&&s.setPhone(o.phone);o.website&&s.setWebsite(o.website);o.subtitle&&(s.subtitle=o.subtitle);o.iconText&&(s.iconText=o.iconText);o.isUpHierarchy&&(s.isUpHierarchy=!0);o.isApproximateLocation&&(s.isApproximateLocation=!0);o.usePricePoi&&(s.usePricePoi=!0);o.badgeType&&(s.badgeType=o.badgeType);o.infoboxHtml&&(s.infoboxHtml=o.infoboxHtml);v=o.chainId;v&&(s.setChainId(v),n.brands&&n.brands.indexOf(v)!==-1&&(b=v,s.setBrand(b)));b&&n.enableBrandedPOI?(s.renderBranded=!0,u=new ti(h,s),u.entity.poiType=1,e.push(u)):(l=null,s.subtitle&&s.subtitle.indexOf("useastitle:")>-1&&(s.subtitle=s.subtitle.replace("useastitle:",""),s.subtitle&&s.subtitle.length>0&&(l=s.clone(),l.setTitle(s.subtitle),l.subtitle=null)),u=new ti(h,l!==null?l:s),u.entity.poiType=1,s.isApproximateLocation&&(u.viewState=3),f._pushpins.push(u));o.isPermanentlyClosed&&(s.isPermanentlyClosed=!0);f._entities.push(s)}}}}),e.length&&(this._pushpins=e.concat(this._pushpins)),this._entities},u.prototype.updateAdvertising=function(){},u.prototype.processDirectionsData=function(){},u.prototype.processCollectionsData=function(){},u.prototype.processTravelData=function(){},u.prototype.boolToDisplay=function(n){return n?"":"none"},u.prototype.nullToDisplayNone=function(n){return n?"":"none"},u.prototype.hideIfMatchedData=function(n){return n===null||this.getEntities()[0].getTitle()===n?"none":""},u.prototype.emptyToDisplayNone=function(n){return n&&n.length?"":"none"},u.prototype._addEventsToEventList=function(n,t,i){this._eventHandlers.push({item:n,eventName:t,handler:i})},u.prototype.clear=function(){this._pushpins=[];this._entities=[];this._eventHandlers.forEach(function(n){n.item.remove_event(n.eventName,n.handler)});this._eventHandlers=[]},u.prototype._parseLandMarkMetaData=function(n){var i=n.select("div[data-landmark]"),u,t;if(i.length==1&&(u=i[0],t=u.getAttribute("data-landmark"),t)){var f=r.Internals.parseJSON(t),s=f.type,e=[],o=[];f.value.forEach(function(n){e.push(n.CategoryID);o.push(n.Percentage)});this.landMarkFilterRule={field:s,value:e,distribution:o}}},u.prototype.parseSuggestionMetaData=function(){var i=this.panelRoot.select("div[data-suggestions]"),u,n,f,t;return i.length!=1?null:(u=i[0],n=u.getAttribute("data-suggestions"),!n)?null:(f=r.Internals.parseJSON(n),t=[],f.forEach(function(n){var i=[];n.viewport&&n.viewport.length>1&&!isNaN(n.viewport[0].latitude)&&!isNaN(n.viewport[0].longitude)&&!isNaN(n.viewport[1].latitude)&&!isNaN(n.viewport[1].longitude)&&(i.push(new p(n.viewport[0].latitude,n.viewport[0].longitude)),i.push(new p(n.viewport[1].latitude,n.viewport[1].longitude)));t.push({Name:n.name,Id:n.categoryId,viewport:i})}),t)},u.prototype._drawCategoryItem=function(n,t,r,f,e){var s;e===void 0&&(e=!1);var h=t.Name,l=t.Id,c=i._createElement("li"),o=i._createElement("a");return o.set_attr("class","searchNearbySuggestionLinkIcon"),s=i._createElement("div"),s.set_attr("class","suggestionIconBound"),o.add_event("click",f),this._addEventsToEventList(o,"click",f),o.set_attr("data-tag",r+"."+h),o.set_attr("title",h),o.set_attr("href","#"),o.append(s),c.append(o),n.getCategoryIconTemplate(function(n){if(n){var i=n.renderIcon();i.set_attr("title",h);i.set_attr("alt",h);s.append(i);e&&s.appendText(t.Name)}},l,u.getSuggestionIconColor(),25,25),c},u.prototype._parseCategoryData=function(){},u.prototype.populateCardCategoryId=function(n){var t=this;n===""?(this.categoryFound=!1,this.catIdPopulated.invoke()):n?this.map.getTemplateSelector().then(function(){var i=kr.extractCategoryId(n,!1);i&&(t._cardCategoryId=i,t.changed.invoke());t.categoryFound=typeof t._cardCategoryId!="undefined";t.catIdPopulated.invoke()}):this.catIdPopulated.invoke()},u.prototype.addReportLinkToNoResultCard=function(n,r,u){var w=this,a,s,f,h,v,e,y,p,o,c,b,l,k;n.select("div[data-answerinfo]").length>0&&(a=n.select("div[data-answerinfo]"),a.get_attr("data-answerinfo")==="0"&&(s=i._createElement("p"),f=i._createElement("a"),f.set_text(t.L_Menu_ReportProblem_Link_Text),f.set_attr("href","#"),f.set_attr("data-tag","reportProblemLink"),f.set_attr("class","reportProblemLink"),h=i._createElement("div"),h.set_attr("class","reportProblemLinkWrapper"),h.append(f),s.append(h),v=a.select(".query"),e=v.length>0?v[0].textContent:"",e=e||u&&u.query,y=this.getUserFacts(),ut&&ut.showAddMissingBusinessLink&&!this._houseIntentFound(u)&&(p=i._createElement("span"),p.set_attr("class","reportProblemLinkSeparator"),s.append(p),o=i._createElement("a"),o.set_text(t.L_ReportMissingBusiness_Text),o.set_attr("href","#"),o.set_attr("class","reportProblemLink"),c=i._createElement("div"),c.set_attr("class","reportProblemLinkWrapper"),c.append(o),s.append(c),b=function(n){return w.onAddMissingBusinessLinkClicked(n,r,e,e,y,1)},o.add_event("click",b)),l=this.panelRoot.select(".errmsg"),l.append(i._createElement("br")),l.append(s),l.append(i._createElement("br")),k=function(n){return w._onReportProblemLinkClick(n,r,e,e,y)},f.add_event("click",k)))},u.prototype.onAddMissingBusinessLinkClicked=function(n,i,r,u,o,h){if(n.preventDefault(),ut&&ut.showAddMissingBusinessLink){var c={AN:"RapEntryPoints#"+h.toString()};this._logHelper&&this._logHelper.log(w.MBR,c);e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,state:{entryPoint:3,feedbackTaskType:6,title:t.L_AddMissingBusinessCardTitle,activeTaskId:i,options:{dataFacts:{parentId:i},reportType:1,noFoundType:2,userFacts:o,rapEntryPoint:h}}})}},u.prototype._houseIntentFound=function(n){if(n){if(n.searchQueryCategory&&i._isHouseCategory(n.searchQueryCategory))return!0;if(n.categoryLayers&&n.categoryLayers.length)for(var t=0;t<n.categoryLayers.length;t++)if(n.categoryLayers[t]&&i._isHouseCategory(n.categoryLayers[t]))return!0}return!1},u.prototype._onReportProblemLinkClick=function(n,t,i,r,u){n.preventDefault();this._logHelper&&this._logHelper.log(w.RAP,{AN:"RapEntryPoints#2"});e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,activateOptions:{parentId:t},state:{entryPoint:3,feedbackTaskType:3,title:i,activeTaskId:t,options:{query:r,reportType:1,userFacts:u,rapEntryPoint:2}}})},u.prototype._forceImageRedrawForEdge=function(){var n=this;r.Browser.is_edge&&Microsoft.Maps.setTimeout(function(){for(var u=n.panelRoot.select(".irpserp img, .cico img"),t=0,o=u.length;t<o;t++){var i=u[t],f=i,e=function(n){r([n.srcElement]).set_style({outline:"0px solid white"});n.srcElement.removeEventListener("load",e)};f&&!f.complete?i.addEventListener("load",e):r([i]).set_style({outline:"0px solid white"})}},0)},u.prototype._assignEntitySearchCategory=function(){var t=this.getCardCategoryId(),n=this.getEntities();t&&n&&n.length&&n.forEach(function(n){return n.setSearchCategory(t)})},u.prototype.getUserFacts=function(){var n=null,t=this.panelRoot.select("div[data-ufacts]").get_attr("data-ufacts");if(t)try{n=JSON.parse(t)}catch(i){}return n},u._suggestionIconColor="rgb(96,96,96)",u._highContrastSuggestionIconColor="rgb(255,255,0)",u}(),ri=function(o){function c(i,r,u,f,e,s,h,c,l,a){var y=o.call(this,i,r,f,"div.overlay-taskpane","data-entity",e,c)||this,p,w,b,k;if(y._buttonGroupViewModel=s,y._moduleClickEventInitialized=!1,y._controlTemplateFactory=l,y._taskId=u,y._state=c,c&&c.savedEntityId&&(y.savedEntityId=c.savedEntityId),c&&c.collectionId&&(y.collectionId=c.collectionId),c&&c.itineraryTaskId&&(y.itineraryTaskId=c.itineraryTaskId),c&&c.id&&(y.itineraryEntityId=c.id),y.printNotes="",y._taskBar=h,y.iconClass="srcTsk",y.resources=t,y.printTitleViewModel=null,y._primitivesInteracted=a,p=n.searchNearbyDefaultSuggestions,y._searchNearbyDefaultCategories=[],p){for(w=0;w<p.length;w++)if(b=p[w].split(":"),b.length==2){var nt=b[0],tt=b[1],d=t[nt],g=t[tt];d&&g&&y._searchNearbyDefaultCategories.push({Name:d,Id:g})}k=v.features;k&&k.transit&&k.transit.isEnabled&&(y._searchNearbyDefaultCategories[y._searchNearbyDefaultCategories.length-1]={Name:t.L_SearchNearbyTerm_7,Id:t.L_SearchNearbyCategoryId_7})}return y}return a(c,o),c.prototype.dispose=function(){o.prototype.dispose.call(this);this._buttonGroupViewModel.dispose();this.annotationControl&&this.annotationControl.dispose();this.upcomingEventsControl&&this.upcomingEventsControl.dispose()},c.prototype.getIsDetails=function(){return!0},c.prototype.getPrintNotes=function(){return this.printNotes},c.prototype.getAttributionText=function(){return this._getAttribution()},c.prototype.updatePoiTitle=function(n){this._pushpins&&this._pushpins.length>0&&this._pushpins[0].entity.setTitle(n)},c.prototype.resetPrimitives=function(n){n.setPrimitives(this._pushpins)},c.prototype.registerLocatedAtSearchEvents=function(){sj_evt.unbind("SearchLocatedAt",this._searchLocatedAtHandler);sj_evt.bind("SearchLocatedAt",this._searchLocatedAtHandler,0)},c.prototype.registerModuleClickEvents=function(){sj_evt.unbind("TPModHdrClick",this._moduleHeaderClickHander);sj_evt.bind("TPModHdrClick",this._moduleHeaderClickHander,0)},c.prototype.registerVenueMapEvents=function(){var t=this,n=this.panelRoot.select("div[class=bm_venueMapButton]");n&&n[0]&&n.is_element_inView()&&n.add_event("click",function(){t.handleVenueMapClick()})},c.prototype.registerGeochainEvents=function(){for(var n,t,o,e=this.panelRoot.select(".geochainModule a"),i=0;i<e.length;i++)n=e[i],t={},n.hasAttribute("data-sid")?t.id="sid:"+n.getAttribute("data-sid"):n.hasAttribute("data-vdpid")?t.id="vdpid:"+n.getAttribute("data-vdpid"):t.query=n.innerText,t.entryPoint=u.Geochain,o={type:s.localSearchTask,requestState:t},n.setAttribute(f.taskProcessDataHandlerKey,r.Internals.stringify(o))},c.prototype.registerCalendarEvents=function(){var c=this,n=this.panelRoot.select("#cal_tm1"),t=this.panelRoot.select("#cal_tm2"),l,i,o,s,a;if(n&&n.length&&t&&t.length){l=this.panelRoot.select("*[data-cal-loc]");i=null;try{i=r.Internals.parseJSON(l.get_attr("data-cal-loc"))}catch(v){}o=this.map.getContainer();o&&(o.instanceAsync("Calendar",function(r){r.init(c.panelRoot,n,t,i)}),s=this._getReservertionForm(n),s&&(a=s.select("input[type='submit']"),a.add_event("click",function(){var n=c._buildLogData(h.Clicked,{AN:"Reservation",EP:u.LocalDetails});e.invokeHandler(f.instrumentationDataHandlerKey,n)})))}},c.prototype.registerActionButtonEvents=function(t){var l=this,nt=this.panelRoot.select("div[data-entity]"),s=nt&&r(nt[0]),i,tt,b,v,y,k,d,it,p,rt,g,c,ut,et;if(s&&this._taskId){i=s.select("a[class=directionsAction]");i&&i.length!==0||(i=this._initializeAlternateDirectionsButton(s));var a=this.getEntities()[0],o=a&&a.getLocation(),w=a&&a.getRoutableLocation();if(w=w?w:o,i&&i.length===1&&(tt=this._buildLogData(h.Clicked,{AN:"Directions",CP:o,EP:u.LocalDetails}),b=function(n){return l._buttonGroupViewModel.directionButtonClicked(n,w,tt,u.LocalDetails)},i.add_event("click",b),this._addEventsToEventList(i,"click",b)),v=new di,y=s.select("a[class=saveAction], a#newCollectAction"),y&&y.length===1&&(it=v.getIsSignedIn()?"CollectionsMenu":lt.isEditable?"SaveWithTravel":"Collections",k=this._buildLogData(h.Clicked,{AN:it,CP:o,EP:u.LocalDetails}),d=function(n){!v.getIsSignedIn()&&lt.isEditable?l._buttonGroupViewModel.saveWithTravelButtonClicked(n,o,k,u.LocalDetails):l._collectionClick(n,o,k,u.LocalDetails,v.getIsSignedIn())},y.add_event("click",d),this._addEventsToEventList(y,"click",d)),p=s.select("a[class=shareAction], a#shareAction"),p&&p.length===1&&(rt=this._buildLogData(h.Clicked,{AN:"ShareActionButton",CP:o,EP:u.LocalDetails}),g=function(n){return l._shareButtonClicked(n,rt,t)},p.add_event("click",g),this._addEventsToEventList(p,"click",g)),c=s.select("a[class=sendAction]"),c&&c.length===1&&v.getIsSignedIn()&&n.enableSendToMobile){ut=s.select("div[class=sendContainer]");ut.set_style({display:"block"});var ot=this._buildLogData(h.Clicked,{AN:"SendToMobileAction",CP:o,EP:u.LocalDetails}),st=c.get_attr("data-time"),ht=c.get_attr("data-hash"),ct=this._state.entryPoint,ft=function(n){return l._sendButtonClicked(n,ot,t,st,ht,ct)};c.add_event("click",ft);this._addEventsToEventList(c,"click",ft);et={logData:{feature:"STM",action:"Shown",data:{IS:!0}}};e.invokeHandler(f.instrumentationDataHandlerKey,et)}this._populateAddToContainer();this._buttonGroupViewModel.setEntityData(a,{requestorType:"LocalDetailsTask",requestorId:this._taskId},this.panelRoot);this._addSuggestionsToNearbyModule(o)}},c.prototype.registerActionsModuleEvents=function(){var s=this,n=this.panelRoot.select("div[class=actionAnswer]"),t,o,i,r;if(n&&n.length)for(t=0;t<n.length;t++)if(o=n[t].getAttribute("data-actiontype"),i=n[t].getElementsByTagName("a"),i&&i.length&&o)for(r=0;r<i.length;r++)i[r].addEventListener("click",function(){var n=s._buildLogData(h.Clicked,{AN:"ActionModule",EP:u.LocalDetails,DT:o});e.invokeHandler(f.instrumentationDataHandlerKey,n)})},c.prototype.processDirectionsData=function(t){var r=this.getEntities(),i=r&&r[0],h=i.getAddress(),f,e,o,s;i&&i.id&&i.id.indexOf("event")>-1&&(e=n.eventPreArrivalTime,f=i.getDateTime&&i.getDateTime()?i.getDateTime()+i.getUtcOffset()*6e4-e*6e4:null);o=i.entitySource===1;s=hi.getDirectionTaskOptions(h,i.getRoutableLocation(),u.LocalDetails,i.getTitle(),i.id,null,o,f);t&&t.inData&&t.inData.requestorState&&(t.inData.requestorState.entryPoint===u.LocalDetails?this._buttonGroupViewModel.processDirectionsData(t,s):this._transientLensViewModel.processDirectionsData(t))},c.prototype.processTravelData=function(n){if(n&&n.inData&&n.inData.requestorState)n.inData.requestorState.entryPoint===u.LocalDetails?this._buttonGroupViewModel.processSaveWithTravelData(n):this._transientLensViewModel.processTravelData(n);else if(n&&n.outData&&n.outData.length){var t=n.outData[n.outData.length-1];this.itineraryTaskInfo=t;this._populateAddToContainer()}},c.prototype._populateAddToContainer=function(){var v=this,c=this.panelRoot.select("div[data-entity]"),f=c&&r(c[0]),n,e,o,u,s,l,h,a;f&&f.length!==0&&(n=f.select("div[class=bm_addToContainer]"),this.itineraryTaskInfo&&!n.length&&(e=f.select("div[class=b_subModule]"),o=e.length&&e[0],o&&(n=i._createElement("div"),n.add_class("bm_addToContainer bm_addToFirstModule"),o.appendChild(n[0]))),this.itineraryTaskInfo&&n.length?(n.clear(),n.add_class("bm_addToItineraryContainer"),u=i._createElement("a"),u.set_attr("href","#"),u.set_attr("class","addToAction addToItinerary"),s=i._createElement("span"),s.set_attr("class","addToItineraryIcon"),u.append(s),u.appendText(t.L_AddToItinerary),l=this.itineraryTaskInfo.processorId,h=function(n){return v._addAttractionButtonClicked(n,l)},u.add_event("click",h),this._addEventsToEventList(u,"click",h),n.append(u),n.set_style({display:"block"}),a=f.select("div[class=sendContainer]"),a.set_style({display:"none"})):n.length&&(n.set_style({display:"none"}),n.remove_class("bm_addToItineraryContainer")))},c.prototype.processCollectionsData=function(n){var r=this.getEntities(),i=r&&r.length===1&&r[0],f=hi.getMyPlacesTaskOptions(i.getTitle(),i.getLocation(),i.getDescription()),t,e;f.activateOptions={parentId:this._taskId};f.state.data.id=i.id;t=n.inData.requestState;(t.action===yt.AddEntity||t.action===yt.AddFavorite||t.action===yt.AddToTemporaryCollection)&&(e=n.outData.length&&n.outData[0].data&&n.outData[0].data.entityId,e&&(this.savedEntityId=e),t.collectionId&&(this.collectionId=t.collectionId),t.action===yt.AddToTemporaryCollection&&(this.collectionId="TEMP"));n&&n.inData&&n.inData.requestorState&&(n.inData.requestorState.entryPoint===u.LocalDetails?this._buttonGroupViewModel.processCollectionsData(n,f):this._transientLensViewModel.processCollectionsData(n))},c.prototype.setResponseContent=function(t,i){var f=this,s,c;if(t){o.prototype.setResponseContent.call(this,t,i);n.enableJavaScriptLoadingInResponse&&Microsoft.Maps.setTimeout(function(){f._loadJavaScriptInResponse(t)},10);s=this.panelRoot.select(".overlay-container");s.length>0&&(c=s[0].getAttribute("data-answerinfo"),c!=null&&n.pushpinIconScenarios!=null&&n.pushpinIconScenarios.indexOf(c)!==-1&&(this.iconClass="addrTsk"));var e={},l={},a=this.panelRoot.select("a[href]");a.for_each(function(t){var o=t.getAttribute("href"),s,i,a,v,k,y,w,g,b,nt,tt;if(o)if(s=o.toLowerCase(),s.indexOf("http")===0||s.indexOf("/search")===0||s.indexOf("/images/search")===0)t.setAttribute("target","_blank");else if(s.indexOf("/local/reportproblem")===0)f._shouldEnableSuggestAnEdit()&&f._setLocalFeedbackTaskOptions(t);else if(s.indexOf("data-process")===0){i=null;try{o=o.replace(/data-process=/i,"");o=o.replace(/\?form=[a-zA-Z]*[0-9]*/i,"");t.setAttribute("data-process",o);t.setAttribute("href","#");i=r.Internals.parseJSON(o);n.enableSeoLinks&&(a=i&&i.requestState,a&&a.seo&&a.query&&t.setAttribute("href","/maps/p/"+a.query.replace(/-/g,"_").replace(/[' ',':','//']/g,"-")))}catch(rt){k=f._buildLogData(h.Clicked,{AN:"SEARCHERROR",EP:u.LocalDetails,DT:"BadDataProcess"});t.setAttribute("data-instrumentation",r.Internals.stringify(k));t.setAttribute("data-process","")}if(i&&i.moduleName&&(v=i.moduleName,v in e?e[v]+=1:e[v]=1,k=f._buildLogData(h.Clicked,{AN:v,EP:u.LocalDetails}),t.setAttribute("data-instrumentation",r.Internals.stringify(k))),i&&i.requestState&&i.requestState.passThruParam&&i.requestState.passThruParam.indexOf("lemodule=")!==-1&&(y=i.requestState.passThruParam.split("="),y&&y.length>1)){var c="lemoduleSeeAll."+y[1],it="MapsModule."+y[1],d,p=f.panelRoot.select("div[data-entitymetadata]");if(p&&p.length)for(w=0;w<p.length;w++)if(p[w].getAttribute("data-moduletag")===it){d=p[w];break}g=f._buildLogData(h.Clicked,{AN:c,EP:u.LocalDetails});d&&(b=d.getAttribute("data-entitymetadata"),b&&b.length&&(l[c]=b,g=f._buildLogData(h.Clicked,{AN:c,EP:u.LocalDetails,DAT:b})));t.setAttribute("data-instrumentation",r.Internals.stringify(g));c in e?e[c]+=1:e[c]=1}}else s.indexOf("javascript:void(0)")===0&&(nt=t.getAttribute("id"),nt!=null&&(tt=nt.toLowerCase(),tt=="raflink"&&f._shouldEnableSuggestAnEdit()&&f._setLocalCrowdSourcingTaskOptions(t)))});this._addOutingsInstrumentation();this._addModulesInstrumentation(e,l);o.prototype.addReportLinkToNoResultCard.call(this,t,this._taskId,i)}},c.prototype._initializeAlternateDirectionsButton=function(n){var r=n.select("a#DirBtn"),u=!1,f,t,i,e;return r&&r.length>0&&(f=this.panelRoot.select(".directionsPopOut"),f&&f.length!==0?u=!0:(t=r.get_ancestor(3),t&&t.length>0&&t.has_class("b_subModule")&&(i=t.select(".infoCardIcons"),i&&i.length!==0||(i=t.select(".b_vList")),i&&i.length>0&&(e=document.createElement("div"),e.className="bm_popout directionsPopOut",t.insertBefore(e,i),u=!0)))),u||(this._processDirectionsButtonClick(),r=null),r},c.prototype._processDirectionsButtonClick=function(){if(this.panelRoot){var n=this.getEntities()[0],t=this.panelRoot.select("#DirBtn")[0];n&&t&&t.addEventListener("click",function(t){t.preventDefault();var i=new nr(n.getAddress(),n.getRoutableLocation(),n.getTitle(),!1,null,n.id,null,null,null,2,1,null),r={entryPoint:3,waypoints:[i]};e.invokeHandler(f.taskDataHandlerKey,{type:s.directionsTask,state:r})})}},c.prototype.parseEntitiesFromResponse=function(t,i){var e=this,u=o.prototype.parseEntitiesFromResponse.call(this,t,i),s,h,f;return this.boundingBox=this._parseBoundingBox(t),this.boundingBox&&(u=this.getEntities(),u&&u.length===1&&u[0].setBoundingBox(this.boundingBox)),n.enableLEPoiHover&&(s=t.select("div.EntityCollectionModuleContainer"),s.for_each(function(n){var l=n.getAttribute("data-entitylist"),i,f,c,o,s,t,h,u;if(l&&(i=r.Internals.parseJSON(l),i&&i.length>0))for(c=n.getAttribute("data-moduletag"),c&&(o=c.split("."),o&&o.length===2&&(f=o[1])),s=0;s<i.length;++s)t=i[s],e._pushpins&&t&&t.location&&t.location.length===2&&t.title&&t.id&&(h=new ki(t.id,t.title),f&&(h.setSearchCategory(f),h.setSelectedCategoryForIcon(f)),u=new ti(new p(t.location[0],t.location[1]),h),u.alwaysShowOnMap=!1,u.viewState=3,u.entity.poiType=1,e._pushpins.push(u))})),lt&&lt.newItineraryEnabled&&(h=t.select("div.overlay-taskpane").get_attr("data-facts"),f=y.parseDataFact(h),f&&u&&u.length===1&&(u[0].addressFields=f.addressFields)),i&&i.dateTime&&u[0]&&u[0].setDateTime(i.dateTime),i&&i.imgUrls&&i.imgUrls.length&&u[0]&&!u[0].getImageUrl()&&u[0].setImageUrl(i.imgUrls[0]),u},c.prototype.processPhotostripData=function(){var n,t=this.panelRoot.select("div[data-photostripconfig]").get_attr("data-photostripconfig");t&&(n=r.Internals.parseJSON(t));n&&(this._setPhotoStripWidth(n),this._registerPhotostripEvents())},c.prototype.createCalendarSync=function(){var n=this.getEntities()&&this.getEntities()[0];this.calendarSync=new tu(this.map,this.panelRoot.select(".calendarSyncControlContainer"),this.panelRoot.select(".calendarSyncLabel"),this.panelRoot.select(".calendarSyncMessage"),this._taskId,n)},c.prototype.addCollectionsDescription=function(n){var e,t,r,u,f;if(n&&n.descriptionList&&n.descriptionList.length>0&&(e=n.descriptionList,t=this.panelRoot.select("ul[id=userDescriptionList]"),t&&t.length===1)){for(r=0;r<e.length;r++)u=i._createElement("li"),u.set_attr("data-tag","MapActionModule.UserDescription.Item"),u.set_text(e[r]),t.append(u);f=this.panelRoot.select("div[id=userDescription]");f&&f.length==1&&f.set_style({display:"block"})}},c.prototype.addAnnotationControl=function(n){var c=this,a=this.getEntities(),t=a&&a.length&&a[0],u=this.panelRoot.select(".local-variant"),f,h,v,y,p,w,i,r,o,s,l;u&&u.length!==0||this._state.selectedCategoryId!=="House"&&(t?t.getPrimaryCategoryPath()!=="House":!0)||(u=this.panelRoot.select(".overlay-taskpane"));u&&u.length&&(f=u.select(".b_entityTitle"),h=f.parent(),h&&h.length&&f&&f.length&&(v=document.createElement("div"),v.className="b_annotate annotate",h.insertBefore(v,f),y=document.createElement("div"),y.className="collectionsPopOut",h.insertBefore(y,f)));var e=this.panelRoot.select(".annotate"),b=this.panelRoot.select(".geocoderInfoModule"),k=this.panelRoot.select(".mapsCustomInfoCard .b_entityTitle");if(e&&e.length){var d=n.originalName?n.originalName:t?t.getTitle():"",nt=n.taskTitle||d,g=null;n.descriptionList&&(g=n.descriptionList[n.descriptionList.length-1]);p=t&&t.getLocationType();w=p==="StreetAddress"||p==="Other"&&(!t.id||t.id===t.getTitle());t.isPermanentlyClosed?e.removeFromParent():(i=new ur(this._controlTemplateFactory,this.map,w,nt,d,g),this.annotationControl=i,i.annotationChanged.add(function(){var t=i.getDescription(),n=i.getCurrentName();c._sendUpdateEntityProcessCall(n,t);c._state.descriptionList=[t];c._state.taskTitle=n;c.titleChanged.invoke(n)}),e.append(i.getControl()),e.set_style({display:"block"}),w&&e.add_class("address"),b&&b.set_style({display:"none"}),k&&k.set_style({display:"none"}));r=this.panelRoot.select(".mapActionsModule li");r&&r.length!==0||(r=this.panelRoot.select(".local-variant .b_entityTitle + .b_hList li"));r&&r.length>3&&(o=this.panelRoot.select(".shareAction, #shareAction"),o&&o.length>0&&(l=o.parent(),i.addAuxillaryButton(o),l.removeFromParent(),o.add_class("show")),r.length>4&&(s=this.panelRoot.select(".newCollectAction, #newCollectAction"),s&&s.length>0&&(l=s.parent(),i.addAuxillaryButton(s),l.removeFromParent(),s.add_class("show"))));this.panelRoot.select("#shareAction").add_class("show");this.panelRoot.select("#newCollectAction").add_class("show")}},c.prototype.removeUpcomingEventContainer=function(){var t=this.panelRoot.select(".upcomingEvents"),n;t&&t.length&&(n=t.getParent(),n&&n.has_class("wpc_module")&&n.removeFromParent())},c.prototype.expandDetailsCard=function(){var i=this,n,t;v.isMobile&&(n=this.panelRoot.select("a[id*='expitem_']"),n&&n.length&&(n.get_attr("data-exp").length>0?n.for_each(function(n){var t=r(n);t.get_attr("data-exp").indexOf("tp_mobileexp")>=0&&i._toggleExpansion(t,!0)}):n.for_each(function(n){n.click()}),t=this.panelRoot.select("div[id='tp_mobileexp']"),t.removeFromParent()))},c.prototype._parseCategoryData=function(){var t,n=this.getEntities();n&&n.length===1&&(t=n[0].getPrimaryCategoryPath(!0));this.populateCardCategoryId(t)},c.prototype.processAdvertising=function(t,i){var r=null,a,f,v,o,s,h,y,u,nt,c,k,d,p,w,l,e,g;try{if(a=this.getEntities(),i&&ft.isEnabled())if(a&&a.length===1)if(f=a[0],n.adsFromWorkflow)e=this.panelRoot.select("div.overlay-container"),e&&e.length?n.isRenderAdsAtServer?(u=this.GetDetailsScenario(t,f),s=this.panelRoot.select("div.syndicatedAds"),r=gi.setShownAds(u,s)):(v=e[0].getAttribute("data-ads"),r=v===null?93:v?this.showAdsFromWorkflow(t,i,f,v):92):r=94;else if(r=98,s=this.panelRoot&&this.panelRoot.select("div.adsContainer"),h=s&&s.length&&s.getParent(),h&&h.length)t&&t.query&&(o=n.detailsMaxAdCount,o&&(i.setScenario(b.PD),r=b.PD,i.requestAds(this._placeAdsQuery(t.query),f.getLocation().clone(),o,this._taskId),h.getParent().insertBefore(i.getControl(),h))),h.removeFromParent();else{if(nt=f.getPrimaryCategoryName(),(t.scenarioKey==="HS"||nt==="Hotel")&&(o=n.hotelsMaxAdCount,o&&(u=b.HO)),o=n.detailsMaxAdCount,!u&&o){if(c=f.getPrimaryCategoryPath(),k=f.getLocationType(),(k==="City"||k==="Country")&&(y=this._placeAdsQuery(f.getTitle()),u=b.PL),!u&&c&&c.length&&(d=c.split("."),d&&(p=n.catsForAdsTest,p)))for(w=0;w<p.length;w++)if(d.indexOf(p[w])>=0){u=b.CT;break}u||t.scenarioKey!=="LS"&&t.scenarioKey!=="LLS"||c&&c.length||(u=b.LS)}u&&(y||(y=f.getTitle()))&&(l=this.panelRoot&&this.panelRoot.select("div.tp_tasks"),!l.length&&n.localOverlayAds&&(l=this.panelRoot.select("div.b_entityTP"),u=b.OD),l.length?(i.setScenario(u),r=u,i.requestAds(y,f.getLocation().clone(),o,this._taskId),l.append(i.getControl()),e=this.panelRoot.select("div.overlay-container"),e&&e.length&&(g=e[0].getAttribute("data-ads"),g===null?r+=23808:g!=="{}"&&(r+=23552))):r=96)}else r=95;else r=99}catch(tt){ft.logError(tt);r=97}t.adsLog=r},c.prototype.showAdsFromWorkflow=function(n,t,i,r){var u,s=t.getControl(),o=this.panelRoot&&this.panelRoot.select("div.adsContainer"),f=o&&o.length&&o.getParent(),e;return f&&f.length?(u=b.PD,t.setScenario(u,"w"),t.setAds(r),f.getParent().insertBefore(s,f),f.removeFromParent()):(e=this.panelRoot&&this.panelRoot.select("div.tp_tasks"),e&&e.length?(u=this.GetDetailsScenario(n,i),t.setScenario(u,"w"),t.setAds(r),e.append(s)):u=96),u},c.prototype.GetDetailsScenario=function(t,i){var e,r,o,u,f;if(t.scenarioKey==="HS"||i.getPrimaryCategoryName()==="Hotel")return b.HO;if(e=i.getLocationType(),e==="City"||e==="Country")return b.PL;if(r=i.getPrimaryCategoryPath(),r&&r.length&&(o=r.split("."),o&&(u=n.catsForAdsTest,u)))for(f=0;f<u.length;f++)if(o.indexOf(u[f])>=0)return b.CT;return(t.scenarioKey==="LS"||t.scenarioKey==="LLS")&&!(r&&r.length)?b.LS:b.DE},c.prototype.getDetailsHtmlContentForPrint=function(n){var t=this,f=this.annotationControl&&this.annotationControl.getOriginalName(),e=this.annotationControl&&this.annotationControl.getDescription(),i,u,r;return this.printTitleViewModel=new yr(this.map,this._controlTemplateFactory,this.getEntities(),n,f),this.notesMaxCharSize=wi.notesMaxChars,i={boolToDisplay:function(n){return t.boolToDisplay(n)},nullToDisplayNone:function(n){return t.nullToDisplayNone(n)},hideIfMatchedData:function(n){return t.hideIfMatchedData(n)},emptyToDisplayNone:function(n){return t.emptyToDisplayNone(n)}},this.titlePrintTemplate=new gt(ci,i),u=this._controlTemplateFactory({templateText:ir,staticResources:i}),this.printNotes=e||"",r=u.applyDataTemplate(this),r.length>0?r[0].outerHTML:""},c.prototype.hideIfMatchedData=function(n){var t=this.getEntities()&&this.getEntities()[0]&&this.getEntities()[0].getSegmentTypes()?this.getEntities()[0].getSegmentTypes()[0].toLowerCase():"";return n===null||this.getEntities()[0].getTitle()===n||t==="house"?"none":""},c.prototype.prepareMenuModule=function(){var t=this.panelRoot.select("div[data-tabcontrolid]").get_attr("data-tabcontrolid"),n;t&&(n=this.panelRoot.select("#"+t+"_menu"),n&&n.length&&(this._prepareTabs(n[0],t),Microsoft.Maps.setTimeout(function(){sj_evt.fire("tab_init",tabcontrol)},10)))},c.prototype.prepareReviewsAccordionModule=function(n){var i=this.panelRoot.select("div[class=revacc]"),t,r;i&&i.length&&(t=i.select("div[class=acc-header]"),t&&t.length&&t[0].children&&t[0].children.length&&sj_evt.bind("accordion_item_click",n,1),r=i.select("a[id*='expitem_']"),r&&r.length&&r.for_each(function(t){t.addEventListener("click",function(){n&&n()})}),Microsoft.Maps.setTimeout(function(){sj_evt.fire("accordion_init",AccordionControl)},10))},c.prototype.addRecommendationModuleHover=function(t){var i=this,f,u;n.enableLEPoiHover&&(f=this.panelRoot.select("div.EntityCollectionModuleContainer"),u=1,f.for_each(function(f){var y=f.getAttribute("data-entitylist"),s,a,o,l;if(y&&(s=r.Internals.parseJSON(y),s&&s.length>0)){for(var h=u,c=u+s.length-1,e=f.parentElement,p=0,v=!1;e&&p<5;){if(v=e&&e.className&&e.className.indexOf("wpc_module")>-1?!0:!1,v)break;++p;e=e.parentElement}v?(a=e.getElementsByClassName("b_secondaryText"),n.enableLEPoiHover2&&a&&a.length&&(o=document.createElement("input"),o.type="checkbox",o.className="seeAllCheckBox",o.checked=!1,o.addEventListener("change",function(){i._onRecommendationModuleHover(t,h,c,o.checked)}),a[0].appendChild(o)),e.addEventListener("mouseenter",function(){i._onRecommendationModuleHover(t,h,c,!0,o)}),e.addEventListener("mouseleave",function(){i._onRecommendationModuleHover(t,h,c,!1,o)})):(f.addEventListener("mouseenter",function(){i._onRecommendationModuleHover(t,h,c,!0)}),f.addEventListener("mouseleave",function(){i._onRecommendationModuleHover(t,h,c,!1)}));l=r(f).select("li");l&&l.length&&l.length==s.length?l.for_each(function(n){var r=u++;n.addEventListener("mouseenter",function(){i._onRecommendationModuleItemHover(t,r,!0)});n.addEventListener("mouseleave",function(){i._onRecommendationModuleItemHover(t,r,!1)})}):u+=s.length}}))},c.prototype.handleVenueMapClick=function(){var n={};n.type=s.venueMapDirectoryTask;n.action="activate";n.activateOptions={};n.activateOptions.activationState=1;var i={},r=this.panelRoot.select("div.overlay-taskpane.local-taskpane"),u=r.get_attr("data-venues"),t=JSON.parse(u);t.venueMapInfo&&t.venueMapInfo[0]&&t.venueMapInfo[0].id&&(i.venueMapId=t.venueMapInfo[0].id,i.venueMapType=t.venueMapInfo[0].mapType,i.title=this._state.taskTitle||"",n.state=i,e.invokeHandler(f.taskDataHandlerKey,n))},c.prototype._onRecommendationModuleItemHover=function(n,t,i){if(n&&this._pushpins&&this._pushpins.length&&t<this._pushpins.length){var r=this._pushpins[t];r.viewState=i?1:0;r.zIndex=i?2:0;n.setPrimitives(this._pushpins,!0)}},c.prototype._onRecommendationModuleHover=function(n,t,i,r,u){var e=u&&u.checked?!0:!1,f;if(n&&this._pushpins&&this._pushpins.length&&t<this._pushpins.length&&i<this._pushpins.length){for(f=t;f<=i;++f)this._pushpins[f].viewState=r||e?0:3,!r&&!e&&n._primitives&&n._primitives.length&&f<n._primitives.length&&n._primitives[f].bucket&&delete n._primitives[f].bucket;n.disableComputingMapViewForFirstTimeLoad=!0;r||e?n.setPrimitives(this._pushpins,!0):n.setPrimitives([this._pushpins[0]],!0)}},c.prototype._addOutingsInstrumentation=function(){var n=this.panelRoot.select(".articleList a.articleCard"),i,t,r;n&&n.length!==0||(n=this.panelRoot.select(".bm_outingsModule a"));n&&n.length>0&&(i=this._buildLogData(h.Clicked,{AN:"MapsModule.OutingsLink",EP:u.LocalDetails}),n.for_each(function(n){n.addEventListener("click",function(){e.invokeHandler(f.instrumentationDataHandlerKey,i)})}));t=this.panelRoot.select(".articleList .b_module_expansion .b_expand");t&&t.length>0&&(r=this._buildLogData(h.Clicked,{AN:"MapsModule.OutingsExpansion",EP:u.LocalDetails}),t[0].addEventListener("click",function(){e.invokeHandler(f.instrumentationDataHandlerKey,r)}))},c.prototype._addModulesInstrumentation=function(n,t){var tt=this,k=this.panelRoot.select("div[data-suppressed]"),y,p,w,b,v,l,s,a,o,c,it,d,rt,i,g,ut,nt;if(k&&k.length&&(y=k[0].getAttribute("data-suppressed"),y&&y.length&&(l=this._buildLogData(h.Removed,{AN:"Suppressed",EP:u.LocalDetails,DAT:y}),l.impressionGuid=this._state.impressionGuid,e.invokeHandler(f.instrumentationDataHandlerKey,l))),p=this.panelRoot.select("div[data-umodules]"),p&&p.length&&(w=p[0].getAttribute("data-umodules"),w&&w.length&&this._state&&(b={moduleKeys:w,query:this._state.query,id:"",title:""},v=this.getEntities&&this.getEntities(),v&&v.length&&(b.id=v[0].id,b.title=v[0].getTitle()),l=this._buildLogData("UM",{AN:"UnrecognizedModules",EP:u.LocalDetails,DAT:r.Internals.stringify(b)}),l.impressionGuid=this._state.impressionGuid,e.invokeHandler(f.instrumentationDataHandlerKey,l))),s=this.panelRoot.select("div[data-moduletag]"),s&&s.length)for(a=0;a<s.length;a++)o=s[a].getAttribute("data-moduletag"),o&&(c=s[a].getAttribute("data-entitymetadata"),c&&c.length&&(t[o]=c),it=r(s[a]),d=it.select("a[href]"),d&&d.for_each(function(t){var e="",s="",l,f,i,a;try{l=t.getAttribute("data-process");l&&(f=JSON.parse(l),f&&f.requestState&&(i=f.requestState,i.title&&(s=i.title),i.entityId&&(e=i.entityId)))}catch(v){}a=c&&c.length?tt._buildLogData(h.Clicked,{AN:o,EP:u.LocalDetails,ID:e,Name:s,DAT:c}):tt._buildLogData(h.Clicked,{AN:o,EP:u.LocalDetails,ID:e,Name:s});t.setAttribute("data-instrumentation",r.Internals.stringify(a));o in n?n[o]+=1:n[o]=1}));rt=["MapsModule.PointsOfInterest","MapsModule.PeopleAlsoSearchedFor","MapsModule.FoundAtThisAddress","MapsModule.FoundNearThisAddress","MapsModule.EatAndDrink","MapsModule.ThingsToDo","MapsModule.WhereToStay","MapsModule.PlaceNearby","MapsModule.PlaceToGo","MapsModule.Events","MapsModule.EventsAtVenue"];for(i in n)n.hasOwnProperty(i)&&n[i]&&(g=rt.indexOf(i)>-1?Math.floor(n[i]/2):n[i],nt=t[i],ut=nt?this._buildLogData(h.Impression,{AN:i,EP:u.LocalDetails,CNT:g,DAT:nt}):this._buildLogData(h.Impression,{AN:i,EP:u.LocalDetails,CNT:g}),e.invokeHandler(f.instrumentationDataHandlerKey,ut))},c.prototype._prepareTabs=function(n,t){for(var r,i,u,f,h,e,o=this,s=0;s<n.children.length;s++)r=n.children[s],i=r.getAttribute("data-content"),i&&(u=this.panelRoot.select("#"+i),u&&u.length&&(r.setAttribute("data-content",i+"_"+t),u[0].id=i+"_"+t)),r.addEventListener("click",function(){o._menuModuleClicked("TabClick")});f=this.panelRoot.select("div[data-tabcontrolid]");f&&(h=["_navl","_navr"],h.forEach(function(n){var i=f.select("#"+t+n);i&&i.length&&i[0].addEventListener("click",function(){o._menuModuleClicked("NavClick")})}),e=f.select("a[class=b_moreLink]"),e&&e.length&&e[0].addEventListener("click",function(){o._menuModuleClicked("MenuLinkClick")}))},c.prototype._menuModuleClicked=function(n){var t=this._buildLogData(h.Clicked,{AN:"RestaurantMenu",EP:u.LocalDetails,DT:n});e.invokeHandler(f.instrumentationDataHandlerKey,t)},c.prototype._shareButtonClicked=function(n,t,i){n&&n.preventDefault();e.invokeHandler(f.shareDataHandlerKey,{action:"shareTasks",taskIds:[i],entryPoint:u.LocalDetails});e.invokeHandler(f.instrumentationDataHandlerKey,t)},c.prototype._sendButtonClicked=function(n,t,i,r,u,o){var s,c,h;(n&&n.preventDefault(),s=this.getEntities(),c=s&&s.length&&s[0],c)&&(h=new hu(c,r,u,o==="Permalink"?o:"Local"),h&&(h.OpenDialog(),h.focusInput()),e.invokeHandler(f.instrumentationDataHandlerKey,t))},c.prototype._addAttractionButtonClicked=function(n,t){n&&n.preventDefault();var i=this.getEntities()[0],r=hi.getItineraryAddItemOptions(i.getTitle(),i.getLocation(),i.id,i.getImageUrl(),t,i.getSelectedCategoryForIcon(),i.interests,i.stayDuration);e.invokeHandler(f.taskProcessDataHandlerKey,r)},c.prototype._setPhotoStripWidth=function(n){var i,t,r,u;if(n.PhotostripItems&&n.PhotostripItems.length){for(this._photostripTotalWidth=0,i=n.PhotostripItems.length,t=0;t<i;t++)r=n.PhotostripItems[t],this._photostripTotalWidth+=r.IsPano?c._photoWidth*2:c._photoWidth;u=this.panelRoot.select("ul.photostrip");u.set_style({width:this._photostripTotalWidth+"px"})}},c.prototype._slidePhotstripLeft=function(n,t,i){if(t<0){var r=i*++t;n.set_style({left:r+"px"})}return t},c.prototype._slidePhotstripRight=function(n,t,i){var r,u,f;return t<=0&&(r=i*(t-1),this._photostripTotalWidth>Math.abs(r)&&(u=Math.floor(c._photostripVisibleWidth/c._photoWidth),f=(this._photostripTotalWidth-Math.abs(r))/c._photoWidth,f>u?n.set_style({left:r+"px"}):(r=r+(c._photostripVisibleWidth-(this._photostripTotalWidth-Math.abs(r))),n.set_style({left:r+"px"})),--t)),t},c.prototype._showImageInModalDialog=function(n){if(n){var t=c._imgModalDialogContentTemplate.replace("{imgSrc}",n.imgsrc).replace("{imgAttrb}",n.imgattrb).replace("{providerLink}",n.providerlink).replace("{providerLinkText}",n.providerlinktext),i=new eu(t,"bigImgDialog");i.OpenDialog()}},c.prototype._registerPhotostripEvents=function(){var n=this,i=this.panelRoot.select("ul.photostrip"),e=c._photoWidth*3,t=0,o=this.panelRoot.select("div.mapsPhotostrip .psnav.prev"),s=function(r){t=n._slidePhotstripLeft(i,t,e);r.preventDefault()},u,f,h;o.add_event("click",s);this._addEventsToEventList(o,"click",s);u=this.panelRoot.select("div.mapsPhotostrip .psnav.next");f=function(r){t=n._slidePhotstripRight(i,t,e);r.preventDefault()};u.add_event("click",f);this._addEventsToEventList(u,"click",f);h=i.select("a.thumb[data-imgsrc]");h.for_each(function(t){var i=r(t),f=r.Internals.parseJSON(i.get_attr("data-imgsrc")),u=function(t){n._showImageInModalDialog(f);t.preventDefault()};i.add_event("click",u);n._addEventsToEventList(i,"click",u)})},c.prototype._parseBoundingBox=function(n){var f=n.select("div[data-boundingbox]").get_attr("data-boundingbox"),i=f&&r.Internals.parseJSON(f),u,t;return i&&i.boundingBox&&i.boundingBox.length>1?(u=[],t=i.boundingBox[0],u.push(new p(t.latitude,t.longitude)),t=i.boundingBox[1],u.push(new p(t.latitude,t.longitude)),u):null},c.prototype._buildLogData=function(n,t){return{logData:{feature:nt.DetailsCard,action:n,data:t}}},c.prototype._logAction=function(n){var t={AN:n};this._logHelper&&this._logHelper.log(w.LDA,t)},c.prototype._loadJavaScriptInResponse=function(n){n.select("div[data-answerinfo]").length>0&&n.select("script").for_each(function(n){var i=n.textContent,t;c._detailsPageScripts[i]||(t=document.createElement("script"),t.type="text/javascript",t.textContent=i,document.head.appendChild(t),c._detailsPageScripts[i]=t)})},c.prototype._moduleHeaderClickHander=function(n){var t,i;n&&n[1]&&n[2]&&(t=n[1].nextElementSibling,t&&(i=_w.getComputedStyle(t,null).display==="none",t.style.display=i?"block":"none",Log.Log(i?"Show":"Hide","TaskPane",n[2],!1)))},c.prototype._searchLocatedAtHandler=function(n){if(n&&n[1]){var t={query:n[1],fullQuery:n[1],entryPoint:u.LocalDetails};e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:t,type:s.localSearchTask})}},c.prototype._toggleExpansion=function(n,t){var o=t?"id":"data-expe",i=n.get_attr(o),u,f,e,r;if(i.indexOf("txt")==0)i=i.substr(3);else if(i.lastIndexOf("_hit")==i.length-4)i=i.substr(0,i.length-4);else return;u=this.panelRoot.select("[data-exp=H;"+i+";;;;]");u&&(t?u.remove_class("b_hide"):u.add_class("b_hide"));f=this.panelRoot.select("[id=txt"+i+"]");f&&(t?f.add_class("b_hide"):f.remove_class("b_hide"));e=this.panelRoot.select("[id="+i+"_hit]");e&&(t?e.add_class("b_hide"):e.remove_class("b_hide"));r=this.panelRoot.select("[data-expid="+i+"]");r&&r.has_class("tp_collapsed")&&(t?r.remove_class("tp_collapsed"):r.add_class("tp_collapsed"))},c.prototype._getReservertionForm=function(n){for(var t=n.parent(),i=null,r=0;r<5;r++){if(t&&t[0]&&t[0].tagName=="FORM"){i=t;break}t=t.parent()}return i},c.prototype._addSuggestionsToNearbyModule=function(t){var u=this,p=this.getEntities(),w=p&&p[0],l=!0,i=o.prototype.parseSuggestionMetaData.call(this),s,y,r;i||(l=!1,i=this._searchNearbyDefaultCategories);s=[];i.forEach(function(n){s.push(n.Name)});var b=v.features,a=n.detailCardNearbyLabels,c=this.panelRoot.select("a[class=searchNearbySearchLink]");c&&c.length===1&&(y=function(n){return u._nearbySearchLinkClickHandler(n,t,s,i&&i.length?i[0].viewport:null)},c.add_event("click",y),this._addEventsToEventList(c,"click",y));r=this.panelRoot.select("ul[class=searchNearbyModule]");this.selectorReady().then(function(n){var c,o,v;r&&r.length===1&&(c=a?"searchNearbyModuleIcon searchNearbyWithLabels":"searchNearbyModuleIcon",r.set_attr("class",c),i.forEach(function(i){var f=u._drawCategoryItem(n,i,"SearchNearbySuggestionLink",function(n){return u._nearbySuggestionClickHandler(n,t,l,w,i.viewport)},a);f&&r.append(f)}),o=u.panelRoot.select("li.searchNearbySearchButton"),a&&o&&o.length===1&&(o.removeFromParent(),r.append(o)),v={logData:{feature:nt.NearbySearch,action:h.Activated,data:{CAT:s.join(","),DY:l}}},e&&e.invokeHandler(f.instrumentationDataHandlerKey,v))})},c.prototype._nearbySearchLinkClickHandler=function(i,r,o,s){var l=this._getMapBounds(s),a=this._buildLogData(h.Clicked,{AN:"SearchNearby",CP:r,EP:u.LocalDetails,DT:"SearchLink"});i&&i.preventDefault();e.invokeHandler(f.instrumentationDataHandlerKey,a);l||it.setMapCenter(this.map,r,n.searchNearbyDefaultZoomLevel);var c=this.getEntities()[0],v=c&&c.getTitle()||"",y=t.L_SearchNearbyGhostTextFormat.replace("{query}",v);this._taskBar&&this._taskBar.setSearchBoxGhostText(y);this._taskBar&&this._taskBar.setNearbyLocationTitle(c.getTitle());o&&this._taskBar.updateSearchBoxAutosuggestDefault(o,l)},c.prototype._nearbySuggestionClickHandler=function(i,r,o,c,l){var g=c&&c.getAddress(),nt=c&&c.getTitle()||g,a,y,b,k,p,w,d;if(i&&i.target){for(a=i.target;a.parentNode;){if(a.nodeName.toLowerCase()==="a")break;a=a.parentNode}if((i.stopPropagation(),i.preventDefault(),a)&&(y=a.title,y)){if(b=o?"SuggestionLinkDynamic.":"SuggestionLink.",k=this._buildLogData(h.Clicked,{AN:"SearchNearby",CP:r,EP:u.LocalDetails,DT:b+y}),e.invokeHandler(f.instrumentationDataHandlerKey,k),(!l||l.length<2)&&it.setMapCenter(this.map,r,n.searchNearbyDefaultZoomLevel),p={},p.entryPoint=u.LocalDetails,p.query=y,p.mapBounds=this._getMapBounds(l),w=v.features,y===t.L_SearchNearbyTerm_7&&w&&w.transit&&w.transit.isEnabled){d={location:r,title:nt,entryPoint:1};e.invokeHandler(f.taskDataHandlerKey,{state:d,type:s.nearbyTransitTask});return}e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:p,type:s.localSearchTask})}}},c.prototype._getMapBounds=function(n){if(n&&n.length>1&&!isNaN(n[0].latitude)&&!isNaN(n[0].longitude)&&!isNaN(n[1].latitude)&&!isNaN(n[1].longitude)){var t=[];return t.push(Math.max(n[0].latitude,n[1].latitude)),t.push(Math.min(n[0].longitude,n[1].longitude)),t.push(Math.min(n[0].latitude,n[1].latitude)),t.push(Math.max(n[0].longitude,n[1].longitude)),t}return null},c.prototype._setLocalCrowdSourcingTaskOptions=function(n){var f=this,e=this.getEntities(),i=e&&e[0],t={},h;t.entityName=i.getTitle();t.entityYpid=i.id;var r=null,u=null,o=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts"),s=this.panelRoot.select("div.overlay-taskpane").get_attr("data-ufacts");if(o){try{r=JSON.parse(o)}catch(c){}r&&(t.dataFacts=r)}if(s){try{u=JSON.parse(s)}catch(c){}u&&(t.userFacts=u)}t.query=i.getTitle();t.reportType=4;h=function(n){f._onLocalCrowdSourcingLinkClick(n,f._taskId,i.getTitle(),t)};n.href="#";n.onclick=h},c.prototype._onLocalCrowdSourcingLinkClick=function(n,i,r,u){n.preventDefault();e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,activateOptions:{parentId:i},state:{entryPoint:3,feedbackTaskType:7,title:t.L_RichAttributeFeedbackTitle,activeTaskId:i,options:u}})},c.prototype._setLocalFeedbackTaskOptions=function(n){var e=this,o=this.getEntities(),r=o&&o[0],i={},c;i.entityName=r.getTitle();i.entityYpid=r.id;var u=null,f=null,s=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts"),h=this.panelRoot.select("div.overlay-taskpane").get_attr("data-ufacts");if(s){try{u=JSON.parse(s)}catch(l){}u&&(i.dataFacts=u)}if(h){try{f=JSON.parse(h)}catch(l){}f&&(i.userFacts=f)}i.query=r.getTitle();i.reportType=4;c=function(n){e._onSuggestAnEditLinkClick(n,e._taskId,r.getTitle(),i)};n.text=t.L_Menu_SuggestAnEdit_Link_Text;n.href="#";n.onclick=c},c.prototype._onSuggestAnEditLinkClick=function(n,i,r,u){n.preventDefault();e.invokeHandler(f.taskDataHandlerKey,{type:s.feedbackTask,activateOptions:{parentId:i},state:{entryPoint:3,feedbackTaskType:4,title:t.L_Menu_SuggestAnEdit_Link_Text+r,activeTaskId:i,options:u}})},c.prototype._shouldEnableSuggestAnEdit=function(){var n=null,t=null,i=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts"),r,u;if(i)try{n=JSON.parse(i)}catch(f){}return(n&&n.languageCultureName&&(t=n.languageCultureName),r=ut.ftwMarkets,u=new RegExp(t,"i"),r.search(u)>=0)?!0:!1},c.prototype._placeAdsQuery=function(n){var i=2,t=-1;do t=n.indexOf(",",t+1);while(t>=0&&--i);return!i&&t>0&&(n=n.substring(0,t)),n},c.prototype._getAttribution=function(){var n=this.panelRoot.select("div[class*='b_footnote']");return n&&n.length>0?n[0].innerText:""},c.prototype._sendUpdateEntityProcessCall=function(n,t){var r,u,i;(this.savedEntityId||this.collectionId)&&(r={action:yt.UpdateEntity,data:{description:t,title:n},entityId:this.savedEntityId,collectionId:this.collectionId},i={type:s.collectionsTask,requestorType:"LocalDetailsTask",requestorId:this._taskId,requestState:r},e.invokeHandler(f.taskProcessDataHandlerKey,i));this.itineraryTaskId&&(u={action:4,itineraryItemChanged:{Description:t,Name:n,Id:this.itineraryEntityId}},i={type:s.itineraryDetailsTask,requestorType:"LocalDetailsTask",requestorId:this._taskId,requestState:u,taskId:this.itineraryTaskId},e.invokeHandler(f.taskProcessDataHandlerKey,i))},c.prototype._collectionClick=function(n,t,i,r,u){this._buttonGroupViewModel.entityDescription=this.annotationControl.getDescription();this.annotationControl.getCurrentName()!==this.annotationControl.getOriginalName()&&(this._buttonGroupViewModel.entityNickName=this.annotationControl.getCurrentName(),this._buttonGroupViewModel.entityOriginalName=this.annotationControl.getOriginalName());u?lt.isEditable?this._buttonGroupViewModel.saveWithTravelButtonClicked(n,t,i,r,!0):this._buttonGroupViewModel.collectionMenuButtonClicked(n,t,i,r):this._buttonGroupViewModel.collectionButtonClicked(n,t,i,r)},c._detailsPageScripts={},c._photostripVisibleWidth=310,c._photoWidth=82,c._imgModalDialogContentTemplate='<div class="bigImg"><p>{imgAttrb}<\/p><div><img src="{imgSrc}" /><\/div><p><a href="{providerLink}">{providerLinkText}<\/a><\/p><\/div>',c}(sr),at=function(o){function c(n,i,r,u,f,e,s){var h=this;return i&&i.add_class("bm_listings-container"),h=o.call(this,n,i,u,"a.listings-item","data-entity",e)||this,h._poiManager=f,h._taskId=r,h._controlTemplateFactory=s,h.resources=t,h.printTitleViewModel=null,h.printListingsViewModel=null,h._paginationImageDelayLoaded=!1,h.loadInfobox=new g,h}return a(c,o),c.prototype.getIsDetails=function(){return!1},c.prototype.getQuery=function(){return this._query},c.prototype.setQuery=function(n){this._query=n},c.prototype.setResponseContent=function(n,t){n&&(this._delayLoadListingImagesInPagination(n),o.prototype.setResponseContent.call(this,n,t),this.setQuery(t.query),o.prototype.addReportLinkToNoResultCard.call(this,n,this._taskId,t),this._dataCategory!="House"&&this._addReportMissingEntityLinkToLocalListing(n,this._taskId,t))},c.prototype._addReportMissingEntityLinkToLocalListing=function(n,t,i){var u=this,o;if(ut&&ut.showAddMissingBusinessLink){var f=this.panelRoot.select(".report-missing-business-link-container"),s=n.select("div[data-answerinfo]"),e=s.select(".query"),r=e.length>0?e[0].textContent:"";if(r=r||i&&i.query,o=this.getUserFacts(),f){var h={addMissingEntityLinkClicked:function(n){u.onAddMissingBusinessLinkClicked(n,u._taskId,r,r,o,4)}},c=this._controlTemplateFactory({templateText:wu,staticResources:h}),l=c.applyDataTemplate(this);f.append(l)}}},c.prototype.dispose=function(){o.prototype.dispose.call(this);this._hoverPoi=null},c.prototype.registerListItemEvents=function(){var n=this,i=this.panelRoot.select("a[data-entity]"),t=this.getPushpinPrimitives();i.for_each(function(i){var v=i.getAttribute("data-entity"),y=r.Internals.parseJSON(v),h=y.entity,u,c,f,e,s;if(h){for(c=t.length,f=0;f<c;f++)if(t[f].entity.id===h.id){u=t[f];break}var o=r(i),l=function(t){return n._processMouseOver(h.id,u,t)},a=function(){return n._processMouseOut(u)};o.add_event("mouseover",l).add_event("mouseleave",a);n._addEventsToEventList(o,"mouseover",l);n._addEventsToEventList(o,"mouseleave",a);u&&(e=u.entity,e&&e.renderBranded&&e.getBrand&&(s=e.getBrand(),s&&s.length&&o.add_class("brandedListing brand_"+s)))}})},c.prototype.processDirectionsData=function(n){n&&n.inData&&n.inData.requestorState&&this._transientLensViewModel.processDirectionsData(n)},c.prototype.processCollectionsData=function(n){this._transientLensViewModel.processCollectionsData(n)},c.prototype.processTravelData=function(n){this._transientLensViewModel.processTravelData(n)},c.prototype.getListingsHtmlContentForPrint=function(n){var t=this,i,u,r;return this.printTitleViewModel=this,this.printListingsViewModel=new pr(this.map,this._controlTemplateFactory,this.getPushpinPrimitives(),n,this.panelRoot),i={boolToDisplay:function(n){return t.boolToDisplay(n)},nullToDisplayNone:function(n){return t.nullToDisplayNone(n)},hideMatchedData:function(n){return t.hideIfMatchedData(n)},chooseIconSource:function(n){return t.chooseIconSource(n)}},this.titlePrintTemplate=new gt(pu,i),this.listingsPrintTemplate=new gt(yu,i),u=this._controlTemplateFactory({templateText:ir,staticResources:i}),r=u.applyDataTemplate(this),r.length>0?r[0].outerHTML:""},c.prototype.chooseIconSource=function(n){var t="";return n&&(n===1&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAMAAAAm/38fAAAAQlBMVEVHcEyqKY+qKY+qKY+qKY+qKY+qKY+qKY+qKY+qKY+qKY////+qKY+wOJfKebncptHBZK7v1+r68vj05PHoxeHVlMftKC+aAAAAC3RSTlMAeN9JrzDvxRRgj9SxIBcAAAC1SURBVCjPfZHtEoUQFEV9lWQfJN7/Va+kJszc9XOvHNqHscbCldaKL6xHCjSE/MSbAsj5lLwjQG1vroEcbSVmQD9Ggw77chD0nfMur4bXQSu87fBYr2EGZAcIpgg1HriOqCIEjlEkiCIAOwH8F3HMzyo00nzH9Ys73Cgc9qtv4JwmLXdVoRehlVU6cf2gtdVrgPC+LAbUQh5DuV50Zvrk5QFlVaAQSgrdr92oe+XKsIlFys/HP2FZEe+D6e0PAAAAAElFTkSuQmCC"),n===2&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAXCAMAAADX9CSSAAAARVBMVEVHcEwAqrAAqrAAqrAAqrAAqrAAqrAAqrAAqrAAqrAAqrAAqrD///8UsbZiy88wur+/6uuA1dhDwMXX8vOv5Obv+vqf3+G0rBkKAAAAC3RSTlMAz6cnXOSPEIBAvytHJ6oAAAC3SURBVCjPdZHZDoQgDEVRdi+7Ov//qVPFUZDMeSE5N2lpy1hFC7UsixKategZP+YmERKIOaWUIyDFrckmV0mUXIEFgnsIgD1ry04fgTx6GPi987uHIS/xcT0fSMY4vHvjwekzZfCFvmSQB5+pwX8fBh/IW8TBR5pMA+tLrwANNg+FAua6ntTpdC1IwbeVVg9VjzLBb7fePKbrNBSg1GQruPW5UyKWeDymPTBX8ryuVJy90Nbap8IXq9AS1imhErwAAAAASUVORK5CYII="),n===3&&(t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAXCAMAAAAm/38fAAAAS1BMVEVHcEwAggAAggAAggAAggAAggAAggAAggAAggAAggAAggAAggD///8AggASixJgsWDP6M/v9+/f79+PyI+AwYCn1KdAoUC/4L9QqVBjJUhMAAAADHRSTlMAz4dJMK8QYL/oIHAyg2hSAAAAuUlEQVQoz32RWxKEIAwEFYyAMkEU1PufdBEfJVi1/TktESZNc9EJ0ppE15RIgwsjX3FPALu4bdExQP2Tt0DwNuMD0N5Ggyf7MDH0mY9Fns2YBxkstmCBOYYpsK1gqCSoPnAcoSQMplpsMEkA9gPwX/g6n7PQiLWI+YkCrhYO4ugbmD+TurOqtRTrVdZgymEOZjhbVMD+3MzvyIXchkP+0Rz4lacLpFWB1zWlaMu1KzpXTqr50En5+vgHNJ4TbfTHZhoAAAAASUVORK5CYII=")),t},c.prototype._parseCategoryData=function(n){var i,t=n.select("div[data-category]");t&&t.length===1&&(i=t.get_attr("data-category"));this.populateCardCategoryId(i)},c.prototype._processMouseOver=function(t,i){var u,r,f;n.enableInfoBox&&(u=i?i.viewState:null,i&&(u!==1&&u!==3&&(r=i,this.loadDelayedListingImagesInPagination(),r.viewState=1,r.zIndex=2,this._hoverPoi=r,r.entity.changed.invoke({sender:r.entity}),sj_evt&&sj_evt.fire("pushpinhoverstarted",i)),f=et.mapsInfobox,f&&f.getOptions()&&f.getOptions().visible!==!1||u!==1&&u!==0||this.loadInfobox.invoke(i)))},c.prototype._processMouseOut=function(n){var i=n?n.viewState:null,t=this._hoverPoi;n&&t&&(n===t&&sj_evt&&sj_evt.fire("pushpinhoverstopped",n),i!==3&&(t.viewState=0,t.zIndex=0,t.entity.changed.invoke({sender:t.entity}),this._hoverPoi=null));et.mapsInfobox&&et.mapsInfobox.setOptions({visible:!1})},c.prototype._buildLogData=function(n,t){return{logData:{feature:nt.ListingCard,action:n,data:t}}},c.prototype.processSearchMapviewButtons=function(){var s=this,n=this.panelRoot.select("div[class=searchSuggestionModule]"),u,t,r;n&&n.length==1&&(u=o.prototype.parseSuggestionMetaData.call(this),u&&u.length!==0)&&(n[0].style.display="block",t=i._createElement("ul"),t.set_attr("class","searchSuggestionModule"),n.append(t),this.selectorReady().then(function(n){var i,r;t.set_attr("class","searchSuggestionModuleIcon");i=[];u.forEach(function(r){var u=s._drawCategoryItem(n,r,"searchSuggestionLink",function(n){return s._mapviewSuggestionClickHandler(n)});i.push(r.Name);u&&t.append(u)});r={logData:{feature:nt.RecommendedSearch,action:h.Activated,data:{CAT:i.join(",")}}};e&&e.invokeHandler(f.instrumentationDataHandlerKey,r)}),n.removeFromParent(),r=this.panelRoot.select("div.recommendedSearchContainer"),r&&(r.getParent().insertBefore(n,r),r.removeFromParent()))},c.prototype._mapviewSuggestionClickHandler=function(n){var t,i,o,r;if(n&&n.target){for(t=n.target;t.parentNode;){if(t.nodeName.toLowerCase()==="a")break;t=t.parentNode}(n&&n.preventDefault(),t)&&(i=t.title,i)&&(o=this._buildLogData(h.Clicked,{AN:"SearchSuggestion",EP:u.LocalListing,DT:"SuggestionLinkDynamic."+i}),e.invokeHandler(f.instrumentationDataHandlerKey,o),r={},r.entryPoint=u.LocalListing,r.query=i,e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:r,type:s.localSearchTask}))}},c.prototype.updateAdvertising=function(t,i){var o,s,r,u,f,e;if(ft.isEnabled())try{o=n.listingMaxAdCount;o&&(n.isRenderAdsAtServer?(s=this.panelRoot.select("div.syndicatedAds"),gi.setShownAds(b.LI,s)):(r=this.panelRoot&&this.panelRoot.select("div.adsContainer"),r&&r.length&&this.map&&(u=this.getEntities(),u&&u.length&&(n.adsFromWorkflow?(f=this.panelRoot.select("div.overlay-container"),f&&f.length&&(e=f[0].getAttribute("data-ads"),e&&e.length&&(this._ads||(this._ads=new ft(this._controlTemplateFactory,b.LI)),this._ads.setScenario(b.LI,"w"),this._ads.setAds(e)))):this._ads||(this._ads=new ft(this._controlTemplateFactory,b.LI),this._ads.requestAds(i.query,u[0].getLocation().clone(),o,this._taskId)),this._ads&&(r.getParent().insertBefore(this._ads.getControl(),r),r.removeFromParent())))))}catch(h){ft.logError(h)}},c.prototype.processPoiPagination=function(n,t){var y=this,e=this.panelRoot.select("div.entity-listing-container ul"),f,r,u,s;if(e&&e.length===1&&(f=e.select("li"),this._shouldPaginate(f))){var h=this._isPricePoiPagination(),o=Math.floor(f.length/c._paginationItemsPerPage)+(f.length%c._paginationItemsPerPage>0?1:0),l=i._createElement("div"),a=i._createElement("ul"),v=[];for(this._paginationCurrentPage=1,l.set_attr("class","bm_paginationModule"),r=0;r<=o+1;r++)u=i._createElement("a"),v.push(u),u.set_attr("href","#"),u.set_attr("data-pageNumber",r.toString()),r===0?u.set_attr("class",c._noDisplayClassName):r===o+1?u.set_attr("class","bm_rightArrow"):u.set_text(r.toString()),r===1&&u.set_attr("class","bm_active"),u.add_event("click",function(n){y._paginationHandler(n,v,o,f,t,h)}),s=i._createElement("li"),s.append(u),r>c._paginationVisiblePageButtons&&r<o+1&&s.set_attr("class",c._noDisplayClassName),a.append(s);l.append(a);e.getParent().append(l);this._paginationSetDisplayForItems(f,1,!0,t,h);n.disableListingRefresh=h?!1:!0;this._paginationListingItems=f}},c.prototype.setIconOnlyLimitBySegmentTypeOrCategoryId=function(){var e,t,r,i,u,f;if(n&&n.iconOnlyLimitBySegmentTypeOrCategoryId){if(e=this._getDataCategory(),!e)return;if(t=e.split("."),r=Object.keys(n.iconOnlyLimitBySegmentTypeOrCategoryId),r&&r.length&&t&&t.length)for(i=0;i<t.length;i++)if(u=t[i]&&t[i].toLowerCase(),u&&r.indexOf(u)>-1&&(f=n.iconOnlyLimitBySegmentTypeOrCategoryId[u],f&&!isNaN(parseFloat(f)))){this._poiManager.iconOnlyLimit=parseFloat(f);break}}},c.prototype.enableServerPagination=function(t,i,r){var h=n.categoriesWithServerPagination,p,e,l,u,o,a,s;if(!h||h.length<1)return!1;var v=!1,y=this._getDataCategory(),f=y&&y.split(".");if(f&&f.length)for(p=f.length,e=0;e<p;++e)if(l=f[e].toLowerCase(),l&&h.indexOf(l)>-1){v=!0;break}return v?(u=this.panelRoot.select("div.entity-listing-container ul"),!u||u.length!==1)?!1:this._serverPaginationControl&&!(i&&i.mapPannedOrZooomed)?(u.getParent().append(this._serverPaginationControl),!0):(o=u.select("li"),!o||!this._pushpins||o.length<c._paginationItemsPerPage||o.length!==this._pushpins.length)?!1:(a=new wr(this._controlTemplateFactory,c._paginationItemsPerPage,t,r),s=a&&a.getControl(),!s)?!1:(this._serverPaginationControl=s,u.getParent().append(s),!0):!1},c.prototype.resetServerPagination=function(){this._serverPaginationControl=null},c.prototype._getDataCategory=function(){if(!this._dataCategory&&this.panelRoot){var n=this.panelRoot.select("div[data-category]");n&&n.length&&(this._dataCategory=n.get_attr("data-category"))}return this._dataCategory},c.prototype._isPricePoiPagination=function(){var r,e,s,t,f;if(n.poiCountOverrideByCategoryId){for(r=!1,e=this._pushpins.length,t=0;t<e;++t)if(this._pushpins[t]&&this._pushpins[t].entity&&this._pushpins[t].entity.usePricePoi){r=!0;break}if(r){var o=this._getDataCategory(),i=o&&o.split("."),u=Object.keys(n.poiCountOverrideByCategoryId);if(u&&u.length&&i&&i.length)for(s=i.length,t=0;t<s;++t)if(f=i[t]&&i[t].toLowerCase(),f&&u.indexOf(f)>-1)return!0}}return!1},c.prototype._delayLoadListingImagesInPagination=function(t){var u,i,f,r,e,o,s;if(n.enablePoiPagination&&(u=t.select("div.entity-listing-container ul"),u&&u.length===1)&&(i=u.select("li"),i&&!(i.length<=c._paginationItemsPerPage))){for(f=c._paginationItemsPerPage;f<i.length;f++)if(r=i[f].getElementsByTagName("img"),r&&r.length)for(e=0;e<r.length;e++)o=r[e],s=o.getAttribute("src"),s&&(o.setAttribute("data-delayedsrc",s),o.setAttribute("src",""));this._paginationImageDelayLoaded=!0}},c.prototype.loadDelayedListingImagesInPagination=function(){var n=this._paginationListingItems,i,t,r,u,f;if(this._paginationImageDelayLoaded&&n&&n.length&&n.length>c._paginationItemsPerPage)for(this._paginationImageDelayLoaded=!1,i=c._paginationItemsPerPage;i<n.length;i++)if(t=n[i].getElementsByTagName("img"),t&&t.length)for(r=0;r<t.length;r++)u=t[r],f=u.getAttribute("data-delayedsrc"),f&&(u.setAttribute("src",f),u.setAttribute("data-delayedsrc",""))},c.prototype._paginationSetDisplayForItems=function(n,t,i,r,u){var f,e;if(n&&this._pushpins&&!(n.length<=c._paginationItemsPerPage)&&n.length===this._pushpins.length){if(i&&t===1)for(f=0;f<n.length;f++)f>=c._paginationItemsPerPage&&(n[f].style.display="none"),u?this._pushpins[f].zIndex=f<c._paginationItemsPerPage?1:0:f>=c._paginationItemsPerPage?(this._pushpins[f].entity.isPaginationReducedPoi=!0,this._pushpins[f].zIndex=0):this._pushpins[f].zIndex=1;else for(this.loadDelayedListingImagesInPagination(),f=0;f<n.length;f++)e=Math.floor(f/c._paginationItemsPerPage)+1===t,n[f].style.display=e?"list-item":"none",u||(this._pushpins[f].entity.isPaginationReducedPoi=!e),this._pushpins[f].zIndex=e?1:0;this._poiManager.setPrimitives(this._pushpins,!1);r&&r()}},c.prototype._paginationHandler=function(n,t,i,r,u,f){var s,e,o;if(n&&n.preventDefault(),!(t.length<i+2)){if(n&&n.target&&(s=n.target.getAttribute("data-pageNumber"),s)){if(e=parseFloat(s),isNaN(e))return;if(e<1){if(this._paginationCurrentPage<=1)return;this._paginationCurrentPage-=1}else if(e>i){if(this._paginationCurrentPage>=i)return;this._paginationCurrentPage+=1}else{if(this._paginationCurrentPage===e)return;this._paginationCurrentPage=e}for(this._paginationSetDisplayForItems(r,this._paginationCurrentPage,!1,u,f),o=1;o<=i;o++)o<t.length&&t[o].set_attr("class",o===this._paginationCurrentPage?"bm_active":"");this._paginationCurrentPage<=1?t[0].set_attr("class",c._noDisplayClassName):t[0].set_attr("class","bm_leftArrow");this._paginationCurrentPage>=i?t[t.length-1].set_attr("class",c._noDisplayClassName):t[t.length-1].set_attr("class","bm_rightArrow");i>c._paginationVisiblePageButtons&&(this._paginationCurrentPage-1>0&&t[this._paginationCurrentPage-1].getParent().get_attr("class").indexOf(c._noDisplayClassName)>-1?(t[this._paginationCurrentPage-1].getParent().set_attr("class",""),this._paginationCurrentPage+c._paginationVisiblePageButtons-2<t.length&&t[this._paginationCurrentPage+c._paginationVisiblePageButtons-1].getParent().set_attr("class",c._noDisplayClassName)):this._paginationCurrentPage+2<t.length&&t[this._paginationCurrentPage+1].getParent().get_attr("class").indexOf(c._noDisplayClassName)>-1&&(t[this._paginationCurrentPage+1].getParent().set_attr("class",""),this._paginationCurrentPage-c._paginationVisiblePageButtons+1>0&&t[this._paginationCurrentPage-c._paginationVisiblePageButtons+1].getParent().set_attr("class",c._noDisplayClassName)))}u&&u()}},c.prototype._shouldPaginate=function(n){return!n||!this._pushpins||n.length<=c._paginationItemsPerPage||n.length!==this._pushpins.length?!1:!0},c._paginationItemsPerPage=20,c._paginationVisiblePageButtons=9,c._noDisplayClassName="bm_noDisplay",c}(sr),y=function(o){function h(n,t,i,r,u){var f=o.call(this,t)||this,e;return f.map=n,f._trafficLayer=u,f._count=20,f._offset=0,f.pageProcessor=i,f.map=n,f.type="LocalSearch",f.mapsInfoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},f._logHelper=new or(f.perfLog),f.setPercentLoaded(0),r&&(f._transientLensViewModel=r,f.disposables.push(f._transientLensViewModel.invalidateLayer.add(function(){return f.concatOverlayPrimitive()}))),h._overlayCloseBtnListenerAdded||(e=Microsoft.Maps.Internal._Gimme&&Microsoft.Maps.Internal._Gimme(".overlayCloseBtn")[0],e&&e.addEventListener&&(h._overlayCloseBtnListenerAdded=!0,e.addEventListener("click",function(){h._useBfpr=!1}))),v.dynamicProperties.totalRequestsFromOverlay=v.dynamicProperties.totalRequestsFromOverlay||0,f}return a(h,o),h.prototype.activate=function(n,t){o.prototype.activate.call(this,n,t);this.poiManager.disableComputingMapViewForFirstTimeLoad=t.disableComputingMapViewForLoadingOnly;this._taskState=t;this._transientLensViewModel.setOptions({requestorId:this.id,requestorType:this.type});this._taskState&&this._taskState.content&&this.processResponse(this._taskState.content);this.getTitle()&&(this._initialTitle=this.getTitle(),t.directionsTaskId&&this._updateTitle())},h.prototype.deactivate=function(){if(h.mapsInfobox&&(h.mapsInfobox.setOptions({visible:!1}),h.mapsInfobox.preventAutoClose=!1),this.isSearchAlongRouteEnabled())this.disableSearchAlongRoute(!0,!1);this.viewModel&&this.viewModel.landMarkFilterRule&&this.map.getLandmarksManager().then(function(n){n.resetDataSource()});o.prototype.deactivate.call(this);this.viewModel.dispose()},h.prototype.setDisplayState=function(n){var t=this;o.prototype.setDisplayState.call(this,n);n.activationState&1&&this.viewModel&&this.viewModel.landMarkFilterRule&&this.map.getLandmarksManager().then(function(n){n.applyFilterOnDataSource(t.viewModel.landMarkFilterRule)});n.activationState&1&&n.prominence&1&&h._removeCardPrimer(this.map)},h.prototype.process=function(t,r){var u=t&&t.requestState,o,s,l;if(u){if(h._useBfpr&&(u.useBfpr=!0,this._taskState&&!this._taskState.useBfpr&&(this._taskState.useBfpr=!0)),u.action==0){this._taskState&&(this._taskState.keyRoutePoints=u.keyRoutePoints,this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>=2&&this._updateRoutePoints(this._getPointsString(this._taskState.keyRoutePoints)),(this.displayState&&this.displayState.activationState!==3||u&&u.cause!==1)&&this.poiManager.suppressViewChangeOnRefreshOnce(),this._refreshWithDelay({appliedFilterOption:new st(u.directionsTaskId,"",null,!0)}));return}if(u.action==1){o=!1;this._updateRoutePoints(null);this.disableSearchAlongRoute(o);this._refreshWithDelay();return}if(u.searchEntitiesRequested)this.viewModel&&r&&r({processorId:this.id,data:this.viewModel.getEntities()});else if(u.trackingDataRequested)this.viewModel&&r&&r({processorId:this.id,data:{ImpressionGuid:this._getImpressionGuid(),TraceId:this._getTraceId()}});else if(this._taskState=u,this._taskState.query&&(this._taskState.query=this._taskState.query.trim()),!this._taskState.query&&this._taskState.category&&(this._taskState.query=""),this._taskState.query||this._taskState.id||this._taskState.category){s=this._taskState.id?d.ID:d.SB;this._searchPerfState=this._logHelper.perfStart(s);var e=this._createUrl(),f=this._taskState.passThruParam,c=n.formCodeMonitr;(!i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&c&&f&&f.toUpperCase().indexOf(c)===-1||f&&f.toLowerCase().indexOf("lemodule")>-1)&&(e+=f.indexOf("&")!==0?"&"+f:f);this._sendSearchRequest(e,t,r);l={Q:this._taskState.query?this._taskState.query:"",URL:e};this._logHelper&&this._logHelper.log(w.LSR,l)}}},h.prototype.processCallback=function(n){var t,i,r;n&&n.inData&&n.processorType&&n.outData&&(n.processorType===s.directionsTask?this.viewModel.processDirectionsData(n):n.processorType===s.collectionsTask?(t=n.inData.requestState,t&&t.action===yt.UpdateEntity&&t.data&&t.data.title&&this.type!==s.localListingTask&&(i=t.data.title,this.setTitle(i),r=this.viewModel,r.updatePoiTitle(i),r.resetPrimitives(this.poiManager),r.annotationControl.setCurrentName(i)),this.viewModel.processCollectionsData(n)):n.processorType===s.itineraryDetailsTask&&this.viewModel.processTravelData(n))},h.prototype.serialize=function(n){var i,t;if(this._taskState&&(this._taskState.content=null,this._taskState.taskTitle||(this._taskState.taskTitle=this.getTitle()),this._taskState.primerPois=null,this._taskState.primerRequestUrl=null,this._taskState.primerParseSelector=null),n&&(this._reduceLatLonPrecisions(),this._taskState.shareDescription=this.getShareDescription(),this._taskState.fromSharing=!0,this.displayState.prominence===1))return this._buildTaskStateWithPrimerPois();if(this._taskState&&this._taskState.originalResponse){i={};for(t in this._taskState)t&&t.indexOf("originalResponse")<0&&this._taskState.hasOwnProperty(t)&&(i[t]=this._taskState[t]);return i}return this._taskState},h.prototype.getShareDescription=function(){return""},h.prototype.getCardIconInfo=function(){return{iconClass:"srcTsk",iconElements:this.getCardIcons(this.viewModel.getCardCategoryId())}},h.prototype._refreshWithDelay=function(n){var t=this;ct.abortRequest(this._outstandingRefreshReqId);window.clearTimeout(this._resultsReqTimeoutHandler);this._resultsReqTimeoutHandler=Microsoft.Maps.setTimeout(function(){t._refresh(n)},su.refreshTimeout)},h.prototype._refresh=function(n){var t=this,r,u,f,e;this._taskState.mapBounds=this._getLocalMapViewBounds();this._taskState.primerPois=null;r=this._createUrl(n);r&&(this.setPercentLoaded(0),u=this._taskState&&this._taskState.id?d.ID:d.SB,n||(n={}),n.perfState=this._logHelper.perfStart(u),f=function(r){t._showOrHideWaitLayer(!1);try{n.perfState.end("NT");var u=t._convertToResponseObject(r),f=k.getEntitiesFromResponse(u,t._taskState);t._shouldProcessResponseOnRefresh(f,n)&&(t.processResponse(u,n),t._logActivated(w.LLR),t._logInstrumentationForRequery(),t.displayState&&t.displayState.prominence===1&&i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("SearchResponseReceived",{IG:ot.getImpressionGuid(t.viewModel.panelRoot),primitives:t.viewModel.getPushpinPrimitives()}))}finally{t._postRefresh()}},this._showOrHideWaitLayer(!0),e=function(){t._showOrHideWaitLayer(!1);t._postRefresh()},this._outstandingRefreshReqId=ct.downloadGeneric(r,"srchrefresh",f,null,e,null,0))},h.prototype.getIconColorAndClassName=function(n){var t=this,i;if(this._taskState.cardBackgroundData){n(this._taskState.cardBackgroundData.cardBackgroundColor,this._taskState.cardBackgroundData.cardClassName);return}i=this.viewModel.categoryFound;typeof i=="undefined"?n(null,null):i?this._buildCardIcon(null,this.viewModel.getCardCategoryId(),function(i){i&&t.poiManager&&t.poiManager.setIconColorFromCard&&t.poiManager.setIconColorFromCard(i);t._taskState.cardBackgroundData={cardBackgroundColor:i,cardClassName:"catid_"+t.viewModel.getCardCategoryId()};n(t._taskState.cardBackgroundData.cardBackgroundColor,t._taskState.cardBackgroundData.cardClassName)}):n("#F7630C","catid_noCategory")},h.prototype.activateInfobox=function(t,i,u,f){var e=this,o=t.entity;u&&r.Browser.is_ie&&r.Browser.ie_version<12||f?h.mouseoverTimeout=0:u||h.mouseoverTimeout!==0||(h.mouseoverTimeout=500);window.clearTimeout(h.mouseoverDelayHandle);h.mouseoverDelayHandle=window.setTimeout(function(){var s,c,l,f,r;if((!h.mapsInfobox||!h.mapsInfobox.preventAutoClose)&&o&&(o.infoboxHtml&&o.infoboxHtml.length>0||i&&i.length>0)){if(s=new Microsoft.Maps.Location(t.geometry.y,t.geometry.x),e.mapsInfoboxOptions.htmlContent=i?i:o.infoboxHtml,e.mapsInfoboxOptions.location=s,c=u?new Microsoft.Maps.Point(4,4):new Microsoft.Maps.Point(10,10),e._taskState.scenarioKey){for(f=Object.keys(n.scenarioKeys),r=0;r<f.length;r++)if(n.scenarioKeys[f[r]]===e._taskState.scenarioKey){l=f[r];break}l&&n.singleEntityScenarios.indexOf(l)>=0&&(c=new Microsoft.Maps.Point(10,14))}e.mapsInfoboxOptions.offset=c;h.mapsInfobox?h.mapsInfobox.setOptions(e.mapsInfoboxOptions):(h.mapsInfobox=new Microsoft.Maps.MapsInfobox(s,e.mapsInfoboxOptions),h.mapsInfobox.setMap(e.map))}},h.mouseoverTimeout)},h.prototype._showOrHideWaitLayer=function(n){var t=this;n?this.displayState&&this.displayState.prominence===1&&this.displayState.activationState===1&&(this._waitlayerId=Microsoft.Maps.setTimeout(function(){t._showOrHideWaitLayer(!1)},3e3),r(".MicrosoftMap .bm_waitlayer").set_style({display:"block"})):(clearTimeout(this._waitlayerId),r(".MicrosoftMap .bm_waitlayer").set_style({display:"none"}))},h.prototype._shouldProcessResponseOnRefresh=function(n){return n&&n.length>0},h.prototype._shouldSuppressMapViewChangeOnRefresh=function(n){return n?n.mapPannedOrZooomed||n.isPaginated:!1},h.prototype._onPrimitivesChanged=function(n){var t=this._currentRefreshContext?this._shouldSuppressMapViewChangeOnRefresh(this._currentRefreshContext):!1;this._currentRefreshContext=undefined;this.poiManager&&this.poiManager.setPrimitives(n,t)},h.prototype._postRefresh=function(){},h.prototype._getTaskState=function(){return this._taskState},h.prototype._logInstrumentationEventForEntityClick=function(){var r=n.sendMoreInstrumentationForOverlay||this._taskState.sendInstrumentationEventOnEntityClick,i=v.dynamicProperties.serpIG,t;r&&i&&(t=Microsoft.Maps.logger,t&&t.logObject({T:"CI.OverlayEntClick",feature:"LocalOverlay",action:"CI.OverlayEntClick",data:{}},i,!1))},h.prototype._logInstrumentationForRequery=function(){var i=v.dynamicProperties.serpIG,t;n.sendMoreInstrumentationForOverlay&&i&&(t=Microsoft.Maps.logger,t&&t.logObject({T:"CI.OverlayRequery",feature:"LocalOverlay",action:"CI.OverlayRequery",data:{}},i,!1))},h.prototype._logInstrumentationForScroll=function(){var t=v.dynamicProperties.serpIG;n.sendMoreInstrumentationForOverlay&&t&&(h._scrollTimeoutHandle&&window.clearTimeout(h._scrollTimeoutHandle),h._scrollTimeoutHandle=window.setTimeout(function(){var n=Microsoft.Maps.logger;n&&n.logObject({T:"CI.OverlayListingScroll",feature:"LocalOverlay",action:"CI.OverlayListingScroll",data:{}},t,!1)},500))},h.prototype.processResponse=function(n,t){var i,r,u;this._taskState.impressionGuid=this._getImpressionGuid();this.viewModel.setResponseContent(n,this._getTaskState());i=this.viewModel.panelRoot.select("div[data-mapcardwidth]");r=i&&i.length&&i[0].getAttribute("data-mapcardwidth");r&&(u=parseInt(r),this.setRecommendedWidth(u),this.setCurrentWidth(u));this.setTaskComplete(t)},h.prototype.setTaskComplete=function(n){this.setPercentLoaded(1);this._taskState.mapBounds=this._getLocalMapViewBounds();this.serializableObjectChanged.invoke({magnitude:0});var t=this.viewModel.getPushpinPrimitives();t&&(this._currentRefreshContext=n,this.setMapPrimitives(t));h._removePoiPrimerLayer(this.map)},h.prototype._logActivated=function(n){var c=this._taskState.fullQuery||this._taskState.query,f=c||this._taskState.id,u,i,e,o,r,s,h;f||(f="");var l=n===w.LLR?"":this._taskState.entryPoint||"",a=this._taskState.scenarioKey||"",t={EP:l,Q:f,BB:this._tryGetBounds(),SNRO:a,SIG:this._getImpressionGuid(),TRACE:this._getTraceId()};t&&t.SNRO&&t.SNRO.indexOf("ERR")!==-1&&(t.AAP=this._getAnswerPicked());n===w.LDT&&(u=this.viewModel&&this.viewModel.getEntities&&this.viewModel.getEntities(),i=u&&u.length&&u[0],t.LT=i&&i.getLocationType?i.getLocationType():"",t.SGMT=i&&i.getSegmentTypes?i.getSegmentTypes():null,e=i.getPrimaryCategoryPath&&i.getPrimaryCategoryPath(),e&&(t.CAT=e),o=this._taskState.adsLog,o&&(t.AD=o));r=this._taskState.keyRoutePoints;r&&r.length>=2&&(s=r[0],h=r[r.length-1],t.AL=!0,t.ST=[s.latitude,s.longitude],t.EN=[h.latitude,h.longitude]);n===w.LLT&&(t.CT=this._getListingContentType());this._logHelper.log(n,t,t.SIG)},h.prototype._getLocalMapViewBounds=function(){var t=it.getMapBounds(this.map,!0),n=[];return n.push(t.getNorth()),n.push(t.getWest()),n.push(t.getSouth()),n.push(t.getEast()),n},h.prototype._getListingContentType=function(){var t=this.panelRoot.select("div.overlay-listings").get_attr("data-listingMetadata"),n;if(t)try{if(n=JSON.parse(t),n)return n.ContentType}catch(i){}return""},h.prototype._getTotalResultCount=function(n){var t,i,r;if(!n)return 0;if(t=n.select("div.overlay-listings").get_attr("data-listingMetadata"),t)try{if(i=JSON.parse(t),i)return r=i.TotalCount,parseInt(r)}catch(u){}return 0},h.prototype._getImpressionGuid=function(){return ot.getImpressionGuid(this.panelRoot)},h.prototype._getTraceId=function(){var n=this.panelRoot.select("div[data-traceid]"),t;return n&&n.length===1&&(t=n[0].getAttribute("data-traceid"),t)?t:""},h.prototype._contextMenuInvoked=function(n){n?(this._contextMenuPrimitive=n.primitive,this._contextMenuPrimitive&&(this._contextMenuPrimitive.viewState=0),this._contextMenuPrimitiveBucket=n.primitive.bucket,this._contextMenuPrimitiveViewState=this._contextMenuPrimitive.viewState,this.poiManager.suppressViewChangeOnRefreshOnce(),this._transientLensViewModel.show(n)):(this.poiManager.suppressViewChangeOnRefreshOnce(),this._transientLensViewModel.hide())},h.prototype._onPoiViewStateChanged=function(){},h.prototype.registerViewModelEvents=function(){var n=this;this.disposables.push(this.viewModel.changed.add(function(){n.viewModel.getCardCategoryId()&&n.changed.invoke({name:"iconClass"})}));this.disposables.push(this.viewModel.catIdPopulated.add(function(){n.changed.invoke({name:"catId"})}))},h.prototype.updateMapBounds=function(n){var t=this;this.disposables.push(this.map.getFrameManager().frameRendered.addOne(function(){pi.areEqual(t.map.getView(),n)&&(t._taskState.mapBounds=t._getLocalMapViewBounds(),t.serializableObjectChanged.invoke({magnitude:0}))}))},h.prototype.concatOverlayPrimitive=function(){var n=this._transientLensViewModel.getPrimitive();n?this.showOverlayPrimitive(n):this.hideOverlayPrimitive()},h.prototype.showOverlayPrimitive=function(n){this._contextMenuPrimitive.bucket&&delete this._contextMenuPrimitive.bucket;this._contextMenuPrimitive.viewState=3;this._contextMenuPrimitive.entity.changed&&this._contextMenuPrimitive.entity.changed.invoke();n.viewState=3;var t=this.viewModel.getPushpinPrimitives();this.setMapPrimitives(t.concat(n))},h.prototype.hideOverlayPrimitive=function(){this._contextMenuPrimitive&&(this._contextMenuPrimitiveBucket&&(this._contextMenuPrimitive.bucket=this._contextMenuPrimitiveBucket),this._contextMenuPrimitive.viewState=this._contextMenuPrimitiveViewState,this._contextMenuPrimitive.entity.changed&&this._contextMenuPrimitive.entity.changed.invoke(),this._onPoiViewStateChanged({primitive:this._contextMenuPrimitive,oldValue:3,newValue:this._contextMenuPrimitiveViewState}));var n=this.viewModel.getPushpinPrimitives();this.setMapPrimitives(n)},h.prototype._tryGetBounds=function(){try{return it.getMapBounds(this.map).bounds}catch(n){return[]}},h.prototype._createUrl=function(t,r,f){var e,ht,a,o,c,s,w,g,b,y,nt,tt,rt,ct,ut,lt,k,l,et,at,vt,p,ot,d,st;return this._taskState&&(e=this._getRequestUrlFormat().replace("{mkt}",v.dynamicProperties.market).replace("{appid}",v.dynamicProperties.appId),a=this._getLocationInfo(),i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&(this._taskState.fullQuery=this._taskState.fullQuery||this._taskState.query),o=this._taskState.id,s="",this._taskState.localFilters&&(ht=!0),i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&this._taskState.localFilters||(this._taskState.filterUrlParam?s=this._taskState.filterUrlParam+"%20":o&&o.indexOf("ypid:")===0?(c=n.localFilterFormat,s=encodeURIComponent(c.replace("{ypid}",o.substring(5))+" ")):o&&o.indexOf("sid:")===0?(c=n.entityFilterFormat,s=encodeURIComponent(c.replace("{sid}",o.substring(4))+" ")):o&&o.indexOf("eventId:")===0?(c=n.eventFilterFormat,b=o.indexOf("eventParentId:"),b!==-1?(w=o.substring(8,b-1),g=o.substring(b+14)):(w=o.substring(8),g=w),s=encodeURIComponent(c.replace("{eventId}",w).replace("{eventParentId}",g).replace("{latlong}",this._taskState.latLongForEventRequery).replace("{city}",this._taskState.locationForEventRequery)+" ")):o&&o.indexOf("vdpid:")===0&&(c=n.vdpIdFilterFormat,s=encodeURIComponent(c.replace("{vdpid}",o.substring(6))+" "))),y=r!==undefined?r.toString():this._offset.toString(),s?(this._taskState.poiCount&&!isNaN(parseFloat(this._taskState.poiCount))||f!==undefined)&&(rt=f!==undefined?f.toString():this._taskState.poiCount,e+="&count="+rt+"&ecount="+rt+"&first="+y+"&efirst="+(parseInt(y)+1).toString(),e+=a):(nt=f!==undefined?f.toString():this._taskState.entryPoint===u.DirectionsWaypointSearch?n.directionsSearchCount.toString():this._taskState.poiCount&&!isNaN(parseFloat(this._taskState.poiCount))?this._taskState.poiCount:this._count.toString(),e+="&count="+nt+"&ecount="+nt+"&first="+y+"&efirst="+(parseInt(y)+1).toString()+a,this._taskState.localFilters&&(s+=encodeURIComponent(this._taskState.localFilters+" ")),tt=this._taskState.scenarioKey,(ht||t&&t.mapPannedOrZooomed)&&n.disableOSearchScenarioKeys&&tt&&n.disableOSearchScenarioKeys.indexOf(tt)>-1&&(e+=h._disableOSearchParameter)),this._taskState.chainId&&(e+="&chain="+this._taskState.chainId,s+=encodeURIComponent('carouselread:"true" ')),ct=this._taskState.taskTitle||"",ut=this._taskState.query||this._taskState.taskTitle||s||this._taskState.category,i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&!a&&(ut=this._taskState.fullQuery),lt=encodeURIComponent(ut.trim()),this._taskState.asName&&(s+=encodeURIComponent('ename:"'+this._taskState.asName+'" ')),this._taskState.asFormattedAddress&&(s+=encodeURIComponent('eaddr:"'+this._taskState.asFormattedAddress+'" ')),e=e.replace("{title}",encodeURIComponent(ct)),e=e.replace(new RegExp("{query}","gi"),lt).replace("{filter}",s),e=e.replace("{tid}",h._tabID),k=this._taskState.keyRoutePoints,k&&k.length>=2&&(e+="&routePoints={points}",e=e.replace("{points}",this._getPointsString(k)),e.indexOf("overlaybfpr")>-1&&e.indexOf(h._disableOSearchParameter)===-1&&(e+=h._disableOSearchParameter)),l="",this._taskState.primerPois&&this._taskState.primerPois.length>0&&(this._taskState.primerPois.forEach(function(n){l+=n.entity.id+","}),l=l.substr(0,l.length-1),l&&(e+="&localypids="+l)),et=this._taskState.filterUrlParam&&this._taskState.filterUrlParam.indexOf("sid:")>-1,at=et&&(this._taskState.filterUrlParam.indexOf('disp:"itr"')>-1||this._taskState.filterUrlParam.indexOf('disp:"itrlist"')>-1),e.indexOf("overlaybfpr")>-1&&!at&&(this._taskState.id&&this._taskState.id.indexOf("sid:")===0||et)&&(e=e.replace("[AplusAnswer",'[AplusAnswer RequeryPage="Default"')),vt=i._getUrlParam(window.location,"overrideBfprAnswerPicker"),vt=="true"&&(e+="&overrideBfprAnswerPicker=true"),a&&e.indexOf("localMapView")<0&&(e+=a)),p=n.formCodeMonitr,p&&window.location.href.toUpperCase().indexOf(p)>-1&&e.toUpperCase().indexOf(p)===-1&&(e+="&FORM="+p),this._updateTitle(),!n.adsFromWorkflow||!ft.isEnabled()||t&&t.mapPannedOrZooomed||(ot=this._taskState.entryPoint,ot!==u.DirectionsWaypointSearch&&(e+="&ads=1",d=it.getMapCenter(this.map),d&&(e+="&cp="+d.latitude+"~"+d.longitude),ft.logWorkflowQueryEvent(ot))),e=e.replace("{originIG}",this._taskState.originIG?this._taskState.originIG:""),st=Logger.getOverlayType(),st&&(e+="&OVRLY="+st),this._taskState&&this._taskState.isFallbackRequery&&this._taskState.fallbackScenario&&(e+="&isFallbackQuery=true"),v.dynamicProperties.totalRequestsFromOverlay>0&&v.dynamicProperties.totalRequestsFromOverlay--,e},h.prototype.enableSearchAlongRoute=function(n){this._taskState&&n&&(this._taskState.directionsTaskId=n,this._invokeListenersAction(2,n))},h.prototype.disableSearchAlongRoute=function(n,t){t===void 0&&(t=!0);this._taskState&&(this._taskState.directionsTaskId&&n&&this._invokeListenersAction(3,this._taskState.directionsTaskId),this._taskState.keyRoutePoints=[],this._taskState.directionsTaskId=null,t&&this._refreshWithDelay())},h.prototype.isSearchAlongRouteEnabled=function(){return this._taskState&&this._taskState.directionsTaskId!=null},h.prototype._getAnswerPicked=function(){var n=this.panelRoot.select("div[data-answerpicked]"),t;return n&&n.length===1&&(t=n[0].getAttribute("data-answerpicked"),t)?t:""},h.prototype.microPoiRequestForLocalOverlayIsAllowed=function(){return this._taskState&&this._taskState.entryPoint&&i._isLocalOverlayShownOnSerp()&&(this._taskState.isFallbackRequery||this._taskState.entryPoint.lastIndexOf(u.Permalink)>-1)&&this._peekForLocalOverlayCategoryId(this.panelRoot)?!0:!1},h.prototype.sendPaginationRequest=function(n,t,r){var f=this,e,o,s;this._taskState.mapBounds=this._getLocalMapViewBounds();this._taskState.primerPois=null;this._taskState.entryPoint=u.ServerPagination;e=this._createUrl(null,n,t);e&&(this.setPercentLoaded(0),o=function(n){f._showOrHideWaitLayer(!1);var u=f._convertToResponseObject(n),t=k.getEntitiesFromResponse(u,f._taskState);t&&t.length?(r.updateChevrons(t.length),f.processResponse(u,{isPaginated:!0}),f.displayState&&f.displayState.prominence===1&&i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("SearchResponseReceived",{IG:ot.getImpressionGuid(f.viewModel.panelRoot),primitives:f.viewModel.getPushpinPrimitives()}),f.scrollLane.invoke(f.panelRoot)):r.updateChevrons(0)},this._showOrHideWaitLayer(!0),s=function(){f._showOrHideWaitLayer(!1);r.updateChevrons(0)},ct.downloadGeneric(e,"pagination",o,null,s,null,0))},h.prototype._invokeListenersAction=function(n,t){var i={action:n,listenerId:this.id};e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:i,type:s.directionsTask,taskId:t})},h.prototype._updateTitle=function(){this._initialTitle&&(this._taskState&&this._taskState.directionsTaskId&&this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>0?this.setTitle(i._formatString(t.L_LocalSearch_SearchAlongYourRouteTitle,this._initialTitle)):this.setTitle(this._initialTitle))},h.prototype._getPointsString=function(n){var t=n.map(function(n){return n.latitude+","+n.longitude});return t.join(",")},h.prototype._sendSearchRequest=function(n,t,u){var h=this,e=r(".cardPrimer"),f,o,s;if(this.map.getConfig().enablePoiPrimer&&e&&e.length>0&&(f=e.select(".contentRoot"),f&&f.length>0&&f[0].children.length>0)){this._parseResponse(f[0].innerHTML,t,u);return}n&&(o=this._taskState&&this._taskState.id?d.ID:d.SB,s=this._logHelper.perfStart(o),sj_evt.fire("v8SearchRequestStarted"),ct.downloadGeneric(n,"search",function(n){(s.end("NT"),sj_evt.fire("v8SearchResponseReceived"),!i._isSmallMapShownOnSerp()||v.dynamicProperties.prefetchingResultsOnSerp)&&(h._parseResponse(n,t,u),sj_evt.fire("v8SearchResponseParsed"))},null,null,null,0))},h.prototype._addImgUrlsToTaskState=function(n){var f,t,e,i,u,o;for(this._taskState.imgUrls=[],f=n.select(".mapsCustomInfoCard, .iclc, .iaplanner, [data-ovl], .entity-listing-container"),t=0;t<f.length&&this._taskState.imgUrls.length<4;t++)for(e=r(f[t]).select("img"),i=0;i<e.length&&this._taskState.imgUrls.length<4;i++)u=e[i].getAttribute("src"),o=u&&u.match("/th/?"),o&&o.length>-1&&this._taskState.imgUrls.push(u)},h.prototype._isInLocalOverlayCategoryIdList=function(t){var i,r;if(t&&n&&n.localOverlayOnSerpCategoryIDs&&(i=t.split("."),i&&i.length))for(r=0;r<i.length;++r)if(i[r]&&n.localOverlayOnSerpCategoryIDs.indexOf(i[r])>-1)return!0;return!1},h.prototype._isHotelListingRequeryOnOverlay=function(){var t=this._taskState.selectedCategoryId||this._taskState.category;return i._isLocalOverlayShownOnSerp()&&this._taskState.isFallbackRequery&&this._taskState.fallbackScenario&&n.multiEntityScenarios.indexOf(this._taskState.fallbackScenario)>-1&&this._isInHotelCategoryIdList(t)?!0:!1},h.prototype._isInHotelCategoryIdList=function(t){var i,u,r;if(t&&n&&n.poiCountOverrideByCategoryId&&(i=t.split("."),u=Object.keys(n.poiCountOverrideByCategoryId),u&&u.length&&i&&i.length))for(r=0;r<i.length;++r)if(i[r]&&u.indexOf(i[r])>-1)return!0;return!1},h.prototype._getPoiCountOverrideIfAny=function(t){var i,f,r,u;if(t&&n&&n.poiCountOverrideByCategoryId&&(i=t.split("."),f=Object.keys(n.poiCountOverrideByCategoryId),f&&f.length&&i&&i.length))for(r=0;r<i.length;++r)if(u=i[r]&&i[r].toLowerCase(),u&&f.indexOf(u)>-1&&n.poiCountOverrideByCategoryId[u])return n.poiCountOverrideByCategoryId[u];return null},h.prototype._getRequestUrlFormat=function(){return i._isTravelOverlayShownOnSerp()?this._taskState&&this._taskState.isFallbackRequery?n.fallbackRequestUrlFormatForTravelOverlayOnSerp:(h._useBfpr=!0,this._taskState&&(this._taskState.useBfpr=!0),n.requestUrlFormatForTravelOverlayOnSerp):this._taskState.isFallbackRequery&&this._taskState.fallbackCategory&&this._taskState.fallbackCategory.toLowerCase().indexOf("attraction")>-1?n.requestUrlFormat:n.fallbackRequestUrlFormat&&n.fallbackRequestUrlFormat.length>10&&this._taskState&&this._taskState.entryPoint&&this._taskState.isFallbackRequery?n.fallbackRequestUrlFormat:n.requestUrlFormatForEventDetailCard&&n.requestUrlFormatForEventDetailCard.length>10&&this._taskState&&(this._taskState.filterUrlParam&&this._taskState.filterUrlParam.indexOf("eventId")!==-1||this._taskState.id&&this._taskState.id.indexOf("eventId")!==-1)?n.requestUrlFormatForEventDetailCard:(this._taskState&&this._taskState.useBfpr&&(h._useBfpr=!0),h._useBfpr)?n.useBfprRequestUrlFormat:this._taskState&&this._taskState.useBmfp?n.useBmfpRequestUrlFormat:n.requestUrlFormat},h.prototype._peekForLocalOverlayCategoryId=function(t){if(t&&n&&n.localOverlayOnSerpCategoryIDs){var i=k.parseCategory(t);return i&&(this._taskState.category=i),this._isInLocalOverlayCategoryIdList(i)}return!1},h.prototype._peekForNoResult=function(n){var t,i;return n&&(t=n.select("div[data-answerinfo]"),t&&t.length)?(i=t.get_attr("data-answerinfo"),i==="0"):!1},h.prototype._isHotelsFallback=function(t){return i._isHotelsCategory(t)&&n.enableCustomHotelsExperience?(this._taskState.category=t,!0):!1},h.prototype._isRestaurantsFallback=function(t){return i._isRestaurantCategory(t)&&n.enableCustomRestaurantsExperience?(this._taskState.category=t,!0):!1},h.prototype._isRealEstateFallback=function(n,t){return i._isHouseCategory(t)&&k.parseAnswerInfo(n,this._taskState).intentKey==="multiEntity"?(this._taskState.originalResponse=n,!0):!1},h.prototype._isAttractionFallback=function(n){return this._taskState&&(this._taskState.entryPoint===u.SearchBox||this._taskState.entryPoint===u.SearchButton)&&n&&n.toLowerCase().indexOf("attraction")>-1?(this._taskState.poiCount="50",!0):!1},h.prototype._fallbackIfNoResultsFoundInResponse=function(t){return!(this._taskState&&this._taskState.useBmfp)&&n.fallbackRequestUrlFormat&&n.fallbackRequestUrlFormat.length>10&&this._peekForNoResult(t)},h.prototype._parseResponse=function(t,r,o){var h=this._convertToResponseObject(t),l;this._taskState||(this._taskState=r.requestState);this._taskState.isFallbackRequery&&i._isHouseCategory(this._taskState.category||this._taskState.searchQueryCategory)&&this._taskState.originalResponse&&this._peekForNoResult(h)&&(h=this._taskState.originalResponse,this._taskState.originalResponse=null);this._addImgUrlsToTaskState(h);this._taskState.searchPerfState=this._searchPerfState;var a=this._taskState.entryPoint,v=a===u.TaskBar&&this._checkDirectionsIntent(h.select("[data-answerinfo]").get_attr("data-answerinfo")),c=k.parseCategory(h);if(this._taskState.disableTaskActivate&&!v){if(l=this._peekForNoResult(h),!this._taskState.isFallbackRequery&&l&&(n.fallbackRequestUrlFormat&&n.fallbackRequestUrlFormat.length>10||i._isRealEstateOverlayShownOnSerp()||i._isTravelOverlayShownOnSerp())){this._taskState.originalProcessInputData=r;r.requestorId||(this._taskState.originalProcessInputData.requestorId=this.id);this._requestFallback(h);l&&o&&(this._taskState.originalCallback=o);return}this._taskState.isFallbackRequery&&this._taskState.originalCallback?this._taskState.originalCallback({originalProcessInputData:this._taskState.originalProcessInputData,data:{content:h,entities:k.getEntitiesFromResponse(h,this._taskState)}}):o&&o({originalProcessInputData:this._taskState.isFallbackRequery?this._taskState.originalProcessInputData:null,data:{content:h,entities:k.getEntitiesFromResponse(h,this._taskState)}})}else!this._taskState.isFallbackRequery&&(this._isAttractionFallback(c)||this._isRealEstateFallback(h,c)||this._isHotelsFallback(c)||this._isRestaurantsFallback(c)||this._fallbackIfNoResultsFoundInResponse(h))?this._requestFallback(h):!this._taskState.isFallbackRequery&&i._isTravelOverlayShownOnSerp()&&this._peekForNoResult(h)?this._requestFallback(h):i._isFeatureEnabled("verticalZipcode")&&i._isZipCodeCategory(this._taskState.category||c)?(this._taskState.category||(this._taskState.category=c),this._shouldRequeryForZipCode(h,this._taskState)?(this._taskState.originalResponse=h,e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:this._taskState,type:s.polygonListingTask})):(this._taskState.originalResponse&&(this._mergeResponses(h,this._taskState.originalResponse),delete this._taskState.originalResponse),k.parseResponse(h,this._taskState,this._trafficLayer,this.map))):k.parseResponse(h,this._taskState,this._trafficLayer,this.map)},h.prototype._requestFallback=function(t){var h="",i="",r,u,c,o,l;t&&(r=t.select("div[data-answerinfo]"),r&&r.length&&(i=r.get_attr("data-answerinfo"),i&&(h=n.scenarioKeys[i])));this._taskState.isFallbackRequery=!0;this._taskState.fallbackScenario=i;this._taskState.fallbackCategory=k.parseCategory(t);u={Q:this._taskState.query?this._taskState.query:this._taskState.fullQuery?this._taskState.fullQuery:"",EP:this._taskState.entryPoint,SNRO:h};u.SIG=ot.getImpressionGuid(t);this._logHelper&&this._logHelper.log(w.FLBK,u,u.SIG);c=this._peekForNoResult(t)?!1:!0;c?(o=k.parseAnswerInfo(t,this._taskState),l=o.intentKey==="multiEntity"?s.localListingTask:o.intentKey==="singleEntity"?s.localDetailsTask:s.localSearchTask,k.invokeTask(l,t,this._taskState,!1)):e.invokeHandler(f.taskProcessDataHandlerKey,{requestState:this._taskState,type:s.localSearchTask})},h.prototype._checkDirectionsIntent=function(t){return n.directionsIntentDrivingScenarios.indexOf(t)>=0?!0:n.directionsIntentTransitScenarios.indexOf(t)>=0||n.directionsIntentWalkingScenarios.indexOf(t)>=0?!0:void 0},h.prototype._shouldRequeryForZipCode=function(n,t){var e=!1,r,f,u;return i._isZipCodeCategory(t.category)&&(r=this._getItemCountsFromResponse(n),r&&(f=r[1]+r[2],u=t.originalResponse&&this._getItemCountsFromResponse(t.originalResponse),u&&(f+=u[1]+u[2]),e=f<r[0])),e},h.prototype._getItemCountsFromResponse=function(n){var t=n.select("div.overlay-listings").get_attr("data-listingMetadata");if(t.length>0){var i=JSON.parse(t),r=parseInt(i.TotalCount),u=parseInt(i.BlockedCount),f=n.select(".listings-item").length;return[r,u,f]}return null},h.prototype._mergeResponses=function(n,t){var i=this._getItemCountsFromResponse(n),u=this._getItemCountsFromResponse(t);if(i&&u){var f="data-listingMetadata",e=n.select("div.overlay-listings"),h=e.get_attr(f),o=JSON.parse(h);o.BlockedCount=(i[1]+u[1]).toString();e.set_attr(f,JSON.stringify(o));var s=".listings-item",c=n.select(s).getParent(),l=t.select(s),a=n.select(".b_vList");l.for_each(function(n){a.insertBefore(r(n).getParent(),c)})}},h.prototype._tryParsingWithDOMParser=function(n){try{var t=new DOMParser;return r(t.parseFromString("<div>"+n+"<\/div>","text/html").firstChild.childNodes[1].firstChild)}catch(i){return vi.assert(!1,"Error parsing the response: "+i),null}},h.prototype._convertToResponseObject=function(n){var t=this._tryParsingWithDOMParser(n);return t||(t=r(document.createElement("div")),t.set_html(n)),t},h.prototype._getLocationInfo=function(){try{var t,n=this._taskState.point;return n&&n.length===2?h._circularViewFormat.replace("{0}",n[0].toString()).replace("{1}",n[1].toString()).replace("{2}",h._radiusInMeters):(t=this._taskState.mapBounds&&this._taskState.mapBounds.length===4?this._taskState.mapBounds:this._getLocalMapViewBounds(),h._mapViewFormat.replace("{0}",t.join(",")))}catch(i){return""}},h.prototype.isSharable=function(){return this.getMapPrimitives()&&this.getMapPrimitives().length>0},h.prototype.getMenuList=function(){for(var n=o.prototype.getMenuList.call(this),r=!1,i=0;i<n.length;i++)if(n[i].name.indexOf("print")||n[i].name.indexOf("Print")){r=!0;break}return!r&&this.hasPrintContent()&&n.push({name:t.L_Menu_Print_Link_Text,handler:function(){e.invokeHandler(f.printDataHandlerKey,{source:2,taskType:this.type,taskId:this.id,data:this.getPrintInstrumentationData()})},instData:this.getInstData("Print")}),this.isReportable()&&(this.getReportType()===4?this.shoudEnableSuggestAnEdit()&&n.push(this._getLocalFeedbackListData()):n.push(this._getFeedbackListData())),n},h.prototype._updateRoutePoints=function(n){if(this._categories)for(var t=0,i=this._categories.length;t<i;t++)e.invokeHandler(f.layerManagerDataHandlerKey,{action:"updateRoutePoints",entryPoint:u.LocalListingAlongRoute,category:this._categories[t],taskId:this.id,routePoints:n})},h.prototype.openReportLocalProblemLink=function(){var n=this.viewModel.reportLocalProblemLinkURL;n&&window.open(n,"_blank")},h.prototype._getFeedbackListData=function(){return{name:t.L_Menu_ReportProblem_Link_Text,options:{type:s.feedbackTask,activateOptions:{parentId:this.id},state:{entryPoint:2,feedbackTaskType:3,activeTaskId:this.id,title:this.getTitle(),options:this.getReportOptions()}},instData:this.getInstData("Report Problem")}},h.cleanupPrimerData=function(n){h._removeCardPrimer(n);h._removePoiPrimerLayer(n)},h.parseDataFact=function(n){var t=null;if(n)try{t=JSON.parse(n)}catch(i){}return t},h._removeCardPrimer=function(n){if(n.getConfig().enablePoiPrimer){var t=r(".cardPrimer");t&&t.length>0&&!h._removeCardPrimerTimer&&(h._removeCardPrimerTimer=Microsoft.Maps.setTimeout(function(){h._removeCardPrimerTimer=null;t&&t.removeFromParent()},500))}},h._removePoiPrimerLayer=function(n){for(var t=n.getLayers(),i,r=0,u=t.length;r<u;r++)if(t[r].getId()==="PoiPrimer"){i=t[r];break}i&&n.getFrameManager().frameRendered.addOne(function(){t.remove(i);i.dispose()})},h.prototype._buildTaskStateWithPrimerPois=function(){var n={};for(var t in this._taskState)this._taskState.hasOwnProperty(t)&&(n[t]=this._taskState[t]);return n.primerPois=this._getPrimerPoisFromViewModel(),n},h.prototype._getPrimerPoisFromViewModel=function(){var r=[],i=this.viewModel.getPushpinPrimitives(),u=i.length>5?5:i.length,t,n;for((this.type===s.localDetailsTask||this.type===s.polygonEntityDetailsTask)&&(u=1),t=0;t<u;t++)n=i[t],r.push({geometry:{y:Math.round(n.geometry.y*1e6)/1e6,x:Math.round(n.geometry.x*1e6)/1e6,bounds:[]},entity:{title:n.entity.getTitle(),id:n.entity.id,subtitle:n.entity.getAddress()}});return r},h.prototype._reduceLatLonPrecisions=function(){var n;if(this._taskState){if(this._taskState.mapBounds&&this._taskState.mapBounds.length>0)for(n=0;n<this._taskState.mapBounds.length;n++)this._taskState.mapBounds[n]&&(this._taskState.mapBounds[n]=Math.round(this._taskState.mapBounds[n]*1e6)/1e6);if(this._taskState.point&&this._taskState.point.length>0)for(n=0;n<this._taskState.point.length;n++)this._taskState.point[n]&&(this._taskState.point[n]=Math.round(this._taskState.point[n]*1e6)/1e6);if(this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>0)for(n=0;n<this._taskState.keyRoutePoints.length;n++)this._taskState.keyRoutePoints[n]&&(this._taskState.keyRoutePoints[n].latitude=Math.round(this._taskState.keyRoutePoints[n].latitude*1e6)/1e6,this._taskState.keyRoutePoints[n].longitude=Math.round(this._taskState.keyRoutePoints[n].longitude*1e6)/1e6)}},h.prototype._getLocalFeedbackListData=function(){return{name:t.L_Menu_SuggestAnEdit_Link_Text,options:{type:s.feedbackTask,activateOptions:{parentId:this.id},state:{entryPoint:2,feedbackTaskType:4,activeTaskId:this.id,title:t.L_Menu_SuggestAnEdit_Link_Text+" - "+this.getTitle(),options:this.getLocalReportOptions()}},instData:this.getInstData("Suggest an Edit")}},h.prototype.getReportOptions=function(){var n=null;return this.getReportType()!==1&&this.getReportType()!==6&&this.viewModel&&this.viewModel.getEntities()&&this.viewModel.getEntities().length>0&&(n=this.viewModel.getEntities()[0].getLocation()),{query:this._taskState.query,reportType:this.getReportType(),pushPinLocation:n,reportLocalProblemLinkURL:this.viewModel.reportLocalProblemLinkURL,taskStateId:this._taskState.id,scenarioKey:this._taskState.scenarioKey,userFacts:this.loadUserFacts(),rapEntryPoint:3}},h.prototype.getLocalReportOptions=function(){var n={},t,i;return this.getReportType()!==1&&this.viewModel&&this.viewModel.getEntities()&&this.viewModel.getEntities().length>0&&(n.pushPinLocation=this.viewModel.getEntities()[0].getLocation(),n.entityName=this.viewModel.getEntities()[0].getTitle(),n.entityYpid=this.viewModel.getEntities()[0].id),t=this.loadDataFacts(),t&&(n.dataFacts=t),i=this.loadUserFacts(),i&&(n.userFacts=i),n.query=this._taskState.query,n.reportType=this.getReportType(),n},h.prototype.loadDataFacts=function(){var n=this.panelRoot.select("div.overlay-taskpane").get_attr("data-facts");return h.parseDataFact(n)},h.prototype.loadUserFacts=function(){var n=null,t=this.panelRoot.select("div[data-ufacts]").get_attr("data-ufacts");if(t)try{n=JSON.parse(t)}catch(i){}return n},h.prototype.isReportable=function(){return this._taskState&&this.getReportType()!==0},h.prototype.isPrintable=function(){var n=this.viewModel?this.viewModel.getPushpinPrimitives():null;return wi.isEnabled&&n&&n.length>0},h.prototype.getReportType=function(){var i=this._taskState.scenarioKey,t=0;return n.reportAsNotFoundKeys.indexOf(i)>-1&&(t=1),n.reportAsMultiBusinessKeys.indexOf(i)>-1?t=6:n.reportAsAddressKeys.indexOf(i)>-1?t=this._taskState.entryPoint===u.ContextMenu?3:2:n.reportAsPlaceKeys.indexOf(i)>-1?t=5:n.reportAsLocalKeys.indexOf(i)>-1&&(t=4),t},h.prototype.getEntityMarket=function(){var n=this.loadDataFacts();return n&&n.languageCultureName?n.languageCultureName:""},h.prototype.shoudEnableSuggestAnEdit=function(){var t=!1,u=this.getEntityMarket(),i=ut.ftwMarkets,n,r;if(i!=undefined){n=i.split(",");for(r in n)if(n[r].toLowerCase()===u.toLowerCase()){t=!0;break}}return t},h._disableOSearchParameter="&DisableOSearch=1",h._circularViewFormat="&localCircularView={0},{1},{2}",h._mapViewFormat="&localMapView={0}",h._useBfpr=!1,h._overlayCloseBtnListenerAdded=!1,h._radiusInMeters="16000",h._tabID=_G.IG,h.mouseoverTimeout=500,h.mouseoutTimeout=500,h}(ot),kt=function(r){function o(n,t,i,u,f,e,o,h,c,l){var a=r.call(this,n,e,t,u)||this;return a.showCloseButton=!0,a.type=s.localDetailsTask,a.poiManager=i,a._controlTemplateFactory=h,a._buttonGroupViewModel=f,a.disposables.push(a.poiManager.contextMenuInvoked.add(function(n){return a._contextMenuInvoked(n)})),a.disposables.push(a.poiManager.poiTapped.add(function(){return a._poiTapped()})),a.disposables.push(a.poiManager.poiHoverStarted.add(function(n){return a._poiHoverStarted(n)})),a.disposables.push(a.poiManager.poiHoverStopped.add(function(){return a._poiHoverStopped()})),a.disposables.push(a.poiManager.mapViewChanged.add(function(n){return a.updateMapBounds(n)})),a._syndicatedAds=o,a._taskBar=c,a._geochainManager=l,a}return a(o,r),o.prototype.activate=function(n,t){var i=this,u,f;t&&(this.viewModel=new ri(this.map,this.panelRoot,this.id,this._logHelper,this._transientLensViewModel,this._buttonGroupViewModel,this._taskBar,t,this._controlTemplateFactory,this.primitiveInteracted),this.registerViewModelEvents(),u=t.taskTitle?t.taskTitle:t.fullQuery||t.query,this.setTitle(u),this.disposables.push(this.viewModel.titleChanged.add(function(n){i.setTitle(n);var t=i.viewModel;t.updatePoiTitle(n);t.resetPrimitives(i.poiManager)})),r.prototype.activate.call(this,n,t),t.content?this._processLocalDetails(t):(t.disableTaskActivate=!0,f={requestState:t},r.prototype.process.call(this,f,function(n){i.processResponse(n.data.content);i._processLocalDetails(t);sj_evt&&i.displayState&&i.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",i.panelRoot,i.stackId)})))},o.prototype.process=function(n,t){var i=n&&n.requestState,u,e;i&&(i.hideBackButton&&i.listingTaskId?(u=this.panelRoot.select(".commonButton.backArrowButton.overlayButton"),e=u.get_attr(f.taskDataHandlerKey),e&&e.indexOf(i.listingTaskId)>0&&(u.set_style({display:"none"}),u.parent().set_style({display:"none"})),t&&t({processorId:this.id,data:{}})):r.prototype.process.call(this,n,t))},o.prototype.deactivate=function(){var u,n,t;if(this._taskState.openingNewCard||this._taskState.flippingCard){var i=this.viewModel&&this.viewModel.getEntities(),o={showEntity:!0,selectedEntityId:i&&i.length>0?i[0].id:null},h={requestorType:s.localDetailsTask,requestorId:this.id,type:s.localListingTask,requestState:o,useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,h)}r.prototype.deactivate.call(this);u=this.panelRoot.select("a[data-streetside]");u.set_style({opacity:0});n=this.panelRoot.select("#bev2Img");n&&n.length>0&&n.set_style({opacity:0});t=this.panelRoot.select(".tp_tasks");t&&t.length>0&&t.set_style({opacity:0})},o.prototype.setTaskComplete=function(){var t=this,c=this._taskState&&this._taskState.id?d.ID:d.SB,l=this._logHelper.perfStart(c),n,i,u,o,h;this.map.getFrameManager().frameRendered.addOne(function(){var i,n,r;t._taskState&&t._taskState.searchPerfState&&(i=t._taskState.searchPerfState.timestamp().getTime(),tt.log(tt.localDetailTimeToGlass,i),n=Microsoft.Maps.Local,r=t instanceof n.HotelsDetailsTask?tt.hotelslocalDetailTimeToGlass:t instanceof n.RestaurantDetailsTask?tt.restaurantslocalDetailTimeToGlass:t instanceof n.HouseDetailsTask?tt.realEstatelocalDetailTimeToGlass:"",r&&tt.log(r,i));l.end("RT")});n=this.viewModel.getEntities();n&&n.length>0&&(i=n[0],this.poiManager&&this.poiManager.setTargetMapView(this.viewModel.boundingBox),this.setTitle(this._taskState&&this._taskState.taskTitle?this._taskState.taskTitle:i.getTitle()),this._taskState.id||(this._taskState.id=i.id),this._taskState.taskTitle&&this._taskState.overridePoiTitle&&this.viewModel.updatePoiTitle(this._taskState.taskTitle),u=this.loadDataFacts(),u&&(i.interests=u.Interests,i.stayDuration=u["Average stay"],i.addressFields=u.addressFields));r.prototype.setTaskComplete.call(this);(this._taskState.flippingCard||this._taskState.openingNewCard)&&n&&n.length>0&&(o={hideEntity:!0,selectedEntityId:n[0].id},h={requestorType:s.localDetailsTask,requestorId:this.id,type:s.localListingTask,requestState:o,useActiveTasks:!0},e.invokeHandler(f.taskProcessDataHandlerKey,h))},o.prototype.processResponse=function(n,t){r.prototype.processResponse.call(this,n,t);this._subscribeToSendEventsForOverlay()},o.prototype._subscribeToSendEventsForOverlay=function(){var n=this;this.panelRoot&&this.panelRoot.select("a").add_event("click",function(){n._logInstrumentationEventForEntityClick()})},o.prototype.serialize=function(n,t){var i=r.prototype.serialize.call(this,n),u=this.viewModel,f,e;return i&&u&&u.calendarSync&&(i.dateTime=u.calendarSync.getStartDateTime()),f=u&&u.annotationControl,e=i,i&&f&&f.getCurrentName()!==f.getOriginalName()&&(e.originalName=f.getOriginalName()),i&&t&&t===2&&(e.hideBackButton=!0,e.flippingCard=!1),i},o.prototype.getOriginalName=function(){var t=this.viewModel,n=t&&t.annotationControl;return n&&n.getCurrentName()!==n.getOriginalName()?n.getOriginalName():""},o.prototype.getNotes=function(){var n=this.viewModel,t=n&&n.annotationControl;return t?t.getDescription():""},o.prototype.canColorFade=function(){return!1},o.prototype.hasPrintContent=function(){return this.isPrintable()},o.prototype.getPrintContent=function(){var n,t;return this.hasPrintContent()?(n=null,this.viewModel instanceof ri&&(n=this.viewModel.getDetailsHtmlContentForPrint(this.loadDataFacts())),t=new ni,t.insert(this.poiManager.getLayerId(),0),n?new bi(n,t,null):null):null},o.prototype.getShareDescription=function(){var i,r,u,n="",f=String.fromCharCode(183),o=this.viewModel.getEntities(),e=this.loadDataFacts(),t;return(e&&e.price&&(r=e.price),o.length===1&&(t=o[0],i=t.getAddress()||t.getDescription(),u=t.getPrimaryCategoryName()),i&&(n+=i),r&&(n+=f+r),u&&(n+=f+u),n.length&&n.charAt(0)===f&&(n=n.substr(1)),n===t.getTitle())?"":n},o.prototype.setDisplayState=function(n){r.prototype.setDisplayState.call(this,n);n.activationState===1&&n.prominence===1&&lt&&lt.isEditable&&!this._itineraryTaskChecked&&this._checkItineraryTasks();var t=this.panelRoot.select("a[data-streetside]");n.activationState===2||n.activationState===3?t.set_style({opacity:0}):n.activationState===1&&t.set_style({opacity:1})},o.prototype._onPoiViewStateChanged=function(t){var i,r,o;n.enableLEPoiHover2&&t&&t.primitive&&t.primitive.entity instanceof ki&&t.newValue!==t.oldValue&&(i=t.primitive.entity,i&&i.id&&t.newValue===2&&(r={entryPoint:u.POI,id:i.id,openingNewCard:!0,taskTitle:i.getTitle()},o={taskColorIndex:this.displayState.colorIndex,groupName:this.id},e.invokeHandler(f.taskDataHandlerKey,{type:s.localDetailsTask,state:r,activateOptions:o})))},o.prototype._processLocalDetails=function(n){var r=this,f=null,c=null,l=null,a=null,e=this.viewModel.getEntities(),t,s,h,v;if(e&&e.length>0&&(c=e[0].getRoutableLocation(),l=e[0].getLocation(),a=e[0].getBoundingBox(),f=e[0].getTitle()),!f||n.taskTitle&&n.originalName?f=n.taskTitle||n.title||"":(n.taskTitle=f,this.setTitle(f)),this._processForCollectionError(n),this.pageProcessor.process(this.panelRoot,{routablePoint:c,id:this.id,showBackButton:(n.flippingCard||n.openingNewCard)&&!i._getIsSlideCardEnabled(),cameFromCollections:n.entryPoint===u.Collections,listingTaskId:n.listingTaskId,location:l,boundingBox:a,map:this.map,geochainManager:this._geochainManager,controlTemplateFactory:this._controlTemplateFactory,taskTitle:f,getDisplayState:function(){return r.displayState}},this.perfLog),t=this.viewModel,nu.enableCalendarSync?t.createCalendarSync():(s=this.panelRoot.select(".calendarSyncModule"),s&&s.getParent()&&s.getParent().set_style({display:"none"})),t.processAdvertising(n,this._syndicatedAds),t.registerActionButtonEvents(this.id),t.registerModuleClickEvents(),t.registerCalendarEvents(),t.registerLocatedAtSearchEvents(),t.processPhotostripData(),t.registerVenueMapEvents(),this._checkLoadingVenueMapTask(),t.addAnnotationControl(n),n.taskTitle&&t.updatePoiTitle(n.taskTitle),t.removeUpcomingEventContainer(),t.registerGeochainEvents(),t.expandDetailsCard(),t.prepareMenuModule(),t.prepareReviewsAccordionModule(function(){r._disableSizeChangeAction()}),t.registerActionsModuleEvents(),t.addRecommendationModuleHover(this.poiManager),h=this.panelRoot.select('div[id^="locovl"]'),this._imgSetOvlId||(this._imgSetOvlId=h.get_attr("data-ovl")),!n.isImgOvlOpen&&this._imgSetOvlId){var o=_d.getElementsByTagName("html")[0],y=o.style.overflowX,p=o.style.overflowY,b=o.style.overflow;sj_evt.fire("ovlHide",this._imgSetOvlId,!0);o.style.overflow=b;o.style.overflowX=y;o.style.overflowY=p}else this._imgSetOvlId=h.get_attr("data-ovl"),typeof ovlc!="undefined"&&ovlc.show(this._imgSetOvlId,n.imgSetOvlCurIndex);this._imgSetOvlShowHandlerWrapper||(this._imgSetOvlShowHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._imgSetOvlShowHandler.apply(r,t[0])});sj_evt.unbind("MapsImgSetOvlShow_"+this._imgOvlHitTargetId,this._imgSetOvlShowHandlerWrapper);this._imgOvlHitTargetId=h.get_attr("id");sj_evt.bind("MapsImgSetOvlShow_"+this._imgOvlHitTargetId,this._imgSetOvlShowHandlerWrapper,0);this._imgSetOvlHideHandlerWrapper||(this._imgSetOvlHideHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._imgSetOvlHideHandler.apply(r,t[0])});sj_evt.unbind("ovlHide",this._imgSetOvlHideHandlerWrapper);sj_evt.bind("ovlHide",this._imgSetOvlHideHandlerWrapper,0);v={searchTaskInstance:this,updateDetailsPricePoi:this._updateDetailsPricePoi};sj_evt.fire("pricePoiInit",v);this._logActivated(w.LDT)},o.prototype._updateDetailsPricePoi=function(n,t){var i,u,r;n&&t&&(i=n.searchTaskInstance,i&&(u=i.viewModel,u&&u.getPushpinPrimitives&&(r=u.getPushpinPrimitives(),r&&r.length&&r[0].entity&&(r[0].entity.iconText=t,i.poiManager&&i.poiManager.setPrimitives&&i.poiManager.setPrimitives(r)))))},o.prototype._checkLoadingVenueMapTask=function(){var n=this.panelRoot.select("div[class=bm_venueMapButton]");this._taskState.loadVenueMap&&n&&n[0]&&(this._taskState.loadVenueMap=!1,this.viewModel.handleVenueMapClick())},o.prototype._disableSizeChangeAction=function(){var n=this;Microsoft.Maps.setTimeout(function(){n.primitiveInteracted.invoke({action:2})},0)},o.prototype._processForCollectionError=function(n){var r;if(n&&n.scenarioKey&&n.scenarioKey==="ERR"&&n.entryPoint===u.Collections&&(r=this.panelRoot.select("div[class=errmsg]"),r&&r.length===1)){var f=i._createElement("p"),e=i._createElement("p"),o=i._createElement("p"),s=i._createElement("p");f.set_text(t.L_Collections_NotFound_Text);e.set_text(n.taskTitle);o.set_text(n.query);s.set_text(t.L_Collections_TryAgain_Text);r.clear();r.append(f);r.append(i._createElement("br"));r.append(e);r.append(o);r.append(i._createElement("br"));r.append(s)}},o.prototype._poiTapped=function(){if(this.primitiveInteracted.invoke(),this.displayState.activationState!==1){var n={action:"focus",id:this.id};e.invokeHandler(f.taskDataHandlerKey,n)}},o.prototype._poiHoverStarted=function(n){n&&n.primitive&&this.activateInfobox(n.primitive,this._taskState.infoboxHtml)},o.prototype._poiHoverStopped=function(){window.clearTimeout(y.mouseoverDelayHandle);y.mouseoverDelayHandle=window.setTimeout(function(){y.mapsInfobox&&y.mapsInfobox.setOptions({visible:!1})},y.mouseoutTimeout/2)},o.prototype._imgSetOvlShowHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._taskState.isImgOvlOpen=!0;this._taskState.imgSetOvlCurIndex=t[2];this._imgSetOvlId=t[1];this.serializableObjectChanged.invoke({magnitude:2})},o.prototype._imgSetOvlHideHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]===this._imgSetOvlId&&(this._taskState.isImgOvlOpen=!1,!t[2]==!0&&this.serializableObjectChanged.invoke({magnitude:2}))},o.prototype._checkItineraryTasks=function(){var n={requestorType:s.localDetailsTask,requestorId:this.id,type:s.itineraryDetailsTask,requestState:{action:0},useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,n);this._itineraryTaskChecked=!0},o.prototype.getCardIconInfo=function(){var n=this.viewModel;return{iconClass:n.iconClass,iconElements:this.getCardIcons(this.viewModel.getCardCategoryId())}},o}(y),gu=function(t){function i(i,r,u,f,e,o,s,h,c,l){var a=t.call(this,i,r,u,f,e,o,s,h,c,l)||this;return a.setRecommendedWidth(n.hotelCardWidth),a.setCurrentWidth(n.hotelCardWidth),a}return a(i,t),i.prototype._createUrl=function(){var n=t.prototype._createUrl.call(this),i,r;return n+=this._taskState.entryPoint===u.SearchBox||this._taskState.entryPoint===u.SearchButton||this._taskState.isFallbackRequery?"&FORM=BHO002":"&FORM=BHO001",i=this._taskState.passThruParam,i&&i.toUpperCase().indexOf("FORM=")===-1&&(n+=i.indexOf("&")!==0?"&"+i:i),this._taskState&&this._taskState.parentIG&&(n+="&IG="+this._taskState.parentIG),this._taskState&&this._taskState.iid&&(n+="&IID="+this._taskState.iid),r=window.location.pathname.indexOf("maps")>=0?"&mapsVertical=true":"",n+=r,_w.suppressBookingAdsModule=this._taskState.isBookingModuleEntryPoint,n},i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},i}(kt),et=function(t){function o(n,r,u,f,e,o,h,c){var l=t.call(this,r,o,u,e)||this,a;return l._primitivesToHideAfterPrint=[],l._defaultInfoboxContentsTemplate='<div class="bm_ib_container bm_ib_titleonly"><div class="bm_ib_title">{title}<\/div><\/div>',l.showCloseButton=!0,l.type=s.localListingTask,l.poiManager=f,l._contextMenu=h,l.disposables.push(l.poiManager.contextMenuInvoked.add(function(n){return l._contextMenuInvoked(n)})),l.disposables.push(e.poiSelected.add(function(n){return l._setSelectedPrimitive(n)})),l.disposables.push(l.poiManager.mapViewChanged.add(function(n){return l.updateMapBounds(n)})),l._micropoiFetched=!1,l._microPoiManager=c,a=l.poiManager.getZIndex(),l._microPoiManager.setZIndex(a-1),l.disposables.push(l._microPoiManager.poiViewStateChanged.add(function(n){l._onPoiViewStateChanged(n,!0)})),l.disposables.push(l._microPoiManager.zoomChangedOnClusterSelect.add(function(){l.map.viewChanged.addOne(function(){l.poiManager._computeBestMapViewOnSetPrimitives=!1;t.prototype._refreshWithDelay.call(l)})})),l._registerEvents(r),l.controlTemplateFactory=n,l.scrollLane=new g,l.laneScrolled=new g,l.disposables.push(l.laneScrolled.add(function(){l._contextMenuOnListMode&&l._hideListItemContextMenu();l._logInstrumentationForScroll()})),l._setTaskCompleted=!1,l._polygonLayerAdded=!1,l._categories=new ni,l._categories.changed.add(function(n){l._onCategoriesChanged(n)}),i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.bind("triggerMapSearch",function(n){var t,i;if(l.displayState&&l.displayState.prominence===1)if(t=n&&n[1],t){if(i=t.filters,typeof i!="undefined"){l._logInstrumentationEventForEntityClick();l.onFilterValueChanged(i)}}else l._logInstrumentationEventForEntityClick(),l._refresh({mapPannedOrZooomed:!0})}),l}return a(o,t),o.prototype.activate=function(n,r){var u=this,f,e,o;this.viewModel||(this.viewModel=new at(this.map,this.panelRoot,this.id,this._logHelper,this.poiManager,this._transientLensViewModel,this.controlTemplateFactory));this.registerViewModelEvents();f=r.fullQuery?r.fullQuery:r.query;e=r.taskTitle?r.taskTitle:f;this.setTitle(e);r&&r.categoryLayers&&(this._taskState=r,this._categories.insertAll(r.categoryLayers));t.prototype.activate.call(this,n,r);r&&r.directionsTaskId&&this.enableSearchAlongRoute(r.directionsTaskId);r.content||(r.disableTaskActivate=!0,o={requestState:r},t.prototype.process.call(this,o,function(n){u.processResponse(n.data.content);u._logActivated(w.LLT);sj_evt&&u.displayState&&u.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",u.panelRoot,u.stackId);i._isNearbyScenarioForLocalOverlayOnSerp()&&sj_evt&&u.displayState.prominence===1&&u.displayState.stackOrder===1&&sj_evt.fire("TaskActivated",{id:u.id,IG:ot.getImpressionGuid(u.panelRoot)})}));this._logActivated(w.LLT)},o.prototype.process=function(n,i){var u=this,r=n&&n.requestState,f;r.hideEntity?(this._setTaskCompleted?this._hideSelectedPrimitive(r.selectedEntityId):(this._hideSelected=new g,this.disposables.push(this._hideSelected.addOne(function(){u._hideSelectedPrimitive(r.selectedEntityId)}))),i&&i({processorId:this.id,data:{}})):r.showEntity?(r.selectedEntityId&&(f=function(){var n=u.viewModel.UpdatePrimitiveState(r.selectedEntityId,0);n&&u.poiManager.invalidated.invoke()},this._setTaskCompleted?f():(this._hideSelected=new g,this.disposables.push(this._hideSelected.addOne(function(){f()})))),i&&i({processorId:this.id,data:{}})):r.hideContextMenu?(this._transientLensViewModel.hide(),i&&i({processorId:this.id,data:{}})):t.prototype.process.call(this,n,i)},o.prototype.deactivate=function(){t.prototype.deactivate.call(this);this._categories.length===0?this._microPoiManager&&this._microPoiManager.dispose():this._updateCategories("removeLayer");this._firstFrameRenderedHandler&&this._firstFrameRenderedHandler.dispose();var n={hideBackButton:!0,listingTaskId:this.id},i={requestorType:s.localListingTask,type:s.localDetailsTask,requestState:n,useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,i);this._cityPolygonManager&&this._polygonLayerAdded&&(this._cityPolygonManager.removeLayer(),this._polygonLayerAdded=!1)},o.prototype.registerViewModelEvents=function(){var n=this;this.disposables.push(this.viewModel.loadInfobox.add(function(t){n.activateInfobox(t,"",!1,!0)}));t.prototype.registerViewModelEvents.call(this)},o.prototype.hasPrintContent=function(){return this.isPrintable()},o.prototype.getPrintContent=function(){var o=this,n,i,u,f,r,t,e;if(!this.hasPrintContent())return null;if(n=this.getMapPrimitives(),n[0]&&n[0].entity&&n[0].entity.usePricePoi)for(this._priceText=[],i=0;i<n.length;i++)u=n[i].entity,u.iconText?this._priceText.push(u.iconText):this._priceText.push("");for(f=null,this.viewModel instanceof at&&(f=this.viewModel.getListingsHtmlContentForPrint(this._colorIndex)),r=0;r<n.length;r++)t=n[r],t&&t.viewState==3&&(this._primitivesToHideAfterPrint.push(t),t.viewState=0);return e=new ni,e.insert(this.poiManager.getLayerId(),0),ou.onPrintDialogClose.addOne(function(){return o.cleanUpPrintEntities()}),new bi(f,e,null)},o.prototype.cleanUpPrintEntities=function(){for(var u,f,r,t,n,i=0;i<this._primitivesToHideAfterPrint.length;i++)u=this._primitivesToHideAfterPrint[i],u&&(u.viewState=3);if(f=this.viewModel,f){for(r=f.getPushpinPrimitives(),t=0;t<r.length;t++)n=r[t].entity,n&&n.iconText&&n.iconText.length>0&&(n.iconText=this._priceText&&this._priceText.length>0&&n.usePricePoi?this._priceText[t]:"");this.poiManager.setPrimitives(r,!0)}},o.prototype.processResponse=function(t,i){var f=this,c,l,a,e,y,w;if(this._getTaskState().content=t,this.viewModel.setResponseContent(t,this._getTaskState()),c={taskParentId:this.id,query:this._taskState.query,clickHandler:function(n,t){return f._processItemClickEvent(t)},contextMenuHandler:function(n,t){return f._processContextMenuEvent(n,t)},saveButtonClickHandler:function(n,t){return f._processSaveButtonClickEvent(n,t)},directionsTaskId:this._getTaskState()&&this._getTaskState().directionsTaskId,originIG:this._taskState.originIG,parentIG:this._getImpressionGuid(),isBookingModuleEntryPoint:this._taskState.isBookingModuleEntryPoint},this.pageProcessor.process(this.viewModel.getResponseContainer(),c),this.viewModel.registerListItemEvents(this._taskState.query,this.isSearchAlongRouteEnabled()),this.viewModel.processSearchMapviewButtons(),this.viewModel.setIconOnlyLimitBySegmentTypeOrCategoryId(),this._registerNoResultResetFiltersClickHandler(),this._drawPivotEntity(),l=this._getTotalResultCount(t),a=this.viewModel.enableServerPagination(this,i,l),!a&&n.enablePoiPagination&&this.viewModel.processPoiPagination(this._taskState,function(){f._doScrollLaneAction()}),this._updateStateWithQueryParseData(),this.viewModel.updateAdvertising(t,this._getTaskState()),!i||!i.mapPannedOrZooomed&&!i.isPaginated)try{var e=[],v=this.panelRoot.select("div[data-boundingbox]").get_attr("data-boundingbox"),u=v&&r.Internals.parseJSON(v);if(u&&u.boundingBox&&u.boundingBox.length>1){e=[];e.push(new p(u.boundingBox[0].latitude,u.boundingBox[0].longitude));e.push(new p(u.boundingBox[1].latitude,u.boundingBox[1].longitude));var h=this.map.getMode().getMapViewForLocationsInView(e),o=ii.fromLocation(h.cameraLocation,!0),s=u.minZoomLevel;s&&!isNaN(s)&&o<s&&(o=s);y=yi.fromEdges(u.boundingBox[0].latitude,u.boundingBox[0].longitude,u.boundingBox[1].latitude,u.boundingBox[1].longitude);w=ii.toLocation(y.center,o,!0);h=it.constructView(this.map,w,o,null,!1,this.map.getViewportPadding(),this.map.getActualSize());this.poiManager&&(this.poiManager.setMapViewFromBackend&&this.poiManager.setMapViewFromBackend(h),this.poiManager.MapViewFromBackendIsSet())}}catch(b){}this.setTaskComplete(i);this.poiManager&&this.disposables.push(this.poiManager.labelsRendered.addOne(function(){sj_evt&&sj_evt.fire("MapSearchTaskActivated",f.id)}))},o.prototype.setTaskComplete=function(i){var f=this,h=this.poiManager,o=this._taskState&&this._taskState.id?d.ID:d.SB,s=this._logHelper.perfStart(o),u,e=this.panelRoot.select("div[data-category]"),r;u=e&&e.length>0?e[0].getAttribute("data-category").toLowerCase():"none";u&&n.useShowMeForSegmentMicroPoi.indexOf(u)>-1||(u=null);r=this._getTaskState();r.selectedEntityId&&(this._updateSelectedPrimitiveById(r.selectedEntityId),this._hideSelectedPrimitive(r.selectedEntityId));this._firstFrameRenderedHandler=this.map.getFrameManager().frameRendered.addOne(function(){var t,e,n,o;s.end("RT");t=i&&i.perfState||r&&r.searchPerfState;t&&(e=t.timestamp().getTime(),tt.log(tt.localListingTimeToGlass,e),n=Microsoft.Maps.Local,o=f instanceof n.HotelsListingTask?tt.hotelslocalListingTimeToGlass:f instanceof n.RestaurantsListingTask?tt.restaurantslocalListingTimeToGlass:f instanceof n.HouseListingTask?tt.realEstatelocalListingTimeToGlass:"",o&&tt.log(o,e));r&&r.searchPerfState&&(u&&f._categories.indexOf(u)===-1&&f._categories.insert(u),f._requestMicroPoiRefresh(r))});this.registerFilterBarEventHandlersV2();t.prototype.setTaskComplete.call(this,i);this._setTaskCompleted=!0;this._hideSelected&&this._hideSelected.invoke();i&&i.mapPannedOrZooomed&&this.scrollLane.invoke(this.panelRoot);this._drawBoundary()},o.prototype.setDisplayState=function(n){var e=this,u,f;t.prototype.setDisplayState.call(this,n);this._categories.length===0?this._microPoiManager&&this._microPoiManager.setTaskDisplayState(n):this._updateCategories("updateDisplayState",null,this.displayState);n.activationState===2?(i._getIsSlideCardEnabled()||(u=this.viewModel.getResponseContainer(),u.remove_class(o._hoverClassName),f=r("."+o._hoverClassName,u[0]),f.remove_class(o._hoverClassName)),this._cityPolygonManager&&this._polygonLayerAdded&&(this._cityPolygonManager.removeLayer(),this._polygonLayerAdded=!1),y.mapsInfobox&&y.mapsInfobox.setOptions({visible:!1})):n.activationState===1&&(i._getIsSlideCardEnabled()&&(u=this.viewModel.getResponseContainer(),u.remove_class(o._hoverClassName),f=r("."+o._hoverClassName,u[0]),f.remove_class(o._hoverClassName)),this._taskState&&this._taskState.vdpid&&!this._polygonLayerAdded&&(this._cityPolygonManager?this._cityPolygonManager.addLayer(this._taskState.vdpid,o._polygonMinZoomLevel,o._polygonMaxZoomLevel):this.map.getCityPolygonManager().then(function(n){e._cityPolygonManager=n;n.addLayer(e._taskState.vdpid,o._polygonMinZoomLevel,o._polygonMaxZoomLevel)}),this._polygonLayerAdded=!0));typeof n.colorIndex=="number"&&(this._colorIndex=n.colorIndex)},o.prototype.isSharable=function(){return t.prototype.isSharable.call(this)},o.prototype._doScrollLaneAction=function(){this.scrollLane.invoke(this.panelRoot)},o.prototype._registerEvents=function(){var n=this;this.disposables.push(this.poiManager.refreshResultsRequired.add(function(){if(!n._taskState||!n._taskState.disableListingRefresh){var i=_ge("map_auto_refresh_checkbox");(!i||i.checked)&&(n._taskState.point&&(n._taskState.point=null),t.prototype._refreshWithDelay.call(n,{mapPannedOrZooomed:!0}),n._requestMicroPoiRefresh(n._getTaskState()))}}))},o.prototype.onFilterValueChanged=function(n,i){this._taskState.localFilters=n;this._categories.length>0&&this._updateCategories("updateFilters",this._taskState.localFilters);this.viewModel&&this.viewModel.resetServerPagination&&this.viewModel.resetServerPagination();t.prototype._refreshWithDelay.call(this,i?{appliedFilterOption:i,filterValueChanged:!0}:{filterValueChanged:!0})},o.prototype.registerFilterBarEventHandlersV2=function(){var n,t,i,r;this.panelRoot[0]&&(n=this.panelRoot[0].getElementsByClassName("bm_sortOption"),n&&n.length>0?this._bindFiltersV2(n):(t=this.panelRoot.select("#LayoutSortBar")[0],t&&this.registerFilterEventHandlers(t)));i=this.panelRoot.select("#bm_contextualTaskbar")[0];i&&(r=i.getElementsByClassName("bm_filterBar")[0],r&&this.registerFilterEventHandlers(r))},o.prototype.registerFilterEventHandlers=function(n){var f=n.getElementsByClassName("filterOption"),i,t,r,u;for(this._bindFiltersV2(f),i=n.getElementsByClassName("b_toggle"),t=0,r=i.length;t<r;t++)u=i[t],sj_be(u,"click",function(n){sj_pd(n)})},o.prototype.logInstrumentationEventForServerRenderedFilter=function(n){var t=n.currentTarget&&n.currentTarget.parentElement&&n.currentTarget.parentElement.className,i=t==="ftrPr"?1:t==="ftrRt"?2:0,r={logData:{feature:nt.FiltersBar,action:h.Selected,data:{Q:this._taskState.query,FT:i,FA:this._taskState.localFilters,IS:!0}}};e.invokeHandler(f.instrumentationDataHandlerKey,r)},o.prototype._resetFilterStates=function(){this._taskState.localFilters=""},o.prototype._registerNoResultResetFiltersClickHandler=function(){var n=this,i,r;this.panelRoot&&(i=this.panelRoot.select("div[data-answerinfo]"),i&&i.length&&i.get_attr("data-answerinfo")==="0"&&(r=this.panelRoot.select(".bm_resetButton"),r&&r.length&&r.add_event("click",function(i){i&&i.preventDefault();n._resetFilterStates();n._categories&&n._categories.length>0&&n._updateCategories("updateFilters",n._taskState.localFilters);n.viewModel&&n.viewModel.resetServerPagination&&n.viewModel.resetServerPagination();t.prototype._refreshWithDelay.call(n,{mapPannedOrZooomed:!0})})))},o.prototype._bindFiltersV2=function(n){var r=this,i,u,t;if(n&&n.length)for(i=0,u=n.length;i<u;i++)(t=n[i],t.className&&t.className.indexOf("selectedSortOption")>=0)||(sj_be(t,"click",function(n){var i=n.currentTarget.getAttribute("data-filterParam"),t=r.decodeHtmlEncoding(i);if(typeof t!="undefined"){r.logInstrumentationEventForServerRenderedFilter(n);r.onFilterValueChanged(t)}}),sj_be(t,"keydown",function(n){var t=n.which;(t===13||t===32)&&n.currentTarget.click&&n.currentTarget.click()}))},o.prototype.decodeHtmlEncoding=function(n){var t=sj_ce("textarea");return t.innerHTML=n,t.value},o.prototype._logPoiHoverIfNecessary=function(n,t){var r=n.primitive.entity;r&&(n.newValue===1?this._poiHoverStartTimeStamp=i._getCurrentTimeStamp():(this._poiHoverStartTimeStamp&&i._getCurrentTimeStamp()-this._poiHoverStartTimeStamp>=o._poiHoverLoggingThresholdForEventLogging&&this._logPoiHover(r,t),this._poiHoverStartTimeStamp=null))},o.prototype._onPoiViewStateChanged=function(n,t){var r=n.primitive.entity,h,c,l;if(r){h=this.pageProcessor.getListItem(r.id);this._logPoiHoverIfNecessary(n,t);switch(n.newValue){case 1:if(this.viewModel&&this.viewModel.loadDelayedListingImagesInPagination(),c=n.primitive,t?(l=this._defaultInfoboxContentsTemplate.replace("{title}",r.getTitle()),this.activateInfobox(c,l,!0)):this.activateInfobox(c),this._taskState&&typeof this._taskState.scrollListOnPoiHover!="undefined"&&!this._taskState.scrollListOnPoiHover)return;this._contextMenuOnListMode&&this._hideListItemContextMenu();this.viewModel.getResponseContainer().add_class(o._hoverClassName);break;case 2:if(r.id){h&&(this.viewModel.getResponseContainer().remove_class(o._hoverClassName),h.remove_class(o._hoverClassName));o._mapsInfobox&&o._mapsInfobox.setOptions({visible:!1});var a=this._getTaskState()&&this._getTaskState().directionsTaskId,p=a?u.POIAlongRoute:u.POI,v=this.pageProcessor.getCatId(this.viewModel.getResponseContainer()),w={entryPoint:p,id:r.id,flippingCard:!0,taskTitle:r.getTitle(),directionsTaskId:a,selectedCategoryId:v?v:r.getSelectedCategoryForIcon&&r.getSelectedCategoryForIcon(),originIG:this._taskState&&this._taskState.originIG,parentIG:this._getImpressionGuid(),iid:this.pageProcessor.iids&&this.pageProcessor.iids[r.id],searchQueryCategory:this._taskState&&this._taskState.searchQueryCategory},b={parentId:this.id};e.invokeHandler(f.taskDataHandlerKey,{type:s.localDetailsTask,state:w,activateOptions:b});this._logPoiClick(r,t);this._setSelectedPrimitive(n.primitive)}break;case 0:if(y.mouseoverTimeout===0&&(y.mouseoverTimeout=500),window.clearTimeout(y.mouseoverDelayHandle),y.mouseoverDelayHandle=window.setTimeout(function(){y.mapsInfobox&&(y.mapsInfobox.preventAutoClose||y.mapsInfobox.setOptions({visible:!1}))},y.mouseoutTimeout),h){if(i._getIsSlideCardEnabled()&&this._taskState.selectedEntityId&&h===this.pageProcessor.getListItem(this._taskState.selectedEntityId))break;this.viewModel.getResponseContainer().remove_class(o._hoverClassName);h.remove_class(o._hoverClassName);o._mapsInfobox&&o._mapsInfobox.getVisible()&&(o._mapsInfobox.preventAutoClose||o._mapsInfobox.setOptions({visible:!1,closeDelayTime:500}))}}}},o.prototype._updateStateWithQueryParseData=function(){var t=this,i=this.panelRoot.select("div[data-queryparse]"),u,n,f;i&&i.length===1&&(u=i[0].getAttribute("data-queryparse"),u&&(n=r.Internals.parseJSON(u),n&&(n.queryKeyword&&(this._getTaskState().query=n.queryKeyword.trim(),this.setTitle(this._getTaskState().query),this._updateCategories("updateQuery"),f=this.poiManager,f&&f.labelsRendered.addOne(function(){t._taskState.mapBounds=t._getLocalMapViewBounds();t.serializableObjectChanged.invoke({magnitude:0})})),n.spellerCorrectedQuery&&(this._getTaskState().spellerCorrectedQuery=n.spellerCorrectedQuery),n.microPoiRequestIsAllowed&&(this._getTaskState().microPoiRequestIsAllowed=n.microPoiRequestIsAllowed),n.chainId&&(this._chainId=n.chainId),n.catId&&(this._catId=n.catId))))},o.prototype._logPoiClick=function(n,t){if(this._getTaskState()){var r=this._getTaskState().query||"",u=t?!0:!1,i={logData:{feature:nt.POI,action:h.Clicked,data:{ID:n.id,Q:r,BB:this._getLocalMapViewBounds(),MP:u}}};this.isSearchAlongRouteEnabled()&&(i.logData.data.AL=!0);e.invokeHandler(f.instrumentationDataHandlerKey,i);this._logInstrumentationEventForEntityClick()}},o.prototype._logPoiHover=function(n,t){if(this._getTaskState()){var r=this._getTaskState().query||"",i={logData:{feature:nt.POI,action:h.Hovered,data:{ID:n.id,Q:r,BB:this._getLocalMapViewBounds(),MP:!!t}}};this.isSearchAlongRouteEnabled()&&(i.logData.data.AL=!0);e.invokeHandler(f.instrumentationDataHandlerKey,i)}},o.prototype._updateSelectedPrimitiveById=function(n){for(var t,r=this.getMapPrimitives(),i=0;i<r.length;i++)if(t=r[i],t&&t.entity&&t.entity.id===n){this._taskState.selectedEntityId=null;this._setSelectedPrimitive(t);return}},o.prototype._setSelectedPrimitive=function(n){var t,r;if(this._taskState){if(this._taskState.selectedEntityId){if(this._taskState.selectedEntityId===n.entity.id)return;this._resetSelectedPrimitive()}i._getIsSlideCardEnabled()&&(t=this.panelRoot.select("a.listings-item.hover"),t&&t.length&&t.remove_class(o._hoverClassName),r=this.pageProcessor.getListItem(n.entity.id),r&&(this.viewModel.getResponseContainer().add_class(o._hoverClassName),r.add_class(o._hoverClassName)));this._taskState.selectedEntityId=n.entity.id}},o.prototype._hideSelectedPrimitive=function(n){var t=this.viewModel.UpdatePrimitiveState(n,3);t&&(this.serializableObjectChanged.invoke({magnitude:0}),this.poiManager.invalidated.invoke())},o.prototype._resetSelectedPrimitive=function(){var n=this.viewModel.UpdatePrimitiveState(this._taskState.selectedEntityId,0);n&&this.poiManager.invalidated.invoke()},o.prototype._processItemClickEvent=function(n){for(var i=this.viewModel.getPushpinPrimitives(),t=0,r=i.length;t<r;t++)if(i[t].entity.id===n){this._setSelectedPrimitive(i[t]);break}this._logInstrumentationEventForEntityClick()},o.prototype.concatOverlayPrimitive=function(){this._contextMenuOnListMode?this._hideListItemContextMenu():t.prototype.concatOverlayPrimitive.call(this)},o.prototype._hideListItemContextMenu=function(){this._contextMenuOnListMode=!1;this._contextMenuElement.removeFromParent();this._contextMenuElement=null},o.prototype._hideContextMenuForOtherListingTasks=function(){var n={requestorType:s.localListingTask,requestorId:this.id,type:s.localListingTask,requestState:{hideContextMenu:!0},useActiveTasks:!0};e.invokeHandler(f.taskProcessDataHandlerKey,n)},o.prototype._processContextMenuEvent=function(n,t){var u=this,e,f,s;for(this._contextMenuOnListMode&&this._hideListItemContextMenu(),this._hideContextMenuForOtherListingTasks(),this._contextMenu.hide(),e=this.viewModel.getPushpinPrimitives(),f=0,s=e.length;f<s;f++)if(e[f].entity.id===t){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation();var h=r(n.currentTarget),c=n.pageX,l=n.pageY-o._contextMenuTopPadding;this._contextMenuOnListMode=!0;this._transientLensViewModel.buildMenu(e[f],h,function(n){u._contextMenuElement=i._createElement("div");u._contextMenuElement.add_class("bm_listMenu").set_style({left:c,top:l});n.appendTo(u._contextMenuElement);u.primitiveInteracted.invoke({action:1,element:u._contextMenuElement})})}},o.prototype._processSaveButtonClickEvent=function(n,t){var i,f,s,e,o;if(i)for(i=this.viewModel.getPushpinPrimitives(),f=0,s=i.length;f<s;f++)if(i[f].entity.id===t){if(n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation(),e=i[f].entity,!e)return;if(o=e.getLocation(),this._transientLensViewModel.getButtonGroupViewModel().setEntityData(e,{requestorType:"LocalListingTask",requestorId:this.id},r(n.target.parentElement)),!e||!o)return;var c=new di,l=c.getIsSignedIn()?"CollectionsMenu":"Collections",a={logData:{feature:nt.ListingCard,action:h.Clicked,data:{AN:l,CP:o,EP:u.LocalListing}}};this._transientLensViewModel.getButtonGroupViewModel().collectionButtonClicked(n,o,a,u.LocalListing)}},o.prototype._shouldProcessResponseOnRefresh=function(n,r){var u=!!this._taskState.localFilters||this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>0,f=r&&r.mapPannedOrZooomed;return t.prototype._shouldProcessResponseOnRefresh.call(this,n)||u&&!f||i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&this._taskState.scenarioKey==="ERR"},o.prototype._postRefresh=function(){sj_evt&&this.displayState&&this.displayState.prominence===1&&this.displayState.stackOrder===1&&sj_evt.fire("OnCardRefresh",this.panelRoot,this.stackId)},o.prototype._requestMicroPoiRefresh=function(n){if(n&&!(this._categories.length>0)){var t=this._isRestaurantMicropoiAllowed(n);(n.microPoiRequestIsAllowed||t||this.microPoiRequestForLocalOverlayIsAllowed())&&this._microPoiManager&&this._microPoiManager.fetchMicroPois(n.query,this.getMapPrimitives(),n.localFilters&&!t?n.localFilters:t&&n.isFilterSelected?"filterselected":null,this._chainId,this._catId,this.viewModel.getCardCategoryId())}},o.prototype._isRestaurantMicropoiAllowed=function(n){return n.isFallbackRequery&&(n.category&&i._isRestaurantCategory(n.category)||n.searchQueryCategory&&n.searchQueryCategory.indexOf("Restaurant")>-1)?(this._catId||(this._catId="90287"),!0):!1},o.prototype._onCategoriesChanged=function(n){var t,o,r;if(n.added&&this._taskState)for(t=0,o=n.added.length;t<o;t++)r=null,n.added[t]&&i._isHotelsCategory(n.added[t])&&this._taskState.keyRoutePoints&&this._taskState.keyRoutePoints.length>=2&&(r=this._getPointsString(this._taskState.keyRoutePoints)),e.invokeHandler(f.layerManagerDataHandlerKey,{action:"activateLayer",entryPoint:u.LocalListing,taskId:this.id,queryText:this._taskState.query,category:n.added[t],displayState:this.displayState,filters:this._taskState.localFilters,cacheId:this._taskState.cacheId,mapBounds:this._taskState.mapBounds,routePoints:r})},o.prototype._updateCategories=function(n,t,i){for(var r=0,o=this._categories.length;r<o;r++)e.invokeHandler(f.layerManagerDataHandlerKey,{action:n,entryPoint:u.LocalListing,taskId:this.id,displayState:i,filters:t,category:this._categories[r],queryText:this._taskState.query})},o.prototype._drawBoundary=function(){var t=this,n=this.panelRoot.select("div[data-vdpid]").get_attr("data-vdpid")||this._taskState&&this._taskState.vdpid,i=!1;if(n&&this._taskState){if(n===o._clearAttributeValue&&this._polygonLayerAdded&&this._cityPolygonManager){this._cityPolygonManager.removeLayer();this._polygonLayerAdded=!1;return}this._taskState.vdpid&&this._taskState.vdpid!==n&&(i=!0);this._taskState.vdpid=n}this._taskState&&this._taskState.vdpid&&(!this._polygonLayerAdded||i)&&(this._polygonLayerAdded&&this._cityPolygonManager&&this._cityPolygonManager.removeLayer(),this._cityPolygonManager?this._cityPolygonManager.addLayer(this._taskState.vdpid,o._polygonMinZoomLevel,o._polygonMaxZoomLevel):this.map.getCityPolygonManager().then(function(n){t._cityPolygonManager=n;n.addLayer(t._taskState.vdpid,o._polygonMinZoomLevel,o._polygonMaxZoomLevel)}),this._polygonLayerAdded=!0)},o.prototype._drawPivotEntity=function(){var u=this.panelRoot.select("div[data-pivot]").get_attr("data-pivot"),n,t,i;if(u){if(u===o._clearAttributeValue){this.poiManager.setPivotPrimitive(null);return}n=r.Internals.parseJSON(u);n&&n.name&&n.idType&&n.id&&n.latitude&&n.longitude&&!isNaN(n.latitude)&&!isNaN(n.longitude)&&(t=new p(n.latitude,n.longitude),i=new oi(n.name,null,n.idType+":"+n.id,t,t),i.setSearchCategory("PivotEntity"),i.setSelectedCategoryForIcon("PivotEntity"),this.poiManager.setPivotPrimitive(new ti(t,i)))}},o._clearAttributeValue="nodata",o._hoverClassName="hover",o._polygonMinZoomLevel=3,o._polygonMaxZoomLevel=11,o._poiHoverLoggingThresholdForEventLogging=500,o._contextMenuTopPadding=25,o}(y),nf=function(t){function r(n,i,r,u,f,e,o,s){var h=t.call(this,n,i,r,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._bindEventsForInfobox(),h}return a(r,t),r.prototype.activate=function(n,i){var r=this,u=this._taskState&&this._taskState.isCompareOverlayOpen,f=i&&i.isCompareOverlayOpen;if(u&&!f){sj_evt.fire("ovlHide","ent_ovlc",!0);return}this._compareOverlayShowHandlerWrapper||(this._compareOverlayShowHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._compareOverlayShowHandler.apply(r,t[0])},sj_evt.bind("ovlShow",this._compareOverlayShowHandlerWrapper,0));this._compareOverlayHideHandlerWrapper||(this._compareOverlayHideHandlerWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._compareOverlayHideHandler.apply(r,t[0])},sj_evt.bind("ovlHide",this._compareOverlayHideHandlerWrapper,0));t.prototype.activate.call(this,n,i)},r.prototype._refresh=function(n){var r,u,o;if(this._taskState.cacheId=null,t.prototype._refresh.call(this,n),i._isLocalOverlayShownOnSerp())for(r=0,u=this._categories.length;r<u;r++)i._isHotelsCategory(this._categories[r])&&(o={action:"refreshData",taskId:this.id,category:this._categories[r]},e.invokeHandler(f.layerManagerDataHandlerKey,o))},r.prototype._resetFilterStates=function(){if(t.prototype._resetFilterStates.call(this),n.showPricePoiHotelsOnOneMap){_w.priceFilterPrice="$500";var i=this._getNextNextNextSunday();_w.ol_startdate=i.toDateString();i.setDate(i.getDate()+1);_w.ol_enddate=i.toDateString()}},r.prototype._createUrl=function(n,i,r){var f,o;this._taskState&&(this._taskState.isFallbackRequery=!0,this._taskState.scrollListOnPoiHover=!1,this._taskState.sendInstrumentationEventOnEntityClick=!0);this._updateLocalFiltersForPricePoi();var e=t.prototype._createUrl.call(this,n,i,r);return e+=this._taskState.entryPoint!==u.SearchBox&&this._taskState.entryPoint!==u.SearchButton&&!this._taskState.isFallbackRequery||this._taskState.localFilters||n&&(n.appliedFilterOption||n.mapPannedOrZooomed)?"&FORM=BHO001":"&FORM=BHO002",f=this._taskState.passThruParam,f&&f.toUpperCase().indexOf("FORM=")===-1&&(e+=f.indexOf("&")!==0?"&"+f:f),o=Logger.getOverlayType(),o||(e+="&mapsVertical=true"),this._taskState.cacheId&&(e+="&cacheid="+this._taskState.cacheId),e},r.prototype.onFilterValueChanged=function(n,i){this._updateLocalFiltersForPricePoi(n);t.prototype.onFilterValueChanged.call(this,this._taskState.localFilters,i)},r.prototype.processResponse=function(n,i){var r,u;t.prototype.processResponse.call(this,n,i);this._taskState&&this.panelRoot&&(r=this.panelRoot.select("div[data-cacheid]"),r&&r.length===1&&(u=r[0].getAttribute("data-cacheid"),u&&(this._taskState.cacheId=u)))},r.prototype.registerFilterBarEventHandlersV2=function(){var i=this.panelRoot.select("#bm_contextualTaskbar")[0],n;i&&(this._processCalendarControl(),this._processPriceFilter(),n=i.getElementsByClassName("bm_filterBar")[0],n&&(_w.hpaFilter=n.getAttribute("fp")));t.prototype.registerFilterBarEventHandlersV2.call(this)},r.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},r.prototype._updateLocalFiltersForPricePoi=function(t){var h,e,i,r,l,a,t,v,s,y;if(n.showPricePoiHotelsOnOneMap){if(this._taskState&&this._taskState.localFilters&&this._taskState.fromSharing){h=this._taskState.localFilters;this._saveDateFromFilters(h,"_SD-\\d{8}","ol_startdate");this._saveDateFromFilters(h,"_ED-\\d{8}","ol_enddate");this._taskState.fromSharing=!1;return}_w.ol_hdf=!0;_w.priceFilterPrice=_w.priceFilterPrice||"$500";_w.ol_startdate=_w.ol_startdate||this._getNextNextNextSunday().toDateString();_w.ol_enddate||(e=this._getNextNextNextSunday(),e.setDate(e.getDate()+1),_w.ol_enddate=e.toDateString())}if(i=t||this._taskState.localFilters||this._taskState.filterUrlParam,i?i.indexOf('local_filters:"UR')===-1&&i.indexOf(",UR")===-1&&(i=i.replace('local_filters:"','local_filters:"UR4U,')):i='local_filters:"UR4U"',_w.ol_hdf){if(r="",_w.priceFilterPrice&&(r="LHP-0_HHP-"+_w.priceFilterPrice.replace("$","").replace("+","")),_w.ol_startdate&&_w.ol_enddate){var p="MMddyyyy",w=_w.ol_startdate,b=_w.ol_enddate,u=null,f=null,c=_w.SpecificDateFormat,o=_w.DateFormatSeparator;typeof DateHelper!="undefined"&&typeof DateHelper.parseShortDate!="undefined"&&(c?(u=DateHelper.parseShortDate(w,o,c.split(o)),f=DateHelper.parseShortDate(b,o,c.split(o))):(u=DateHelper.parseShortDate(w),f=DateHelper.parseShortDate(b)));(!u||isNaN(u.valueOf()))&&(u=new Date(_w.ol_startdate));(!f||isNaN(f.valueOf()))&&(f=new Date(_w.ol_enddate));l=this._calendarFormatDate(u,p);a=this._calendarFormatDate(f,p);r=r?r+"_SD-"+l+"_ED-"+a:"SD-"+l+"_ED-"+a}t='hotel_filters:"'+r+'" segment:"Hotel"';v=i.indexOf("hotel_filters");i=v===-1?i+" "+t:i.slice(0,v)+t}this.panelRoot&&(s=this.panelRoot.select("div[data-locationfilterkey]"),s&&s.length&&(y=s.get_attr("data-locationfilterkey"),y&&(i+=' locationfilterkey:"'+y+'"')));this._taskState.localFilters=i},r.prototype._compareOverlayShowHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]==="ent_ovlc"&&(this._taskState.isCompareOverlayOpen=!0,this.serializableObjectChanged.invoke({magnitude:2}))},r.prototype._compareOverlayHideHandler=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t[1]==="ent_ovlc"&&(this._taskState.isCompareOverlayOpen=!1,!t[2]==!0&&this.serializableObjectChanged.invoke({magnitude:2}))},r.prototype._bindEventsForInfobox=function(){var n=this;sj_evt&&(sj_evt.bind("pushpinhoverstarted",function(t){var i=t[1],e=i.entity.id.replace("ypid:","").replace("sid:",""),u=_ge(e),r,f;u&&(r=new Microsoft.Maps.Location(i.geometry.y,i.geometry.x),f="<div class='MiniInfobox2' id= 'infobox-container' > <div class='infobox-body' >"+u.innerHTML+"<\/div><\/div>",n._infoboxOptions.htmlContent=f,n._infoboxOptions.location=r,n._infobox?n._infobox.setOptions(n._infoboxOptions):(n._infobox=new ei(r,n._infoboxOptions),n._infobox.setMap(n.map)))}),sj_evt.bind("pushpinhoverstopped",function(){n._infobox&&n._infobox.setOptions({visible:!1})}))},r.prototype._processPriceFilter=function(){var n=this;sj_evt.bind("priceFilterUpdate",function(){n.onFilterValueChanged(null)})},r.prototype._processCalendarControl=function(){var t=this,n;this.panelRoot&&(n=this.panelRoot.select("div[data-calendarEndId]"),n&&n.length&&(this._calendarEndId=n.get_attr("data-calendarEndId")));this._calendarEndId&&sj_evt.bind("TwoCalCombo_EndDateClick",function(n){var i=n[1];if(i==t._calendarEndId){_w.ol_startdate=n[2];_w.ol_enddate=n[3];t.onFilterValueChanged(null)}})},r.prototype._getNextNextNextSunday=function(){var n=new Date,t=6-n.getDay(),i=t+15;return n.setDate(n.getDate()+i),n},r.prototype._calendarFormatDate=function(n,t){var i=n.getMonth(),r=n.getDate();return t.replace(/yyyy/i,n.getFullYear().toString()).replace(/mm/i,(i<9?"0":"")+(i+1)).replace(/m/i,(i+1).toString()).replace(/dd/i,(r<10?"0":"")+r).replace(/d/i,r.toString())},r.prototype._saveDateFromFilters=function(n,t,i){var e=new RegExp(t,"i"),u=n.search(e),r,f;u>-1&&u+12<=n.length&&(r=n.substr(u+4,8),r&&r.length===8&&(f=this._convertFilterDate(r),f&&(_w[i]=f)))},r.prototype._convertFilterDate=function(n){var r;if(n&&n.length===8){var t=parseInt(n.substr(0,2),10),i=parseInt(n.substr(2,2),10),u=parseInt(n.substr(4,4),10);return isNaN(t)||t<1||t>12||isNaN(i)||i>31||i<1||isNaN(u)?null:(r=new Date(u,t-1,i),r?r.toDateString():null)}return null},r}(et),tf=function(t){function i(i,r,u,f,e,o,s,h,c,l){var a=t.call(this,i,r,u,f,e,o,s,h,c,l)||this;return a.setRecommendedWidth(n.houseCardWidth),a.setCurrentWidth(n.houseCardWidth),a}return a(i,t),i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForRealEstateOverlayOnSerp},i}(kt),rf=function(t){function i(n,i,r,u,f,e,o,s){var h=t.call(this,n,i,r,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._bindEventsForInfobox(),h._isFirstRequest=!0,h}return a(i,t),i.prototype._refresh=function(n){this.map.getMapType().id!==si.birdseyeV2&&t.prototype._refresh.call(this,n)},i.prototype._createUrl=function(n,i,r){return this._taskState&&(this._taskState.poiCount="20",this._taskState.isFallbackRequery=!0,this._taskState.scrollListOnPoiHover=!1,this._taskState.sendInstrumentationEventOnEntityClick=!0),t.prototype._createUrl.call(this,n,i,r)},i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForRealEstateOverlayOnSerp},i.prototype._getLocationInfo=function(){return this._isFirstRequest?"":t.prototype._getLocationInfo.call(this)},i.prototype._sendSearchRequest=function(n,i,r){this._isFirstRequest=!1;t.prototype._sendSearchRequest.call(this,n,i,r)},i.prototype.logInstrumentationEventForServerRenderedFilter=function(n){var t=n.currentTarget&&n.currentTarget.parentElement&&n.currentTarget.parentElement.id,i={logData:{feature:nt.FiltersBar,action:h.Selected,data:{Q:this._taskState.query,FT:t,FA:this._taskState.localFilters,IS:!0}}};e.invokeHandler(f.instrumentationDataHandlerKey,i)},i.prototype.processResponse=function(n,i){this._updateQueryParamsForSubscription(n);t.prototype.processResponse.call(this,n,i)},i.prototype._updateQueryParamsForSubscription=function(n){var i=this,t="data-queryparams",r=n&&n.select("["+t+"]").get_attr("id");r&&this.map&&this.poiManager&&this.disposables.push(this.poiManager.labelsRendered.addOne(function(){var f=it.getMapCenter(i.map),e=it.getMercatorZoomLevel(i.map),u=document.getElementById(r),n;u&&(n=u.getAttribute(t),n&&(n+=";"),n+="cp:"+f.latitude+"~"+f.longitude+";lvl:"+e,u.setAttribute(t,n))}))},i.prototype._bindEventsForInfobox=function(){var n=this;sj_evt&&(sj_evt.bind("pushpinhoverstarted",function(t){var i=t[1],e=i.entity.id.replace("ypid:","").replace("sid:",""),u=_ge(e),r,f;u&&(r=new Microsoft.Maps.Location(i.geometry.y,i.geometry.x),f="<div class='MiniInfobox2' id= 'infobox-container' > <div class='infobox-body' >"+u.innerHTML+"<\/div><\/div>",n._infoboxOptions.htmlContent=f,n._infoboxOptions.location=r,n._infobox?n._infobox.setOptions(n._infoboxOptions):(n._infobox=new ei(r,n._infoboxOptions),n._infobox.setMap(n.map)))}),sj_evt.bind("pushpinhoverstopped",function(){n._infobox&&n._infobox.setOptions({visible:!1})}))},i}(et),uf=function(){function n(){this._birdseyePreviewInitialized=!1}return n.prototype.process=function(n,u,e){var o,c,h,s;n&&u&&(u.showBackButton&&(o=i._createElement("a"),o.add_class("commonButton backArrowButton overlayButton"),o.set_attr("href","#"),o.set_attr("title",u&&u.cameFromCollections?t.L_LocalSearch_BackToCollections:t.L_LocalSearch_BackToSearchResults),c=u.listingTaskId?{action:"focus",id:u.listingTaskId}:{action:"remove",id:u.id},o.set_attr(f.taskDataHandlerKey,r.Internals.stringify(c)),h=i._createElement("div"),h.add_class("overlayBackButtonText"),h.set_text(t.L_LocalSearch_ReturnToList),o.append(h),s=i._createElement("div"),s.set_attr("data-tag","detailsCardBackBtnContainer"),s.set_style({"padding-bottom":"35px"}),s.append(o),n.insertBefore(s,n[0].firstElementChild)),this._processStreetside(n,e,u),this._processGeochain(n,u))},n.prototype._processStreetside=function(n,t,i){var c=this,o=n.select("a[data-streetside]"),l=i?i.routablePoint:null,h,s,u,a,v;if(!tr||!tr.isEnabled){o&&o.getParent().getParent()&&o.getParent().getParent().removeFromParent();return}h=o&&o.get_attr("data-streetside");h&&(s=r.Internals.parseJSON(h),u=s.localDetailsStartupOptions,u&&(u.fov=null,u.heading=null,u.pitch=null,!u.routablePoint&&l&&(u.routablePoint=l),o.set_attr("data-streetside",r.Internals.stringify(s))),u.canonicalImageUrlGroup&&u.canonicalImageUrlGroup.length?o.set_style({display:"block","background-image":"url('"+u.canonicalImageUrlGroup[0].url+"')"}):(o.set_attr("data-streetside",""),a=t&&t.start(cu.LocalDetailsIntegrationTime),u.sivImageContainer=o,i!=null&&i.location==null&&s!=null&&s.location!=null&&(i.location=new p(s.location.latitude,s.location.longitude)),v={action:"showBubbleImage",location:new p(s.location.latitude,s.location.longitude),localDetailsStartupOptions:u,perfState:a,callback:function(){c._processBirdsEyePreview(n,i,o,!1)},errorCallback:function(){c._processBirdsEyePreview(n,i,o,!0)}},e.invokeHandler(f.streetsideDataHandlerKey,v)))},n.prototype._processBirdsEyePreview=function(n,t,i,r){var f=this,u;if(!this._birdseyePreviewInitialized){if(this._birdseyePreviewInitialized=!0,!n||!t||!t.map||!t.location){r&&i&&i.getParent().getParent()&&i.getParent().getParent().removeFromParent();return}u=n.select("a[id=bev2Img]");u&&u.length?(this._loadBirdsEyeThumbnail(n,t,i,r),t.map.mapResized.add(function(){f._loadBirdsEyeThumbnail(n,t,i,r)})):r&&i&&i.getParent()&&i.getParent().removeFromParent()}},n.prototype._loadBirdsEyeThumbnail=function(n,t,i,r){var h=this,u=n.select("a[id=bev2Img]"),c=t.location,f=t.map,o=ht.north,e=v.features.taskFramework,l=e&&e.defaultZoomLevel?e.defaultZoomLevel:16,s=ii.toLocation(c,l,!0),a=gr.imageryStartZoom+1;dr.getBirdseyeV2Thumbnail(f.getConfig(),s,a,function(n){var e;n?(u.set_style({"background-image":"url('"+n+"')"}),i.getParent().set_style({display:""}),i?(e=i.get_style("display"),e&&e.indexOf("none")===-1?(i.add_class("bm_sharedModule"),i.set_style({display:"inline-block"}),u.add_class("bm_sharedModule"),u.set_style({display:"inline-block"})):u.set_style({display:"block"})):u.set_style({display:"block"}),u.add_event("click",function(n){h._birdseyePreviewClicked(n,s,f,o,t.taskTitle,t.getDisplayState)})):(u.set_style({display:"none"}),e=i.get_style("display"),e&&e.indexOf("none")===-1&&(i.remove_class("bm_sharedModule"),i.set_style({display:"block"})),r&&i&&i.getParent().getParent()&&i.getParent().getParent().set_style({display:"none"}))},o,f.getViewport())},n.prototype._computeBirdsEyeHeading=function(n,t){if(!n||!t||isNaN(n.latitude)||isNaN(n.longitude)||isNaN(t.latitude)||isNaN(t.longitude))return ht.north;var r=this._toRad(n.longitude-t.longitude),u=Math.sin(r)*Math.cos(this._toRad(n.latitude)),f=Math.cos(this._toRad(t.latitude))*Math.sin(this._toRad(n.latitude))-Math.sin(this._toRad(t.latitude))*Math.cos(this._toRad(n.latitude))*Math.cos(r),e=this._toDeg(Math.atan2(u,f)),i=(e+360)%360;return i>=315||i>=0&&i<45?ht.north:i>=45&&i<135?ht.east:i>=135&&i<225?ht.south:i>=225&&i<315?ht.west:ht.north},n.prototype._toRad=function(n){return n*Math.PI/180},n.prototype._toDeg=function(n){return n*180/Math.PI},n.prototype._birdseyePreviewClicked=function(n,t,i,r,o,s){n&&n.preventDefault();n&&n.stopPropagation();e.invokeHandler(f.instrumentationDataHandlerKey,{logData:{feature:rt.BirdseyeV2,action:h.Clicked,data:{EP:u.LocalDetails,CP:t}}});var c=v.features.taskFramework,l=c&&c.defaultZoomLevel?c.defaultZoomLevel:16;it.setMapCenter(i,t,l,r,new fu(i.getView(),new pi(ii.toLocation(t,l,!0),r)),null,null,{top:0,right:0,bottom:0,left:0});v.tileRefactoringEnabled?i.getFrameManager().frameRendered.addOne(function(){i.setMapType(i.createMapType(si.birdseyeV2));i.getBirdseyeV2Manager().then(function(n){var i=s();n&&n.addContextPoi(t,o,i?i.colorIndex:3)})}):Microsoft.Maps.setTimeout(function(){i.setMapType(i.createMapType(si.birdseyeV2));i.getBirdseyeV2Manager().then(function(n){var i=s();n&&n.addContextPoi(t,o,i?i.colorIndex:3)})},1200)},n.prototype._processGeochain=function(n,t){var i,r,u;t.geochainManager&&t.map&&(i=n?n.select(".geochainModule"):null,i&&t.location)&&(t.boundingBox||(t.boundingBox=[t.location,t.location,t.location,t.location]),r=yi.fromCorners(t.boundingBox[0],t.boundingBox[1]),u=function(n){if(!n||n.length===0){i.parent().removeFromParent();return}var r=new er(n,t.controlTemplateFactory);r.getControl().appendTo(i)},t.geochainManager.getGeochain(u,t.location,r,!0))},n}(),hr=function(){function t(){}return t.prototype.getCatId=function(n){var r,t;return i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&n&&(t=n.select("div[data-category]"),t&&t.length&&(r=t.get_attr("data-category"))),r},t.prototype.process=function(n,t){var i=this,f,u;n&&(this._listElements={},this.iids={},this._listItems=n.select("a[data-entity]"),f=this.getCatId(n),u=0,this._listItems.for_each(function(n){var c=n.getAttribute("data-entity"),o=c&&c.length>0&&r.Internals.parseJSON(c),h,s,l,e;o&&o.entity&&o.entity.id&&(h=r(n),s=o.entity.id,i._listElements[s]=h,l=n.getAttribute("h"),l&&(e=l.split("="),e&&e.length===2&&(e=e[1].split("."),e&&e.length&&(i.iids[s]=e[0].replace(",",".")))),i._setTaskData(n,o.entity,t,f),i._addQuicksaveIcon(n,s,t),h.add_event("click",function(n){return t.clickHandler(n,o.entity.id)}),h.add_event("contextmenu",function(n){return t.contextMenuHandler(n,o.entity.id)}));i._updateListItemStyle(n);i._setInstrumentationData(n,s,u,t);u++}))},t.prototype.getListItem=function(n){return this._listElements[n]},t.prototype.getFirstListItem=function(){return r(this._listItems[0])},t.prototype._setInstrumentationData=function(n,t,i,u){var f={ID:t,Q:u&&u.query?u.query:"",PO:i+1},e=w[w.LLT]+"_"+h.Clicked,o={logData:{feature:rt.Search,action:e,data:f}};n.setAttribute("data-instrumentation",r.Internals.stringify(o))},t.prototype._updateListItemStyle=function(n){var t=r(n).select("div.inner img");t&&t.length!==0||r(n).select("div.inner").add_class("imgHolder")},t.prototype._setTaskData=function(n,t,e,o){var l=e&&e.directionsTaskId,a=l?u.LocalListingAlongRoute:u.LocalListing,h={entryPoint:a,id:t.id,flippingCard:!0,taskTitle:t.title,directionsTaskId:e&&e.directionsTaskId,selectedCategoryId:o?o:t.primaryCategoryPath,originIG:e&&e.originIG,parentIG:e&&e.parentIG,iid:this.iids[t.id],query:t.id?t.seeMoreQueryText:t.title,infoboxHtml:t.infoboxHtml,isBookingModuleEntryPoint:e&&e.isBookingModuleEntryPoint},c;h.id&&h.id.indexOf("eventId:")===0&&(h.latLongForEventRequery=t.latitude+","+t.longitude,h.locationForEventRequery=t.city);c={state:h,type:i._isFeatureEnabled("verticalZipcode")&&i._isZipCodeCategory(h.selectedCategoryId)?s.polygonEntityDetailsTask:s.localDetailsTask,activateOptions:{parentId:e&&e.taskParentId}};n.setAttribute(f.taskDataHandlerKey,r.Internals.stringify(c))},t.prototype._addQuicksaveIcon=function(t,i,u){if(n.listingQuicksaveEnabled){var f=r(t).select(".bm_qsicon");f&&f.length>0&&n.listingQuicksaveClass&&(f.add_class(n.listingQuicksaveClass),n.listingQuicksaveClass==="bm_contextMenuButton"?f.add_event("click",function(n){return u.contextMenuHandler(n,i)}):n.listingQuicksaveClass==="bm_saveButton"&&f.add_event("click",function(n){return u.saveButtonClickHandler(n,i)}))}},t}(),ui=function(n){function i(){var r=this,i={};return r=n.call(this,i)||this,r.resources=t,i.defineProperty("factLabel"),i.defineProperty("factData"),i.defineProperty("extendedFacts"),r}return a(i,n),i.prototype.dispose=function(){this.factData=null;this.factLabel=null},i.prototype.nullToDisplayNone=function(n){return n?"":"none"},i.prototype.displayOnTrails=function(n){return this.showIfEqual(n,"trails")},i.prototype.displayOnCampgrounds=function(n){return this.showIfEqual(n,"campgrounds")},i.prototype.showIfEqual=function(n,t){return n===t?"":"none"},i}(bt),cr=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("start"),t.defineProperty("end"),i}return a(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this.start=null;this.end=null},t}(bt),lr=function(n){function t(){var i=this,t={};return i=n.call(this,t)||this,t.defineProperty("day"),t.defineProperty("hourRanges"),i}return a(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);this.day=null},t}(bt),ff=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return a(t,n),t}(fr),ai=function(){function n(){}return n.getNameForProperty=function(n){switch(n){case"at":return t.L_PrintExtendedAt_Text;case"capital":return t.L_PrintExtendedCapitol_Text;case"countyseat":return t.L_PrintExtendedCounty_Text;case"area":return t.L_PrintExtendedArea_Text;case"population":return t.L_PrintExtendedPopulation_Text;case"cuisine":return t.L_PrintExtendedCuisine_Text;case"price":return t.L_PrintExtendedPrice_Text;case"hotelclass":return t.L_PrintExtendedHotelClass_Text;case"avgrate":return t.L_PrintExtendedAvgRate_Text;case"Founded":case"founded":return t.L_PrintExtendedFounded_Text;case"gdp":return t.L_PrintExtendedGDP_Text;case"callingcode":return t.L_PrintExtendedCC_Text;case"specialty":return t.L_PrintSpecialtyTitle_Text;case"experience":return t.L_PrintExperienceTitle_Text;case"clinic":return t.L_PrintClinicTitle_Text;case"homefacts":return t.L_PrintHomeFactsTitle_Text;case"moreinfo":return t.L_PrintMoreInfoTitle_Text;case"lastsold":return t.L_PrintLastSoldTitle_Text;case"zestimate":return t.L_PrintZestimateTitle_Text;case"Season":return t.L_PrintSeason_Text;case"Activity":case"Activities":return t.L_PrintActivities_Text;case"Rates":return t.L_PrintRates_Text;case"Open":return t.L_PrintOpen_Text;case"Sites":return t.L_PrintSites_Text;case"Interests":return t.L_PrintInterests_Text;case"Opened":return t.L_PrintOpened_Text;case"Floors":return t.L_PrintFloors_Text;case"Height":return t.L_PrintHeight_Text;case"Architect":case"Architects":return t.L_PrintArchitects_Text;case"Established":return t.L_PrintEstablished_Text;case"Artist":case"Artists":return t.L_PrintArtists_Text;case"Subjects":return t.L_PrintSubjects_Text;case"Media":return t.L_PrintMedia_Text;case"Teams":return t.L_PrintTeams_Text;case"Capacity":return t.L_PrintCapacity_Text;case"Elevation":return t.L_PrintElevation_Text;case"Prominence":return t.L_PrintProminence_Text;case"speciality":return t.L_PrintSpecialtyTitle_Text;case"Nearby airports":case"Nearby airport":return t.L_PrintNearbyAirport_Text;case"First ascent":return t.L_PrintFirstAscent_Text;case"First ascender":return t.L_PrintFirstAscender_Text;case"Mountain range":return t.L_PrintMountainRange_Text;case"Last eruption":return t.L_PrintLastEruption_Text;case"Colleges and universities":return t.L_PrintCollegesUniversities_Text;case"Architecture firm":return t.L_PrintArchitectureFirm_Text;case"Service Areas":return t.L_PrintServiceAreas_Text;case"Date completed":return t.L_PrintDateCompleted_Text;case"Annual visitors":return t.L_PrintAnnualVisitors_Text;case"Average stay":return t.L_PrintAverageStay_Text}return null},n.parseAndPushDataFactForPrint=function(t,i){var r,u;if(i&&t)for(r in t)u=n.getNameForProperty(r),n.complexType.indexOf(r)!==-1?n.pushFactToList(i,null,null,t):n.pushFactToList(i,u,n.beautifyList.indexOf(r)===-1?t[r]:n.beautify(t[r]))},n.listContains=function(n,t){for(var i=0;i<n.length;i++)if(n[i].getFactLabel()===t)return!0;return!1},n.pushFactToList=function(t,i,r,u){if(!n.listContains(t,i)){var f=n.setFactsInfo(t,i,r,u);f&&t.push(f)}},n.setFactsInfo=function(t,i,r,u){var f=null;return u?f=n.setExtendedFacts(t,u):i&&r&&(f=new ui,f.setFactLabel(i),f.setFactData(r)),f},n.setExtendedFacts=function(n,i){var o=null,r,u,f,e;return i&&(i.trails&&(r=i.trails,u=new ff,u.length=r.length?r.length:"",u.lengthIcon=r.lengthIcon?r.lengthIcon:"",u.elevation=r.elevation?r.elevation:"",u.elevationIcon=r.elevationIcon?r.elevationIcon:"",u.duration=r.duration?r.duration:"",u.durationIcon=r.durationIcon?r.durationIcon:"",u.difficulty=r.difficulty?r.difficulty:"",u.type="trails",o=new ui,o.setFactLabel(u.length||u.elevation||u.duration?t.L_PrintTrailInfo_Text:""),o.setExtendedFacts(u)),i.campgrounds&&(f=i.campgrounds,e=new du,e.rvSites=f.RVSites?f.RVSites:"",e.rvIcon=f.RVIcon?f.RVIcon:"",e.tentSites=f.tentSites?f.tentSites:"",e.tentIcon=f.tentIcon?f.tentIcon:"",o=new ui,o.setFactLabel(e.rvSites||e.tentSites?t.L_PrintMainSites_Text:""),o.setExtendedFacts(e))),o},n.beautify=function(n){return n.split(",").join(t.L_PrintSeparator_Text)},n.beautifyList=["Main sites","Nearby airport","Nearby airports","Colleges and universities","Teams","Media","Subjects","Artist","Artists","Architect","Architects","Height","Interests","Sites","Activities","Activity"],n.complexType=["trails","campgrounds"],n}(),ef=function(n){function t(t,i,r,u,f,e,o,h,c,l){var a=n.call(this,t,i,r,u,f,e,o,h,c,l)||this;return a.type=s.polygonEntityDetailsTask,a.displayState={groupName:"PolygonEntityDetails"},a}return a(t,n),t.prototype.activate=function(t,r){i._isFeatureEnabled("verticalZipcode")&&r.selectedCategoryId&&i._isZipCodeCategory(r.selectedCategoryId.toLowerCase())&&r&&r.id&&r.id.indexOf("sid:")>=0&&(r.query=r.taskTitle,r.id=null);n.prototype.activate.call(this,t,r)},t.prototype.canColorFade=function(){return v.features.taskFramework.canCardColorFade},t.prototype.setTaskComplete=function(){n.prototype.setTaskComplete.call(this);var t=this.viewModel.getEntities()[0].getVdpId();t&&(this._taskState.vdpid=t,this.serializableObjectChanged.invoke({magnitude:0}))},t}(kt),of=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return a(t,n),t.prototype.process=function(n,t){var i=this,u,f;n&&(this._listElements={},this.iids={},this._listItems=n.select("a[data-entity]"),u=this.getCatId(n),f=0,this._listItems.for_each(function(n){var l=n.getAttribute("data-entity"),e,h,c,a,o,s,v;l&&l.length>0?(e=r.Internals.parseJSON(l),e&&e.entity&&e.entity.id&&(h=r(n),c=e.entity.id,i._listElements[c]=h,a=n.getAttribute("h"),a&&(o=a.split("="),o&&o.length===2&&(o=o[1].split("."),o&&o.length&&(i.iids[c]=o[0].replace(",",".")))),i._setTaskData(n,e.entity,t,u),h.add_event("click",function(n){return t.clickHandler(n,e.entity.id)}),h.add_event("contextmenu",function(n){return t.contextMenuHandler(n,e.entity.id)}))):(s=n.getElementsByClassName("b_factrow"),s&&s.length>0&&s[0].innerHTML&&(v=s[0].innerHTML.trim().split("-")[0],i._setTaskData(n,{title:v,primaryCategoryPath:"ZipCode"},t,u)));i._updateListItemStyle(n);i._setInstrumentationData(n,c,f,t);f++}))},t.prototype._updateListItemStyle=function(n){var t=r(n).select("div.inner img"),i;t&&t.length!==0||(i=r(n).select("div.b_vPanel"),i.set_style({"margin-left":0,"text-align":"left"}))},t}(hr),sf=function(n){function t(t,i,r,u,f,e,o,s){return n.call(this,t,i,r,u,f,e,o,s)||this}return a(t,n),t.prototype._refresh=function(){},t.prototype.activate=function(t,i){this.viewModel||(this.viewModel=new af(this.map,this.panelRoot,this.id,this._logHelper,this.poiManager,this._transientLensViewModel,this.controlTemplateFactory));n.prototype.activate.call(this,t,i)},t.prototype._onPoiViewStateChanged=function(n,t){var r=n.primitive,i=r.entity;if(i&&i.id&&r.metadata){this._logPoiHoverIfNecessary(n,t);var h=this.map.getConfig(),c=this.map.getMercatorZoomLevel(),l=h.postCodeMaxHoverClickZoom;if(n.newValue===2&&c<=l){var o=this._getTaskState()&&this._getTaskState().directionsTaskId,a=o?u.POIAlongRoute:u.POI,p=this.pageProcessor.getCatId(this.viewModel.getResponseContainer()),v={entryPoint:a,id:i.id,flippingCard:!0,taskTitle:r.metadata.title,directionsTaskId:o,originIG:this._taskState&&this._taskState.originIG,parentIG:this._getImpressionGuid(),iid:this.pageProcessor.iids&&this.pageProcessor.iids[i.id],searchQueryCategory:this._taskState&&this._taskState.searchQueryCategory},y={parentId:this.id};e.invokeHandler(f.taskDataHandlerKey,{type:s.polygonEntityDetailsTask,state:v,activateOptions:y});this._logPoiClick(i,t);this._setSelectedPrimitive(n.primitive)}}},t.prototype.processResponse=function(t,u){if(i._isZipCodeCategory(this._taskState.category)||i._isZipCodeCategory(this._taskState.searchQueryCategory)){var e=t.select(".listings-item"),f=[];e.for_each(function(n){var i=r(n),t=i.select(".b_factrow");t&&t.length>0&&t[0].innerHTML.indexOf("-")>=0&&f.push(i.getParent())});f.forEach(function(n){return n.removeFromParent()})}n.prototype.processResponse.call(this,t,u)},t.prototype._createUrl=function(t,i,r){var f=i,u;if(this._taskState.originalResponse&&(u=this._taskState.originalResponse.select("div.overlay-listings").get_attr("data-listingMetadata"),u.length>0)){var e=JSON.parse(u),o=parseInt(e.BlockedCount),s=this._taskState.originalResponse.select(".listings-item").length;f=o+s}return n.prototype._createUrl.call(this,t,f,typeof r=="number"?r:100)},t}(et),k;(function(t){function ot(n,t,i,r){var u,f,s,l,e,c;if(n&&(u=ut(n,t),u&&u.intentKey)){if(f=o[u.intentKey],vi.assert(typeof f=="function","taskInvoker is not defined!"),t&&(t.scenarioKey=u.scenarioKey,t.isFilterSelected=et(n)),u.intentKey===h){if(y.cleanupPrimerData(r),s=lt(n,t),s){f&&f(n,s);g(n,t.entryPoint,u.scenarioKey,t.query,[]);return}}else{if(u.intentKey===nt){y.cleanupPrimerData(r);l=vt(n,i,r);g(n,t.entryPoint,u.scenarioKey,t.query,l);return}if(u.intentKey===tt){if(y.cleanupPrimerData(r),e=pt(n),e){e.entryPoint=t.entryPoint;f&&f(n,e);g(n,t.entryPoint,u.scenarioKey,t.query,[]);return}}else if(u.intentKey===it){y.cleanupPrimerData(r);c=yt(n,t,r);f&&f(n,c);g(n,t.entryPoint,u.scenarioKey,t.query,c.boundingBox);return}}f&&f(n,t)}}function st(t,r){var h=null,u,o,e,f,s,l;if(t&&(u=ut(t,r),u&&u.intentKey)){if(r.scenarioKey&&!(i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&u.scenarioKey==="ERR")){for(e=Object.keys(n.scenarioKeys),f=0;f<e.length;f++)if(n.scenarioKeys[e[f]]===r.scenarioKey){o=e[f];break}if(o&&n.multiEntityScenarios.indexOf(o)>=0&&(u.intentKey===v||u.intentKey===a))return null}s=c[u.intentKey];s&&(l=s(),h=l.parseEntitiesFromResponse(t,r));r&&(r.scenarioKey=u.scenarioKey,r.isFilterSelected=et(t))}return h}function ft(n){var t=null,i,u;return n&&(i=n.select("div[data-category]"),i&&i.length&&(t=i.get_attr("data-category")),t||(u=n.select("div.overlay-taskpane"),u&&u.length&&u.for_each(function(n){var u=n.getAttribute("data-entity"),i;u&&u.length&&(i=r.Internals.parseJSON(u),i&&i.entity&&i.entity.primaryCategoryPath&&i.entity.primaryCategoryPath&&(t=i.entity.primaryCategoryPath))}))),t}function ut(t,i){var u=t.select("[data-answerinfo]").get_attr("data-answerinfo"),r={};return u?(n.polygonEntityScenarios.indexOf(u)>=0&&ht(t)&&ct(t)?r.intentKey=a:n.singleEntityScenarios.indexOf(u)>=0?r.intentKey=i.localFilters||i.keyRoutePoints?b:v:n.multiEntityScenarios.indexOf(u)>=0?r.intentKey=b:n.directionsIntentDrivingScenarios.indexOf(u)>=0?(k=fi.driving,r.intentKey=h):n.directionsIntentTransitScenarios.indexOf(u)>=0?(k=fi.transit,r.intentKey=h):n.directionsIntentWalkingScenarios.indexOf(u)>=0?(k=fi.walking,r.intentKey=h):n.trafficIntentScenarios.indexOf(u)>=0?r.intentKey=nt:n.itineraryDetailsIntentScenarios.indexOf(u)>=0?r.intentKey=tt:n.itineraryListingsIntentScenarios.indexOf(u)>=0&&(r.intentKey=it),r.scenarioKey=n.scenarioKeys[u],r):r}function ht(n){var i=n.select("[data-entity]").get_attr("data-entity"),t;return i&&(t=r.Internals.parseJSON(i),t&&t.entity&&t.entity&&t.entity.vdpId&&t.entity.vdpId!=="")?!0:!1}function ct(t){var u=t.select("[data-entity]").get_attr("data-entity"),i;return u&&(i=r.Internals.parseJSON(u),i&&i.entity&&i.entity&&i.entity.locationType&&i.entity.locationType!==""&&n.boundaryDisabledLocationTypes.indexOf(i.entity.locationType)===-1)?!0:!1}function l(n,t,r,u){u===void 0&&(u=!0);u&&r&&(r.content=t);var f=ft(t);i._isHouseCategory(f)?r.searchQueryCategory="house":i._isRestaurantCategory(f)?r.searchQueryCategory="restaurant":i._isHotelsCategory(f)?r.searchQueryCategory="hotel":i._isZipCodeCategory(f)&&(r.searchQueryCategory="zipcode");n=i._overrideTasktypeBasedOnCategory(n,r);d(n,r)}function d(n,t){e.invokeHandler(f.taskDataHandlerKey,{type:n,state:t})}function lt(n,t){var c=n.select("[data-directionsintent]").get_attr("data-directionsintent"),i,o,s,f,u,e,h;if(c&&(i=r.Internals.parseJSON(c),i&&i.waypoints&&i.waypoints.length>0)){for(o=[],s=i.waypoints.length,f=0;f<s;f++)u=i.waypoints[f],u&&u.address&&u.point&&(e=new nr(u.address,new p(u.point.latitude,u.point.longitude)),f===s-1?e.waypointType=2:f===0&&(e.waypointType=1),e.eid=u.eid,o.push(e));return h={waypoints:o,mode:k,entryPoint:5,taskStartTime:t.searchPerfState&&t.searchPerfState.timestamp()},i.longDistanceDisplay&&(h.longDistanceDisplay=i.longDistanceDisplay),h}return null}function vt(n,t,i){var f=[],s=n.select("[data-boundingbox]").get_attr("data-boundingbox"),e=s&&r.Internals.parseJSON(s),o,u;return e&&e.boundingBox&&e.boundingBox.length>1&&(o=[],u=e.boundingBox[0],t&&t.hide(),o.push(new p(u.latitude,u.longitude)),f.push(u.latitude),f.push(u.longitude),u=e.boundingBox[1],o.push(new p(u.latitude,u.longitude)),f.push(u.latitude),f.push(u.longitude),i.setView(i.getMode().getMapViewForLocationsInView(o)),t&&t.show(2)),f}function yt(n,t,f){var h={content:n,searchTaskState:t},o,l,v;if(h.entryPoint=t.entryPoint===u.Permalink&&i._isTravelOverlayShownOnSerp()?u.TravelL2:t.entryPoint,o=n.select("div[data-title]"),o&&o.length===1){l=o[0].getAttribute("data-title");h.title=l;var s=[],c=[],a=o[0].getAttribute("data-boundingbox"),e=a&&r.Internals.parseJSON(a);e&&!isNaN(e.SouthLatitude)&&!isNaN(e.WestLongitude)&&!isNaN(e.NorthLatitude)&&!isNaN(e.EastLongitude)&&e.SouthLatitude<90&&e.SouthLatitude>-90&&e.NorthLatitude<90&&e.NorthLatitude>-90&&(s=[e.SouthLatitude,e.WestLongitude,e.NorthLatitude,e.EastLongitude],c.push(new p(s[0],s[1])),c.push(new p(s[2],s[3])),f.setView(f.getMode().getMapViewForLocationsInView(c)),h.boundingBox=s);v=o[0].getAttribute("data-vdpid");h.vdpId=v}return h}function pt(n){var t=n.select("[data-itinerary]").get_attr("data-itinerary");return t?{itineraryJson:t}:null}function g(n,t,i,r,u){var s,o=n.select("div[data-ig]"),h,c;o&&o.length===1&&(s=o[0].getAttribute("data-ig")||"");h={EP:t||"",Q:r||"",BB:u,SNRO:i||""};c={impressionGuid:s,logData:{feature:rt.Search,action:w[w.STP],data:h}};e.invokeHandler(f.instrumentationDataHandlerKey,c)}function et(n){var t=n.select("div[data-isFilterSelected]").get_attr("data-isFilterSelected");return t&&t.toLowerCase().indexOf("true")>-1?!0:!1}var a="polygonEntity",v="singleEntity",b="multiEntity",h="directions",nt="traffic",tt="itinerary",it="itineraryList",o={},c,k;o[v]=function(n,t){l(s.localDetailsTask,n,t)};o[b]=function(n,t){l(s.localListingTask,n,t)};o[a]=function(n,t){l(s.polygonEntityDetailsTask,n,t)};o["multiPolygon"]=function(n,t){l(s.polygonListingTask,n,t)};o[h]=function(n,t){d(s.directionsTask,t)};o[nt]=function(){};o[tt]=function(n,t){d(s.itineraryDetailsTask,t)};o[it]=function(n,t){d(s.itineraryListingsTask,t)};c={};c[v]=function(){return new ri};c[b]=function(){return new at};c[a]=function(){return new ri};t.parseResponse=ot;t.getEntitiesFromResponse=st;t.parseCategory=ft;t.parseAnswerInfo=ut;t.invokeTask=l})(k||(k={}));var hf=function(t){function i(i,r,u,f,e,o,s,h,c,l){var a=t.call(this,i,r,u,f,e,o,s,h,c,l)||this;return a.setRecommendedWidth(n.restaurantCardWidth),a.setCurrentWidth(n.restaurantCardWidth),a}return a(i,t),i.prototype._createUrl=function(){var n=t.prototype._createUrl.call(this);return this._taskState&&this._taskState.parentIG&&(n+="&IG="+this._taskState.parentIG),this._taskState&&this._taskState.iid&&(n+="&IID="+this._taskState.iid),n},i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},i}(kt),cf=function(t){function i(n,i,r,u,f,e,o,s){var h=t.call(this,n,i,r,u,f,e,o,s)||this;return h._infoboxOptions={showCloseButton:!1,zIndex:1006,showPointer:!1,visible:!0,htmlContent:null,location:null,autoAlignment:!0},h._bindEventsForInfobox(),h}return a(i,t),i.prototype._createUrl=function(n,i,r){this._taskState&&(this._taskState.isFallbackRequery=!0,this._taskState.scrollListOnPoiHover=!1,this._taskState.sendInstrumentationEventOnEntityClick=!0);return t.prototype._createUrl.call(this,n,i,r)},i.prototype._getRequestUrlFormat=function(){return t.prototype._getRequestUrlFormat.call(this),n.requestUrlFormatForLocalOverlayOnSerp},i.prototype._bindEventsForInfobox=function(){var n=this;sj_evt&&(sj_evt.bind("pushpinhoverstarted",function(t){var i=t[1],e=i.entity.id.replace("ypid:","").replace("sid:",""),u=_ge(e),r,f;u&&(r=new Microsoft.Maps.Location(i.geometry.y,i.geometry.x),f="<div class='MiniInfobox2' id= 'infobox-container' > <div class='infobox-body' >"+u.innerHTML+"<\/div><\/div>",n._infoboxOptions.htmlContent=f,n._infoboxOptions.location=r,n._infobox?n._infobox.setOptions(n._infoboxOptions):(n._infobox=new ei(r,n._infoboxOptions),n._infobox.setMap(n.map)))}),sj_evt.bind("pushpinhoverstopped",function(){n._infobox&&n._infobox.setOptions({visible:!1})}))},i}(et),ar=function(){function n(){}return n.prototype.createBar=function(n){var r=new uu([],!1),u,i,e,o,f,t;if(!n||!n.categories&&!n.levels)return null;if(n.categories&&n.categories.length>0){for(u=new wt("bm_category","bm_category","Category",0,5),i=0;i<n.categories.length;i++)e=n.categories[i],o=new st(i.toString(),e),u.addOption(o);r.addItem(u)}if(n.levels&&n.levels.length>0){for(f=new wt("bm_level","bm_level","Level",0,5),t=0;t<n.levels.length;t++){var s=n.levels[t],h=s.name,c=new st(t.toString(),h,null,t===n.defaultFloor);f.addOption(c)}r.addItem(f)}return r.getItemsNumber()===0?null:r},n}(),vt=function(){function n(){}return n.logFilterBarInteraction=function(n,t,i,r){var o={logData:{feature:nt.FiltersBar,action:t,data:{EP:u.VenueMap,ID:n,IT:i,DN:r}}};e.invokeHandler(f.instrumentationDataHandlerKey,o)},n.logBusinessClick=function(n,t,i){var r={logData:{feature:rt.VenueMap,action:h.Clicked,data:{EP:t,ID:n,YP:i,IM:v.isMobile}}};e.invokeHandler(f.instrumentationDataHandlerKey,r)},n.logMobileActivation=function(n){var t={logData:{feature:rt.VenueMap,action:h.Activated,data:{EP:u.SerpAnswer,ID:n}}};e.invokeHandler(f.instrumentationDataHandlerKey,t)},n.logMobileViewToggle=function(n,t){var i={logData:{feature:rt.VenueMap,action:h.Clicked,data:{TG:"ViewToggle",ID:n,TL:t}}};e.invokeHandler(f.instrumentationDataHandlerKey,i)},n}(),vr=function(n){function f(i,r,u,f){var e=this,s={},h,o;return e=n.call(this,s,u,r)||this,s.defineProperty("entities"),e._map=i,e.controlTemplateFactory=u,e.resources=t,e._businessYpidDictionary={},e._selecteDirectoryBusiness=null,e._venueMap=f.venueMap,e._venueMapTask=f,e._venueMapMetadata=e._venueMapTask.metadata,h=e._venueMap.defaultFloor,o=e._venueMap.floors.filter(function(n){return n.name===h}),e.activeFloor=o.length>0&&o[0],e.floors=e._venueMapMetadata.floors,e.entities=new ni,e._lang=v.dynamicProperties.market.split("-")[0].toLowerCase(),e._setPrimitiveDictionaries(),e._createUIElements(),e}return a(f,n),f.prototype._setPrimitiveDictionaries=function(){var r={},u,s,t,f,h,i,e,n,o;for(this.categories=[],u=this._venueMap.floors,s=u.length,t=0;t<s;t++)for(f=u[t].getPrimitives(),h=f.length,i=0;i<h;i++)e=f[i],n=e.metadata,n&&n.ypid&&n.category&&(!this.activeCategory||n.category===this.activeCategory)&&(this._businessYpidDictionary[n.ypid]=e,r[n.category]=!0);for(o in r)r[o]&&this.categories.push(o);this.categories.sort()},f.prototype._createUIElements=function(){this.name=this._venueMap.name;this._updateEntityList();this._createFiltersBar()},f.prototype._updateEntityList=function(){var r=this,t,i,n;if(this.entities.clear(),this.activeFloor)this._venueMap.setActiveFloor(this.activeFloor.name),this._addBusinessesToList(this.activeFloor);else{for(t=this._venueMap.floors,i=t.length,n=0;n<i;n++)this._addBusinessesToList(t[n]);this._venueMap.setActiveFloor(this._venueMap.defaultFloor)}this.updateNoEntityMessage();this._map.getTemplateSelector().then(function(){r._venueMapTask.directoryUpdated.invoke()})},f.prototype._addBusinessesToList=function(n){var t=this;this._map.getTemplateSelector().then(function(r){for(var e,u,c,l,s,h,a,k,w=n.getPrimitives(),d=w.length,v=f._iconDictionary,y=0;y<d;y++)if(e=w[y],u=e.metadata,u&&u.ypid&&u.category&&(!t.activeCategory||u.category===t.activeCategory)){if(u.name=e.getTitle(),u.taskInfo=u.ypid&&t._buildEntityDataTask(u),c=e.bucket,v[c])u.listingIcon=v[c];else{l=new iu;l.setSize(30,30);var p=r.getLandmarkVectorImageTemplate(e,2,1),b=p&&p.length>0&&p[0],o=b&&b.getVectorImage();if(o){for(s={},s.hotspotX=o.hotspotX,s.hotspotY=o.hotspotY,s.records=[],h=1;h<o.records.length;h++)a=i._copyObject(o.records[h]),a.style=i._copyObject(o.records[h].style),a.style.fillStyle="rgb(168, 168, 168)",s.records.push(a);k=new lu(s);k.renderCanvas(l,e.entity,15,15)}u.listingIcon=l.getDataURL();v[c]=u.listingIcon}t.entities.insert(u)}})},f.prototype.toggleSelectedBusiness=function(n){var t="bm_selected";this._selecteDirectoryBusiness&&this._selecteDirectoryBusiness.remove_class(t);n&&(n.add_class(t),this._selecteDirectoryBusiness=n)},f.prototype.onBusinessClick=function(n){var t=r(n.currentTarget?n.currentTarget:n);this.toggleSelectedBusiness(t);vt.logBusinessClick(this._venueMapTask.venueMapState.venueMapId,u.TaskCard,this._getYpidFromBusiness(t))},f.prototype.onBusinessMouseOver=function(n){var f,i;if(this._map.getMercatorZoomLevel()>=15&&!v.isMobile){var e=r(n.currentTarget||n),u=this._getYpidFromBusiness(e),t=u&&this._businessYpidDictionary[u];t&&(t.setState(3),f=t.metadata.polygon,i=new Microsoft.Maps.Polyline(f.getLocations(),{strokeColor:"rgb(0, 0, 0)"}),this._venueMap.activeFloorLayer.add(i),this._hoveredEntityInfo={primitive:t,highlightPolyline:i})}},f.prototype._getYpidFromBusiness=function(n){var t=n&&n.get_attr("data-task"),i=t&&t.length>0&&JSON.parse(t),r=i&&i.state&&i.state.id;return r&&r.substring(5)},f.prototype._buildEntityDataTask=function(n){var i={},t={};return t.entryPoint="LocalListing",t.id="ypid:"+n.ypid,t.flippingCard=!0,t.taskTitle=n.name.replace(/\n/g," "),t.originalName=t.taskTitle,t.selectedCategoryId=n.category,i.state=t,i.type=s.localDetailsTask,i.activateOptions={},i.activateOptions.parentId=this._venueMapTask.id,JSON.stringify(i)},f.prototype._createFiltersBar=function(){var n=this;this._filterBarViewModel=new ru(this.controlTemplateFactory);var t=this._venueMap.floors.filter(function(t){return t.name===n.activeFloor.name}),i={categories:this.categories,levels:this._venueMap.floors,defaultFloor:this._venueMap.floors.indexOf(t[0])},r=new ar;this._filtersBar=r.createBar(i);this._filterBarViewModel.filterItemDiscardedFromSelection.add(function(t){var i=n._venueMapTask.venueMapState.venueMapId;t.id==="bm_level"?(vt.logFilterBarInteraction(i,h.Removed,t.displayName,n.activeFloor.name),n.entities.clear(),n.activeFloor=null):t.id==="bm_category"&&(vt.logFilterBarInteraction(i,h.Removed,t.displayName,n.activeCategory),n.activeCategory=null,n._venueMap.setBusinessCategoryFilters([]));n._updateEntityList()});this._filterBarViewModel.filterOptionClicked.add(function(t){var r=n._venueMapTask.venueMapState.venueMapId,i=t.item,u=parseInt(t.value);i.id==="bm_level"?(n.entities.clear(),n.activeFloor=n._venueMap.floors[u],vt.logFilterBarInteraction(r,h.Selected,i.displayName,n.activeFloor.name)):i.id==="bm_category"&&(n.activeCategory=n.categories[u],n._venueMap.setBusinessCategoryFilters([n.activeCategory]),vt.logFilterBarInteraction(r,h.Selected,i.displayName,n.activeCategory));n._updateEntityList()})},f.prototype.showFiltersBar=function(){var n=this._venueMapTask.panelRoot.select("div[class=bm_filtersBarModule]");typeof n!="undefined"&&this._filterBarViewModel.update(this._filtersBar,n)},f.prototype.updateNoEntityMessage=function(){var n=this;this._map.getTemplateSelector().then(function(){var t=n._venueMapTask.panelRoot.select(".bm_noEntityMessage");t&&(t.set_style({display:n.entities.length>0?"none":""}),t.set_text(n.activeFloor&&n.activeFloor.hasRichDetailsPois?n.resources.L_VenueMapTask_NoCategory_Message:n.resources.L_VenueMapTask_NoEntity_Message))})},f.prototype.onBusinessMouseOut=function(){if(this._hoveredEntityInfo){var n=this._hoveredEntityInfo.primitive;n.setState(2);this._venueMap.activeFloorLayer.remove(this._hoveredEntityInfo.highlightPolyline);this._hoveredEntityInfo=null}},f._iconDictionary={},f}(pt),lf=function(n){function i(i,r){var u=n.call(this)||this;return u.map=i,u.type=s.venueMapDirectoryTask,u._controlTemplateFactory=r,u.resources=t,u.scrollLane=new g,u.venueMapLoaded=new g,u.directoryUpdated=new g,u}return a(i,n),i.prototype.activate=function(t,i){var r=this,u;i||this.deactivate();n.prototype.activate.call(this,t);u=this.resources.L_VenueMapTaskTitle_Suffix;this.setTitle(u+i.title);this.venueMapState=i;t.getContainer().instanceAsync("VenueMap",function(){r._venueMapType=Microsoft.Maps.VenueMaps.VenueMap;r.getVenueMetadata(r.venueMapState.venueMapId,function(n){var i,f,e;r.metadata=n;r.venueMap=new r._venueMapType(r.venueMapState.venueMapId,t,n,{businessClickedHandler:function(n){r._handleBusinessClick(n)}});r.venueMap.setActiveFloor(r.venueMap.defaultFloor);r.setTitle(u+r.venueMap.name);r._viewModel=new vr(r.map,rr,r._controlTemplateFactory,r);r.panelRoot.clear();r.changed.add(function(n){if(n&&n.name&&n.name==="displayState"&&n.newValue!==n.oldValue){var t=n.newValue,i=n.oldValue;t&&t.activationState!==3?r.venueMap.show():r.venueMap.hide()}});r.displayState.activationState===3?r.venueMap.hide():r.venueMap.show();i=n.bbox;f=r.map.getMode().getMapViewForLocationsInView([new p(i[2],i[1]),new p(i[0],i[3])]);r.map.setView(f);r._venueMapHelper||(r._venueMapHelper=o&&o.Internal&&o.Internal._VenueMapHelper);r._venueMapHelper&&r._venueMapHelper.venueMaps.insert(r.venueMap);e=new gt(rr,r._viewModel).applyDataTemplate(r._viewModel);r.addControl(e);r._viewModel.showFiltersBar();r._viewModel.updateNoEntityMessage();r.venueMapLoaded.invoke()})})},i.prototype.getVenueMetadata=function(n,t){var u=this,e=this.map.getMapOptions().credentials,s=this.map.getConfig().venueMapMetadataUrl.replace("{venueMapId}",n).replace("{credentials}",e).replace("{culture}",v.dynamicProperties.market),h="venueMap_"+this.id,r=1,o=function(){--r;t(null)},f=null,i;this._venueMapType.categoryToBucket||(r++,i=this.map.getConfig().venueMapCategoryToBucketUrl,i=i.replace("{credentials}",e),ct.downloadJsonp(i,"venueMap",function(n){u._venueMapType.categoryToBucket=n;u._onMetadataAvailable(--r,t,f)},o));this._venueMapType.typeToBucket||(r++,i=this.map.getConfig().venueMapTypeToBucketUrl,i=i.replace("{credentials}",e),ct.downloadJsonp(i,"venueMap",function(n){u._venueMapType.typeToBucket=n;u._onMetadataAvailable(--r,t,f)},o));ct.downloadJsonp(s,"venueMap",function(n){f=n;u._onMetadataAvailable(--r,t,f)},o)},i.prototype.setDisplayState=function(t){t.activationState===1&&this._viewModel&&this._viewModel.toggleSelectedBusiness(null);n.prototype.setDisplayState.call(this,t)},i.prototype.deactivate=function(){var t,i;n.prototype.deactivate.call(this);t=this.venueMap&&this.venueMap.getActiveFloor();t&&(i=this.venueMap.floors.filter(function(n){return t===n.name}),this.map.getLayers().remove(i[0]));this._viewModel&&this._viewModel.entities.clear();this._viewModel&&this._viewModel.dispose();this._venueMapHelper&&this._venueMapHelper.venueMaps.remove(this.venueMap);this.venueMap&&this.venueMap.dispose();n.prototype.deactivate.call(this)},i.prototype.close=function(){var n={action:"remove",id:this.id};e.invokeHandler(f.taskDataHandlerKey,n)},i.prototype.serialize=function(){return this.venueMapState},i.prototype.processCallback=function(){return},i.prototype.getMenuList=function(){return[]},i.prototype.getCardIconInfo=function(){var n=i._cardIconCatIdMapping[this.venueMapState&&this.venueMapState.venueMapType]||i._cardIconCatIdMapping["default"];return{iconClass:"vmTask",iconElements:this.getCardIcons(n)}},i.prototype.getIconColorAndClassName=function(n){var t=i._cardIconCatIdMapping[this.venueMapState&&this.venueMapState.venueMapType]||i._cardIconCatIdMapping["default"];this._buildCardIcon(null,t,function(t){n(t,"venueMapTask")})},i.prototype.isSharable=function(){return!1},i.prototype.getListingFromPushpin=function(n){var e=null,o=n&&n.metadata&&n.metadata.ypid,i,t,u,f;if(o)for(i=this.panelRoot.select(".bm_venueEntity"),t=0;t<i.length;t++)if(u=i[t],f=u.getAttribute("data-task"),f&&f.indexOf(o)>=0){e=r(u);break}return e},i.prototype._handleBusinessClick=function(n){var t=n.primitive,i=this.getListingFromPushpin(t),r;i&&(r=t&&t.metadata&&t.metadata.ypid,this.scrollLane.invoke(i),this._viewModel&&this._viewModel.toggleSelectedBusiness(i),e.invokeHandler(f.taskDataHandlerKey,JSON.parse(i.get_attr("data-task"))),vt.logBusinessClick(this.venueMapState.venueMapId,u.POI,r))},i.prototype._onMetadataAvailable=function(n,t,i){n===0&&this.map.getTemplateSelector().then(function(n){n.selectorReady().then(function(){var o=[],e=i.floors,r,u,f;if(e)for(r=0;r<e.length;r++)if(u=e[r].entities,u)for(f=0;f<u.length;f++)o.push(Microsoft.Maps.VenueMaps.VenueMap.getEntityBucketId(u[f]));n.prefetchImages(o).then(function(){t(i)})})})},i._cardIconCatIdMapping={Airport:"91621",Mall:"90771","default":"91600"},i}(ot),yr=function(n){function r(i,r,u,f,e){var o=this,s={},h,c;for(o=n.call(this,s,r,ci)||this,o._controlTemplateFactory=r,s.defineProperty("printEntities"),s.defineProperty("listHours"),s.defineProperty("wikiText"),s.defineProperty("printFacts"),o._entities=[],o._openHours=[],o._printFacts=[],o.resources=t,o._dataFacts=f,h=0;h<u.length;h++)c=new li(u[h]),o._entities.push(c);return o.createHoursTemplate(),o._setPrintFacts(),o.setListHours(o._openHours),o.setPrintFacts(o._printFacts),o._entities&&o._entities.length&&o._entities[0].getTitle()!==e&&(o._entities[0].originalName=e),o.setPrintEntities(o._entities),o}return a(r,n),r.prototype.hideIfMatchedData=function(n){return n===null&&this._entities[0].getTitle()===n?"none":""},r.prototype.createHoursTemplate=function(){var t,e,o,s,l,u,v,h,a;if(this._dataFacts&&this._dataFacts.openHours!==undefined)for(t=0;t<this._dataFacts.openHours.length;t++){var f=new lr,n=[],r=[];for(e=0;e<this._dataFacts.openHours[t].hoursRanges.length;e++)if(o=this._dataFacts.openHours[t].hoursRanges[e].start,s=this._dataFacts.openHours[t].hoursRanges[e].end,o!=s){f.setDay(this._dataFacts.openHours[t].day);o=o.split(":");s=s.split(":");var c=new cr,y=i._formatShortTimeString(Number(o[0]),Number(o[1]),0),p=i._formatShortTimeString(Number(s[0]),Number(s[1]),0);c.setStart(y);c.setEnd(p);n.push(c);e>=0&&this._openHours.length>0&&(r=this._openHours[this._openHours.length-1].getHourRanges())}if(r&&r.length>0&&n&&n.length>0&&r.length===n.length){for(l=!1,u=0;u<r.length;u++)(r[u].getStart()!==n[u].getStart()||r[u].getEnd()!==n[u].getEnd())&&(l=!0);l?(f.setHourRanges(n),this._openHours.push(f)):(v=f.getDay(),h=this._openHours[this._openHours.length-1].getDay(),h.indexOf("-")>0&&(a=[],a=h.split("-"),h=a[0].trim()),this._openHours[this._openHours.length-1].setDay(h+" - "+v))}else n&&n.length>0&&(f.setHourRanges(n),this._openHours.push(f))}},r.prototype._setPrintFacts=function(){if(this._entities[0].getLocation()&&!this._entities[0].id.toUpperCase().match("YPID")&&(this._entities[0].getLocationType()==="State"||this._entities[0].getLocationType()==="StreetAddress"||this._entities[0].getLocationType()==="County")){var n=this._entities[0].getLocation(),i=n.latitude.toString()+", "+n.longitude.toString();this._pushFactsIntoList(t.L_PrintExtendedLatLong_Text,i)}this._dataFacts&&(this._dataFacts.website&&!this._entities[0].getWebsite()&&this._entities[0].setWebsite(this._dataFacts.website),this._dataFacts.phone&&!this._entities[0].getPhone()&&this._entities[0].setPhone(this._dataFacts.phone),ai.parseAndPushDataFactForPrint(this._dataFacts,this._printFacts))},r.prototype._pushFactsIntoList=function(n,t,i){var r=ai.setFactsInfo(this._printFacts,n,t,i);r&&this._printFacts.push(r)},r}(pt),pr=function(n){function t(t,i,u,f,e){var o=this,a={},c,s,p,h,v,l;for(o=n.call(this,a,i,ci)||this,o._controlTemplateFactory=i,a.defineProperty("printEntities"),a.defineProperty("printEntitiesList2"),o._entities1=[],o._entities2=[],c=e?e.select("a.listings-item"):null,s=0;s<u.length;s++)u[s].entity.iconText=(s+1).toString(),p=u[s].entity,h=new li(p),o.setPrintIconTextAndColor(h,s,f),c&&s<c.length&&(v=r(c[s]).get_attr("data-facts"),v&&(l=[],o.setPrintFactsForEntity(y.parseDataFact(v),l),l.length>0&&(h.printFacts=l))),s%2==0?o._entities1.push(h):o._entities2.push(h);return o.setPrintEntities(o._entities1),o.setPrintEntitiesList2(o._entities2),o}return a(t,n),t.prototype.hideIfMatchedData=function(n){return n&&n.getAddress()===null||n.getTitle()===n.getAddress()?"none":""},t.prototype.setPrintIconTextAndColor=function(n,t,i){n.iconText=(t+1).toString();n.colorIndex=i},t.prototype.setPrintFactsForEntity=function(n,t){ai.parseAndPushDataFactForPrint(n,t)},t}(pt),af=function(n){function t(t,i,r,u,f,e,o){return n.call(this,t,i,r,u,f,e,o)||this}return a(t,n),t.prototype.setResponseContent=function(t,i){var r=this;(n.prototype.setResponseContent.call(this,t,i),t&&this.panelRoot)&&(this._zipCodes=[],this._zipCodePolygonDownloadCompleted=!1,this.zipCodePolygonsDownloaded=new g,this.zipCodePolygonsDownloaded.add(function(){r._zipCodePolygonDownloadCompleted=!0}),this._getZipCodePolygonsFromResponse(t,i))},t.prototype.registerListItemEvents=function(){var n=this;this._zipCodePolygonDownloadCompleted?this._handlerHoverEvents():this.zipCodePolygonsDownloaded.add(function(){n._handlerHoverEvents()})},t.prototype.parseEntitiesFromResponse=function(){return[]},t.prototype._shouldPaginate=function(n){return!n||n.length<=at._paginationItemsPerPage?!1:!0},t.prototype._paginationSetDisplayForItems=function(n,t,i,r){var u,f,e;if(n&&!(n.length<=at._paginationItemsPerPage)){for(u=0,f=n.length;u<f;u++)e=Math.floor(u/at._paginationItemsPerPage)+1===t,n[u].style.display=e?"list-item":"none";r&&r()}},t.prototype._handlerHoverEvents=function(){var t=this,n;this._registerListItemEventsForZipCodes();n=this._poiManager.getLayer();n?Microsoft.Maps.Internal.CityPolygonManager.bindPostCodeLayerHandlers(n,this.map):this._poiManager.primitivesRendered.addOne(function(){n=t._poiManager.getLayer();Microsoft.Maps.Internal.CityPolygonManager.bindPostCodeLayerHandlers(n,t.map)})},t.prototype._getZipCodePolygonsFromResponse=function(n){var t=this,i=n.select(this._selector);i.for_each(function(n){var i=t._findZipCodeInItem(n,!0);i&&i.length>0&&t._zipCodes.indexOf(i)<0&&t._zipCodes.push(i)});this._zipCodes.length>0&&this.map.getCityPolygonManager().then(function(){Microsoft.Maps.Internal.CityPolygonManager.populatePostCodeLayer(t.map,null,t._zipCodes,function(n){t._poiManager.setPrimitives(n);t._primitives=n;t.zipCodePolygonsDownloaded.invoke()},!0)})},t.prototype._registerListItemEventsForZipCodes=function(){var n=this,i=this.panelRoot.select("a[data-entity]"),t=Microsoft.Maps.Internal.CityPolygonManager;i.for_each(function(i){var o=n._findZipCodeInItem(i),f,u,h,c,e;if(o&&o.length>0){for(u=0,h=n._primitives.length;u<h;u++)if(c=n._primitives[u],e=c.metadata,e&&o.indexOf(e.title)>=0&&!e.polygon){f=n._primitives[u];break}if(f){var s=r(i),l=function(){t.handlePostCodePrimitiveHover({eventName:"mouseover",layer:n._poiManager.getLayer(),primitive:f})},a=function(){t.handlePostCodePrimitiveHover({eventName:"mouseout",layer:n._poiManager.getLayer(),primitive:f})};s.add_event("mouseover",l).add_event("mouseleave",a);n._addEventsToEventList(s,"mouseover",l);n._addEventsToEventList(s,"mouseleave",a)}}})},t.prototype._findZipCodeInItem=function(n,t){var i,e=n.getAttribute("data-entity"),u,f;return e&&e.length>0?(u=r.Internals.parseJSON(e),u&&u.entity&&(i=u.entity.title)):(f=n.getElementsByClassName("b_factrow"),f&&f.length>0&&(i=f[0].innerHTML)),t&&(i=i.trim().split("-")[0]),i},t}(at),wr=function(n){function t(t,i,r,u){var f=this,e={};return f=n.call(this,e,t,bu)||this,e.defineProperty("showLeftChevron"),e.defineProperty("showRightChevron"),f._listingTask=r,f._totalResultCount=u,f.setShowLeftChevron(!1),f.setShowRightChevron(!0),f._offset=0,f._paginationItemsPerPage=i,f}return a(t,n),t.prototype.leftChevronClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset>=this._paginationItemsPerPage&&(this._offset-=this._paginationItemsPerPage,this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this));this._offset===0&&this.setShowLeftChevron(!1)},t.prototype.rightChevronClicked=function(n){n&&(n.stopPropagation(),n.preventDefault());this._offset+=this._paginationItemsPerPage;this._rightChevronRequestSent=!0;this._listingTask.sendPaginationRequest(this._offset,this._paginationItemsPerPage,this)},t.prototype.updateChevrons=function(n){n>0&&(n<this._paginationItemsPerPage||this._totalResultCount&&n+this._offset>=this._totalResultCount?this.setShowRightChevron(!1):this.setShowRightChevron(!0));n===0&&this._rightChevronRequestSent&&this._offset>=this._paginationItemsPerPage&&(this._offset-=this._paginationItemsPerPage);this._offset>0?this.setShowLeftChevron(!0):this.setShowLeftChevron(!1);this._rightChevronRequestSent=!1},t}(pt);l.HotelsDetailsTask=gu;l.HotelsListingTask=nf;l.HouseDetailsTask=tf;l.HouseListingTask=rf;l.PolygonListingTask=sf;l.RestaurantDetailsTask=hf;l.RestaurantsListingTask=cf;l.AnnotationControl=ur;l.DirectoryFilterBarFactory=ar;l.GeochainListViewModel=er;l.LocalDetailsPageProcessor=uf;l.LocalDetailsPrintViewModel=yr;l.LocalDetailsTask=kt;l.LocalListingPageProcessor=hr;l.LocalListingPrintViewModel=pr;l.LocalListingTask=et;l.LocalPrintEntity=li;l.LocalPrintFacts=ui;l.LocalPrintHourRange=cr;l.LocalPrintOpenHours=lr;l.LocalSearchTask=y;l.LogHelper=or;l.PolygonEntityDetailsTask=ef;l.PolygonListingPageProcessor=of;l.ResponseIntentProcessor=k;l.ServerPaginationViewModel=wr;l.VenueMapLogHelper=vt;l.VenueMapTask=lf;l.VenueMapTaskViewModel=vr}catch(br){if(o.logger)o.logger.logCriticalError(br);else throw br;}}).call(window)