(function(){try{var i=window.$MicrosoftMaps8,n=i.Internal,a=n._CurveColorHelper,t=n._Debug,v=n._Dispatcher,s=n._Gimme,r=n._Helper,y=n._ObservableObject,p=i.Point,h=i.Size,u=i.GlobalConfig,c=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),f=function(){function n(t,i,u){if(this.arrowDrawAccumulator=0,t&&t.substr(t.length-9)==="Singleton")return n[t]=n[t]||new n;this._rasterDPIScale=u;this._canvas=i||r._createElement("canvas");this._canvasElem=this._canvas[0];this._context=this._canvasElem.getContext("2d");this._style=this._resetStyle={fillStyle:this._context.fillStyle,strokeStyle:this._context.strokeStyle,lineWidth:this._context.lineWidth}}return n.prototype.setGlobalAlpha=function(n){this._context.globalAlpha=n},n.prototype.getGlobalAlpha=function(){return this._context.globalAlpha},n.prototype.save=function(){this._context.save()},n.prototype.restore=function(n){this._context.restore();n!==!1&&(this._font=null,this._style=this._resetStyle)},n.prototype.getDataURL=function(){return this._canvasElem.toDataURL()},n.prototype.setSize=function(n,t){var i=this.getDevicePixelRatio(!0);this._canvasElem.width=n*i;this._canvasElem.height=t*i;this._canvasElem.style.width=n+"px";this._canvasElem.style.height=t+"px";this._context.scale(i,i)},n.prototype.getSize=function(){return new h(this._canvasElem.width,this._canvasElem.height)},n.prototype.clear=function(n,t,i,r,u){if(t=t||0,i=i||0,r=r||this._canvasElem.width,u=u||this._canvasElem.height,n){var f=this._context.fillStyle;this._context.fillStyle=n;this._context.fillRect(t,i,r,u);this._context.fillStyle=f}else this._context.clearRect(t,i,r,u)},n.prototype.setFont=function(n){n!==this._font&&(this._context.font=n,this._font=n)},n.prototype.translate=function(n,t){this._context.translate(n,t)},n.prototype.setStyle=function(n,t){var i,r,f;if(this._style!==n||u.tileRefactoringEnabled){if(this._style=n,t=t||1,this._context.fillStyle=this._style.fillStyle||"transparent",this._context.strokeStyle=this._style.strokeStyle||"transparent",this._context.lineWidth=Math.round(this._style.lineWidth*t)||0,this._context.lineCap=this._style.lineCap||"round",this._context.lineJoin=this._style.lineJoin||"round",this._context.setLineDash){if(i=[],this._style.dashes&&(i=this._style.dashes.slice(0)),i&&i.length>0)for(r=0;r<i.length;r++)i[r]=Math.round(i[r]*this._context.lineWidth);this._context.setLineDash(i)}if(f=this._style.fillImage,f&&typeof f!="number"&&(this._context.fillStyle=this._context.createPattern(f,"repeat")),this._style.font){var s=this._style.horizontalAlignment,h=this._style.verticalAlignment,e="center",o="middle";s===1?e="left":s===2&&(e="right");h===0?o="alphabetic":h===2&&(o="hanging");this._context.textAlign=e;this._context.textBaseline=o}this._context.shadowColor=this._style.shadowColor||"transparent";this._context.shadowBlur=this._style.shadowBlur||0;this._style.shadowOffset&&(this._context.shadowOffsetX=this._style.shadowOffset.x||0,this._context.shadowOffsetY=this._style.shadowOffset.y||0)}},n.prototype.getStyle=function(){return this._style},n.prototype.setPrimitive=function(){},n.prototype.hasPrimitives=function(){return!1},n.prototype.setLayer=function(){},n.prototype.getHitTestingData=function(){return null},n.prototype.flush=function(){var n=this._context.shadowColor;this._needsFill&&(this._context.fill(),this._context.shadowColor="transparent");this._needsStroke&&this._style.lineWidth>0&&this._context.stroke();this._needsStroke=this._needsFill=!1;this._context.shadowColor=n;this._context.beginPath()},n.prototype.stroke=function(){var n=this._style,t,i;n.secondaryLineWidth>0&&(t=this._context.strokeStyle,i=this._context.lineWidth,this._context.strokeStyle=n.secondaryStrokeStyle,this._context.lineWidth=n.secondaryLineWidth,this._context.stroke(),this._context.strokeStyle=t,this._context.lineWidth=i);this._needsStroke=!0},n.prototype.fill=function(){this._needsFill=!0},n.prototype.getImageData=function(n,t,i,r){return this._context.getImageData(n,t,i,r)},n.prototype.getRawContext=function(){return this._context},n.prototype.getRootElement=function(){return this._canvas},n.prototype.getDevicePixelRatio=function(n){return(!this._devicePixelRatio||n)&&(this._devicePixelRatio=this._rasterDPIScale||(u.tileRefactoringEnabled?window.devicePixelRatio:1)||1),this._devicePixelRatio},n.prototype.putImageData=function(n,t,i,r,u,f,e){typeof r=="number"?this._context.putImageData(n,t,i,r,u,f,e):this._context.putImageData(n,t,i)},n.prototype.drawImage=function(n,i,r,u,f,e,o,s,h,c){var a,l;t.assertNotNull(n,"image");a=this._context.globalAlpha;e&&(this._context.globalAlpha=e);try{l=this.getDevicePixelRatio();u&&f&&typeof o=="number"&&typeof s=="number"&&h&&c?this._context.drawImage(n,o,s,h/l,c/l,i||0,r||0,u/l,f/l):u&&f?this._context.drawImage(n,i||0,r||0,u/l,f/l):this._context.drawImage(n,i||0,r||0)}catch(v){}this._context.globalAlpha=a},n.prototype.drawEllipse=function(n,t,i,r){if(i===r)this._context.arc(n,t,i,0,2*Math.PI,!1);else{var u=r/.75;this._context.beginPath();this._context.moveTo(n-i,t);this._context.bezierCurveTo(n-i,t+u,n+i,t+u,n+i,t);this._context.bezierCurveTo(n+i,t-u,n-i,t-u,n-i,t)}},n.prototype.lineTo=function(n,t,i,r){var u=this._style.dashes;!this._context.setLineDash&&u&&u.length>0?this._dashedLineTo(n,t,i||0,r||0,u):this._context.lineTo(n,t)},n.prototype.moveTo=function(n,t){this._context.moveTo(n,t)},n.prototype.dispose=function(){this._canvas&&(this._canvas.removeFromParent(),this._canvas.clear(),this._canvas=null);this._canvasElem=null;this._context=null},n.prototype._dashedLineTo=function(n,i,r,u,f){var s,l,c,e,v,y,o,p;t.assert(f.length%2==0,"Dashes count is odd number");s=n-r;l=i-u;Math.abs(s)>.005&&(c=l/s);var h=new Array(f.length),a=new Array(f.length),w=this._style.lineWidth;for(e=0;e<f.length;e++){if(o=Math.round(f[e]*w),t.assert(o>0,"Dash length is not positive"),o<1){this._context.lineTo(n,i);break}Math.abs(s)<=.005||Math.abs(c)>200?(h[e]=0,a[e]=l>0?o:-o):Math.abs(c)<.005?(h[e]=s>0?o:-o,a[e]=0):(h[e]=Math.sqrt(o*o/(1+c*c)),s<0&&(h[e]=-h[e]),a[e]=c*h[e])}for(v=Math.sqrt(s*s+l*l),y=!0,e=0;v>0;)o=f[e%f.length]*w,v>o?(p=e++%f.length,r+=h[p],u+=a[p]):(r=n,u=i),y?this._context.lineTo(r,u):this._context.moveTo(r,u),v-=o,y=!y},n}(),l=function(n){function i(t){var i=n.call(this,t)||this;return r._disableSmoothing(i.getRawContext()),i._primitives=[],i._layers=[],i._layerIdToIndex={},i}return c(i,n),i.prototype.setSize=function(t,i){n.prototype.setSize.call(this,t,i);r._disableSmoothing(this.getRawContext())},i.prototype.stroke=function(){this.getRawContext().stroke()},i.prototype.fill=function(){this.getRawContext().fill()},i.prototype.setPrimitive=function(n){if(n){this._currentPrimitiveIndex=this._primitives.length;var r=i.decimalToColorString(this._currentLayerIndex,this._currentPrimitiveIndex),t=this.getRawContext();t.fillStyle=t.strokeStyle=r;t.beginPath();this._primitives.push(n)}},i.prototype.hasPrimitives=function(){return!0},i.prototype.setLayer=function(n){t.assertNotNull(n,"layer");var r=n.getId(),i=this._layerIdToIndex[r];i||(this._layers.push(n),this._layerIdToIndex[r]=i=this._layers.length);this._currentLayerIndex=i},i.prototype.getHitTestingData=function(){var n=this.getSize();return new e(this._primitives,this._layers,this.getRawContext().getImageData(0,0,n.width,n.height))},i.prototype.clear=function(){this._primitives=[];this._layers=[];this._layerIdToIndex={};n.prototype.clear.call(this)},i.prototype.drawImage=function(n,i,r,u,f){t.assertNotNull(n,"image");u=u||n.naturalWidth||n.width;f=f||n.naturalHeight||n.height;this.getRawContext().fillRect(i||0,r||0,u,f)},i.prototype.setStyle=function(n){n.lineWidth&&(this.getRawContext().lineWidth=n.lineWidth+2)},i.decimalToColorString=function(n,i){var r,u;return t.assert(n>0,"layers is empty"),r=(n-1).toString(16).toUpperCase(),t.assert(r.length<=2,"Hit testing layers number exceeds #FF"),u=r.length===1?"#0"+r+"0000":"#"+r+"0000",r=i.toString(16).toUpperCase(),t.assert(r.length<=4,"Hit testing primitives number exceeds #00FFFF"),u.substring(0,u.length-r.length)+r},i}(f),e=function(){function n(n,t,i){this._primitives=n||[];this._layers=t||[];this._imageData=i}return n.prototype.setResultToArgs=function(n,i,r){var u,o,h,c,f,e;if((t.assertNotNull(r,"args"),n=Math.round(n),i=Math.round(i),u=this.getResultIndex(n,i),!(u<0))&&(o=u>>16,h=u&65535,h<this._primitives.length&&o<this._layers.length)){if(s.Browser.is_webkit){r.primitive=this._primitives[h];r.layer=this._layers[o];return}for(c=0,f=i-1;f<=i+1;f++)for(e=n-1;e<=n+1;e++)if((e!==n||f!==i)&&this.getResultIndex(e,f)===u&&++c>1){r.primitive=this._primitives[h];r.layer=this._layers[o];return}}},n.prototype.getResultIndex=function(t,i){var u=-1,r;if(n.isPointWithinBoundary(t,i,this._imageData.width,this._imageData.height)&&this._imageData&&this._imageData.data&&(r=(this._imageData.width*i+t)*4,r>=0&&r+3<this._imageData.data.length)){var f=this._imageData.data[r],e=this._imageData.data[r+1],o=this._imageData.data[r+2],s=this._imageData.data[r+3];s===255&&(u=(f<<16)+(e<<8)+o)}return u},n.isPointWithinBoundary=function(n,t,i,r){return n>=0&&n<i&&t>=0&&t<r?!0:!1},n}();n.CanvasDrawingContext=f;n.HitTestingCanvasDrawingContext=l;n.HitTestingData=e}catch(o){if(i.logger)i.logger.logCriticalError(o);else throw o;}}).call(window)