var BootstrapMapsAnswerForOverlayControl=function(){function n(n,t){this._attrName=n;this._featureName=t}return n.prototype.getBestMapView=function(){return null},n.prototype.getOutingsUpsellCategory=function(){var r=Microsoft.Maps.GlobalConfig.features.localSearch&&Microsoft.Maps.GlobalConfig.features.localSearch.outingsUpsellCategoryList,i,n,u,t;if(r&&r.length&&this._overlayObject&&this._overlayObject.getV8Map&&(i=this._overlayObject.getV8Map().getMapOptions(),i&&i.searchQueryCategory&&(n=i.searchQueryCategory.split(","),n&&n.length)))for(u=n.length,t=0;t<u;t++)if(n[t]&&r.indexOf(n[t].toLowerCase())>-1)return n[t];return null},n.prototype.getPermalinkState=function(n){var t=[],i=this._getFeatureState(n);return i&&t.push({featureType:this._featureName,data:i}),t},n.prototype._subscribeForClickEventsOnDataElements=function(n){var t=this,i;this._overlayObject=n;i=Microsoft.Maps.Internal._Gimme;this._bindClickEventsOnDataElements(_d);sj_evt.bind("LargeMapHidden",function(){t._showOrHideDataElements(!1)});sj_evt.bind("LargeMapShown",function(){t._showOrHideDataElements(!0)});sj_evt.bind("carItemsAdded",function(n){n&&n.length>1&&n[1]&&n[1].length>0&&n[1].forEach(function(n){t._bindClickEventsOnDataElements(n)})});sj_evt.bind("Cap.ExpOn",function(){var n=i(".sa_cp");n.for_each(function(n){t._bindClickEventsOnDataElements(n)})})},n.prototype._processClickEvent=function(n){n.preventDefault();for(var i=n.currentTarget,r=i&&i.getAttribute(this._attrName),t=i;!r&&t;)t=t.parentElement,r=t&&t.getAttribute(this._attrName);this._processAttribute(i,r)},n.prototype._processAttribute=function(n,t,i){var r;if(i===void 0&&(i=!0),t&&this._overlayObject&&this._overlayObject._showOrHideLargeMap){this._attrVal=t;try{this._subscribeForLargeMapShown();this._overlayObject._showOrHideLargeMap(!0,this,i)}catch(o){}if(r=n&&this._getAnchorElement(n,"data-h"),r){var f=r.getAttribute("data-h"),e=this._getFormCode(r),u=this._overlayObject.getV8Map().getMapOptions();Microsoft.Maps.logger.logObject({feature:"OverlayControl",action:"Click",data:{h:f,attribute:this._attrName,feature:this._featureName,form:e},service:u.service,scenario:u.scenario,searchQueryCategory:u.searchQueryCategory},Microsoft.Maps.GlobalConfig.dynamicProperties.mapsIG)}}else r=this._getAnchorElement(n,"data-h"),r&&(window.location.href=r.getAttribute("href"))},n.prototype._getFeatureState=function(){return this._attrVal},n.prototype._showOrHideDataElements=function(n){var u=Microsoft.Maps.Internal._Gimme,i=u("["+this._attrName+"]"),t,r;if(i)for(t=0,r=i.length;t<r;t++)i[t].style.display=n?"none":""},n.prototype._subscribeForLargeMapShown=function(){},n.prototype._bindClickEventsOnDataElements=function(n){var u=this,t=n.querySelectorAll("["+this._attrName+"]"),i,r;if(t!=null&&t.length>0)for(i=0,r=t.length;i<r;i++)sj_be(t[i],"click",function(n){return u._processClickEvent(n)}),this._updateInstrumentation(t[i])},n.prototype._updateInstrumentation=function(n){var t=this._getAnchorElement(n,"h"),i;t&&(i=t.getAttribute("h"));i&&(Microsoft.Maps.GlobalConfig.features.localSearch.sendMoreInstrumentationForOverlay||t.removeAttribute("h"),t.setAttribute("data-h",i))},n.prototype._getAnchorElement=function(n,t){var i=n.querySelector("a");if(i)return i;for(i=n;i!==document.body&&!i.getAttribute(t);)i=i.parentElement;return i!=document.body?i:null},n.prototype._getFormCode=function(n){if(n){var t=n.getAttribute("href");if(t)return Microsoft.Maps.Internal._Helper._getUrlParam({search:t},"form")}return null},n}(),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForResultsOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapLoaded",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2]);i._subscribeForClickEventsOnChildrenBoundaries(n[2])}}))},t.prototype.getBestMapView=function(n,t,i,r){var c=Microsoft.Maps.Internal._Gimme,f=c.Internals.parseJSON(this._attrVal),e,u=r||f&&f.mapBounds,o,s;if(u&&u.length==4&&(o=new Microsoft.Maps.Location(u[0],u[1]),s=new Microsoft.Maps.Location(u[2],u[3]),e={mapBounds:[o,s]}),f.minZoomForBestMapView>0&&e&&e.mapBounds){var l=this._overlayObject.getV8Map().getMode(),h=l.getMapViewForLocationsInView(e.mapBounds),a=Microsoft.Maps.ZoomLevel.fromLocation(h.cameraLocation,!0);if(a<f.minZoomForBestMapView)return{mapCenter:h.cameraLocation,mapZoom:f.minZoomForBestMapView}}return e},t.prototype._subscribeForClickEventsOnDataElements=function(i){var r=this;n.prototype._subscribeForClickEventsOnDataElements.call(this,i);sj_evt.bind("ShowResultsMapOverlay",function(n){var i,h,e;if(n){var u=n[1],o=n[2],s=typeof n[3]=="undefined"?!0:!1,f=Microsoft.Maps.Internal._Gimme;u&&u.query&&o?r._processAttribute(o,f.Internals.stringify(u),s):(i=f("["+t._attrName+"]"),i&&i[0]&&(h=i[0].getAttribute(t._attrName),e=f.Internals.parseJSON(h),e.mapBounds&&r._processAttribute(i[0],f.Internals.stringify(t._getPermalinkStateFromFeatureState(u,e)),s)))}})},t.prototype._subscribeForClickEventsOnChildrenBoundaries=function(n){var i=this,r=n.getV8Map(),t=r.getLayers().find(function(t){return t.getId()===n.childrenBoundariesLayerId});t&&t.primitiveTapped.add(function(t){var r=t.primitive.metadata&&t.primitive.metadata.title,u=_d.createElement("div");u.setAttribute("data-h","PrimitiveClick:"+r);i._processAttribute(u,'{"query":"'+r+'","disableComputingMapViewForLoadingOnly":'+!n.hasUserChangedMapView()+"}")})},t.prototype._getFeatureState=function(n){var t=Microsoft.Maps.Internal._Gimme,i=t.Internals.parseJSON(this._attrVal);return i.originIG=n,t.Internals.stringify(i)},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._getPermalinkStateFromFeatureState=function(n,t){var i=n&&n.poiCount?n.poiCount.toString():t.poiCount?t.poiCount.toString():"";return{query:t.query,mapBounds:t.mapBounds,localFilters:n&&n.filter,poiCount:i,disableComputingMapViewForLoadingOnly:t.disableComputingMapViewForLoadingOnly,searchQueryCategory:t.searchQueryCategory,chainId:t.chainId,useBmfp:t.useBmfp,primerPois:t.primerPois,categoryLayers:t.categoryLayers}},t._attrName="data-resultsoverlay",t._featureName="localListing",t}(BootstrapMapsAnswerForOverlayControl),BootstrapMapsAnswerForResultsWithDetailsOverlay,BootstrapMapsAnswerForDetailsOverlay;BootstrapMapsAnswerForResultsOverlay.Init();__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();BootstrapMapsAnswerForResultsWithDetailsOverlay=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._openDetailsCardWrapper=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r._openDetailsCard.apply(r,t)},r}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapLoaded",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}))},t.prototype.getBestMapView=function(n,t,i,r){var p=Microsoft.Maps.Internal._Gimme,o=p.Internals.parseJSON(this._attrVal),s=o.localListingsState,f,e,h=new Microsoft.Maps.Location(o.center[0],o.center[1]),u=r||s&&s.mapBounds,c,l,a,v,y;return u&&u.length==4?(c=new Microsoft.Maps.Location(u[0],u[1]),l=new Microsoft.Maps.Location(u[2],u[3]),f={mapBounds:[c,l]},a=this._overlayObject.getV8Map().getMode(),v=a.getMapViewForLocationsInView(f.mapBounds,t,n),e=s.taskFrameworkState?Microsoft.Maps.Internal.MapHelper.getZoomLevelForLocationsToBecomeVisible(this._overlayObject.getV8Map(),f.mapBounds,h):Microsoft.Maps.ZoomLevel.fromLocation(v.cameraLocation,!0)):f={mapCenter:h,mapZoom:16},y={left:t.left+i,right:t.right,top:t.top,bottom:t.bottom},(!e||isNaN(e))&&(e=f.mapZoom),{mapCenter:h,mapZoom:e,customPadding:y}},t.prototype.getPermalinkState=function(n){return this._getFeatureStateForResults(n)},t.prototype._subscribeForClickEventsOnDataElements=function(i){var r=this;sj_evt.bind("LargeMapShown",function(){r._saveOrRestoreCarouselPos(!0)});n.prototype._subscribeForClickEventsOnDataElements.call(this,i);sj_evt.bind("LargeMapHidden",function(){r._saveOrRestoreCarouselPos(!1)});sj_evt.bind("ShowResultsWithDetailsMapOverlay",function(n){var o,l,s,a,h,c,u;if(n&&n[1]){var i=n[1],v=typeof n[3]=="undefined"?!0:!1,e=Microsoft.Maps.Internal._Gimme,f=e("["+t._attrName+"]");if(!i.location&&f&&f.length>0){for(o=0,l=f.length;o<l;o++)if(s=f[o].getAttribute(t._attrName),u=e.Internals.parseJSON(s),i.title&&u.query===i.title||i.id.indexOf(u.id)>=0){sj_evt.bind("MapSearchTaskActivated",r._openDetailsCardWrapper);r._processAttribute(f[o],s);return}}else if(f&&f.length>0)s=f[0].getAttribute(t._attrName),u=e.Internals.parseJSON(s),u.disableComputingMapViewForLoadingOnly=!0,i.filter&&(u.localListingsState.filterUrlParam=i.filter),i.poiCount&&(u.localListingsState.poiCount=i.poiCount),u.localListingsState.originIG=r._overlayObject.getOriginIG(),sj_evt.bind("MapSearchTaskActivated",r._openDetailsCardWrapper),a=t._getPermalinkStateFromFeatureState(i,u),r._processAttribute(f[0],e.Internals.stringify(a));else if(h=r._overlayObject.getLargeMapLinkPermalinkState(),h)c=e.Internals.parseJSON(h),c.originIG=r._overlayObject.getOriginIG(),u={query:i.title,id:i.id,center:i.location,localListingsState:c,disableComputingMapViewForLoadingOnly:!0,entryPoint:"Permalink",type:i.type},sj_evt.bind("MapSearchTaskActivated",r._openDetailsCardWrapper),r._processAttribute(f[0],e.Internals.stringify(u));else throw"Unable to show results with details overlay";}})},t.prototype._processAttribute=function(t,i){n.prototype._processAttribute.call(this,t,i);this._prefetchDetailsCardContent()},t.prototype._processClickEvent=function(t){sj_evt.bind("MapSearchTaskActivated",this._openDetailsCardWrapper);n.prototype._processClickEvent.call(this,t)},t.prototype._saveOrRestoreCarouselPos=function(n){var u=".carousel_scroll",i="data-scrollbookmark",r=Microsoft.Maps.Internal._Gimme;n?r(u).for_each(function(n){!n.hasAttribute(i)&&r(n).select("["+t._attrName+"]").length>0&&n.setAttribute(i,n.scrollLeft.toString())}):r(u).for_each(function(n){if(n.hasAttribute(i)){var t=parseInt(n.getAttribute(i));n.removeAttribute(i);n.scrollLeft=t}})},t.prototype._getFeatureStateForResults=function(n){var r=Microsoft.Maps.Internal._Gimme,i=r.Internals.parseJSON(this._attrVal);return i.localListingsState.taskFrameworkState?this._buildPermalinkState("taskFramework",i.localListingsState.taskFrameworkState):(i.localListingsState.disableComputingMapViewForLoadingOnly=!this._overlayObject.hasUserChangedMapView(),i.localListingsState.originIG=n,this._buildPermalinkState(t._featureName,i.localListingsState))},t.prototype._buildPermalinkState=function(n,t){var r=Microsoft.Maps.Internal._Gimme,i=[];return i.push({featureType:n,data:r.Internals.stringify(t)}),i},t.prototype._prefetchDetailsCardContent=function(){var u=this,i,n,t,r;this._prefetchedDetailsCardData=null;i=Microsoft.Maps.Internal._Gimme;n=i.Internals.parseJSON(this._attrVal);switch(n.type){case"Satori":t="sid:";break;case"Business":t="ypid:"}t&&(r=Microsoft.Maps.Internal._Helper._overrideTasktypeBasedOnCategory("LocalDetailsTask",n&&n.localListingsState),this._overlayObject._map.getV8Map().getContainer().instanceAsync(r,function(i){var r=n;r.id=t+r.id;r.disableTaskActivate=!0;Microsoft.Maps.GlobalConfig.dynamicProperties.prefetchingResultsOnSerp=!0;i.process({requestState:r},function(n){u._prefetchedDetailsCardData=n&&n.data&&n.data.content;Microsoft.Maps.GlobalConfig.dynamicProperties.prefetchingResultsOnSerp=!1;sj_evt.fire("OnDetailsCardPrefetch")})}))},t.prototype._openDetailsCard=function(n){var t=this;Microsoft.Maps.GlobalConfig.dynamicProperties.prefetchingResultsOnSerp?sj_evt.bind("OnDetailsCardPrefetch",function(){t._openDetailsCardInternal(n)}):this._openDetailsCardInternal(n)},t.prototype._openDetailsCardInternal=function(){var h=Microsoft.Maps.Internal._Gimme,n=h.Internals.parseJSON(this._attrVal),t,f,r,o,i,s,c;if(n&&(n.id?t=this._getListing(n.id):n.query&&(t=this._getListing(null,n.query))),!t&&n&&n.id&&(r=document.getElementsByClassName("listings-item"),r&&r.length>0)){t=r[0];var l=t.getAttribute("data-entity"),e=JSON.parse(l),u=e&&e.entity&&e.entity.id,a=u&&u.indexOf(":");f=u.replace(u.substr(a+1),n.id)}t&&(this._overlayObject.replaceNextHistoryPoint(),o=h.Internals.parseJSON(t.getAttribute("data-task")),i=o.state,i.disableComputingMapViewForLoadingOnly=!0,i.content=this._prefetchedDetailsCardData,this._prefetchedDetailsCardData&&(i.suppressAnimationWhileSlideOut=!0),f&&(i.id=f,i.query=n.query,i.taskTitle=n.query),Microsoft.Maps.GlobalDataEventHandler.invokeHandler("data-task",o),s=Microsoft.Maps.logger,c=this._overlayObject.getOriginIG(),s&&s.logObject({T:"CI.OverlayEntClick",feature:"OverlayControl",action:"CI.OverlayEntClick",data:{}},c,!1));sj_evt.unbind("MapSearchTaskActivated",this._openDetailsCardWrapper)},t.prototype._getListing=function(n,t){var r=document.getElementsByClassName("listings-item"),u,h,f,e,i,o,s;if(r&&r.length)for(u=0,h=r.length;u<h;u++)if(f=r[u],e=f.getAttribute("data-entity"),e)if(i=JSON.parse(e),n){if(o=i&&i.entity&&i.entity.id,o&&o.indexOf(n)>0)return f}else if(t&&(s=i&&i.entity&&i.entity.title,s&&s===t))return f;return null},t._getPermalinkStateFromFeatureState=function(n,t){return{query:n.title,id:n.id,center:n.location,localListingsState:t.localListingsState,disableComputingMapViewForLoadingOnly:t.disableComputingMapViewForLoadingOnly,entryPoint:"Permalink",type:n.type}},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-resultswithdetailsoverlay",t._featureName="localListing",t}(BootstrapMapsAnswerForOverlayControl);BootstrapMapsAnswerForResultsWithDetailsOverlay.Init();__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}();BootstrapMapsAnswerForDetailsOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapLoaded",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}))},t.prototype.getBestMapView=function(){var u=Microsoft.Maps.Internal._Gimme,n=u.Internals.parseJSON(this._attrVal),t,i,r;return n&&(n&&n.centerLongitude&&n.zoom!=-1?t={mapCenter:new Microsoft.Maps.Location(n.centerLatitude,n.centerLongitude),mapZoom:n.zoom}:n.mapBounds&&n.mapBounds.length===4&&(i=new Microsoft.Maps.Location(n.mapBounds[0],n.mapBounds[1]),r=new Microsoft.Maps.Location(n.mapBounds[2],n.mapBounds[3]),t={mapBounds:[i,r]})),t},t.prototype._getFeatureState=function(n){var i=Microsoft.Maps.Internal._Gimme,r=i.Internals.parseJSON(this._attrVal),t=r.localDetailsState;return t.disableComputingMapViewForLoadingOnly=!(r.forceComputingMapViewForLoading||this._overlayObject.hasUserChangedMapView()),t.originIG=n,i.Internals.stringify(t)},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-detailsoverlay",t._featureName="localDetails",t}(BootstrapMapsAnswerForOverlayControl);BootstrapMapsAnswerForDetailsOverlay.Init();var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForBasicMapOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapLoaded",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}))},t.prototype.getBestMapView=function(){var i=Microsoft.Maps.Internal._Gimme,n=i.Internals.parseJSON(this._attrVal),t;return n&&(t={mapCenter:new Microsoft.Maps.Location(n.centerLatitude,n.centerLongitude),mapZoom:n.mapZoom,customPadding:{left:0,top:70,bottom:0,right:0}}),t},t.prototype._subscribeForClickEventsOnDataElements=function(i){var r=this;n.prototype._subscribeForClickEventsOnDataElements.call(this,i);sj_evt.bind("ShowBasicMapOverlay",function(n){var u,o;if(n){var f=n[1],i=n[2],e=Microsoft.Maps.Internal._Gimme;f&&i?r._processAttribute(i,e.Internals.stringify(f)):i&&(u=e("["+t._attrName+"]"),u&&u[0]&&(o=u[0].getAttribute(t._attrName),r._processAttribute(i,o)))}})},t.prototype._getFeatureState=function(){return null},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-basicmapoverlay",t._featureName="compositemapMode",t}(BootstrapMapsAnswerForOverlayControl),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForNearbyResultsOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapLoaded",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}))},t.prototype._getFeatureState=function(){var n=Microsoft.Maps.Internal._Gimme,t=n.Internals.parseJSON(this._attrVal);return n.Internals.stringify(t.taskFrameworkState)},t.prototype.getBestMapView=function(n,t,i,r){var h=Microsoft.Maps.Internal._Gimme,f=h.Internals.parseJSON(this._attrVal),u=r||f&&f.mapBounds,e,o,s;return u&&u.length==4&&(o=new Microsoft.Maps.Location(u[0],u[1]),s=new Microsoft.Maps.Location(u[2],u[3]),e={mapBounds:[o,s]}),e},t.prototype._subscribeForClickEventsOnDataElements=function(i){var r=this;n.prototype._subscribeForClickEventsOnDataElements.call(this,i);sj_evt.bind("ShowNearbyResultsMapOverlay",function(n){var e,f;if(n){var o=n[1],s=typeof n[3]=="undefined"?!0:!1,u=Microsoft.Maps.Internal._Gimme,i=u("["+t._attrName+"]");i&&i[0]&&(e=i[0].getAttribute(t._attrName),f=u.Internals.parseJSON(e),f.mapBounds&&r._processAttribute(i[0],u.Internals.stringify(t._getPermalinkStateFromFeatureState(o,f)),s))}})},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._getPermalinkStateFromFeatureState=function(n,t){return!t.taskFrameworkState||!t.taskFrameworkState.stacks?t:(t.taskFrameworkState.stacks.forEach(function(t){t.tasks.forEach(function(t){if(t.type==="LocalListing"){var i=t.state;i.poiCount=n&&n.poiCount?n.poiCount.toString():i.poiCount?i.poiCount.toString():"";i.localFilters=n.filter?n.filter:i.localFilters;i.disableComputingMapViewForLoadingOnly=n.filter?!1:i.disableComputingMapViewForLoadingOnly;t.state=i}})}),t)},t._attrName="data-nearbyresultsoverlay",t._featureName="taskFramework",t}(BootstrapMapsAnswerForOverlayControl),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForStreetsideOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapLoaded",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2])}}),sj_evt.bind("StreetsideImageLoaded",function(n){n&&n[1]&&(t._streetsideModeState=t._parseStreetsideUrl(n[1]))}))},t.prototype._showOrHideDataElements=function(t){n.prototype._showOrHideDataElements.call(this,t);t||sj_evt.unbind("LargeMapShown",this._showStreetside)},t.prototype._subscribeForLargeMapShown=function(){t._attrValForEventProcessing=this._attrVal;sj_evt.bind("LargeMapShown",this._showStreetside)},t.prototype._showStreetside=function(){var u=Microsoft.Maps.Internal._Gimme,f=t._getObject(),i=f._overlayObject,n,r;i&&i.setDirectStreetsideLaunch();n=u.Internals.parseJSON(t._attrValForEventProcessing);r={action:"showBubble",location:new Microsoft.Maps.Location(n.centerPoint.latitude,n.centerPoint.longitude),localDetailsStartupOptions:{},directionsStartupOptions:{heading:t._streetsideModeState&&t._streetsideModeState.direction}};Microsoft.Maps.GlobalDataEventHandler.invokeHandler("data-streetside",r)},t._parseStreetsideUrl=function(n){var f,t,i,r,u;return n?(t=n.indexOf("&dir="),t>0&&(i=n.indexOf("&",t+1),i>0&&i<n.length&&(r=n.substring(t+5,i),r&&r.length>0&&(u=parseFloat(r),u&&u!==NaN&&(f={centerPoint:null,mode:2,direction:u})))),f):null},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-streetsideoverlay",t._featureName="streetside",t}(BootstrapMapsAnswerForOverlayControl),__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),BootstrapMapsAnswerForDirectionsOverlay=function(n){function t(t,i){return n.call(this,t,i)||this}return __extends(t,n),t.Init=function(){t._initialized||(t._initialized=!0,sj_evt.bind("dynMapLoaded",function(n){if(n&&n[2]){var i=t._getObject();i._subscribeForClickEventsOnDataElements(n[2]);sj_evt.bind("DirectionButtonClicked",function(n){i._processClickEvent(n&&n[1])})}}))},t.prototype.getBestMapView=function(){var r=Microsoft.Maps.Internal._Gimme,n=r.Internals.parseJSON(this._attrVal),i,t;if(n&&n.waypoints&&n.waypoints.length==2)for(i=[],t=0;t<n.waypoints.length;t++)n.waypoints[t].point&&i.push(new Microsoft.Maps.Location(n.waypoints[t].point.latitude,n.waypoints[t].point.longitude));return{mapBounds:i}},t.prototype._subscribeForClickEventsOnDataElements=function(i){var l=this,f,r,u,h,c,e,o,s;if(n.prototype._subscribeForClickEventsOnDataElements.call(this,i),sj_evt.bind("ShowDirectionsMapOverlay",function(n){if(n&&n[1]){var t=n[1],i={mode:1,waypoints:t,entryPoint:"4"};l._processAttribute(n[2],f.Internals.stringify(i))}}),f=Microsoft.Maps.Internal._Gimme,r=f("["+t._attrName+"]"),r)for(t._dict||(t._dict={}),u=0,h=r.length;u<h;u++)if(c=r[u].getAttribute(t._attrName),e=r[u].querySelector("img"),e){o=e.getAttribute("data-imgsrc");o&&(s=DirectionsImageLoader.getHeader(o),s&&(t._dict[c]=s));return}},t.prototype._getFeatureState=function(){return this._attrVal},t._getObject=function(){return t._self||(t._self=new t(t._attrName,t._featureName)),t._self},t._attrName="data-directionoverlay",t._featureName="directions",t}(BootstrapMapsAnswerForOverlayControl)