(function(){var si,et,ci;try{(function(){var n={L_CloseTask_Text:"Close",L_Landmark_CardsContainer_Aria_Label:"Search results, directions or favorites",L_Menu_Print_Link_Text:"Print",L_Menu_Share_Link_Text:"Share",L_Menu_ListView_Link_Text:"See all cards",L_TaskCardMoreMenuText:"More",L_CardLayoutExpandCollapse_Text:"Expand/Collapse Cards"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("TaskFramework",n):window.$MicrosoftMaps8.ResourcesObject=n})();var n=window.$MicrosoftMaps8,r=n.Internal,di=r.TaskData,dt=n.Anchor,gt=r._Binding,ni=n.BasicMapAnimation,st=n.BasicTemplate,l=r._BaseMapTemplateSelector,gi=n.BitmapImageTemplate,nr=r._BoundsAccumulator,tr=n.ChildVectorImageTemplate,b=r._ComponentNames,ir=r._Color,ti=r.ContentControl,rr=r.Control,k=r.ControlTemplate,v=n.DataHandlerKeys,du=n.DefaultTemplateSelector,nt=r._EntityHelper,y=n.GlobalDataEventHandler,ur=n.ImageFromCssHelper,ut=r._Debug,ii=r._ElementSizeHelper,fr=r._EntryPoints,o=r._Gimme,w=n.GlobalConfig,i=r._Helper,t=r._JSEvent,er=n.LocalSearchEntity,or=n.LocationRect,p=r._LoggerConstants,ri=r._PerfV2Logger,sr=r._LruCache,s=r.MapHelper,hr=r.MapInteractionBehavior,a=n.Location,cr=n.MapMath,f=n.MapTypeId,ht=n.MapView,lr=n.MapViewAnimator,ui=r._MercatorTileUtility,fi=r._Network,d=r._Observable,ct=r._ObservableObject,ei=r._ObservableCollection,ar=r._ObservableObjectChangedArgs,gu=r._OverlayEntity,vr=n.Point,yr=r.PyramidTileSpatialIndex,tt=n.ResourceManager.TaskFramework,pt=n.SimplePointPrimitive,pr=n.Size,wr=r.StaticPromise,u=w.features.taskFramework,br=n.TaskTypes,kr=di.TravelAttractionEntity,dr=n.VectorMapLayer,it=n.VectorImageTemplate,nf=n.ZoomAroundLocationAnimator,h=n.ZoomLevel,gr='<div class="panelWrapper multi">    <div class="bm_waitlayer"><\/div>\t<ItemsControl ItemsSource="{Binding stacks}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<div data-containerAreaType="cardsContainer" class="panelContent" role="main" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">\t\t\t\t\t<ItemsPresenter />\t\t\t\t<\/div>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<div class="cardWrapper expand" style:width="{StaticBinding FocusedStack.ForegroundTask.RecommendedWidth Converter=getWidthString}">\t\t\t\t\t<TaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" event:click="onTaskCardClick" event:touchstart="onTaskCardTouchstart" event:touchmove="onTaskCardTouchmove" event:touchend="onTaskCardTouchend">\t\t\t\t\t\t<TaskCard.Template>\t\t\t\t\t\t\t<DataTemplate>\t\t\t\t\t\t\t\t<div class="{TemplateBinding cssClass}" data-taskId="{TemplateBinding Stack.id}" style:visibility="hidden" style:width="{TemplateBinding Stack.ForegroundTask.CurrentWidth Converter=getWidthString}">\t\t\t\t\t\t\t\t\t<div class="cardFace sideA front">                                        <div class="titleBar" event:mouseover="onTitleMouseOver" event:mouseleave="onTitleMouseLeave">                                            <a class="focusDummy" tabindex="-1" role="button" title="{TemplateBinding sideATitle}"><\/a>                                            <a href="#" role="button" class="cardTitleText">                                                <div class="{TemplateBinding iconClass}" data-tag="{TemplateBinding iconClass}" style:display="{TemplateBinding iconClass Converter=stringToDisplay}"><\/div>                                                <div class="catIcon" style:display="{TemplateBinding iconClass Converter=hideOnIconClass}">                                                    <div class="focused"><\/div>                                                    <div class="unfocused"><\/div>                                                    <div class="hovered"><\/div>                                                    <div class="decayed"><\/div>                                                <\/div>                                                <div class="title">                                                    <h2>                                                        <TextBlock Text="{TemplateBinding sideATitle}" />                                                    <\/h2>                                                <\/div>                                            <\/a>                                            <a href="#" style:display="{TemplateBinding Stack Converter=isMenuVisible}" class="menu" role="menu" title="{StaticBinding resources.L_TaskCardMoreMenuText}">                                            <\/a>                                            <a href="#" class="panelClose closeA" title="{StaticBinding resources.L_CloseTask_Text}" data-task="{TemplateBinding Stack.id Converter=closeStackById}">                                                <div class="icon"><\/div>                                            <\/a>                                        <\/div>                                        <!-- REVIEW: Share the close button for front/back faces? -->                                        <div class="cardContent">                                            <div class="contentRoot" data-containerareatype="taskArea">                                                <ContentPresenter content="sideAContent" />                                            <\/div>                                        <\/div>                                    <\/div>\t\t\t\t\t\t\t\t\t<div class="cardFace sideB back">                                        <div class="titleBar" event:mouseover="onTitleMouseOver" event:mouseleave="onTitleMouseLeave">                                            <a href="#" role="button" class="cardTitleText">                                                <div class="{TemplateBinding iconClass}" data-tag="{TemplateBinding iconClass}" style:display="{TemplateBinding iconClass Converter=stringToDisplay}"><\/div>                                                <div class="catIcon" style:display="{TemplateBinding iconClass Converter=hideOnIconClass}">                                                    <div class="focused"><\/div>                                                    <div class="unfocused"><\/div>                                                    <div class="hovered"><\/div>                                                    <div class="decayed"><\/div>                                                <\/div>                                                <div class="title">                                                    <h2>                                                        <TextBlock Text="{TemplateBinding sideBTitle}" />                                                    <\/h2>                                                <\/div>                                            <\/a>                                            <a href="#" style:display="{TemplateBinding Stack Converter=isMenuVisible}" class="menu" title="{StaticBinding resources.L_TaskCardMoreMenuText}">                                            <\/a>                                            <a href="#" class="panelClose closeB" title="{StaticBinding resources.L_CloseTask_Text}" data-task="{TemplateBinding Stack.id Converter=closeStackById}">                                                <div class="icon"><\/div>                                            <\/a>                                        <\/div>                                        <div class="cardContent">\t\t\t\t\t\t\t\t\t        <div class="contentRoot" data-containerAreaType="taskArea">\t\t\t\t\t\t\t\t\t            <ContentPresenter content="sideBContent" />\t\t\t\t\t\t\t\t\t        <\/div>                                        <\/div>                                        \t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t<\/DataTemplate>\t\t\t\t\t\t<\/TaskCard.Template>\t\t\t\t\t<\/TaskCard>\t\t\t\t<\/div>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl><\/div>',nu='<div class="panelWrapper multi">    <div class="bm_waitlayer"><\/div>\t<ItemsControl ItemsSource="{Binding stacks}">\t\t<ItemsControl.Template>\t\t\t<DataTemplate>\t\t\t\t<div data-containerAreaType="cardsContainer" class="panelContent" role="main" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">\t\t\t\t\t<ItemsPresenter />\t\t\t\t<\/div>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.Template>\t\t<ItemsControl.ItemTemplate>\t\t\t<DataTemplate>\t\t\t\t<div class="cardWrapper">\t\t\t\t\t<!-- The original solution was to use disabled="{Binding $self$ Converter=shouldStackBeDisabled}". But during debugging it turned out that the converter for the special $self$ object is being called on\t\t\t\t\t_every_  $self$ property change, not just the one I bind to. Since the converter is heavy I am moving this assignment to the stackChanged event. -->                    <SelectionTaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" event:click="onTaskCardClick" event:touchend="onTaskClick" ignoreTaskFadeProperty="true" >                        <SelectionTaskCard.Template>                            <DataTemplate>                                <div class="{TemplateBinding cssClass}" data-taskid="{TemplateBinding Stack.id}" style="visibility:hidden">                                    <div class="cardFace selectionMode sideA front"> \t\t\t\t\t\t\t\t\t\t<div class="titleBar" event:mouseover="onTitleMouseOver" event:mouseleave="onTitleMouseLeave">\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="cardTitleText">                                                <div class="{TemplateBinding iconClass}" data-tag="{TemplateBinding iconClass}" style:display="{TemplateBinding iconClass Converter=stringToDisplay}"><\/div>                                                <div class="catIcon" style:display="{TemplateBinding iconClass Converter=hideOnIconClass}">                                                    <div class="focused"><\/div>                                                    <div class="unfocused"><\/div>                                                    <div class="hovered"><\/div>                                                    <div class="decayed"><\/div>                                                <\/div>\t\t\t\t\t\t\t\t\t\t\t\t<div class="title">\t\t\t\t\t\t\t\t\t\t\t\t\t<h2>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TextBlock text="{TemplateBinding sideATitle}" />\t\t\t\t\t\t\t\t\t\t\t\t\t<\/h2>\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t\t\t\t<\/a>\t\t\t\t\t\t\t\t\t\t\t<div class="stackSelect">\t\t\t\t\t\t\t\t\t\t\t\t<CheckBox title="{StaticBinding resources.L_ClickToSelect_Text}" checked="{TemplateBinding Stack.IsSelected  Mode=TwoWay}" disabled="{TemplateBinding Stack.IsLocked}" />\t\t\t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t\t\t<\/div>                                    <\/div>                                    <div class="cardFace selectionMode sideB back">\t\t\t\t\t\t\t\t\t\t<div class="titleBar" event:mouseover="onTitleMouseOver" event:mouseleave="onTitleMouseLeave">\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="cardTitleText">                                                <div class="{TemplateBinding iconClass}" data-tag="{TemplateBinding iconClass}" style:display="{TemplateBinding iconClass Converter=stringToDisplay}"><\/div>                                                <div class="catIcon" style:display="{TemplateBinding iconClass Converter=hideOnIconClass}">                                                    <div class="focused"><\/div>                                                    <div class="unfocused"><\/div>                                                    <div class="hovered"><\/div>                                                    <div class="decayed"><\/div>                                                <\/div>\t\t\t\t\t\t\t\t\t\t\t\t<div class="title">\t\t\t\t\t\t\t\t\t\t\t\t\t<h2>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<TextBlock text="{TemplateBinding sideBTitle}" />\t\t\t\t\t\t\t\t\t\t\t\t\t<\/h2>\t\t\t\t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t\t\t\t<\/a>\t\t\t\t\t\t\t\t\t\t\t<div class="stackSelect">\t\t\t\t\t\t\t\t\t\t\t\t<CheckBox title="{StaticBinding resources.L_ClickToSelect_Text}" checked="{TemplateBinding Stack.IsSelected Mode=TwoWay}" disabled="{TemplateBinding Stack.IsLocked}" />\t\t\t\t\t\t\t\t\t\t\t<\/div>\t\t\t\t\t\t\t\t\t\t<\/div>                                    <\/div>                                <\/div>                            <\/DataTemplate>                        <\/SelectionTaskCard.Template>                    <\/SelectionTaskCard>\t\t\t\t<\/div>\t\t\t<\/DataTemplate>\t\t<\/ItemsControl.ItemTemplate>\t<\/ItemsControl>    <ContainerControl containerClass="selectionCardClass" controlName="{Binding selectionModeControlName}" controlRef="{Binding selectionControl Mode=TwoWay}"/><\/div>',tu='<div class="{Binding primitive.toolTipCssClass}">    <ul>        <ItemsControl ItemsSource="{Binding primitive.titles}">            <ItemsControl.ItemTemplate>                <DataTemplate>                    <li>                        <TextBlock Text="{Binding $self$}"/>                    <\/li>                <\/DataTemplate>            <\/ItemsControl.ItemTemplate>        <\/ItemsControl>    <\/ul><\/div>',iu='<div class="{TemplateBinding cssClass}" data-taskId="{TemplateBinding dataTaskId}" data-subTaskId="{TemplateBinding task.id}" style:width="{TemplateBinding task.CurrentWidth Converter=getWidthString}">    <div class="cardFace front">        <div class="titleBar" event:mouseenter="onTitleMouseEnter" event:mouseleave="onTitleMouseLeave" event:click="onTitleBarClick">            <a class="focusDummy" tabindex="-1" title="{TemplateBinding cardTitle}"><\/a>            <a href="#" class="cardTitleText">                <div class="{TemplateBinding iconClass}" data-tag="{TemplateBinding iconClass}" style:display="{TemplateBinding iconClass Converter=stringToDisplay}"><\/div>                <div class="catIcon" style:display="{TemplateBinding iconClass Converter=hideOnIconClass}">                    <div class="focused"><\/div>                    <div class="unfocused"><\/div>                    <div class="hovered"><\/div>                    <div class="decayed"><\/div>                <\/div>                <div class="title">                    <h2>                        <TextBlock Text="{TemplateBinding cardTitle}" />                    <\/h2>                <\/div>            <\/a>            <a href="#" style:display="{TemplateBinding task Converter=isMenuVisible}" class="menu" role="menu" title="{StaticBinding resources.L_TaskCardMoreMenuText}">            <\/a>            <a href="#" class="panelClose" title="{StaticBinding resources.L_CloseTask_Text}" data-task="{TemplateBinding task.id Converter=closeTaskById}">                <div class="icon"><\/div>            <\/a>        <\/div>        <div class="cardContent">            <div class="contentRoot" data-containerareatype="taskArea">                <ContentPresenter content="cardContent" />            <\/div>        <\/div>    <\/div><\/div>',ru='<div>    <div class="bm_scrollbarMask">        <div class="panelWrapper multi">            <div class="bm_waitlayer"><\/div>            <ItemsControl ItemsSource="{Binding stacks}">                <ItemsControl.Template>                    <DataTemplate>                        <div class="cardCol panelContent" data-containerAreaType="cardsContainer" role="main" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">                            <ItemsPresenter />                        <\/div>                    <\/DataTemplate>                <\/ItemsControl.Template>                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <div class="cardWrapper expand" style:width="{StaticBinding FocusedStack.FirstTask.RecommendedWidth Converter=getWidthString}">                            <SingleTaskCard LayoutMetrics="{StaticBinding layoutMetrics}" Stack="{Binding $self$}" Task="{Binding firstTask}" event:click="onTaskCardClick" event:titleMouseEnter="onTitleMouseOver" event:titleMouseLeave="onTitleMouseLeave"/>                        <\/div>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div>    <div class="bm_scrollbarMask" style:display="{Binding slideoutTask Converter=taskExistsToDisplay}">        <div class="panelWrapper multi left noScroll">            <div class="bm_waitlayer"><\/div>            <div class="cardCol slidecard panelContent" data-containerAreaType="cardsContainer" role="main" aria-label="{StaticBinding resources.L_Landmark_CardsContainer_Aria_Label}">                <div class="cardWrapper expand">                    <SingleTaskCard LayoutMetrics="{StaticBinding focusedStack.layoutMetrics}" Stack="{Binding focusedStack}" Task="{Binding slideoutTask}" />                <\/div>            <\/div>        <\/div>    <\/div><\/div>',e=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),uu=function(n){function t(t,i,r){var u=this;return t||(t={}),u=n.call(this,t)||this,u.controlTemplateFactory=i,u._templateName=r,u.disposables=[],u}return e(t,n),t.prototype.boolToDisplay=function(n){return n?"":"none"},t.prototype.boolToNotDisplay=function(n){return n?"none":""},t.prototype.nullToDisplayNone=function(n){return n?"":"none"},t.prototype.nullToDisplay=function(n){return n?"none":""},t.prototype.boolToVisibility=function(n){return n?"visible":"hidden"},t.prototype.boolToActiveClass=function(n){return n?"active":"inactive"},t.prototype.boolToInactiveClass=function(n){return this.boolToActiveClass(!n)},t.prototype.boolToDisabledClass=function(n){return n?"active":"disabled"},t.prototype.fractionToPercent=function(n){return n*100+"%"},t.prototype.update=function(){throw"update is not implemented";},t.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw"control template factory must be defined.";var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},t.prototype.getTitle=function(){return""},t.prototype.dispose=function(){n.prototype.dispose.call(this);this._control&&this._control.clear();this._control=null;this._templateName=null;this.controlTemplateFactory=null;i._clearDisposables(this.disposables)},t.prototype._getCardWidth=function(){return u.defaultCardWidth},t}(ct),oi=function(){function n(n,t,i,r){this.sender=n;this.primitive=t;this.oldValue=i;this.newValue=r}return n}(),ft=function(){function i(n,i,r){this._events=[];this._computeBestMapViewOnSetPrimitives=!0;this._computeBestMapViewOnDisplayStateChange=!0;this._computeBestMapViewOnTaskActivate=!1;this._map=n;this.invalidated=new t;this.mapViewChanged=new t;this.labelsRendered=new t;this.poiViewStateChanged=new t;this.primitivesRendered=new t;this._layerName=i;this._poiTemplateSelector=r;r&&r.selectorReady();this._overlayAnchor=new dt(20,-20);this._hoverTimerId=-1}return i._getOverlayTemplate=function(){return i._overlayTemplate||(i._overlayTemplate=new k(tu)),i._overlayTemplate},i.prototype._isProminenceDefined=function(){return this._taskDisplayState&&typeof this._taskDisplayState.prominence!="undefined"},i.prototype._isDataDefined=function(){return typeof this._primitives!="undefined"},i.prototype._shouldInvalidate=function(){return this._isProminenceDefined()&&this._isDataDefined()&&this._isDirty&&(!this._invalidateQueued||this._isMapViewFromBackendJustSet)},i.prototype.setPrimitives=function(n,t){n&&(this._isDirty=!0,this._primitives=n,this._updatePrimitivesAndLayerData(this._isPrimaryProminence()&&this._computeBestMapViewOnSetPrimitives&&!t))},i.prototype.suppressViewChangeOnRefreshOnce=function(){this._suppressViewChangeOnRefreshOnce=!0},i.prototype.getPrimitiveAt=function(n){return this._primitives&&n>=0&&n<this._primitives.length?this._primitives[n]:null},i.prototype._setDirtyBasedOnTaskDisplayState=function(n){this._isDirty=typeof n.prominence!="undefined"&&this._taskDisplayState&&this._taskDisplayState.prominence!==n.prominence||typeof n.cardTitleHoveringState!="undefined"||typeof n.isAutoFocused!="undefined"&&this._taskDisplayState&&this._taskDisplayState.isAutoFocused!==n.isAutoFocused||n.activationState===1},i.prototype.setTaskDisplayState=function(n){var t;this._setDirtyBasedOnTaskDisplayState(n);var u=this._taskDisplayState&&this._taskDisplayState.activationState,i=n&&n.activationState,f=this._taskDisplayState&&this._taskDisplayState.prominence,e=n&&n.prominence,r=this._taskDisplayState&&n&&typeof n.isAutoFocused!="undefined"&&!this._taskDisplayState.isAutoFocused&&n.isAutoFocused;this._taskDisplayState=this._taskDisplayState||{};d.mergeProperties(this._taskDisplayState,n);t=(u!==i||f!==e)&&i===1;this._computeBestMapViewOnTaskActivate&&(this._isDirty=t);this._primitives&&(n.prominence&&!this._computeBestMapViewOnTaskActivate||this._computeBestMapViewOnTaskActivate&&t||r)?this._updatePrimitivesAndLayerData(this._isPrimaryProminence()&&this._computeBestMapViewOnDisplayStateChange&&!n.suppressViewChange,r):n.cardTitleHoveringState&&this._updatePrimitivesAndLayerData(!1)},i.prototype.dispose=function(){if(this._primitives=null,this._events){for(var n=this._events.length-1;n>=0;n--)this._events[n].dispose();this._events=null}this._layer&&(this._map.getLayers().remove(this._layer),this._layer.dispose(),this._layer=null);this._isDisposed=!0},i.prototype.getPrimitives=function(n,t){t&&t({primitives:this._primitives})},i.prototype.getLayer=function(){return this._layer},i.prototype.refreshMap=function(n,t){var i=this,r;this._suppressViewChangeOnRefreshOnce&&(n=!1,this._suppressViewChangeOnRefreshOnce=!1);this._shouldInvalidate()&&(this._invalidateQueued=!0,(this._isMapViewFromBackendJustSet||n&&!this._taskDisplayState.isAutoFocused)&&(r=this.computeBestMapView(t),r&&this.mapViewChanged.invoke(r)),Microsoft.Maps.setTimeout(function(){i._invalidateQueued=!1;i._initialized?i.invalidated.invoke():i._initialize()},0),this._isDirty=!1)},i.prototype.setPoiState=function(n,t){var i=n;this.poiViewStateChanged.invoke(new oi(this,i,i.viewState,t));i.viewState=t;i.zIndex=t===1?2:0;this._createEntityChangedEvent(n);n.entity&&n.entity.changed.invoke()},i.prototype.getBestMapView=function(){return null},i.prototype.getZIndex=function(){return this._layer&&this._layer.getZIndex()},i.prototype.getLayerId=function(){return this._layer&&this._layer.getId()},i.prototype.setZIndex=function(n){this._layer&&this._layer.setZIndex(n)},i.prototype.setIconColorFromCard=function(n){this._iconColorFromCard=n},i.prototype._setSelectedPrimitive=function(n,t){if(n){if(this.setPoiState(n,2),t)return;this._isDirty=!0;this.refreshMap()}},i.prototype._getTargetMapView=function(){var n,t;if(this._primitives&&(t=this._getLocations(),t=this._cullOutlierLocations(t),n=this._map.getMode().getMapViewForLocationsInView(t),this._prevTaskPrimitive&&this._prevTaskPrimitive.geometryType===1)){var i=this._prevTaskPrimitive.geometry,f=this._map.getBounds(!0,n),r=new a(i.y,i.x);if(!f.contains(r)){var e=h.fromLocation(n.cameraLocation,!0),o=new a(n.cameraLocation.latitude,n.cameraLocation.longitude,h.toAltitude(n.location,Math.floor(e-1),!0),0),u=new ht(o),s=this._map.getBounds(!0,u);s.contains(r)&&(n=u)}this._prevTaskPrimitive=null}return n},i.prototype.computeBestMapView=function(){var n=null,e=this._map.getMapType(),t;if(this._primitives&&e.id!==f.birdseyeV2){if(this.disableComputingMapViewForFirstTimeLoad)return this.disableComputingMapViewForFirstTimeLoad=!1,n;var r=this._getLocations(),o=this._map.getView(),u=this._getTargetMapView(),h=s.getMapBounds(this._map,!0),i=0;for(t=r.length-1;t>=0;t--)h.contains(r[t])&&++i;i===this._primitives.length?n=this.zoomInIfNeeded(o,u):0===i&&(n=this.findBestViewForPrimitivesNotInView(u))}return n},i.prototype.zoomInIfNeeded=function(n,t){var r=h.fromLocation(n.cameraLocation,!0),i=h.fromLocation(t.cameraLocation,!0);return s.setMapCenter(this._map,t.cameraLocation,i,null,this.getDefaultAnimator(t)),t},i.prototype.zoomOutWithCurrentContext=function(n){var t=this._getTargetMapView(),i=s.getMapCenter(this._map),r=s.getZoomLevelForLocationsToBecomeVisible(this._map,n,i);return s.setMapCenter(this._map,t.cameraLocation,r,null,this.getDefaultAnimator(t)),t},i.prototype.findBestViewForPrimitivesNotInView=function(n){this._storeComputedMapView();var t=h.fromLocation(n.cameraLocation,!0);return t<=u.defaultZoomLevel?s.setMapCenter(this._map,n.cameraLocation,t):s.setMapCenter(this._map,n.cameraLocation,u.defaultZoomLevel)},i.prototype.getDefaultAnimator=function(n){var t=this._map.getView();return new lr(t,n)},i.prototype._initialize=function(){var n=this;this._initialized||this._isDisposed||(this._initialized=!0,this._createLayer(i._getUniqueId(this._layerName?this._layerName:"PoiManager"),this._poiTemplateSelector),(this instanceof wi||this instanceof bi||this instanceof ai)&&w.tileRefactoringEnabled?this._layer.setRenderTarget(2):this._layer.setRenderTarget(1),this._setPrimitiveLayer(),this._addLayerToMap(this._layer),this._events.push(this._layer.primitiveTapped.add(function(t){n._onPrimitiveTapped(t)})),this._events.push(this._layer.contextMenuInvoked.add(function(t){n.onContextMenuInvoked(t)})),this._events.push(this._layer.primitiveHoverStarted.add(function(t){n._onPrimitiveHoverStarted(t)})),this._events.push(this._layer.primitiveHoverStopped.add(function(t){n._onPrimitiveHoverStopped(t)})),this._events.push(this._layer.getFrameManager().primitivesRendered.add(function(t){n.primitivesRendered.invoke(t)})),this._events.push(this._map.getFrameManager().labelsRendered.add(function(){n.labelsRendered.invoke()})))},i.prototype._createLayer=function(n,t){this._layer=new dr(n,this,t,ot.foregroundZOrder)},i.prototype._setPrimitiveLayer=function(){var n=this;this._layer&&this._primitives&&this._primitives.forEach(function(t){t.layer=n._layer})},i.prototype._addLayerToMap=function(n){this._map.getLayers().insert(n)},i.prototype._onPrimitiveHoverStarted=function(n){var t=this;n.primitive&&n.primitive.entity&&n.primitive.viewState!==2&&n.primitive.viewState!==3&&(this._hoverTimerId=Microsoft.Maps.setTimeout(function(){sj_evt&&t._primitiveHasRichInfobox(n.primitive)&&sj_evt.fire("pushpinhoverstarted",n.primitive);t.setPoiState(n.primitive,1);t._hoverTimerId=-1;t._hoverPoi=n.primitive},i._primitiveHoverTimeoutThreshold))},i.prototype._onPrimitiveHoverStopped=function(n){(this._hoverPoi===n.primitive||n.primitive&&n.primitive.entity&&n.primitive.viewState!==2&&n.primitive.viewState!==3)&&(this._hoverTimerId!==-1?(window.clearTimeout(this._hoverTimerId),this._hoverTimerId=-1):(sj_evt&&n&&this._primitiveHasRichInfobox(n.primitive)&&sj_evt.fire("pushpinhoverstopped",n.primitive),this.setPoiState(n.primitive,0)))},i.prototype._updatePrimitiveForLabeling=function(n){n.viewState!==3&&(this._isPrimaryProminence()?n.bucket=n.entity.usePricePoi?l.pricePoiBucketId:l.bucketIdForPoi:n.taskDisplayState&&n.taskDisplayState.cardTitleHoveringState===1?n.bucket=n.entity.usePricePoi?l.pricePoiBucketId:l.bucketIdForPoi:delete n.bucket)},i.prototype._isPrimaryProminence=function(){return this._isProminenceEqualTo(1)},i.prototype._getLocations=function(){var n=[];return this._primitives&&this._primitives.forEach(function(t){if(1===t.geometryType){var i=t.geometry;n.push(new a(i.y,i.x))}else ut.assert(!1,"Only point primitives are supported")}),n},i.prototype._storeComputedMapView=function(){},i.prototype._resetHoveredPoi=function(n){!this._isPrimaryProminence()&&n&&n.primitive&&n.primitive.viewState!==2&&n.primitive.viewState!==3&&this.setPoiState(n.primitive,0)},i._getUniqueId=function(n){var t=i._layerIndex++;return n+"_Layer_"+t},i.prototype._onPrimitiveTapped=function(n){this._resetHoveredPoi(n);this._setSelectedPrimitive(n.primitive)},i.prototype.onContextMenuInvoked=function(n){this._setSelectedPrimitive(null);this._resetHoveredPoi(n)},i.prototype._isProminenceEqualTo=function(n){return this._taskDisplayState&&this._taskDisplayState.prominence===n},i.prototype._setEntityCollisionBehavior=function(n){n.entity.collisionBehavior=2},i.prototype._updatePrimitivesAndLayerData=function(n,t,i){var r=this,u,f;i===void 0&&(i=!0);this._primitives&&(u=this._getPoiToolTipTemplateCssClass(),f=function(){return!0},this._primitives.forEach(function(n){n.isHoverEnabled||(n.isHoverEnabled=f);var t=n.entity;t&&t.isPaginationReducedPoi&&!t.iconColorFromCard&&r._iconColorFromCard&&(t.iconColorFromCard=r._iconColorFromCard);n.layer=r._layer;n.revision=(n.revision||0)+1;r._createEntityChangedEvent(n);r._updatePrimitiveForOverlay(n,n.entity&&[n.entity.getTitle&&n.entity.getTitle()],u);i&&(n.taskDisplayState=r._taskDisplayState,r._updatePrimitiveForLabeling(n),r._setEntityCollisionBehavior(n))}),this.refreshMap(n,t))},i.prototype._createEntityChangedEvent=function(n){n.entity&&!n.entity.changed&&(n.entity.changed=new t)},i.prototype._updatePrimitiveForOverlay=function(n,t,r){n.titles=t;n.toolTipCssClass=r;this._layer&&(this._layer.overlayAnchor=this._overlayAnchor,this._layer.overlayTemplate=i._getOverlayTemplate(),this._layer.overlayEvent=this._isPrimaryProminence()||this._primitiveHasRichInfobox(n)||this._isTransientLensEntity(n)?0:2)},i.prototype._getPoiToolTipTemplateCssClass=function(){var n="bm_poiToolTip",i=this._taskDisplayState&&this._taskDisplayState.colorIndex,t;if(i){t=this._map.getMapType().id===f.aerial?"dark":"light";switch(i){case 1:n+=" "+t+"PoiToolTipAccentColor1";break;case 2:n+=" "+t+"PoiToolTipAccentColor2";break;case 3:n+=" "+t+"PoiToolTipAccentColor3";break;case 7:n+=" "+t+"PoiToolTipTransitColor"}}return n},i.prototype._isTransientLensEntity=function(t){return n&&n.PoiOverlayEntity&&t&&t.entity instanceof n.PoiOverlayEntity},i.prototype._primitiveHasRichInfobox=function(n){var e=["90287","90232","91572","13344","house"],t,u,i,f,r;if(n){if((t=n.entity,t&&t.infoboxHtml)||n.entity instanceof kr)return!0;if(u=t&&t.getPrimaryCategoryPath&&t.getPrimaryCategoryPath(),i=u&&u.split("."),i&&i.length)for(f=i.length,r=0;r<f;++r)if(i[r]&&e.indexOf(i[r].toLowerCase())>-1)return!0}return!1},i.prototype._cullOutlierLocations=function(n){var u=.675,f=7,r;if(n.length<15)return n;var t=n.map(function(n){return n.latitude}),i=n.map(function(n){return n.longitude}),e=t.sort()[Math.floor(t.length/2)],o=i.sort()[Math.floor(i.length/2)],s=t.map(function(n){return Math.abs(n-e)}),h=i.map(function(n){return Math.abs(n-o)}),c=s.sort()[Math.floor(s.length/2)],l=h.sort()[Math.floor(h.length/2)];return c===0||l===0?n:(r=n.filter(function(n){var t=u*Math.abs(n.latitude-e)/c<f,i=u*Math.abs(n.longitude-o)/l<f;return t&&i}),n.length-r.length>2?n:r)},i._layerIndex=1e4,i._primitiveHoverTimeoutThreshold=200,i}(),fu=function(r){function f(n){var i=this,f={};return i=r.call(this,f)||this,i.serializableObjectChanged=new t,i.primitiveInteracted=new t,f.defineProperty("percentLoaded"),f.defineProperty("title"),f.defineProperty("recommendedWidth"),f.defineProperty("currentWidth"),f.defineProperty("mapPrimitives",function(n,t){return i._onPrimitivesChanged(t)},null,{defaultValue:[]}),i.panelRoot=o(document.createElement("div")),i.disposables=[],i.perfLog=n,i._areEventsInitialized=!1,i.setRecommendedWidth(u.defaultCardWidth),i.setCurrentWidth(u.defaultCardWidth),i}return e(f,r),f.getImpressionGuid=function(n){var r,t,i;return n&&(t=n.select("div[data-ig]"),t&&t.length===1&&(i=t[0].getAttribute("data-ig"),i&&(r=i))),r},f.prototype.activate=function(n){var t=this;this.map=n;this._areEventsInitialized||(this.poiManager&&this.disposables.push(this.poiManager.poiViewStateChanged.add(function(n){t._onPoiViewStateChanged(n)})),this._areEventsInitialized=!0);n&&this.map.getTemplateSelector().then(function(n){f._mapTemplateSelector=n;t.changed.invoke({name:"iconClass"})})},f.prototype.setDisplayState=function(n){this.displayState=this.displayState||{};d.mergeProperties(this.displayState,n);this._setMapLayerZIndex(ot.getZOrderOfTaskPrimitives(this.displayState));this.poiManager&&this.poiManager.setTaskDisplayState(n);this.changed.invoke(new ar(this,"displayState",null,n));i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&this.displayState.prominence===1&&this.displayState.stackOrder===1&&n.cardTitleHoveringState!==1&&n.cardTitleHoveringState!==2&&!this.displayState.pendingRemoval&&sj_evt.fire("TaskActivated",{id:this.id,IG:f.getImpressionGuid(this.panelRoot)})},f.prototype.deactivate=function(){this.poiManager&&(this.poiManager.dispose(),this.poiManager=null);i._clearDisposables(this.disposables);i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&sj_evt&&sj_evt.fire("TaskDeactivated",{id:this.id,IG:f.getImpressionGuid(this.panelRoot)})},f.prototype.serialize=function(){throw"serialize not implemented";},f.prototype.deserialize=function(){},f.prototype.canColorFade=function(){return u.canCardColorFade},f.prototype.hasDefaultFocusElement=function(){return!1},f.prototype.getContent=function(){return this.panelRoot&&this.panelRoot[0]},f.prototype.appendControl=function(n){this.panelRoot.append(n);this.changed.invoke()},f.prototype.addControl=function(n){this.panelRoot.clear();this.appendControl(n)},f.prototype.process=function(){},f.prototype.processCallback=function(){},f.prototype.getMenuList=function(){var t=this,i=[],r=n.GlobalConfig.features.sharing;return r&&r.isEnabled&&!r.disableOutboardSharing&&this.isSharable()&&i.push({name:tt.L_Menu_Share_Link_Text,handler:function(){return t._share()},instData:this.getInstData("Share")}),this.hasPrintContent()&&i.push({name:tt.L_Menu_Print_Link_Text,handler:function(){y.invokeHandler(v.printDataHandlerKey,{source:2,taskType:t.type,taskId:t.id,data:t.getPrintInstrumentationData()})},instData:this.getInstData("Print")}),u.enableListView&&i.push({name:tt.L_Menu_ListView_Link_Text,handler:function(){y.invokeHandler(v.layoutDataHandlerKey,{action:"updateLayout",state:{layoutType:"listView"}})},instData:this.getInstData("ListView")}),i},f.prototype.getPrintInstrumentationData=function(){return null},f.prototype.getCardIconInfo=function(){throw"Not implemented";},f.prototype.hasPrintContent=function(){return!1},f.prototype.getPrintContent=function(){return null},f.prototype._onPoiViewStateChanged=function(n){if(n&&n.oldValue&&n.newValue===2){var t={action:"focus",id:this.id};y.invokeHandler(v.taskDataHandlerKey,t)}},f.prototype._onPrimitivesChanged=function(n){this.poiManager&&this.poiManager.setPrimitives(n)},f.prototype.isReportable=function(){return!1},f.prototype.isSharable=function(){return!1},f.prototype._setMapLayerZIndex=function(n){n&&this.poiManager&&this.poiManager.setZIndex(n)},f.prototype._share=function(){y.invokeHandler(v.shareDataHandlerKey,{action:"shareTasks",taskIds:[this.id],entryPoint:fr.TaskCard})},f.prototype.getInstData=function(n){return{logData:{feature:b.CardModel,action:p.Clicked,data:{TT:this.type,TID:this.id,MI:n}}}},f.prototype.getCardIcons=function(n){return!this._cardIcons&&f._mapTemplateSelector&&n&&(this._cardIcons=[],this._cardIcons.push(this._buildCardIcon(ir.white,n)),i._isNewCardHeaderStyleEnabled()?(this._cardIcons.push(this._buildCardIcon(null,n)),this._cardIcons.push(this._buildCardIcon(f._decayedCardIconColor,n)),this._cardIcons.push(this._buildCardIcon(null,n))):this._cardIcons.push(this._buildCardIcon(f._unfocusedCardIconColor,n))),this._cardIcons},f.prototype.getIconColorAndClassName=function(n){n(null,null)},f.prototype._buildCardIcon=function(n,t,r){var u,e,o,s;return f._mapTemplateSelector&&(e=w.isMobile?40:28,o=w.isMobile?48:36,u=i._createElement("div"),u.set_style({width:e+"px",height:o+"px","padding-top":"4px"}),s=f._mapTemplateSelector.getCategoryIconTemplate(function(n,t){n&&u.append(n.renderIcon());r&&r(t)},t,n,e,o)),u},f._unfocusedCardIconColor="rgba(255, 255, 255, 0.8)",f._decayedCardIconColor="#919191",f}(ct),lt=function(n){function i(i){var r=this,u={};return r=n.call(this,u)||this,r._privates=u,r.id=i,r.displayState={},r._handlers={},r.serializableObjectChanged=new t,r.tasksRemoved=new t,r.taskAdded=new t,r.stackSelected=new t,r._tasks=[],r.flipAnimationCompleted=new t,u.defineProperty("foregroundTask",function(){r.serializableObjectChanged.invoke()},null,{isPrivate:!0,defaultValue:null}),u.defineProperty("isSelected",function(n,t){n!==null&&n!==undefined&&r.stackSelected.invoke({stack:r,isSelected:t})}),u.defineProperty("isLocked",null,null,{defaultValue:!1}),r}return e(i,n),i.prototype.addTask=function(n,t){var i,r;if(!n){ut.throwException("Invalid task passed to TaskStack.addTask");throw 1;}if(this._getTaskIndex(n.id)>=0){ut.throwException("Attempt to add task to stack that already contains it");throw 1;}if(i=0,t){if(r=this._getTaskIndex(t),r<0){ut.throwException("Invalid parentId passed to TaskStack.addTask");throw 1;}i=r+1}this._pruneStack(i);this.setTaskAt(n,i);this.setForegroundTask();this.taskAdded.invoke(n)},i.prototype.dispose=function(){n.prototype.dispose.call(this);this._pruneStack(0,!0)},i.prototype.focusTask=function(n){var t=this._getTaskIndex(n);t>=0&&(this._pruneStack(t+1),this.setForegroundTask())},i.prototype.getTask=function(n){var t=this._getTaskIndex(n);return t>=0?this._tasks[t]:null},i.prototype.getAllTasks=function(){return this._tasks},i.prototype.removeAllTasks=function(){this._pruneStack(0);this.setForegroundTask()},i.prototype.removeTask=function(n){var t=this._getTaskIndex(n);t>=0&&(this._pruneStack(t),this.setForegroundTask())},i.prototype.removeChildren=function(n,t){var i=this._getTaskIndex(n);i>=0&&this._pruneStack(i+1,t)},i.prototype.setForegroundTask=function(){var n=this._tasks.length>0?this._tasks[this._tasks.length-1]:null;this._privates.setForegroundTask(n)},i.prototype.setTaskAt=function(n,t){this._addSerializationHandlers(n);this._tasks[t]=n;n.stackId=this.id;i.setTaskDisplayState(n,{stackOrder:t+1})},i.prototype.getTasksByType=function(n,t){this._tasks.forEach(function(i){i&&i.type===n&&t.push(i)})},i.prototype.getFirstTask=function(){var n,t;return this._tasks.length!==0?(n=this._tasks.length-1,n>0)?(t=this._tasks[n],t.noSlideout?t:this._tasks[n-1]):this._tasks[0]:null},i.prototype.setDisplayState=function(n,t){var u,r;for(t===void 0&&(t=!0),d.mergeProperties(this.displayState,n),u=n.activationState===1,u&&(n.activationState=2,n.suppressViewChange=!0),r=0;r<this._tasks.length;r++)u&&r===this._tasks.length-1&&(n.activationState=1,n.suppressViewChange=!1,i.setTaskDisplayState(this._tasks[r],n)),i.setTaskDisplayState(this._tasks[r],n);t&&this.serializableObjectChanged.invoke({magnitude:0})},i.setTaskDisplayState=function(n,t){return n&&(n.displayState=n.displayState||{},d.mergeProperties(n.displayState,t),n.setDisplayState&&n.setDisplayState(t)),!!n},i.prototype.serialize=function(n,t){function f(i,r){var f=!1;return i&&(!r||r&&i.isSharable())&&(u.tasks.push({id:i.id,ds:i.displayState,type:i.type.replace("Task",""),state:i.serialize(n,t)}),f=!0),f}var i=!1,u={id:this.id,ds:this.displayState,tasks:[]},r;if(t&&t===2)this._tasks&&this._tasks.length>0&&(i=i||f(this._tasks[this._tasks.length-1],!0));else{for(r=0;r<this._tasks.length;r++)f(this._tasks[r],!1);i=!0}return i?u:null},i.prototype.deserialize=function(n){if(this.id&&this.id!=n.id){ut.throwException("Attempt to deserialize into incorrect task stack");throw 1;}this.id=n.id},i.prototype._addSerializationHandlers=function(n){var t=this;n&&!this._handlers[n.id]&&n.serializableObjectChanged&&(this._handlers[n.id]=n.serializableObjectChanged.add(function(n){t.serializableObjectChanged.invoke(n)}))},i.prototype._removeSerializationHandlers=function(n){var t=n&&this._handlers[n.id];t&&(t.dispose(),delete this._handlers[n.id])},i.prototype._getTaskIndex=function(n){for(var i=-1,t=0,r=this._tasks.length;t<r;t++)if(this._tasks[t].id===n){i=t;break}return i},i.prototype._pruneStack=function(n,t){var r=this,i;n>=0&&n<this._tasks.length&&(i=this._tasks.splice(n),i.forEach(function(n){r._removeSerializationHandlers(n)}),t||this.tasksRemoved.invoke(i))},i}(ct),c=function(n){function i(){var i=this,r={};return i=n.call(this,r)||this,i._privates=r,r.defineProperty("stack",function(n,t){return i._onStackChanged(t)}),r.defineProperty("sideATask",function(n,t){return i._onSideAChanged(n,t)},null,{isPrivate:!0}),r.defineProperty("sideBTask",function(n,t){return i._onSideBChanged(n,t)},null,{isPrivate:!0}),r.defineProperty("sideATitle"),r.defineProperty("sideBTitle"),r.defineProperty("cssClass"),r.defineProperty("iconClass"),r.defineProperty("layoutMetrics"),i.click=new t,i.touchstart=new t,i.touchmove=new t,i.touchend=new t,i.rendered.add(function(){i._onRendered()}),i.setTemplate(new k("<div><ContentPresenter /><\/div>")),i}return e(i,n),i.prototype._onClick=function(n){var u=this._getCardTitle(),f=this._getCardCloseButton(),t=this._getCardMenu(),i,r,e;if(t&&(t[0]===n.target||t.length>0&&t.has(n.target)))n.preventDefault&&n.preventDefault(),i=this.getStack(),r=i.getForegroundTask(),i.displayState.activationState!==1&&y.invokeHandler(v.taskDataHandlerKey,{action:"focus",id:r.id}),y.invokeHandler(v.instrumentationDataHandlerKey,{logData:{feature:b.CardModel,action:p.Activated,data:{TT:r.type,TID:r.id,SID:i.id}}}),this._showMenu(this.getStack().getForegroundTask().getMenuList());else{if(f[0]===n.target||f.length>0&&f.has(n.target))return;(u[0]===n.target||u.length>0&&u.has(n.target))&&(n.preventDefault&&n.preventDefault(),e=this.getStack(),this.click.invoke({card:this,stack:e}))}},i.prototype._onTouchstart=function(n){this.touchstart.invoke({event:n,card:this,panel:this._getPanelWrapper()})},i.prototype._onTouchmove=function(n){this.touchmove.invoke({event:n,card:this,panel:this._getPanelWrapper()})},i.prototype._onTouchend=function(n){this.touchend.invoke({event:n,card:this,panel:this._getPanelWrapper()})},i.prototype._getContent=function(n){var t=this.getLayoutMetrics();return n&&t&&n.getContent(t)},i.prototype.getSideAContent=function(){return this._getContent(this.getSideATask())},i.prototype.getSideBContent=function(){return this._getContent(this.getSideBTask())},i.prototype._flipCard=function(){var s=this,t=this.getStack(),n=t&&t.getForegroundTask(),r,l,a,w,v;if(n){if(!this.getSideATask()&&!this.getSideBTask()){this._privates.setSideATask(n);this._setCardFaces(!0);return}r=!this.isSideAFront;r?this._privates.setSideATask(n):this._privates.setSideBTask(n);var y=r?this.getSideBTask():this.getSideATask(),b=y&&y.displayState.stackOrder||0,h=Math.min(Math.max(n.displayState.stackOrder-b,-1),1),u=this.getRootElement(),e=u.select(".cardFace.front"),f=u.select(".cardFace.back"),c=null,p={"backface-visibility":"hidden",visibility:"visible"};if(e.set_style(p),f.set_style(p),c=function(){s._setCardFaces(r);r?s._privates.setSideBTask(null):s._privates.setSideATask(null);e.set_style({transform:"",visibility:"visible"});f.set_style({transform:"",visibility:"","backface-visibility":""});t.flipAnimationCompleted.invoke();i.setFocusToTitle(t,u,!1)},l=d.getValue(n,"percentLoaded"),a=n,a.changed&&typeof l=="number"&&l!==1&&(f.set_style({height:e[0].clientHeight+"px"}),w=a.changed.add(function(n){n&&n.name==="percentLoaded"&&n.newValue===1&&(w.dispose(),f.set_style({height:""}))})),!h||t.displayState.activationState!==1){c();return}if(v=this._getPanelWrapper(),v&&v.has_class("left")){var k=this._panelWrapper.get_size(),g=this._panelWrapper.get_scroll_pos(),nt=u.get_relative_pos();u.set_style({"perspective-origin":"50% "+(k.height/2-(nt.y-g.y))+"px"})}o.Transition.run(f,[{property:"transform",from:"rotateY("+-h*180+"deg)",to:"rotateY(0)",duration:500}]);o.Transition.run(e,[{property:"transform",from:"rotateY(0)",to:"rotateY("+h*180+"deg)",duration:500}],c)}},i.prototype._onStackChanged=function(n){var t=this;this._stackChanged&&this._stackChanged.dispose();n&&(this._stackChanged=n.changed.add(function(n){n.name==="foregroundTask"&&t._flipCard()}));this._privates.setSideBTask(null);this._privates.setSideATask(n&&n.getForegroundTask());this._setCardFaces(!0)},i.prototype._onSideAChanged=function(n,t){var r=this;n&&n.changed.remove(this._setSideATaskChanged);t&&(t.changed.add(function(n){return r._setSideATaskChanged(t,n)}),this.setSideATitle(t.getTitle()),this.setCssClass(this._getCardClass(this.getStack())),this._setCardIconClass(t,i.SideASelector))},i.prototype._onSideBChanged=function(n,t){var r=this;n&&n.changed.remove(this._setSideBTaskChanged);t&&(t.changed.add(function(n){return r._setSideBTaskChanged(t,n)}),this.setSideBTitle(t.getTitle()),this.setCssClass(this._getCardClass(this.getStack())),this._setCardIconClass(t,i.SideBSelector))},i.prototype._setSideATaskChanged=function(n,t){t&&t.name==="title"?this.setSideATitle(n.getTitle()):t&&t.name==="iconClass"&&this._setCardIconClass(this.getSideATask(),i.SideASelector);this._updateCardClass(t);this._updateMenu(t)},i.prototype._setSideBTaskChanged=function(n,t){t&&t.name==="title"?this.setSideBTitle(n.getTitle()):t&&t.name==="iconClass"&&this._setCardIconClass(this.getSideBTask(),i.SideBSelector);this._updateCardClass(t);this._updateMenu(t)},i.prototype._updateCardClass=function(n){n&&n.name==="displayState"&&n.newValue&&n.newValue.prominence&&this.setCssClass(this._getCardClass(this.getStack()))},i.prototype._updateMenu=function(n){if(n&&n.name==="mapPrimitives"&&n.newValue){var t=this._getCardMenu(),i=this.getStack(),r=i&&i.getForegroundTask(),u=r&&r.getMenuList().length>0?"":"none";t&&t.set_style({display:u})}},i.prototype._setCardFaces=function(n){var t=this.getRootElement(),r=n?i.SideASelector:i.SideBSelector,u=n?i.SideBSelector:i.SideASelector;t.select(r).swap_class("back","front");t.select(u).swap_class("front","back");this.isSideAFront=n},i.prototype._getPanelWrapper=function(){if(!this._panelWrapper){var n=this.getRootElement();do if(n=n.get_ancestor(1),n.has_class("panelWrapper")){this._panelWrapper=n;break}while(n[0])}return this._panelWrapper},i.prototype._getCardTitle=function(){return this.getRootElement().select(".front .cardTitleText")},i.prototype._getCardMenu=function(){var n=this.getRootElement();return n&&n.select(".cardFace.front .menu")},i.prototype._getCardCloseButton=function(){return this.getRootElement().select(".cardFace .panelClose")},i.prototype._onRendered=function(){var n=this;this.getRootElement().add_event("click",function(t){n._onClick(t)},!0);this.getRootElement().add_event("touchstart",function(t){n._onTouchstart(t)},!0);this.getRootElement().add_event("touchmove",function(t){n._onTouchmove(t)},!0);this.getRootElement().add_event("touchend",function(t){n._onTouchend(t)},!0);this._setCardIconClass(this.getStack().getForegroundTask(),this.getSideATask()?i.SideASelector:i.SideBSelector);i.setFocusToTitle(this.getStack(),this.getRootElement(),!1)},i.prototype._getCardClass=function(n){var r=n?i._replaceCardClass(n.id,this.getRootElement(),""):"";if(n&&n.displayState){var t=n.getForegroundTask(),f=t&&t.canColorFade&&t.canColorFade(),u=n.displayState.colorIndex,e=n.displayState.prominence;r+=f&&u>=1&&u<=3&&e>2?" "+i.GrayedOutStyle:" ac"+n.displayState.colorIndex}return r},i._getCardCssClassForTask=function(n,t){var i=t.select("[data-taskId='"+n+"']");return i?i.get_attr("class"):null},i._replaceCardClass=function(n,t,r){var e=i._getCardCssClassForTask(n,t),u=e?e:"taskCard",f=i._taskCardRegex.exec(u);return f&&f.length===1&&(u=u.replace(f[0],r)),u.trim()},i.setFocusToTitle=function(n,t,i){var r=n&&n.getForegroundTask(),e=r&&r.hasDefaultFocusElement&&r.hasDefaultFocusElement(),u,f;!i&&r&&e||(u=t.select(".cardFace.front"),u.length>0&&(f=u.select(".focusDummy")[0],f&&f.focus()))},i.prototype._showMenu=function(n){var t=this,i;this._menuListDropdownViewModel?this._addMenuToCard(n):(i=[{name:"ListDropdownViewModel"},{name:"PopOutButtonViewModel"}],this.getStack().getForegroundTask().map.getContainer().instanceAsyncAll(i,function(i){t._menuListDropdownViewModel=i.ListDropdownViewModel;t._menuListDropdownViewModel.setDropdown(n);t._popOutButtonViewModel=i.PopOutButtonViewModel;t._popOutButtonViewModel.setDropdownClass("cardMenuPopOut");t._popOutElement=t._popOutButtonViewModel.buildPopOut();t._addMenuToCard(n)}))},i.prototype._addMenuToCard=function(n){var i=this._getCardMenu(),t=i&&i.getParent();t&&!t.has(this._popOutElement[0])&&t.append(this._popOutElement);this._menuListDropdownViewModel.setDropdown(n);this._popOutButtonViewModel.setDropdown(this._menuListDropdownViewModel);this._popOutButtonViewModel.setIsDisplayed(!0)},i.prototype._setCardIconClass=function(n,t){var i=this._getIconInfo(),r=i&&i.iconElements,u=i&&i.iconClass||"";r?this._updateCardIcons(r,t,n&&n.displayState&&n.displayState.prominence):this.setIconClass(u)},i.prototype._getIconInfo=function(){var u=this.getStack(),i=u&&u.getAllTasks(),r,n,t;if(i)for(t=i.length-1;t>=0;t--)if(r=i[t],n=r.getCardIconInfo&&r.getCardIconInfo(),n&&n.iconElements)return n;return n&&n.iconClass&&(n.iconClass=n.iconClass+" titleIcon"),n},i.prototype._updateCardIcons=function(n,t,i){var i=i?i:1;n&&n.length===2?(this._appendCardIcon(n[0],t,".focused","block"),this._appendCardIcon(n[1],t,".unfocused","none")):n&&n.length===4&&(this._appendCardIcon(n[0],t,".focused",i===1?"block":"none"),this._appendCardIcon(n[1],t,".hovered","none"),this._appendCardIcon(n[2],t,".decayed",i===3?"block":"none"),this._appendCardIcon(n[3],t,".unfocused",i===2?"block":"none"))},i.prototype._appendCardIcon=function(n,t,i,r){if(n&&n.length>0){var u=this.getRootElement().select(t+" .catIcon "+i);u&&u.length>0&&(this.setIconClass(null),u.clear(),u.set_style({display:r}),u.append(n))}},i.GrayedOutStyle="ac9",i.SideASelector=".cardFace.sideA",i.SideBSelector=".cardFace.sideB",i._taskCardRegex=new RegExp("ac[0-9]s*"),i}(ti);k.registerControl("TaskCard",c);si=function(t){function r(){var n=t.call(this)||this;return n._privates.defineProperty("disabled",function(t,i){var r=n.getStack();r.displayState.activationState=4;r.setIsLocked(i);n.setCssClass(n._getCardClass(r))},null,{defaultValue:!1}),n._isChangePublicInProgress=!1,n}return e(r,t),r.prototype._clickHandler=function(t){var u=this,r,i;if(t&&t.stopPropagation(),r=this.getStack(),i=r.getForegroundTask(),i.type.toLowerCase()==="collectionstask")if(i.isSharable()){if(i.isPublicCollection&&!i.isPublicCollection()&&!this._isChangePublicInProgress){t.preventDefault();r.setIsLocked(!0);r.setIsSelected(!1);this._isChangePublicInProgress=!0;i.makePublic&&i.makePublic(function(t){u._isChangePublicInProgress=!1;r.setIsLocked(!1);t?(u._flipCheckBox(null,!0),u._showMadePublicPrompt()):(u._flipCheckBox(null,!1),u._showPrompt(n.ResourceManager.Collections.L_MakePublicFail_Text))});return}}else t.preventDefault(),this._showPrompt(n.ResourceManager.Collections.L_ShareOnlySpecificCollection_Text);this.getDisabled()||r.getIsLocked()||this._flipCheckBox(t)},r.prototype._onStackChanged=function(n){t.prototype._onStackChanged.call(this,n);var i=n.getForegroundTask();this.setDisabled(!(i.isSharable&&i.isSharable()))},r.prototype._onRendered=function(){var u=this;t.prototype._onRendered.call(this);var n=this.getRootElement(),f=n.select("input"),r=function(n){u._clickHandler(n)};n.add_event("click",r,!0);f.add_event("pointerdown",r,!0);i._isNewCardHeaderStyleEnabled()&&(n.select(".titleBar").add_class("xsr7_5_style"),et.changeStackFocusState(this.getStack(),1))},r.prototype._getCardClass=function(n){var i=t.prototype._getCardClass.call(this,n),n=this.getStack(),r,u;return this.getDisabled()||!n.getIsSelected()?i=this._getGrayedOutCss(i):(r=n.getForegroundTask(),u=r&&r.canColorFade&&r.canColorFade(),u&&n.displayState.activationState===4&&(i=this._getGrayedOutCss(i))),i},r.prototype._getGrayedOutCss=function(n){return r._styleParsingRegex.test(n)?n.replace(r._styleParsingRegex,c.GrayedOutStyle):n+" "+c.GrayedOutStyle},r.prototype._showMadePublicPrompt=function(){var t=this,i=this.isSideAFront?this.getSideATitle():this.getSideBTitle(),r=n.ResourceManager.Collections.L_MakePublicSuccess_Text.replace("{0}",i);this._showPrompt(r,{undoClick:function(i){i.preventDefault();var r=t.getStack().getForegroundTask();t._isChangePublicInProgress=!0;t._currentPrompt.getRootElement().select(".undoLink").add_class("nonClickable");r&&r.makePrivate&&r.makePrivate(function(i){t._isChangePublicInProgress=!1;i?(t._flipCheckBox(null,!1),t._closeCurrentPrompt()):t._showPrompt(n.ResourceManager.Collections.L_UndoFail_Text)})}},'<a href="#" class="undoLink" event:click="undoClick"><TextBlock text="{StaticBinding resources.L_Undo_Text}" /><\/a>')},r.prototype._showPrompt=function(t,i,u){var a=this,o,e,s,h,p,l;this._closeCurrentPrompt();var v={},f=new rr(v),y={closeClick:function(){a._closeCurrentPrompt()},resources:n.ResourceManager.Collections};if(i)for(o=Object.keys(i),e=o.length-1;e>=0;e--)s=o[e],y[s]=i[s];v.defineProperty("promptText");f.setTemplate(new k(r._promptControlTemplate.replace("{0}",u?u:""),y));h=f.getRootElement();document.body.appendChild(h[0]);p=this.getRootElement().select(this.isSideAFront?c.SideASelector:c.SideBSelector).select("input[type=checkbox]");l=p.get_absolute_pos();h.set_style({top:l.y+"px",left:l.x+30+"px"});f.setPromptText(t);Microsoft.Maps.setTimeout(function(){a._closeCurrentPrompt()},5e3);this._currentPrompt=f},r.prototype._closeCurrentPrompt=function(){this._currentPrompt&&(this._currentPrompt.dispose(),this._currentPrompt.getRootElement().removeFromParent(),this._currentPrompt=null)},r.prototype._flipCheckBox=function(n,t){var u=this.getRootElement().select(this.isSideAFront?c.SideASelector:c.SideBSelector).select("input[type=checkbox]"),i=u[0],r;t!==undefined?this.getStack().setIsSelected(t):n&&n.target!=i&&(r=!i.checked,this.getStack().setIsSelected(r))},r._styleParsingRegex=new RegExp("ac\\d+","gi"),r._promptControlTemplate='<div class="collectionsMakePublicPrompt"><div class="close" event:click="closeClick">X<\/div><div class="prompt"><TextBlock text="{TemplateBinding promptText}" /><span> <\/span>{0}<\/div><\/div >',r}(c);k.registerControl("SelectionTaskCard",si);et=function(n){function r(){var i=this,r={};return i=n.call(this,r)||this,r.defineProperty("cssClass"),r.defineProperty("iconClass"),r.defineProperty("task",function(n,t){i._onTaskChanged(n,t)}),r.defineProperty("stack",function(n,t){i._onStackChanged(n,t)}),r.defineProperty("dataTaskId"),r.defineProperty("cardTitle"),r.defineProperty("layoutMetrics"),i._emptyCardContent=document.createElement("div"),i.click=new t,i.titleMouseEnter=new t,i.titleMouseLeave=new t,i.rendered.add(function(){i._onRendered()}),i.setTemplate(new k(iu,{resources:tt,stringToDisplay:function(n){return n?"block":"none"},hideOnIconClass:function(n){return n?"none":"block"},closeTaskById:function(n){return o.Internals.stringify({id:n,action:"removeTaskAndReseatChild"})},onTitleBarClick:function(n){i._onTitleBarClick(n)},onTitleMouseEnter:function(n){i.titleMouseEnter.invoke(n)},onTitleMouseLeave:function(n){i.titleMouseLeave.invoke(n)},isMenuVisible:function(n){return n&&n.getMenuList().length>0?"":"none"},getWidthString:function(n){return n?n+"px":""}})),i}return e(r,n),r.prototype._onRendered=function(){this._setCardIconClass(this.getTask());c.setFocusToTitle(this.getStack(),this.getRootElement(),!1);i._isNewCardHeaderStyleEnabled()&&this.getRootElement().select(".titleBar").add_class("xsr7_5_style")},r.prototype.getCardContent=function(){if(this.getTask()){var n=this.getLayoutMetrics();return this.getTask().getContent(n)}return this._emptyCardContent},r.prototype._setCardHeaderBackgroundColor=function(n){var t=this;i._isNewCardHeaderStyleEnabled()&&n&&n.getIconColorAndClassName&&n.getIconColorAndClassName(function(i,r){if(i&&r&&r!==t._classNameForCardBackground){var u=n.getCardIconInfo();t._classNameForCardBackground&&t.getRootElement().select(".titleBar").remove_class(t._classNameForCardBackground);t._classNameForCardBackground=r;t._appendCssForBackground(r,i,u&&u.iconClass?u.iconClass:"srcTsk")}})},r.prototype._appendCssForBackground=function(n,t,i){var r,u;n&&t&&(r=document.createElement("style"),r.type="text/css",u=".MicrosoftMap .taskCard.focus .titleBar.xsr7_5_style."+n+",\n                       .MicrosoftMap .taskCard.focus .titleBar.xsr7_5_style.hover."+n+",\n                       .MicrosoftMap .taskCard.focus .titleBar.xsr7_5_style."+n+" .catIcon,\n                       .MicrosoftMap .taskCard.focus .titleBar.xsr7_5_style.hover."+n+" .catIcon,\n                       .MicrosoftMap .taskCard.focus .titleBar.xsr7_5_style."+n+" ."+i+".titleIcon,\n                       .MicrosoftMap .taskCard.focus .titleBar.xsr7_5_style.hover."+n+" ."+i+".titleIcon\n                        {background-color:"+t+" !important}",r.innerHTML=u,this.getRootElement().append(r),this.getRootElement().select(".titleBar").add_class(n))},r.prototype._setCardIconClass=function(n){if(n){var t=this._getIconInfo(),i=t&&t.iconElements,r=t&&t.iconClass||"";i?this._updateCardIcons(i,n.displayState&&n.displayState.prominence):this.setIconClass(r)}},r.prototype._getCardClass=function(n){var t;if(n){if(t=c._replaceCardClass(n.id,this.getRootElement(),""),n&&n.displayState){var r=this.getTask(),e=r&&r.canColorFade&&r.canColorFade(),u=n.displayState.colorIndex,f=n.displayState.prominence;t+=e&&u>=1&&u<=3&&f>2?" "+c.GrayedOutStyle:" ac"+n.displayState.colorIndex;i._isNewCardHeaderStyleEnabled()&&f===1&&(t+=" focus")}return t}},r.prototype._showMenu=function(n){var t=this,i;this._menuListDropdownViewModel?this._addMenuToCard(n):(i=[{name:"ListDropdownViewModel"},{name:"PopOutButtonViewModel"}],this.getTask().map.getContainer().instanceAsyncAll(i,function(i){t._menuListDropdownViewModel=i.ListDropdownViewModel;t._menuListDropdownViewModel.setDropdown(n);t._popOutButtonViewModel=i.PopOutButtonViewModel;t._popOutButtonViewModel.setDropdownClass("cardMenuPopOut");t._popOutElement=t._popOutButtonViewModel.buildPopOut();t._addMenuToCard(n)}))},r.prototype._getCardTitle=function(){return this.getRootElement().select(".front .cardTitleText")},r.changeStackFocusState=function(n,t){var i,r,u,f;n&&(n.getIsLocked()||n.getIsSelected())&&(t=1);n&&(i=o('[data-taskid="'+n.id+'"]'),i.select(".catIcon .focused").set_style({display:t===0?"block":"none"}),i.select(".catIcon .unfocused").set_style({display:t===1?"block":"none"}),i.select(".catIcon .decayed").set_style({display:t===3?"block":"none"}),i.select(".catIcon .hovered").set_style({display:t===2?"block":"none"}),r=i.select(".titleBar"),t===1?r.add_class("unfocused"):r.remove_class("unfocused"),u=function(n){r.set_style({borderLeftColor:n})},t===0?u("transparent"):t===1?(f=n.getForegroundTask(),f&&f.getIconColorAndClassName(u)):t===3&&u("#919191"))},r.prototype._getCardMenu=function(){var n=this.getRootElement();return n&&n.select(".cardFace.front .menu")},r.prototype._getCardCloseButton=function(){return this.getRootElement().select(".cardFace .panelClose")},r.prototype._addMenuToCard=function(n){var i=this._getCardMenu(),t=i&&this._getCardMenu().getParent();t&&!t.has(this._popOutElement[0])&&t.append(this._popOutElement);this._menuListDropdownViewModel.setDropdown(n);this._popOutButtonViewModel.setDropdown(this._menuListDropdownViewModel);this._popOutButtonViewModel.setIsDisplayed(!0)},r.prototype._appendCardIcon=function(n,t,i){if(n&&n.length>0){var r=this.getRootElement().select(".catIcon "+t);r&&r.length>0&&(this.setIconClass(null),r.clear(),r.set_style({display:i}),r.append(n))}},r.prototype._onTaskChanged=function(n,t){var i=this;this._setDataTaskId();n&&t&&n.id&&n.id.indexOf("LocalListingTask")===0?sj_evt&&sj_evt.fire("HideContextualTaskbar"):n&&t&&t.id&&t.id.indexOf("LocalListingTask")===0&&sj_evt&&sj_evt.fire("ShowContextualTaskbar");t&&(this._taskContentsChanged&&this._taskContentsChanged.dispose(),this.disposables.push(this._taskContentsChanged=t.changed.add(function(n){var u=n&&n.name,f;if(u==="title")i.setCardTitle(t.getTitle());else if(u==="iconClass")i._setCardIconClass(i.getTask());else if(u==="catId")i._setCardHeaderBackgroundColor(i.getTask());else if(u==="displayState")n.newValue&&n.newValue.prominence&&(i.setCssClass(i._getCardClass(i.getStack())),f=n.newValue.prominence,f===1?r.changeStackFocusState(i.getStack(),0):f!==2&&r.changeStackFocusState(i.getStack(),3));else if(u==="mapPrimitives"){var e=i._getCardMenu(),o=i.getTask(),s=o&&o.getMenuList().length>0?"":"none";e&&e.set_style({display:s})}})),this._setCardHeaderBackgroundColor(t),this._setCardIconClass(t),this.setCardTitle(t.getTitle()))},r.prototype._onStackChanged=function(n,t){this._setDataTaskId();this.setCssClass(this._getCardClass(t))},r.prototype._setDataTaskId=function(){var n=this.getTask(),t=this.getStack();this.setDataTaskId(n&&n.id&&t&&t.id)},r.prototype._onTitleBarClick=function(n){var r=this._getCardTitle(),u=this._getCardCloseButton(),i=this._getCardMenu(),f,t,e;if(i&&(i[0]===n.target||i.length>0&&i.has(n.target)))n.preventDefault&&n.preventDefault(),f=this.getStack(),t=this.getTask(),f.displayState.activationState!==1&&y.invokeHandler(v.taskDataHandlerKey,{action:"focus",id:t.id}),y.invokeHandler(v.instrumentationDataHandlerKey,{logData:{feature:b.CardModel,action:p.Activated,data:{TT:t.type,TID:t.id,SID:f.id}}}),this._showMenu(t.getMenuList());else{if(u[0]===n.target||u.length>0&&u.has(n.target))return;(r[0]===n.target||r.length>0&&r.has(n.target))&&(n.preventDefault&&n.preventDefault(),e=this.getStack(),this.click.invoke({card:this,stack:e}))}},r.prototype._updateCardIcons=function(n,t){var t=t?t:1;n&&n.length===2?(this._appendCardIcon(n[0],".focused","block"),this._appendCardIcon(n[1],".unfocused","none")):n&&n.length===4&&(this._appendCardIcon(n[0],".focused",t===1?"block":"none"),this._appendCardIcon(n[1],".hovered","none"),this._appendCardIcon(n[2],".decayed",t===3?"block":"none"),this._appendCardIcon(n[3],".unfocused",t===2?"block":"none"))},r.prototype._getIconInfo=function(){var u=this.getStack(),i=u&&u.getAllTasks(),r,n,t;if(i){if(n=this.getTask().getCardIconInfo(),n&&n.iconElements)return n;for(t=i.length-1;t>=0;t--)r=i[t],n=r.getCardIconInfo&&r.getCardIconInfo()}return n&&n.iconClass&&(n.iconClass=n.iconClass+" titleIcon",n.iconElements=null),n},r}(ti);k.registerControl("SingleTaskCard",et);var eu=function(){function n(n,i,r,u){var f=this;this._container=n;this._map=i;this.secondaryTaskAdded=new t;this.stackAdded=new t;this.stackFocusing=new t;this.stackFocused=new t;this.stackCollapsed=new t;this.stackRemoved=new t;this.stackRemoving=new t;this.stacksReset=new t;this.deserializationCompleted=new t;this._createStackList();this._stackMap={};this._taskStackMap={};this._taskActivateQueue=[];this._hiddenTasks=[];this._index=0;this._isFocusedStackInCollapsedState=!1;this.isDeserializingTasks=!1;this._isActivatingTask=!1;this.serializableObjectChanged=new t;this.serializableObjectChanged.addOne(function(){f._hasSerializableObjectChanged=!0});u&&u.register("TaskManager",this)}return n.prototype.getFocusedStack=function(){return this._focusedStack},n.prototype.activateTask=function(n,t,i,r){var f=this,u,o,e,s;if(n){if(this._isActivatingTask){this._taskActivateQueue.push({task:n,taskState:t,taskActivateOptions:i});return}if(u=this.getStackForTask(i&&i.parentId),o=!u,this.getStackForTask(n.id)){this.focusTask(n.id,t);return}this._isActivatingTask=!0;t&&t.disableHistoryPointCreation||this._newHistoryPoint();n.id=this._parseId(n.id)||this._generateId(n.type);e=this.getFocusedStack();e&&e!==u&&e.displayState.activationState!==4&&e.setDisplayState({activationState:2});r||n.activate(this._map,t);o&&(u=new lt(this._generateId("ts")),this._attachStackEvents(u),this._stacks.insert(u),this._stackMap[u.id]=u);u.addTask(n,!o&&i&&i.parentId);this._taskStackMap[n.id]={stack:u,task:n};s={colorIndex:i&&i.taskColorIndex?i.taskColorIndex:this._getColorIndex(u,n),groupName:i&&i.groupName?i.groupName:this._getGroupName(u,n)};u.setDisplayState(s);var h=i&&i.activationState===3,c=function(){f._setFocusedStack(u);f._isActivatingTask=!1;var t=f._taskActivateQueue.pop();t&&f.activateTask(t.task,t.taskState,t.taskActivateOptions);h&&f.collapseStack(u,n)},l=o?this.stackAdded:this.secondaryTaskAdded;l.invoke({task:n,stack:u,resume:c});this._logData(p.Activated,{TT:n.type,TID:n.id,SID:u.id})}},n.prototype.manageHiddenTask=function(n){n&&(n.id=this._parseId(n.id)||this._generateId(n.type),this._taskStackMap[n.id]={stack:null,task:n})},n.prototype.focusTask=function(t,i){var u=this,r=this.getStackForTask(t),f;r&&(f=function(){var f=u.getFocusedStack(),e;f&&f!==r&&f.displayState.activationState!=4&&f.setDisplayState({activationState:2});i&&(e=r.getTask(t),e.activate(u._map,i));r.focusTask(t);u._setFocusedStack(r);u.stackFocused.invoke({stack:r});u._logData(p.Focused,{TT:n.getTaskType(t),TID:t,SID:r.id})},this.stackFocusing.hasHandlersRegistered()?this.stackFocusing.invoke({stack:r,resume:f}):f())},n.prototype.toggleStack=function(n){if(n){var t=n.getForegroundTask();this._focusedStack!==n||this._isFocusedStackInCollapsedState?(this._isFocusedStackInCollapsedState=!1,this.focusTask(t.id)):(this._isFocusedStackInCollapsedState=!0,this.collapseStack(n,t))}},n.prototype.removeStackForTask=function(n){return this._removeStackHelper(this.getStackForTask(n))},n.prototype.removeTaskAndReseatChild=function(n){var i=this.getStackForTask(n),r;if(i)if(i.getAllTasks().length>1){if(r=i.getForegroundTask(),r.id===n){this.removeTask(n);return}if(r.type===br.trafficFlipTask||i!==this.getFocusedStack()||this.isFocusedStackInCollapsedState()){this._removeStackHelper(i);return}i.removeChildren(n,!0);i.removeAllTasks();sj_evt&&sj_evt.fire("OnTaskStackRemoved",i);r.changed=new t;this._taskStackMap[r.id]={stack:i,task:r};i.addTask(r,null);this._newHistoryPoint();this._stacks.changed.invoke();this._logData(p.Activated,{TT:r.type,TID:r.id,SID:i.id});r&&sj_evt&&sj_evt.fire("OnCardFocus",o(document).select("[data-subtaskid='"+r.id+"'"))}else this._removeStackHelper(i)},n.prototype.removeTaskStack=function(n){return this._removeStackHelper(this._getStack(n))},n.prototype.collapseStack=function(t,i){i&&t&&(t.setDisplayState({activationState:3}),this.stackCollapsed.invoke({stack:t,task:i}),this._logData(p.Collapsed,{TT:n.getTaskType(i.id),TID:i.id,SID:t.id}))},n.prototype.isFocusedStackInCollapsedState=function(){return this._isFocusedStackInCollapsedState},n.prototype.removeAllStacks=function(){var t,n;if(this._stacks){for(t=[],n=0;n<this._stacks.length;n++)t.push(this._stacks[n]);for(n=0;n<t.length;n++)this._removeStackHelper(t[n],!0);this._clearHistory()}},n.prototype.removeHiddenTasks=function(){var n,t;if(this._hiddenTasks)for(n=this._hiddenTasks.length-1;n>=0;n--)t=this._hiddenTasks.pop(),t.dispose()},n.prototype._removeStack=function(n){n.removeAllTasks();this._stacks.remove(n);delete this._stackMap[n.id]},n.prototype._removeStackHelper=function(n,t){var u=this,f,e,i,r;n&&(t||this._newHistoryPoint(),f=this._focusedStack,e=this._isFocusedStackInCollapsedState,this._findNewFocusedStackOnRemoval(n),n===f&&this._stacks.length>1&&(e||t?(this._isFocusedStackInCollapsedState=!0,this._focusedStack.setDisplayState({activationState:3})):this.focusTask(this._focusedStack.getForegroundTask().id)),i=n.getForegroundTask(),r=function(){u._removeStack(n);u.stackRemoved.invoke({stack:n})},this.stackRemoving.hasHandlersRegistered()&&!i.isHiddenTask?this.stackRemoving.invoke({stack:n,resume:r}):r(),this._logData(p.Removed,{TT:i.type,TID:i.id,SID:n.id}))},n.prototype.removeTask=function(n){var t=this.getStackForTask(n),i=t&&t.getTask(n);t&&i&&(this._newHistoryPoint(),this._removeTask(t,i),t.getForegroundTask()?(this.focusTask(t.getForegroundTask().id),this.updateProminences()):(this._findNewFocusedStackOnRemoval(t),this._removeStack(t),this.stackRemoved.invoke({stack:t})),this._logData(p.Deactivated,{TT:i.type,TID:i.id,SID:t.id}))},n.prototype._removeTask=function(n,t){t&&n.removeTask(t.id)},n.prototype._findNewFocusedStackOnRemoval=function(n){if(n.setDisplayState({pendingRemoval:!0}),n===this._focusedStack){var t=this._stacks.indexOf(n);n=t<this._stacks.length-1?this._stacks[t+1]:t>0?this._stacks[t-1]:null;this._setFocusedStack(n,!0)}else this.updateProminences()},n.prototype.getStacks=function(){return this._stacks},n.prototype.getStackById=function(n){for(var i,t=0,r=this._stacks.length;t<r;t++)if(i=this._stacks[t],i.id===n)return i;return null},n.prototype.getTaskById=function(n){var t=this._taskStackMap[n];return t&&t.task},n.prototype.getTaskByType=function(n){for(var i=[],t=0,r=this._stacks.length;t<r;t++)this._stacks[t].getTasksByType(n,i);return i},n.prototype.getHiddenTaskByType=function(n){for(var i=[],t=0;t<this._hiddenTasks.length;t++)this._hiddenTasks[t].type===n&&i.push(this._hiddenTasks[t]);return i},n.prototype.getHiddenTaskById=function(n){for(var i=null,t=0;t<this._hiddenTasks.length;t++)if(this._hiddenTasks[t].id===n){i=this._hiddenTasks[t];break}return i},n.prototype.addHiddenTask=function(n){this._hiddenTasks.push(n);n.isHiddenTask=!0},n.prototype.getPreviousTaskByStack=function(n){var i=this._taskStackMap[n],t,r,u;if(i)for(t=0,r=this._stacks.length;t<r;t++)if(u=this._stacks[t],u===i.stack&&t>0)return this._stacks[t-1].getForegroundTask();return null},n.getTaskType=function(t){if(!t)return null;var i=t.split(n._separator);return i&&i.length>0&&i[0]},n.prototype.serialize=function(n,t,i){var r={stacks:[]},o=0,u,s,f,e;if(i)for(u=0,s=this._stacks.length;u<s;u++)f=this._stacks[u],f===this._focusedStack&&(e=f.serialize(n,t),r.stacks.push(e),r.focusedStackIndex=0);else{for(u=0,s=this._stacks.length;u<s;u++)f=this._stacks[u],e=f.serialize(n,t),e?(r.stacks.push(e),f===this._focusedStack&&(r.focusedStackIndex=o),o++):f===this._focusedStack&&(r.focusedStackIndex=o>0?o-1:0);n&&(r.isFocusedStackInCollapsedState=r.stacks.length>1)}return r},n.prototype.deserialize=function(t){function a(n,t,i,u){var s,f;n.id=u.id;s=n.serialize();o.Internals.stringify(s)!==o.Internals.stringify(u.state)&&n.activate(r._map,u.state);t.setTaskAt(n,i);l[n.id]={stack:t,task:n};lt.setTaskDisplayState(n,u.ds||{});f=t.displayState;typeof t.displayState.colorIndex!="number"&&(f={colorIndex:r._getColorIndex(t,n,e),groupName:r._getGroupName(t,n)});t.setDisplayState(f)}function y(n,t){return t&&t.state?i._overrideTasktypeBasedOnCategory(n,t.state):n}function p(t,i,u){var o=u.id=r._parseId(u.id),c=u.type=r._parseId(u.type),l=f[o],h,e,p;if(delete f[o],l&&(h=l.task),h)a(h,t,i,u);else{if(e=n.getTaskType(o),!e)if(c)e=c+"Task",u.id=r._generateId(e);else return;e=y(e,u);p=!r._hasSerializableObjectChanged;s++;r._container.instanceAsync(e,function(n){a(n,t,i,u);s--;s||(v(),r._map&&r._map.getFrameManager().frameRendered.addOne(function(){p&&typeof performance!="undefined"&&performance.timing&&ri.log(ri.permalinkTimeToGlass,performance.timing.navigationStart)}))})}}function w(n){var i=n.id=r._parseId(n.id)||r._generateId("ts"),t=h[i];delete h[i];t&&t.dispose();t=new lt;t.deserialize(n);t.setDisplayState(n.ds);n.tasks&&n.tasks.forEach(function(n,i){return p(t,i,n)});e.push(t);c[i]=t}function v(){var n,t,i,o;for(n in f)if(f.hasOwnProperty(n)){var s=f[n],c=s.stack,h=s.task;h.deactivate()}t=0;e.forEach(function(n){n.setForegroundTask();r._attachStackEvents(n);n.displayState.prominence||t===u.focusedStackIndex||r.updateProminences(null,n,e);t++});r._createStackList(e);i=u.focusedStackIndex?u.focusedStackIndex:0;o=r._stacks.length&&r._stacks[i];i!==0&&r._stacks.length&&r._stacks[0].setDisplayState({activationState:2});r._setFocusedStack(o);u.isFocusedStackInCollapsedState&&(r._isFocusedStackInCollapsedState=u.isFocusedStackInCollapsedState,o.setDisplayState({activationState:3}));r.stacksReset.invoke();r.isDeserializingTasks=!1;r.deserializationCompleted.invoke()}var c,l,s;if(!i._isLargeMapShownOnSerp()||Microsoft.Maps.GlobalConfig.dynamicProperties.mapsOverlayProcessingPermalink||this._stacks.length!==0){var r=this,u=t||{},h=this._stackMap,f=this._taskStackMap,e=[];this._stackMap={};c=this._stackMap;this._taskStackMap={};l=this._taskStackMap;s=0;this.isDeserializingTasks=!0;u.stacks&&u.stacks.forEach(w);s||v()}},n.prototype._attachStackEvents=function(n){var t=this;n.tasksRemoved.add(function(n){t._deactivateTasks(n)});n.serializableObjectChanged.add(function(n){t.serializableObjectChanged.invoke(n)})},n.prototype._createStackList=function(n){var t=this;this._stacks=new ei(n);this._stacks.changed.add(function(){t.serializableObjectChanged.invoke()})},n.prototype._generateId=function(t){if(!t||t.indexOf(n._separator)>=0)throw"Invalid type";var i=this._index++;return t+n._separator+i.toString()},n.prototype._newHistoryPoint=function(){this.serializableObjectChanged.invoke({magnitude:2})},n.prototype._clearHistory=function(){this.serializableObjectChanged.invoke({magnitude:2,clearHistory:!0})},n.prototype._parseId=function(t){if(t){var i=t.split(n._separator);i&&i.length===2&&(this._index=Math.max(~~i[1]+1,this._index))}return t},n.prototype._getStack=function(n){for(var i,r=this._stacks,t=0,u=r.length;t<u;t++)if(i=r[t],i.id===n)return i;return null},n.prototype.getStackForTask=function(n){var t=n&&this._taskStackMap[n];return t&&t.stack},n.prototype._setFocusedStack=function(n,t){var i;n||(i=this._focusedStack);this._focusedStack&&this._focusedStack.displayState.isAutoFocused&&this._focusedStack.setDisplayState({isAutoFocused:!1});this._focusedStack=n;this._isFocusedStackInCollapsedState=!1;t&&this._focusedStack&&this._focusedStack.setDisplayState({isAutoFocused:!0});this._focusedStack&&this._focusedStack.setDisplayState({activationState:1});this.updateProminences(i)},n.prototype.updateProminences=function(n,t,i){function o(n,t,i){return n.displayState.activationState===4?n.setDisplayState({prominence:3}):n.displayState.groupName!==t||n.displayState.pendingRemoval||(n.setDisplayState({prominence:i}),i++),i}var f=t?t:this.getFocusedStack();if(f&&f.displayState.activationState!==4){var s=f.displayState.groupName,e=i?i:this._stacks,h=e.indexOf(f),r,c,u;for(f.setDisplayState({activationState:1,prominence:1}),r=h-1,u=2;r>=0;r--)u=o(e[r],s,u);for(r=h+1,c=e.length,u=2;r<c;r++)u=o(e[r],s,u)}else n&&o(n,null,null)},n.prototype._getColorIndex=function(n,t,i){var r=this;return this._getDisplayProperty(n,t,"colorIndex",function(){for(var f,n,e=t.displayState.groupName?3:1,o=t.displayState.groupName?t.displayState.groupName:"Default",u=i?0:r._stacks.length-1;i?u<i.length:u>=0;i?u++:u--)if(f=i?i[u]:r._stacks[u],n=f.displayState.colorIndex,n>=1&&n<=3&&f.displayState.groupName===o){e=o==="Default"?n<3?n+1:1:n>1?n-1:3;break}return e})},n.prototype._getDisplayProperty=function(n,t,i,r){var f=n.displayState[i],u=t&&t.displayState&&t.displayState[i];return f===undefined&&((u===null||u===undefined)&&(u=r()),f=u),f},n.prototype._getGroupName=function(n,t){return this._getDisplayProperty(n,t,"groupName",function(){return"Default"})},n.prototype._deactivateTasks=function(n){var t=this;n.forEach(function(n){n.isHiddenTask?t._taskStackMap[n.id]={task:n,stack:null}:(lt.setTaskDisplayState(n,{activationState:2}),delete t._taskStackMap[n.id],n.deactivate())})},n.prototype._logData=function(n,t){var i={logData:{feature:b.TaskManager,action:n,data:t},isMapsAction:n===p.Activated};y.invokeHandler(v.instrumentationDataHandlerKey,i)},n._separator="$$",n}(),at=function(){function n(n,t,i,r){var u=this;if(this._layouts={},this._map=n,this._taskManager=t,this._controlTemplateFactory=i,this._coreConfig=r,this._layoutContainer=o("[data-tasklayout]"),this._map.getMapType()&&this._updateLayoutContainerBackground(this._layoutContainer,this._map.getMapType().id),this._map.mapTypeChanged.add(function(n){return u._updateLayoutContainerBackground(u._layoutContainer,n.newMapTypeId)}),!this._layoutContainer.length)throw"No task layout container defined.";try{this._taskLayoutData=o.Internals.parseJSON(this._layoutContainer.get_attr("data-tasklayout"))}catch(f){this._taskLayoutData={}}this._defaultLayoutName=this._taskLayoutData.defaultLayout||"MultiCardLeftLayout";this.activateLayout(this._defaultLayoutName)}return n.registerLayout=function(t,i){n._registeredLayouts[t]=i},n.prototype._getLayout=function(t){if(!t)return null;if(!this._layouts[t]){var i=n._registeredLayouts[t];i&&(this._layouts[t]=new i(this._controlTemplateFactory))}return this._layouts[t]},n.prototype.activateLayout=function(n){var t=this._getLayout(n);t||(t=this._getLayout("FullMapLayout"));t&&t!==this._layout&&(this._layout&&this._layout.deactivate(),this._layout=t,t.activate(this._layoutContainer,this._taskManager,this._coreConfig,this._map,this._taskLayoutData.cardPrimerShown))},n.prototype.updateLayout=function(n){this._layout&&this._layout.update&&this._layout.update(n)},n.prototype._updateLayoutContainerBackground=function(n,t){this._layout&&this._layout.update&&this._layout.update({mapTypeId:t});switch(t){case f.road:case f.roadVector1:case f.roadVector2:n.remove_class("Dark");n.add_class("Light");return;case f.birdseye:case f.aerial:case f.seasonal:n.remove_class("Light");n.add_class("Dark");return;default:n.remove_class("Dark");n.add_class("Light");return}},n._registeredLayouts={},n}(),ou=function(){function n(){}return n.prototype.activate=function(){},n.prototype.deactivate=function(){},n}();at.registerLayout("FullMapLayout",ou);var wt=function(n){function t(t,i,r){var u=this,f={};return u=n.call(this,f)||this,u.stacks=r,u.resources=tt,u.loadingImage=t.imageUrlFormat+"/img_loading.gif",u.layoutMetrics=i,f.defineProperty("focusedStack",function(n,t){u._onFocusedStackChanged(n,t)}),f.defineProperty("slideoutTask"),u}return e(t,n),t.prototype.closeStackById=function(n){return o.Internals.stringify({id:n,action:"removeStack"})},t.prototype.isMenuVisible=function(n){var t=n&&n.getForegroundTask();return t&&t.getMenuList().length>0?"":"none"},t.prototype.stringToDisplay=function(n){return n?"block":"none"},t.prototype.taskExistsToDisplay=function(n){return n?"":"none"},t.prototype.hideOnIconClass=function(n){return n?"none":"block"},t.prototype.selectSlideoutTask=function(n){var t=null,i;return n&&n.getAllTasks().length>1&&(i=n.getForegroundTask(),i&&!i.noSlideout&&(t=i)),this.setSlideoutTask(t),bt.setIsSecondColumnDisplayed(!!t),!!t},t.prototype._onFocusedStackChanged=function(){var n=this,t;i._getIsSlideCardEnabled()&&(this.stackChanged&&this.stackChanged.dispose(),t=function(t){var r,i,u;t.name==="foregroundTask"&&(r=n.getSlideoutTask(),n.selectSlideoutTask(t.sender)&&(o(".slidecard .svg").inlineDataSvgs().remove_class("svg"),r||(i=n.getSlideoutTask(),u=i&&i._getTaskState&&i._getTaskState().suppressAnimationWhileSlideOut,o.Transition.run(o(".slidecard"),[{property:"margin-left",from:"-375px",to:"0",duration:u?0:500}]))))},t({name:"foregroundTask",oldValue:null,newValue:this.getFocusedStack().getForegroundTask(),sender:this.getFocusedStack()}),this.stackChanged=this.getFocusedStack().changed.add(t))},t.prototype.dispose=function(){n.prototype.dispose.call(this);this.stackChanged&&this.stackChanged.dispose()},t}(ct),bt=function(){function n(n,t,i){this._disposables=[];this._controlTemplateFactory=n;this._controlTemplateText=t;this._layoutMetrics=i;this._animationCount=0;this._hideLayoutOnEmptyTasks=!0}return n.prototype._onTaskCardClick=function(n){var t=n.stack;this._taskManager.toggleStack(t)},n.prototype.refreshStacks=function(){var t=this,u=this._taskManager.getStacks(),r,n,i;this._stacks.clear();sj_evt&&sj_evt.fire("OnAllTaskStacksRemoved");this._stacks.insertAll(u.slice());r=this._cardsContainer.select("[data-taskId]").set_style({visibility:"visible"});this._initTaskCard(r,this._cardsContainer);n=this._taskManager.getFocusedStack();n&&(this.layoutContext.setFocusedStack(n),this._useSlideLayout&&this.layoutContext.selectSlideoutTask(n),i=this._cardsContainer.select("[data-taskId='"+n.id+"']"),this._animateCard(n,i,2,function(){t._taskManager.isFocusedStackInCollapsedState()?t._animateCard(n,i,4):t._scrollToFocusedCard(n,!1)}))},n.prototype._completeAnimation=function(){this._animationCount--;this._animationCount<=0&&(this._animationCount=0,this._layoutSizeHelper.startMonitoring())},n.prototype.onStackAdded=function(n){var f=this,t=n.stack,i,r,u;this.layoutContext.setFocusedStack(t);this._useSlideLayout&&this.layoutContext.selectSlideoutTask(t);i=this._taskManager.getStacks().slice().indexOf(t);r=0;this._useSlideLayout&&i!==this._taskManager.getStacks().length-1?(this._stacks.insert(t,i),r=5):(i===0&&(r=5),this._stacks.insert(t));u=this._cardsContainer.select("[data-taskId='"+t.id+"']");this._initTaskCard(u,this._cardsContainer);this._animationCount+=2;this._layoutSizeHelper.stopMonitoring();this._animateCard(t,u,r,function(){f._completeAnimation();f._animationCount<=0&&n.resume()});this._updateViewPortPadding(this._panelWrapper,!0,t)},n.prototype._onStackRemoved=function(n){var u=this,r=n.stack,t,i;this._stacks.remove(r);sj_evt&&sj_evt.fire("OnTaskStackRemoved",r);t=this._taskManager.getFocusedStack();t&&(i=this._cardsContainer.select("[data-taskId='"+t.id+"']"),this._removingFocusedCard?this._animateCard(t,i,4,function(){u._scrollToFocusedCard(t,!0)}):c.setFocusToTitle(t,i,!0));this._removingFocusedCard=!1},n.prototype._onStackRemoving=function(n){var t=n.stack,f=this._cardsContainer.select("[data-taskId='"+t.id+"']"),u=this._taskManager.getFocusedStack(),i,r;this.focusedStack!==t||this._isCollapsed(t)?n.resume():(this._removingFocusedCard=!0,i=2,r=function(){i--;i||n.resume()},u&&(i++,this._scrollToFocusedCard(u,!1,r)),this._animateCard(t,f,3,r))},n.prototype._onStackFocusing=function(n){var u=this,t=n.stack,i,r;if(this.layoutContext.setFocusedStack(t),this._useSlideLayout&&(this.layoutContext.selectSlideoutTask(t),this._updateViewPortPadding(this._panelWrapper,!0,t)),i=this._cardsContainer.select("[data-taskId='"+t.id+"']"),this._useSlideLayout&&(this.layoutContext.getSlideoutTask()&&this._resetSlideoutLaneScroll(),t===this.focusedStack&&!this._isCollapsed(t))){t.getAllTasks().length>1?(r=this._slideoutCardsContainer.select("[data-subtaskid='"+t.getForegroundTask().id+"']"),c.setFocusToTitle(t,r,!1)):c.setFocusToTitle(t,i,!1);n.resume&&n.resume();return}this._animationCount+=1;this._layoutSizeHelper.stopMonitoring();this._animateCard(t,i,2,function(){u._completeAnimation();n.resume&&n.resume()})},n.prototype._onStackFocused=function(n){var t=n.stack;this._scrollToFocusedCard(t,!0)},n.prototype._onStackCollapsed=function(n){var t=n.stack,i=this._cardsContainer.select("[data-taskId='"+t.id+"']");this.layoutContext.selectSlideoutTask(null);this._animateCard(t,i,4)},n.prototype._scrollToFocusedCard=function(n,t,i){var r=this.focusedStack,f,u;if(this.focusedStack=n,r&&r!==n&&(f=this._cardsContainer.select("[data-taskid='"+r.id+"']"),f.remove_class("focus"),et.changeStackFocusState(r,1)),!n||!t&&r===n){i&&i();return}if(u=this._cardsContainer.select("[data-taskid='"+n.id+"']"),u.add_class("focus"),et.changeStackFocusState(n,0),this._fireOnCardFocusEvent(u),this._useSlideLayout&&this._slideoutCardsContainer.select(".taskCard").add_class("focus"),this._skipNextTaskScroll){this._skipNextTaskScroll=!1;i&&i();return}this._scrollLane(n,t,i)},n.prototype._fireOnCardFocusEvent=function(n){sj_evt&&sj_evt.fire("OnCardFocus",n)},n.prototype.activate=function(n,t,i,r){var e=this,c=this._taskPanel&&this._taskPanel[0],s,h,o;this._layoutContainer||(this._map=r,this._taskManager=t,this._stacks=new ei,s="taskLayoutContainer",h=w.features.taskFramework,this._layoutContainer=n.add_class(s),r.getMapType().id===f.birdseyeV2&&this._layoutContainer.add_class("hideTaskLayout"),this._coreConfig=i,this._hideLayoutOnEmptyTasks&&this._disposables.push(new gt(this._stacks,"length",this._layoutContainer,"style",function(n){var t="";return e._map.getMode().mapModeType===2&&(t=";z-index: -1"),(n?"":"display:none")+t})),o=this._createTaskListViewModel(i),this.layoutContext=o,this._disposables.push(o),o.onTaskCardClick=function(n){e._onTaskCardClick(n)},o.getWidthString=function(n){return n?(e._previousWidth=n,n+"px"):e._previousWidth?e._previousWidth+"px":u.defaultCardWidth+"px"},this._controlTemplate=this._controlTemplateFactory({templateText:this._controlTemplateText,staticResources:o}),this._panelWrapper=this._controlTemplate.applyDataTemplate(o),this._initializeDomObjects(),this._registerTouchEvent(o));this._disposables.push(t.secondaryTaskAdded.add(function(n){return e._onStackFocusing(n)}),t.stackAdded.add(function(n){return e.onStackAdded(n)}),t.stackFocusing.add(function(n){return e._onStackFocusing(n)}),t.stackCollapsed.add(function(n){return e._onStackCollapsed(n)}),t.stackRemoved.add(function(n){return e._onStackRemoved(n)}),t.stackRemoving.add(function(n){return e._onStackRemoving(n)}),t.stacksReset.add(function(){return e.refreshStacks()}),this._map.mapModeChanged.add(function(n){return e._onMapModeChanged(n)}));this.refreshStacks()},n.prototype.deactivate=function(){for(var n=0;n<this._disposables.length;n++)this._disposables[n].dispose();this._disposables=[];this._layoutContainer=null},n.prototype._createTaskListViewModel=function(n){return new wt(n,this._layoutMetrics,this._stacks)},n.prototype._animateCard=function(n,t,i,r){r&&r()},n.prototype._getScrollbarThickness=function(){var n=i._createElement("div"),t=i._createElement("div"),r;return n.append(t),n.appendTo(document.body),n.set_style({overflow:"scroll",height:"100px",width:"100px"}),t.set_style({height:"100%",width:"100%"}),r=new pr(n[0].offsetWidth-t[0].offsetWidth,n[0].offsetHeight-t[0].offsetHeight),n.removeFromParent(),r},n.prototype._getScrollTarget=function(n){return n},n.prototype._resetSlideoutLaneScroll=function(){if(this._useSlideLayout){var n=this._slideoutPanelWrapper[0];n&&(n.scrollTop=0)}},n.prototype._scrollLane=function(n,t,r){var o=this,h=this._cardsContainer.select("[data-taskid='"+n.id+"']"),e;this._panelScrollFromFocus=!0;var s=this._panelWrapper.get_scroll_pos(),c=h.get_relative_pos(),u=this._getScrollTarget(s,c),f=this._panelWrapper[0];u.x=i._clamp(u.x,0,f.scrollWidth);u.y=i._clamp(u.y,0,f.scrollHeight);e=function(){o._cardsContainer.set_style({transform:""});f.scrollTop=u.y;f.scrollLeft=u.x;r&&r();Microsoft.Maps.setTimeout(function(){o._panelScrollFromFocus=!1},100)};t?e():this.cardsContainerTransition(f,s,u,e)},n.prototype.cardsContainerTransition=function(n,t,i,r){o.Transition.run(this._cardsContainer,[{property:"transform",to:"translate("+(t.x-i.x)+"px, "+(t.y-i.y)+"px)"}],r)},n.prototype._initPanelWrapper=function(){},n.prototype._initSlideoutPanelWrapper=function(){},n.prototype._initTaskCard=function(){},n.prototype._layoutSizeChanged=function(){},n.prototype._scrollOnCardClick=function(){return!0},n.prototype._updateViewPortPadding=function(){},n.prototype._registerTouchEvent=function(){},n.prototype._isCollapsed=function(){return!1},n.prototype.addScrollHandler=function(n){var t=this;n.getAllTasks().forEach(function(i){i&&i.scrollLane&&!t._taskStackScrollHandlerDictionary[i.id]&&(t._taskStackScrollHandlerDictionary[i.id]=i.scrollLane.add(function(r){t.scrollCardsLaneToElement(n,i,r)}))})},n.prototype.scrollCardsLaneToElement=function(){},n.prototype.removeScrollHandler=function(n){var t=this;n.getAllTasks().forEach(function(n){var i=t._taskStackScrollHandlerDictionary[n.id];i&&(i.dispose(),delete t._taskStackScrollHandlerDictionary[n.id])})},n.prototype._cleanupDomObjects=function(){this._layoutSizeHelper.resize=new t},n.prototype._initializeDomObjects=function(){var n=this,t,i;this._useSlideLayout?(this._layoutContainer.clear().append(this._panelWrapper.select(".bm_scrollbarMask")),t=this._layoutContainer.select(".panelWrapper"),this._panelWrapper=o(t[0]),this._slideoutPanelWrapper=o(t[1]),this._initSlideoutPanelWrapper(this._slideoutPanelWrapper),i=".cardCol[data-containerAreaType=cardsContainer]",this._cardsContainer=this._panelWrapper.select(i),this._slideoutCardsContainer=this._slideoutPanelWrapper.select(i)):(this._layoutContainer.clear().append(this._panelWrapper),this._cardsContainer=this._panelWrapper.select("[data-containerAreaType=cardsContainer]"));this._taskStackScrollHandlerDictionary={};this._initPanelWrapper(this._panelWrapper);this._layoutSizeHelper=this._useSlideLayout?new ii(o([this._layoutContainer[0],this._cardsContainer[0]]),500):new ii(o([this._panelWrapper[0],this._cardsContainer[0]]),500);this._disposables.push(this._layoutSizeHelper.resize.add(function(t){return n._layoutSizeChanged(n._panelWrapper,n._cardsContainer,t)}));this._layoutSizeChanged(this._panelWrapper,this._cardsContainer)},n.prototype._onMapModeChanged=function(n){var t=n.newMode;t===2?sj_evt.fire("HideContextualTaskbar"):this._map.getMapType().id!==f.birdseyeV2&&sj_evt.fire("ShowContextualTaskbar")},n.setIsSecondColumnDisplayed=function(t){n._isSecondColumnDisplayed=t},n.getIsSecondColumnDisplayed=function(){return n._isSecondColumnDisplayed},n}(),hi=function(n){function t(t,r,u){u===void 0&&(u=!0);var f=this,e=u&&i._getIsSlideCardEnabled(),o=e?ru:gr;return f=n.call(this,t,r?r:o,{horizontalAlignment:1,verticalAlignment:0,orientation:1})||this,f._useSlideLayout=e,f}return e(t,n),t.prototype.activate=function(t,i,r,u,f){var e=this;n.prototype.activate.call(this,t,i,r,u,f);this._scrollHandler=function(){var t=e._taskManager.getFocusedStack(),n=t&&t.getForegroundTask();n&&n.laneScrolled&&n.laneScrolled.invoke()};this._panelWrapper.add_event("scroll",this._scrollHandler)},t.prototype.deactivate=function(){var i,t,r;for(this.removeToggleButton(),this._panelWrapper.remove_event("scroll",this._scrollHandler),i=this._taskManager.getStacks(),t=0,r=i.length;t<r;t++)this._removePrimitiveInteractedHandler(i[t]);n.prototype.deactivate.call(this)},t.prototype.update=function(n){if(n)switch(n.mapTypeId){case f.road:case f.roadVector1:case f.roadVector2:this._toggleButton.remove_class("Dark");this._toggleButton.add_class("Light");return;case f.birdseye:case f.aerial:case f.seasonal:this._toggleButton.remove_class("Light");this._toggleButton.add_class("Dark");return;default:this._toggleButton.remove_class("Dark");this._toggleButton.add_class("Light");return}},t.prototype.refreshStacks=function(){n.prototype.refreshStacks.call(this);for(var t=0,i=this._stacks.length;t<i;t++)this._addPrimitiveInteractedHandler(this._stacks[t])},t.prototype._createTaskListViewModel=function(n){var i=this,t=new wt(n,this._layoutMetrics,this._stacks);return t.onTitleMouseOver=function(n){i._onMouseOverTitle(n)},t.onTitleMouseLeave=function(n){i._onMouseLeaveTitle(n)},t},t.prototype._onTaskCardClick=function(i){var u=i.stack,r=this._cardsContainer.select("[data-taskId='"+u.id+"']");r.remove_attr("data-cardColor");window.clearTimeout(t._mouseoverDelayHandle);r.get_attr("data-hoverpoi")&&(r.remove_attr("data-hoverpoi"),u.setDisplayState({cardTitleHoveringState:2}));n.prototype._onTaskCardClick.call(this,i)},t.prototype._animateCard=function(n,t,i,r){var f=this,u;this._layoutHidden?(u=function(){f._performAnimation(n,t,i,r)},this._toggleLayout(u)):this._performAnimation(n,t,i,r)},t.prototype._performAnimation=function(i,r,u,f){var h,l=0,s=f,y,a,v,e;s&&u!==3&&(s=function(){f();c.setFocusToTitle(i,r,u===4)});this._updateTaskPanelHeight(this._taskManager.getFocusedStack(),0);switch(u){case 5:case 0:i.setDisplayState({animationState:0},!1);u!==5?(y=this._panelWrapper[0].clientHeight,h=[{property:"visibility",from:"visible",to:"visible"},{property:"top",from:y+"px",to:"0"}]):h=[{property:"visibility",from:"visible",to:"visible"}];l=this._updateCardList(i,!0,s);this.addScrollHandler(i);this._addPrimitiveInteractedHandler(i);break;case 3:h=[{property:"transform",to:"scale(0.6)",duration:200},{property:"visibility",from:"visible",to:"hidden",duration:100}];l=this._updateCardList(i,!1,s);this.removeScrollHandler(i);this._removePrimitiveInteractedHandler(i);break;case 2:i.setDisplayState({animationState:0},!1);l=this._updateCardList(i,!1,s);this.addScrollHandler(i);break;case 4:for(r.set_style({height:t._titleHeight+"px",overflow:"hidden"}),r.add_class("collapsed"),a=r.select(".cardTitleText"),e=0;e<a.length;e++)a[e].setAttribute("aria-expanded","false");for(v=r.select(".focusDummy"),e=0;e<v.length;e++)v[e].setAttribute("aria-expanded","false");this._panelWrapper[0].scrollTop=0;this._updateTaskPanelHeight(i,t._titleHeight);this._useSlideLayout&&this._addTitleMaskToStack(i)}u!==2&&(h&&h.length?o.Transition.run(r,h,s):n.prototype._animateCard.call(this,i,r,u,s))},t.prototype._getScrollTarget=function(n,i){return new vr(n.x,i.y-t._scrollSnapLinePx)},t.prototype._initPanelWrapper=function(n){var t=this,i=this._useSlideLayout,r;i?this._layoutContainer.add_class("slideout"):n.getParent().remove_class("slideout");r=this._getScrollbarThickness().width;n.add_class("left noScroll").add_event(i?"mouseenter":"mouseover",function(){t._getLaneContentHeight()>t._panelWrapper[0].clientHeight&&t._updateScrollingOnPanel(n,0,!0)}).add_event(i?"mouseleave":"mouseout",function(){t._updateScrollingOnPanel(n,r,!1)});this._updateScrollingOnPanel(n,r,!1);this._taskPrimitiveInteractedHandlerDictionary={};this.addToggleButton();this._taskStackChangeHandlerDictionary={}},t.prototype._initSlideoutPanelWrapper=function(n){var t=this,i=this._getScrollbarThickness().width;n.add_event("mouseenter",function(){t._slideoutCardsContainer[0].clientHeight>n[0].clientHeight&&t._updateScrollingOnPanel(n,0,!0)}).add_event("mouseleave",function(){t._updateScrollingOnPanel(n,i,!1)});this._updateScrollingOnPanel(n,i,!1)},t.prototype._getLaneContentHeight=function(){return this._cardsContainer[0].clientHeight},t.prototype._layoutSizeChanged=function(n,t,i){var s=t[0],c=s&&s.lastElementChild,e,o,f,r,h;this._updateViewPortPadding(n,c);e=i&&i[0]&&i[0].height;o=i&&i[1]&&i[1].height;e===this._panelHeight&&o===this._cardsHeight&&i||(this._panelHeight=e,this._cardsHeight=o,f=this._taskManager.getFocusedStack(),r=f&&this._cardsContainer.select("[data-taskId='"+f.id+"']"),r&&r.length==0&&(r=null),h=r&&r.get_size().height,u.noStopSizeMonitoring||this._updateTaskPanelHeight(f,h))},t.prototype._updateViewPortPadding=function(n,t,r){var e;if(i._isSmallMapShownOnSerp())this._map.setViewportPadding({left:0,right:0,top:0,bottom:0});else{var f=this._map.getRootElement(),w=f.get_size(),h=0,c=f.parent().select(".taskBar");if(c.length===1&&(h=c.get_size().height+20),e=0,t){var p=r?r:this.focusedStack,l=u.defaultCardWidth,a=p.getAllTasks(),v=a.length;e=v>1&&this._useSlideLayout&&!a[v-1].noSlideout?2*l+50:l+30}var o=0,s=f.select("#MicrosoftNav"),y=30;s.length===1&&(o=s.parent().get_size().width-s.get_relative_pos().x);i._isLocalOrRealEstateScenarioOverlayShownOnSerp()&&(y=o=0);this._map.setViewportPadding({left:e,right:o,top:h,bottom:y})}},t.prototype._isCollapsed=function(n){var i=n&&this._cardsContainer.select("[data-taskId='"+n.id+"']"),r=i&&i.get_size().height;return r===t._titleHeight},t.prototype._changeCategoryIconDisplayState=function(n,t,r){var u=n.select(".catIcon"),f;if(u.length>0)if(i._isNewCardHeaderStyleEnabled()){if(f=u.select("."+t),f.get_style("display")==="block")return u.select("."+r).set_style({display:"block"}),f.set_style({display:"none"}),!0}else u.select(".focused").set_style({display:r==="decayed"?"none":"block"}),u.select(".unfocused").set_style({display:r==="decayed"?"block":"none"});return!1},t.prototype._onMouseOverTitle=function(n){var t=this._getTitleBar(o(n.target)),e,s;t.add_class("hover");var i=t.get_ancestor(2),u=i.get_attr("data-taskid"),r=this._taskManager.getStackById(u),f=c._getCardCssClassForTask(u,this._cardsContainer),h=f.indexOf(c.GrayedOutStyle)!==-1,l=f.indexOf("focus")!==-1;h&&(e="ac"+r.displayState.colorIndex,i.set_attr("data-cardColor",e),this._replaceCardClass(i,u,f,e+" hovering"));(h||!l)&&this._showHoverPois(i,r);this._changeCategoryIconDisplayState(t,"decayed","hovered")&&(s=r&&r.getForegroundTask(),s&&s.getIconColorAndClassName(function(n){t.set_style({borderLeftColor:n})}))},t.prototype._replaceCardClass=function(n,t,i,r){var u=c._replaceCardClass(t,this._cardsContainer,r);n.remove_class(i);n.add_class(u)},t.prototype._showHoverPois=function(n,i){window.clearTimeout(t._mouseoverDelayHandle);t._mouseoverDelayHandle=Microsoft.Maps.setTimeout(function(){n&&n.set_attr("data-hoverpoi",1..toString());i&&i.setDisplayState({cardTitleHoveringState:1});var t=i&&i.getForegroundTask();t&&y.invokeHandler(v.instrumentationDataHandlerKey,{logData:{feature:b.CardModel,action:p.Hovered,data:{TT:t.type,TID:t.id,SID:i.id,GN:i.displayState.groupName,CI:i.displayState.colorIndex,PR:i.displayState.prominence}}})},t._mouseoverTimeout)},t.prototype._onMouseLeaveTitle=function(n){var r=this._getTitleBar(o(n.target));r.remove_class("hover");var i=r.get_ancestor(2),u=i.get_attr("data-cardColor"),f=i.get_attr("data-taskid"),e=this._taskManager.getStackById(f);u&&(i.remove_attr("data-cardColor"),this._replaceCardClass(i,f,u+" hovering",c.GrayedOutStyle));window.clearTimeout(t._mouseoverDelayHandle);i.get_attr("data-hoverpoi")&&(i.remove_attr("data-hoverpoi"),e.setDisplayState({cardTitleHoveringState:2}));this._changeCategoryIconDisplayState(r,"hovered","decayed")&&r.set_style({borderLeftColor:"#919191"})},t.prototype._getTitleBar=function(n){for(var t=n;t&&!t.has_class("titleBar");)t=t.getParent();return t},t.prototype._getStackIndex=function(n){for(var i=this._taskManager.getStacks(),r=i.length,t=0;t<r;t++)if(i[t]===n)return t;return-1},t.prototype._updateTaskPanelHeight=function(n,i){if(u.noStopSizeMonitoring){this._layoutContainer.set_style({bottom:n&&i===t._titleHeight?"auto":""});return}if(n&&i===t._titleHeight){var r=this._cardsContainer.get_size().height;this._layoutContainer.set_style({height:r+"px"})}else this._layoutContainer.set_style({height:""})},t.prototype._updateScrollingOnPanel=function(n,t,i){var r,u;this._layoutSizeHelper&&this._layoutSizeHelper.stopMonitoring();r=i?-t:t;n.set_style({"margin-right":-r+"px"});u=this._useSlideLayout?r+"px":i?"0":"";n.select("> *").set_style({"padding-right":u});this._layoutSizeHelper&&this._layoutSizeHelper.startMonitoring(!0)},t.prototype._scrollLane=function(t,i,r){n.prototype._scrollLane.call(this,t,i,r)},t.prototype._updateCardList=function(n,i,r,f){var a=this,h,v,c,y,l,d,s,e,g,p,w,b,o,k;for(f===void 0&&(f=!0),h=this._taskManager.getStacks(),v=h.length,this._cardFocusTimer&&(this._cardFocusTimerCallback&&(this._cardFocusTimerCallback(),this._cardFocusTimerCallback=null),clearTimeout(this._cardFocusTimer)),s=0;s<v;s++)if(e=this._cardsContainer.select("[data-taskId='"+h[s].id+"']"),h[s]===n)c=e,this._useSlideLayout&&(g="[data-taskid='"+h[s].id+"'] .title",p=this._panelWrapper.select(g+" .titleMask"),p.length!==0&&p.removeFromParent());else{for(e.set_style({height:t._titleHeight+"px",overflow:"hidden",transition:t._transitionStyleFormat.replace("{duration}","0.3")}),e.add_class("collapsed"),w=e.select(".cardTitleText"),o=0;o<w.length;o++)w[o].setAttribute("aria-expanded","false");for(b=e.select(".focusDummy"),o=0;o<b.length;o++)b[o].setAttribute("aria-expanded","false");this._useSlideLayout&&this._addTitleMaskToStack(h[s])}return y=c.select("div.front").get_size().height,l=u.slideoutEnabled&&this._taskManager.isFocusedStackInCollapsedState()||v===1?0:this._getAnimationDurationForHeight(y),d=t._transitionStyleFormat.replace("{duration}",l.toString()),k=function(){c.set_style({height:y+"px",overflow:"hidden",transition:d});e.add_class("collapsed");a._cardFocusTimerCallback=r;a._cardFocusTimer=Microsoft.Maps.setTimeout(function(){var i,u,t;if(c){for(c.set_style({height:"",overflow:""}),c.remove_class("collapsed"),i=e.select(".cardTitleText"),t=0;t<i.length;t++)i[t].setAttribute("aria-expanded","true");for(u=e.select(".focusDummy"),t=0;t<u.length;t++)u[t].setAttribute("aria-expanded","true")}n&&n.setDisplayState({animationState:1},!1);r&&r();a._cardFocusTimerCallback=null},l*1e3)},f?this._scrollToFocusedCard(n,!0,k):k(),l},t.prototype._getAnimationDurationForHeight=function(n){return n<t._smallCardMaxHeight?t._smallCardAnimationDuration:n<t._mediumCardMaxHeight?t._mediumCardAnimationDuration:t._largeCardAnimationDuration},t.prototype.scrollCardsLaneToElement=function(n,t,i){if(this._taskManager.getFocusedStack()===n&&(n.getForegroundTask()===t||this._useSlideLayout)){var r=this._map.getViewportPadding();i.is_element_inView(r.top,r.bottom)||(i===t.panelRoot?this._scrollLane(n,!0):this._panelWrapper[0].scrollTop=i.get_relative_pos().y)}},t.prototype._addPrimitiveInteractedHandler=function(n){var i=this,r,t,u;if(this._useSlideLayout){for(r=n.getAllTasks(),t=0;t<r.length;t++)this._updatePrimitiveInteractedDictionary(r[t]);this._disposables.push(n.taskAdded.add(function(n){i._updatePrimitiveInteractedDictionary(n)}));this._disposables.push(n.tasksRemoved.add(function(n){for(var t=0,r=n.length;t<r;t++)i._removePrimitiveInteractedHandlerFromTask(n[t])}))}else u=n.getForegroundTask(),this._updatePrimitiveInteractedDictionary(u);this._taskStackChangeHandlerDictionary[n.id]||(this._taskStackChangeHandlerDictionary[n.id]=n.flipAnimationCompleted.add(function(){return i._primitiveInteractedHandlerForFlippedStack(n)}))},t.prototype._primitiveInteractedHandlerForFlippedStack=function(n){var t=n.getForegroundTask();this._updatePrimitiveInteractedDictionary(t)},t.prototype._updatePrimitiveInteractedDictionary=function(n){var t=this;n&&n.primitiveInteracted&&!this._taskPrimitiveInteractedHandlerDictionary[n.id]&&(this._taskPrimitiveInteractedHandlerDictionary[n.id]=n.primitiveInteracted.add(function(n){return t._primitiveInteractedHandler(n)}))},t.prototype._primitiveInteractedHandler=function(n){n&&n.action!==0?n.action===1&&n.element?n.element.appendTo(this._layoutContainer.getParent()):n.action===2?u.noStopSizeMonitoring||this._layoutSizeHelper.stopMonitoring():n.action===3&&(u.noStopSizeMonitoring||this._layoutSizeHelper.startMonitoring(!0)):this._layoutHidden&&this._toggleLayout()},t.prototype._removePrimitiveInteractedHandler=function(n){var t=this;n.getAllTasks().forEach(function(n){t._removePrimitiveInteractedHandlerFromTask(n)});n.flipAnimationCompleted.remove(this._primitiveInteractedHandlerForFlippedStack);this._taskStackChangeHandlerDictionary[n.id].dispose();delete this._taskStackChangeHandlerDictionary[n.id]},t.prototype._removePrimitiveInteractedHandlerFromTask=function(n){var t=this._taskPrimitiveInteractedHandlerDictionary[n.id];t&&(n&&n.primitiveInteracted&&n.primitiveInteracted.remove(this._primitiveInteractedHandler),t.dispose(),delete this._taskPrimitiveInteractedHandlerDictionary[n.id])},t.prototype.addToggleButton=function(){var n=this,t=o(".toggleButton");t.length>0&&t.removeFromParent();this._toggleButton=i._createElement("a");this._toggleButton.add_class("toggleButton hide").add_event("click",function(t){t.stopPropagation();t.preventDefault();n._toggleLayout()}).set_style({visibility:"hidden"}).set_attr("data-tag","toggleButtonHide").set_attr("href","#").set_attr("role","button").set_attr("aria-expanded","true").set_attr("title",tt.L_CardLayoutExpandCollapse_Text);this._useSlideLayout?this._toggleButton.appendTo(this._layoutContainer):this._toggleButton.appendTo(this._layoutContainer.getParent());this.update({mapTypeId:this._map.getMapType().id});this._disposables.push(new gt(this._stacks,"length",this._toggleButton,"style",function(t){var i="";return n._map.getMode().mapModeType===2&&(i=";z-index: -1"),(t?"":"visibility:hidden")+i}))},t.prototype.removeToggleButton=function(){this._toggleButton.removeFromParent()},t.prototype._toggleLayout=function(n){var t=this,i=this._taskManager.getFocusedStack(),r=i&&i.getForegroundTask(),u={logData:{feature:b.CardModel,action:this._layoutHidden?p.Expanded:p.Collapsed,data:{TT:r&&r.type,TID:r&&r.id,SID:i&&i.id}},isMapsAction:!1};this._layoutSizeHelper.stopMonitoring();this._layoutHidden?(this._layoutHidden=!1,this._useSlideLayout&&this._animateElement(this._slideoutPanelWrapper,"width",0,this._slideoutPanelWrapperWidth,200,function(){t._slideoutPanelWrapper.set_style({width:""})}),this._animateElement(this._panelWrapper,"width",0,this._panelWrapperWidth,200,function(){t._panelWrapper.set_style({width:""});t._layoutSizeHelper.startMonitoring(!0);n&&n()}),this._animateElement(this._toggleButton,"left",0,this._panelWrapperWidth,200,function(){t._toggleButton.set_style({left:""});t._toggleButton.swap_class("show","hide");t._toggleButton.set_attr("aria-expanded","true")})):(this._layoutHidden=!0,this._panelWrapperWidth=this._panelWrapper.get_size().width,this._useSlideLayout&&(this._slideoutPanelWrapperWidth=this._slideoutPanelWrapper.get_size().width,this._animateElement(this._slideoutPanelWrapper,"width",this._slideoutPanelWrapperWidth,0,200)),this._animateElement(this._panelWrapper,"width",this._panelWrapperWidth,0,200,function(){t._layoutSizeHelper.startMonitoring(!0);n&&n()}),this._animateElement(this._toggleButton,"left",this._panelWrapperWidth,0,200,function(){t._toggleButton.swap_class("hide","show");t._toggleButton.set_attr("aria-expanded","false")}));y.invokeHandler(v.instrumentationDataHandlerKey,u)},t.prototype._animateElement=function(n,t,i,r,u,f){o.Transition.run(n,[{property:t,from:i,to:r,duration:u}],f)},t.prototype._addTitleMaskToStack=function(n){var r="[data-taskid='"+n.id+"'] .title",t,i;this._panelWrapper.select(r+" .titleMask").length===0&&(t=document.createElement("h2"),t.className="titleMask",t.textContent=n.getForegroundTask().getTitle(),i=this._panelWrapper.select(r),i.insertBefore(t,i.select("h2")))},t._scrollSnapLinePx=55,t._smallCardMaxHeight=500,t._mediumCardMaxHeight=1e3,t._smallCardAnimationDuration=.3,t._mediumCardAnimationDuration=.5,t._largeCardAnimationDuration=.6,t._transitionStyleFormat="height {duration}s cubic-bezier(0.445, 0.05, 0.55, 0.95)",t._titleHeight=36,t._mouseoverTimeout=300,t}(bt);at.registerLayout("MultiCardLeftLayout",hi);ci=function(n){function i(t){var i=n.call(this,t,nu,!1)||this;return i._hideLayoutOnEmptyTasks=!1,i}return e(i,n),i.prototype._animateCard=function(t,i,r,u){switch(r){case 0:n.prototype._animateCard.call(this,t,i,r,u);break;default:u&&u()}},i.prototype._onTaskCardClick=function(){},i.prototype._getLaneContentHeight=function(){return this._cardsContainer[0].clientHeight+this._selectionCardContainer[0].clientHeight},i.prototype._updateTaskPanelHeight=function(){if(u.noStopSizeMonitoring){this._panelWrapper.getParent().set_style({bottom:""});return}this._panelWrapper.getParent().set_style({height:""})},i.prototype.activate=function(i,r,u,f){var e=this;this._map=f;this._container=f.getContainer();this._taskManager=r;this._container.instanceAsync("BrowserHistoryManager",function(o){e._browserHistoryManager=o;e._browserHistoryManager.setIsCapturing(!1);e._browserHistoryManager.register("MultiCardSelectionLayout",{serialize:function(){},deserialize:function(){y.invokeHandler(v.shareDataHandlerKey,{action:"closeShare"})},serializableObjectChanged:new t});n.prototype.activate.call(e,i,r,u,f);e._layoutContainer.set_attr("style","");e._selectionCardContainer=e._panelWrapper.select(".selectionCardClass");e._currentTaskListViewModel.getSelectionControl().refresh()})},i.prototype.deactivate=function(){var r,i,u,t,f;for(n.prototype.deactivate.call(this),this._selectionCardContainer=null,r=this._taskManager.getStacks(),i=this._taskManager.getFocusedStack(),u=0;u<r.length;u++)t=r[u],t&&(t.setIsLocked(!1),t.setIsSelected(!1),t.displayState.activationState===4&&(t.displayState.activationState=3));i||(i=r[0]);i&&(f=i.getForegroundTask())&&this._taskManager.focusTask(f.id);this._browserHistoryManager.unregister("MultiCardSelectionLayout");this._browserHistoryManager.setIsCapturing(!0);this._map=null;this._container=null;this._taskManager=null;this._browserHistoryManager=null},i.prototype._createTaskListViewModel=function(n){return this._currentTaskListViewModel=new ku(n,this._layoutMetrics,this._taskManager,this._map.getContainer(),this._stacks),this._currentTaskListViewModel},i.prototype.addToggleButton=function(){},i.prototype.removeToggleButton=function(){},i.prototype._fireOnCardFocusEvent=function(){},i}(hi);at.registerLayout("MultiCardLeftSelectionLayout",ci);var g=function(){function n(n){this._map=n}return n.prototype.selectorReady=function(){return this._ready||(this._ready=new wr(this)),this._ready},n.prototype.getTemplates=function(){return null},n.prototype._getFillStyle=function(t,i){var u=null,r=t.taskDisplayState&&t.taskDisplayState.colorIndex;return(r>=1&&r<=3||r===4)&&(u=i?n.AerialColors[r]:n.Colors[r]),u},n.prototype._getRadius=function(t,i){return this._shouldUseProminentTaskRadius(t)?n._getMostProminentTaskRadius(i):n._getNonProminentTaskRadius(i)},n.prototype._shouldUseProminentTaskRadius=function(){throw"Not implemented";},n.prototype._getBorderSize=function(){throw"Not implemented";},n.prototype._getVectorImage=function(){throw"Not implemented";},n._convertToRGBA=function(n,t){var i=n.replace("#",""),r=parseInt(i.substring(0,2),16),u=parseInt(i.substring(2,4),16),f=parseInt(i.substring(4,6),16);return"rgba("+r+","+u+","+f+","+t+")"},n._getMostProminentTaskRadius=function(n){return n<8?6:n<12?7:n<18?8:10},n._getNonProminentTaskRadius=function(n){return n<18?4.5:6},n.Colors=["#4379bc","#aa298f","#00c6c6","#008200","#f9a11b"],n.AerialColors=["#4379bc","#d348bf","#009aaa","#52b573","#f9a11b"],n.HoverColor="#000000",n.HoverColorInAerialMode="#ffffff",n._defaultInnerBorderFillStyle="#FFFFFF",n._defaultPoiBorderRadius=1,n}(),li=function(){function n(n){var t=this;this._map=n;this._map.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(t._resetTemplateSelector=!0)})}return n.prototype.selectorReady=function(){var n=this;return!this._baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){return n._baseMapTemplateSelector=t,n._resetTemplateSelector=!1,n._baseMapTemplateSelector.selectorReady()}):this._baseMapTemplateSelector.selectorReady()},n.prototype.getMarkupStyle=function(n,t,i){var r,u;return i===void 0&&(i=1),n&&this._baseMapTemplateSelector&&(u=this._getPoiState(n),r=this._baseMapTemplateSelector.getMarkupStyle(n,t,u,i)),r},n.prototype._getPoiState=function(n){var i=n.viewState,t=2;return i===1?t=3:i===2&&(t=4),t},n.prototype.getTemplates=function(n,t){var i=null;return n&&this._baseMapTemplateSelector&&n.geometryType===1&&(i=this._baseMapTemplateSelector.getLandmarkVectorImageTemplate(n,this._getPoiState(n),t,n.entity&&n.entity.poiType||1)),i},n}(),rt=function(n){function t(t){return n.call(this,t)||this}return e(t,n),t.prototype.getTemplates=function(n){var t=n,r=null,u,i;if(t){if(u=t.taskDisplayState&&t.taskDisplayState.prominence,t.viewState&&t.viewState===3)return r;if(t.taskDisplayState&&t.taskDisplayState.cardTitleHoveringState===1)i=this._getVectorTemplate(t),r=i&&[i];else{if(u>2||!u)return r;i=this._getVectorTemplate(t);r=i&&[i]}}return r},t.prototype._getFillStyle=function(t,i){return t.viewState&&t.viewState===1?i?g.HoverColorInAerialMode:g.HoverColor:n.prototype._getFillStyle.call(this,t,i)},t.prototype._getBorderSize=function(n,t){return n.taskDisplayState&&(n.taskDisplayState.prominence===1||n.taskDisplayState.cardTitleHoveringState===1)?t<8?1:t<12?1.5:2:g._defaultPoiBorderRadius},t.prototype._getVectorImage=function(n,i,r,u,f,e){return t._getDefaultVectorImage(n,i,r,u,f,e)},t.prototype._shouldUseProminentTaskRadius=function(n){return n.taskDisplayState&&(n.taskDisplayState.prominence===1||n.taskDisplayState.cardTitleHoveringState===1)},t.prototype._getInnerBorderFillStyle=function(n){var i=g._defaultInnerBorderFillStyle,r;return n.viewState&&n.viewState===1?null:n.taskDisplayState&&n.taskDisplayState.cardTitleHoveringState===1?i:(n.taskDisplayState&&n.taskDisplayState.prominence!==1&&(r=n.taskDisplayState.colorIndex,r>=1&&r<=3&&(i=t._innerBorderColors[n.taskDisplayState.colorIndex])),i)},t._convertToRGBA=function(n,t){var i=n.replace("#",""),r=parseInt(i.substring(0,2),16),u=parseInt(i.substring(2,4),16),f=parseInt(i.substring(4,6),16);return"rgba("+r+","+u+","+f+","+t+")"},t.prototype._getVectorTemplate=function(n){var i=this._getFillStyle(n,this._map.getMapType().id===f.aerial);if(!i)return null;var u=Math.round(this._map.getMercatorZoomLevel()),e=this._getRadius(n,u),o=this._getBorderSize(n,u),s=this._getInnerBorderFillStyle(n),h=i+","+o+","+e+","+s,r=t._vectorImageTemplateDictionary[h];return r||(r=new it(this._getVectorImage(i,i,o,e,s,1)),t._vectorImageTemplateDictionary[h]=r),r},t._getDefaultVectorImage=function(n,t,i,r,u,f){var s=[],e=null,o=null,h;return u?(e={centerX:0,centerY:0,radiusX:r-f,radiusY:r-f,vectorType:2,style:{fillStyle:n}},o={centerX:0,centerY:0,radiusX:r,radiusY:r,vectorType:2,style:{fillStyle:u}}):e={centerX:0,centerY:0,radiusX:r,radiusY:r,vectorType:2,style:{fillStyle:n}},i>0?(h={centerX:0,centerY:0,radiusX:r+i,radiusY:r+i,vectorType:2,style:{fillStyle:t}},s=o?[h,o,e]:[h,e]):s=o?[o,e]:[e],{records:s,hotspotX:0,hotspotY:0,hitTest:1}},t._vectorImageTemplateDictionary={},t._innerBorderColors=["#4379bc","#93277f","#00afaa","#007500"],t}(g),su=function(t){function r(n){return t.call(this,n)||this}return e(r,t),r.prototype.getTemplates=function(u){var e=u,o=null,v,w,b,y,d,ht,c,tt,at,vt;if(e&&e.taskDisplayState){var ut=this._map.getMapType().id===f.aerial,yt=this._map.getMapType().id===f.seasonal,p=e.viewState===1,pt=e.viewState===2,a=Math.round(this._map.getMercatorZoomLevel()),s;if(e.geometryType===1){if(v=this._getFillStyle(u,ut),!v)return o;if(w=this._getRadius(e,a),b=this._getBorderSize(e,a),yt){o=[];var ft=this._getIconSize(a,!0),et=ft.toString(),ot=ft+",hover",k=r._seasonalTemplateDictionary[et];return k||(k=this._getHalloweenTemplate(a),r._seasonalTemplateDictionary[et]=k),y=r._seasonalTemplateDictionary[ot],y||(y=this._getHoverBoarderTemplate(a),r._seasonalTemplateDictionary[ot]=y),p&&o.push(y),o.push(k),nt.getIconText(e.entity)&&nt.getIconText(e.entity).length>0&&(o=o.concat(l.getPushpinTextTemplates(o[o.length-1],null,null,null))),o}if(e instanceof n.CloudGraphDataManager.FavoritePoint&&(d=e.entity.homeOrWork,d==="home"||d==="work"))return[this._getHomeOrWorkTemplate(d,a,p)];c=v+","+b+","+w;nt.getIconText(e.entity)&&nt.getIconText(e.entity).length>0?(s=r._printTemplateDictionary[c],s||(s=new it(t.prototype._getVectorImage.call(this,v,rt._defaultInnerBorderFillStyle,b,w,null,null)),r._printTemplateDictionary[c]=s)):(s=r._starImageTemplateDictionary[c],s||(ht=ut&&p?g.Colors[4]:rt._defaultInnerBorderFillStyle,s=new it(this._getVectorImage(v,ht,b,w)),r._starImageTemplateDictionary[c]=s));o=[s];nt.getIconText(e.entity)&&nt.getIconText(e.entity).length>0&&(o=o.concat(l.getPushpinTextTemplates(o[o.length-1],null,null,null)))}else if(e.geometryType===2||e.geometryType===3){var ct=e,lt={strokeStyle:r._defaultStrokeStyle,lineWidth:r._defaultLineWidth,dashes:[]},h=ct.polyShapeStyle||lt;h.hitTest=1;c=h.strokeStyle+"_"+h.lineWidth+"_"+h.dashes;h.dashes.length===1&&h.dashes[0]===0&&(h.dashes=[]);ct.geometryType===3&&(lt.fillStyle=r._defaultFillStyle,c=h.fillStyle+"_"+c,h.fillStyle.indexOf("#")===0&&(tt=h.fillStyle,h.fillStyle=i._formatString("rgba({0}, {1}, {2}, 0.30)",parseInt(tt.slice(1,3),16),parseInt(tt.slice(3,5),16),parseInt(tt.slice(5),16))));o=[];s=r._polyshapeTemplateDictionary[c];s||(s=new st(h),r._polyshapeTemplateDictionary[c]=s);(p||pt)&&(at={strokeStyle:"#000",lineWidth:h.lineWidth+3,dashes:[]},vt=new st(at),o.push(vt));o.push(s)}}return o},r.prototype._getVectorImage=function(n,i,r,u){var o=t.prototype._getVectorImage.call(this,n,rt._defaultInnerBorderFillStyle,r,u,null,null),e=[{x:0,y:-10},{x:3,y:-3},{x:9,y:-3},{x:4,y:1},{x:6,y:8},{x:0,y:4},{x:-6,y:8},{x:-4,y:1},{x:-9,y:-3},{x:-3,y:-3},{x:0,y:-10}],s,f,h;if(u!==10)for(s=e.length,f=0;f<s;f++)e[f].x=e[f].x*u/10,e[f].y=e[f].y*u/10;return h={pointsList:e,vectorType:0,style:{fillStyle:i}},o.records=o.records.concat(h),o},r.prototype._shouldUseProminentTaskRadius=function(){return!0},r.prototype._getHoverBoarderTemplate=function(n){var t="halloweenHover",i=this._getIconSize(n,!0);return t+=i,this._getTemplateFromImageString(t,i+10)},r.prototype._getHomeOrWorkTemplate=function(n,t,i){var r=n,u;return i&&(r+="Hover"),u=this._getIconSize(t),r+=u,this._getTemplateFromImageString(r,u)},r.prototype._getHalloweenTemplate=function(n){var t="halloween",i=this._getIconSize(n,!0);return t+=i,this._getTemplateFromImageString(t,i)},r.prototype._getTemplateFromImageString=function(n,t){var i=ur.getImageFromCss(n);return i.width=t,i.height=t,new gi(i,1,new dt(Math.ceil(i.width/2),Math.ceil(i.height/2),1))},r.prototype._getIconSize=function(n,t){return n<8?t?24:14:n<12?t?26:16:n<18?t?28:18:t?34:24},r._starImageTemplateDictionary={},r._polyshapeTemplateDictionary={},r._seasonalTemplateDictionary={},r._printTemplateDictionary={},r._defaultStrokeStyle="rgba(97, 168, 241, 1)",r._defaultFillStyle="rgba(189, 213, 245, .3)",r._defaultLineWidth=6,r}(rt),hu=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return e(t,n),t.prototype.getTemplates=function(r,u){var e=r,o=null,h,c,v,y;if(e&&e.taskDisplayState)if(e.geometryType===1)o=n.prototype.getTemplates.call(this,r,u);else if(e.geometryType===2||e.geometryType===3){var p=e.viewState===1,w=e.viewState===2,s=void 0,l=e,a={strokeStyle:t._defaultStrokeStyle,lineWidth:t._defaultLineWidth,dashes:[]},f=l.polyShapeStyle||a;f.hitTest=1;h=f.strokeStyle+"_"+f.lineWidth+"_"+f.dashes;f.dashes.length===1&&f.dashes[0]===0&&(f.dashes=[]);l.geometryType===3&&(a.fillStyle=t._defaultFillStyle,h=f.fillStyle+"_"+h,f.fillStyle.indexOf("#")===0&&(c=f.fillStyle,f.fillStyle=i._formatString("rgba({0}, {1}, {2}, 0.30)",parseInt(c.slice(1,3),16),parseInt(c.slice(3,5),16),parseInt(c.slice(5),16))));o=[];s=t._polyshapeTemplateDictionary[h];s||(s=new st(f),t._polyshapeTemplateDictionary[h]=s);(p||w)&&(v={strokeStyle:"#000",lineWidth:f.lineWidth+3,dashes:[]},y=new st(v),o.push(y));o.push(s)}return o},t._polyshapeTemplateDictionary={},t._defaultStrokeStyle="rgba(97, 168, 241, 1)",t._defaultFillStyle="rgba(189, 213, 245, .3)",t._defaultLineWidth=6,t}(li),ai=function(r){function f(n,t){var u=r.call(this,n,"CollectionsPoiManager",t)||this;return u._computeBestMapViewOnTaskActivate=!0,u._currentPrimitivesAreCollections=!0,u._newPrimitive=null,u._poiRefresh=i._isCoreConfigSettingEnabled("poiRefresh")&&!i._isMapsSDK(),u}return e(f,r),f.prototype._initialize=function(){this._initialized||r.prototype._initialize.call(this)},f.prototype.mapAllEntities=function(){this._primitives&&this._map.setView(r.prototype._getTargetMapView.call(this))},f.prototype.viewThisPrimitive=function(n){var t=this._getMapViewForPrimitive(n);t&&this._map.setView(t)},f.prototype.setPrimitives=function(i,r){var e=this,f,u,o;i&&(this._initialize(),f=!0,u=i.length&&i[0]instanceof n.CloudGraphDataManager.SimplePoint,this._newPrimitive=null,this._primitives&&this._primitives.length&&(o=!(this._primitives[0]instanceof n.CloudGraphDataManager.FavoritePoint),f=!(o===u),f||u||this._setNewPrimitive(this._primitives,i)),this._primitives=i,this._currentPrimitivesAreCollections=u,this._isDirty=!0,this._primitives.forEach(function(n){n.isHoverEnabled=function(){return!0};n.layer=e._layer;n.taskDisplayState=e._taskDisplayState;n.entity&&!n.entity.changed&&(n.entity.changed=new t);e._updatePrimitiveForLabeling(n);e._setEntityCollisionBehavior(n)}),r&&this.setTaskDisplayState({activationState:1,prominence:1,stackOrder:1,colorIndex:4}),r&&(this._isDirty=!0),this.refreshMap(this._computeBestMapViewOnSetPrimitives&&this._primitives.length&&(f&&u||!u&&!f)))},f.prototype._getTargetMapView=function(){var n;if(this._currentPrimitivesAreCollections)if(this._primitives.length===1){var t=this._primitives[0],i=s.getMapBounds(this._map,!0),f=new a(t.geometry.y,t.geometry.x);n=i.contains(f)?this._map.getView():this._getMapViewForPrimitive(t,u.defaultZoomLevel)}else n=r.prototype._getTargetMapView.call(this);else if(this._newPrimitive)n=this._getMapViewForPrimitive(this._newPrimitive);else return this._map.getView();return n},f.prototype._getLocations=function(){var t=this,n=[];return this._primitives&&this._primitives.forEach(function(i){var r,u,f;1===i.geometryType?(r=i.geometry,n.push(new a(r.y,r.x))):2===i.geometryType?(u=i.geometry,t._addLocationsFromLine(u,n)):3===i.geometryType&&(f=i.geometry,t._addLocationsFromArea(f,n))}),n},f.prototype._updatePrimitiveForLabeling=function(n){if(this._poiRefresh&&n&&n.geometryType===1){var t=n.entity||{},i=t.homeOrWork;n.bucket=f._buckets[i]||f._buckets["default"]}else r.prototype._updatePrimitiveForLabeling.call(this,n)},f.prototype.findBestViewForPrimitivesNotInView=function(n){return this._storeComputedMapView(),this._currentPrimitivesAreCollections?r.prototype.findBestViewForPrimitivesNotInView.call(this,n):n},f.prototype._addLocationsFromLine=function(n,t){for(var i=0;i<n.x.length;i++)t.push(new a(n.y[i],n.x[i]))},f.prototype._addLocationsFromArea=function(n,t){for(var u,i,r=0;r<n.rings.length;r++)for(u=n.rings[r],i=0;i<u.x.length;i++)t.push(new a(u.y[i],u.x[i]))},f.prototype._setNewPrimitive=function(n,t){for(var u,f,r,e,i=0;i<t.length;i++){for(u=t[i],f=!1,r=0;r<n.length;r++)if(e=n[r],u.entity.id===e.entity.id){f=!0;break}if(!f){this._newPrimitive=u;break}}},f.prototype._getMapViewForPrimitive=function(n,t){var i=null,f,r,u;return n&&n.geometryType===1?(t||(t=this._map.getMercatorZoomLevel()),f=h.toLocation(new a(n.geometry.y,n.geometry.x),t,!0),i=new ht(f)):n&&n.geometryType===2?(r=[],this._addLocationsFromLine(n.geometry,r),i=this._map.getMode().getMapViewForLocationsInView(r)):n&&n.geometryType===3&&(u=[],this._addLocationsFromArea(n.geometry,u),i=this._map.getMode().getMapViewForLocationsInView(u)),i},f.prototype.getPrimitives=function(n,t){i._isSmallMapShownOnSerp()?t&&t({primitives:[]}):r.prototype.getPrimitives.call(this,n,t)},f._buckets={"default":"353",home:"1370",work:"1371"},f}(ft),vt=function(n){function r(i,r){var u=n.call(this,i,"DetailsPoiManager",r)||this;return u.contextMenuInvoked=new t,u.poiTapped=new t,u.poiHoverStarted=new t,u.poiHoverStopped=new t,u}return e(r,n),r.prototype._initialize=function(){var t=this;this._initialized||this._isDisposed||(n.prototype._initialize.call(this),this._layer.hasCustomContextMenu=!0,this._events.push(this._map.contextMenuInvoked.add(function(){t.contextMenuInvoked.invoke(null)})))},r.prototype.setPrimitives=function(t,i){this._detailsTaskPrimitive=t[0];this._setDefaultPrimitiveState();n.prototype.setPrimitives.call(this,t,i)},r.prototype.setTaskDisplayState=function(t){n.prototype.setTaskDisplayState.call(this,t);t.prominence&&this._setDefaultPrimitiveState()},r.prototype.setTargetMapView=function(n){n&&n.length===2&&(this.mapViewFromBackend=this._map.getMode().getMapViewForLocationsInView(n))},r.prototype._onPrimitiveTapped=function(t){n.prototype._onPrimitiveTapped.call(this,t);this.poiTapped.invoke()},r.prototype._onPrimitiveHoverStarted=function(t){n.prototype._onPrimitiveHoverStarted.call(this,t);this.poiHoverStarted.invoke(t)},r.prototype._onPrimitiveHoverStopped=function(t){n.prototype._onPrimitiveHoverStopped.call(this,t);this.poiHoverStopped.invoke()},r.prototype.onContextMenuInvoked=function(t){n.prototype.onContextMenuInvoked.call(this,t);t.primitive&&t.primitive.entity&&this.contextMenuInvoked.invoke(t)},r.prototype._getTargetMapView=function(){var f,n,r,t,i;return this.mapViewFromBackend?(n=this._detailsTaskPrimitive,n)?(t=h.fromLocation(this.mapViewFromBackend.cameraLocation,!0),i=h.toLocation(new a(n.geometry.y,n.geometry.x),t,!0),new ht(i)):this.mapViewFromBackend:(n=this._detailsTaskPrimitive,n&&(r=n.entity,t=u.defaultZoomLevel,r&&r.isApproximateLocation?t=u.approximateLocationZoomLevel:bt.getIsSecondColumnDisplayed()&&(t=u.defaultZoomLevel-1),i=h.toLocation(new a(n.geometry.y,n.geometry.x),t,!0),f=new ht(i)),f)},r.prototype.computeBestMapView=function(){var e=null,r=this._detailsTaskPrimitive,c=this._map.getMapType();if(r&&c.id!==f.birdseyeV2){if(this.disableComputingMapViewForFirstTimeLoad)return this.disableComputingMapViewForFirstTimeLoad=!1,e;var t=new a(r.geometry.y,r.geometry.x),l=s.getMapBounds(this._map,!0),v=h.fromLocation(this._map.getView().cameraLocation,!0),y=l.contains(t),o=parseInt(i._getUrlParam(window.location,"animduration")),n=this._getTargetMapView();return o?this.computeBestMapViewWithNewAlgo(o,y,t):this._taskDisplayState.stackOrder>1?(this._originalZoomForChildDetailsTask||(this._originalZoomForChildDetailsTask=h.fromLocation(this._map.getView().cameraLocation,!0)),s.setMapCenter(this._map,n.cameraLocation,this._originalZoomForChildDetailsTask,null,this.getDefaultAnimator(n))):s.getMapBounds(this._map,!1).contains(t)&&v>=u.defaultZoomLevel?s.setMapCenter(this._map,t,null,null,this.getDefaultAnimator(n)):this.mapViewFromBackend?(this._map.setView(n,this.getDefaultAnimator(n)),n):(s.setMapCenter(this._map,n.cameraLocation,h.fromLocation(n.cameraLocation,!0),null,this.getDefaultAnimator(n)),n)}return e},r.prototype.computeBestMapViewWithNewAlgo=function(t,r,u){var f=this._getTargetMapView(),w=this._map.getView(),a=h.fromLocation(f.cameraLocation,!0),e=h.fromLocation(w.cameraLocation,!0),v=3,y=parseInt(i._getUrlParam(window.location,"zoomthreshold")),o,c,l,p;return(y&&(v=y),o=3,c=parseInt(i._getUrlParam(window.location,"distancethreshold")),c&&(o=c),Math.abs(a-e)<=v&&(r||(l=n.prototype.zoomOutWithCurrentContext.call(this,[u],e),l!==null&&(p=h.fromLocation(l.cameraLocation,!0),Math.abs(e-p)<=o))))?s.setMapCenter(this._map,f.cameraLocation,a,null,new ni(t),1):(this._map.setView(f),f)},r.prototype._updatePrimitiveForLabeling=function(n){!n.entity.id&&n.entity.getTitle&&(n.entity.id=n.entity.getTitle());n.viewState!==3&&(n.bucket=n.entity instanceof er?n.entity.usePricePoi?l.pricePoiBucketId:l.bucketIdForSelectedPoi:l.bucketIdForPoi)},r.prototype._updatePrimitiveForOverlay=function(){this._layer&&(this._layer.overlayEvent=0)},r.prototype._setDefaultPrimitiveState=function(){var t=this._detailsTaskPrimitive,i;t&&(t.viewState!==3&&(t.alwaysShowOnMap=!0),i=this._taskDisplayState&&this._taskDisplayState.prominence,i&&(this._isPrimaryProminence()&&t.viewState!==3?n.prototype._setSelectedPrimitive.call(this,t):t.viewState===2&&n.prototype._setSelectedPrimitive.call(this,null),this._primitives&&this._primitives.length!=1||n.prototype.setPrimitives.call(this,[t])))},r._setViewAnimation=null,r}(ft),yt=function(n){function r(i,r,u){var f=n.call(this,i,"ResultsPoiManager",r)||this,e,o;return f.iconOnlyLimit=-1,f.refreshResultsRequired=new t,f.contextMenuInvoked=new t,f._setComputedResultsMapView(),e=u?u.getFocusedStack()?u.getFocusedStack().getForegroundTask():null:null,e&&e.poiManager instanceof vt&&(o=e.getMapPrimitives(),f._prevTaskPrimitive=o&&o.length>0?o[0]:null),f}return e(r,n),r.prototype.dispose=function(){n.prototype.dispose.call(this)},r.prototype._initialize=function(){var t=this;this._initialized||this._isDisposed||(n.prototype._initialize.call(this),this._layer&&this.iconOnlyLimit>-1&&this._layer.setIconOnlyLimit(this.iconOnlyLimit),this._layer.hasCustomContextMenu=!0,this._events.push(this._map.mapPanStarted.add(function(n){return t._waitForFrameRenderedAfterPanStarted(n)})),this._events.push(this._map.mapZoomStarted.add(function(n){return t._waitForFrameRenderedAfterZoomStarted(n)})),this._events.push(this._map.contextMenuInvoked.add(function(){t.contextMenuInvoked.invoke(null)})))},r.prototype.refreshMap=function(t,i){t||this._setComputedResultsMapView();n.prototype.refreshMap.call(this,t,i)},r.prototype._waitForFrameRenderedAfterPanStarted=function(){var n=this;this._map.getFrameManager().frameRendered.addOne(function(){n._hasProminenceForRefreshResults()&&n._hasMapMovedOverThreshold()&&(n._mapviewAfterPanZoom=n._map&&n._map.getView(),window.clearTimeout(n._refreshSlidingTimer),n._refreshSlidingTimer=Microsoft.Maps.setTimeout(function(){n._raiseRefreshRequired()},r.refreshTimeout))})},r.prototype._waitForFrameRenderedAfterZoomStarted=function(){var n=this;this._map.getFrameManager().frameRendered.addOne(function(){n._hasProminenceForRefreshResults()&&(n._mapviewAfterPanZoom=n._map&&n._map.getView(),n._raiseRefreshRequired())})},r.prototype.setPivotPrimitive=function(n){var t,u,i;if(n){if(t=n.entity,n.bucket=r._pivotEntityBucket,n.layer=this._layer,t&&(t.alwaysShowLabel=!0),this._createEntityChangedEvent(n),this._setEntityCollisionBehavior(n),this._updatePrimitiveForOverlay(n,t&&[t.getTitle&&t.getTitle()],this._getPoiToolTipTemplateCssClass()),n.isHoverEnabled=function(){return!0},this._taskDisplayState){u={};for(i in this._taskDisplayState)i&&this._taskDisplayState.hasOwnProperty(i)&&(u[i]=this._taskDisplayState[i]);n.taskDisplayState=u;n.taskDisplayState.colorIndex=4}this._pivotPrimitive=n}else this._pivotPrimitive=null},r.prototype.setPrimitives=function(t,i){t&&n.prototype.setPrimitives.call(this,t,i)},r.prototype.getPrimitives=function(n,t,i,r){var f,u;if(this._taskDisplayState&&this._primitives&&this._primitives.length&&this._primitives[0].entity&&this._primitives[0].entity.usePricePoi&&(f=this._primitives[0].entity.getPrimaryCategoryPath&&this._primitives[0].entity.getPrimaryCategoryPath(),f&&f.toLowerCase().indexOf("house")>-1&&r<9)){t&&t({primitives:[]});return}if(this._pivotPrimitive&&(this._pivotPrimitive.revision=this._primitives&&this._primitives.length&&this._primitives[0].revision?this._primitives[0].revision:(this._pivotPrimitive.revision||0)+1,this._pivotPrimitive.zIndex=1,this._primitives&&this._primitives.length))for(u=0;u<this._primitives.length;u++)this._primitives[u].zIndex=0;t&&t({primitives:this._pivotPrimitive?this._primitives.concat([this._pivotPrimitive]):this._primitives})},r.prototype._storeComputedMapView=function(){var n=this;this._map.viewChanged.addOne(function(){n._setComputedResultsMapView()})},r.prototype.MapViewFromBackendIsSet=function(){this._isMapViewFromBackendJustSet=!0},r.prototype._getTargetMapView=function(){if(this._primitives&&this._primitives.length&&this._primitives[0].entity&&this._primitives[0].entity.usePricePoi){var t=this._primitives[0].entity.getPrimaryCategoryPath&&this._primitives[0].entity.getPrimaryCategoryPath();if(t&&t.toLowerCase().indexOf("house")>-1){if(this._mapviewAfterPanZoom)return this._mapviewAfterPanZoom;if(this.mapViewFromBackend)return this.mapViewFromBackend}else if(i._isHotelsCategory(t)&&this._isMapViewFromBackendJustSet&&this.mapViewFromBackend)return this._isMapViewFromBackendJustSet=!1,this.mapViewFromBackend}return n.prototype._getTargetMapView.call(this)},r.prototype.setMapViewFromBackend=function(n){this.mapViewFromBackend=n},r.prototype.onContextMenuInvoked=function(t){n.prototype.onContextMenuInvoked.call(this,t);t.primitive&&t.primitive.entity&&this.contextMenuInvoked.invoke(t)},r.prototype.computeBestMapView=function(){var i=!1,r=this._map.getMapType(),t;if(this._primitives&&r.id!==f.birdseyeV2)for(t=0;t<this._primitives.length;t++)if(this._primitives[t]&&this._primitives[t].viewState!==3){i=!0;break}if(i){if(this.disableComputingMapViewForFirstTimeLoad)return this.disableComputingMapViewForFirstTimeLoad=!1,null;var e=this._getLocations(),o=this._map.getView(),n=this._getTargetMapView(),c=s.getMapBounds(this._map,!0);return this._storeComputedMapView(),h.fromLocation(n.cameraLocation,!0)>u.defaultZoomLevel?s.setMapCenter(this._map,n.cameraLocation,u.defaultZoomLevel,null,this.getDefaultAnimator(n)):this._map.setView(n,this.getDefaultAnimator(n)),n}return null},r.prototype._setComputedResultsMapView=function(){this._computedResultsMapView=this._map.getView();var n=h.fromLocation(this._computedResultsMapView.cameraLocation,!0);this._lastResultsCoord=ui.locationToPixelXY(this._computedResultsMapView.cameraLocation,n)},r.prototype._hasProminenceForRefreshResults=function(){return this._isPrimaryProminence()||this._isProminenceEqualTo(2)?!this._isMapViewChangedSignificantly():!1},r.prototype._raiseRefreshRequired=function(){this._computeBestMapViewOnSetPrimitives=!1;this.refreshResultsRequired.invoke()},r.prototype._hasMapMovedOverThreshold=function(){var n=this._map.getView(),i=h.fromLocation(n.cameraLocation,!0),t=ui.locationToPixelXY(n.cameraLocation,i),u=Math.pow(this._lastResultsCoord.x-t.x,2)+Math.pow(this._lastResultsCoord.y-t.y,2);return u>r._pixelDistanceThreshold},r.prototype._isMapViewChangedSignificantly=function(){var n=this._map.getView(),t=cr.greatCircleDistance(this._computedResultsMapView.cameraLocation,n.cameraLocation);return t>r._mapViewDistanceThresholdInMeters},r.prototype._canShowOverlay=function(n){return!this._isPrimaryProminence()&&n.viewState===1},r._pivotEntityBucket="353",r._milesToMetersFactor=1609.344,r._mapViewDistanceThresholdInMeters=u.mapViewDistanceThreshold*r._milesToMetersFactor,r.refreshTimeout=u.autoRefreshDelayInMs,r._pixelDistanceThreshold=Math.pow(u.distanceRequiredInPixelsForAutoRefresh,2),r}(ft),cu=function(n){function t(t,i){return n.call(this,t,i)||this}return e(t,n),t.prototype.computeBestMapView=function(){return null},t.prototype.setBestMapView=function(n){var r=this._map.getMapType(),i,t;r.id!==f.birdseyeV2&&n&&n.length&&(i=hr.getLocationsForPrimitivesInView(n),t=this._map.getMode().getMapViewForLocationsInView(i,{left:40,top:30,bottom:30}),n.length===1?s.setMapCenter(this._map,t.cameraLocation,14,null,this.getDefaultAnimator(t)):this._map.setView(t,this.getDefaultAnimator(t)))},t}(yt),kt=function(){function n(n){var t=this;this._map=n;this._map.mapTypeChanged.add(function(n){n.newMapTypeId!==n.oldMapTypeId&&(t._resetTemplateSelector=!0)})}return n.prototype.selectorReady=function(){var n=this;return!this.baseMapTemplateSelector||this._resetTemplateSelector?this._map.getTemplateSelector().then(function(t){return n.baseMapTemplateSelector=t,n._resetTemplateSelector=!1,n.baseMapTemplateSelector.selectorReady()}):this.baseMapTemplateSelector.selectorReady()},n.prototype.getMarkupStyle=function(n,t,i){var e,h,f;if(i===void 0&&(i=1),n&&this.baseMapTemplateSelector){var o=n&&n.entity,u=o,c=u.usePricePoi,s=this._map.getMercatorZoomLevel(),r=void 0;u.getSelectedCategoryForIcon&&(!o.iconText||c)&&(r=u.getSelectedCategoryForIcon(),r||(r=l.extractCategoryId(u.getPrimaryCategoryPath(!0),!0),u.setSelectedCategoryForIcon(r)));h=s>=9&&s<=11&&r&&r.toLowerCase().indexOf("house")>-1;f=this._getPoiState(n,h);e=f&&this.baseMapTemplateSelector.getMarkupStyle(n,t,f,i)}return e},n.prototype._getPoiState=function(n,t){var i=n,r;if(i&&i.taskDisplayState){var f=i.taskDisplayState.prominence,u=i.viewState,e=i.taskDisplayState.cardTitleHoveringState===1;if(u===3)return null;if(e)r=u===2?4:t?5:2;else if(u===1)r=3;else if(u===2||i.alwaysShowOnMap)r=f===1?4:6;else if(u===0||!u)if(f===1)r=t?5:2;else if(f===2)r=5;else return null}return r},n.prototype.getTemplates=function(t){var r=t,f=null,a=r&&r.entity,i=a,o=!!(a.iconText&&a.iconText.length>0),y=i.usePricePoi,p,w,tt,v,k,g,ft,rt;if(i&&i.isPaginationReducedPoi&&(p=this._getReducedPoiTemplates(r),p&&p.length))return p;if(r&&r.taskDisplayState&&this.baseMapTemplateSelector){if(r instanceof pt&&(w=d.getValue(r,"image"),w&&w.records))return[new it(w)];var nt=r.taskDisplayState.prominence,c=r.viewState,et=r.taskDisplayState.cardTitleHoveringState===1,ut=r.taskDisplayState.colorIndex,b=this._map.getMercatorZoomLevel(),e,h,ot=i.getSearchCategory&&i.getSearchCategory();if(i.getSelectedCategoryForIcon&&(!a.iconText||y)&&(h=i.getSelectedCategoryForIcon(),h||(h=l.extractCategoryId(i.getPrimaryCategoryPath(!0),!0),i.setSelectedCategoryForIcon(h))),tt=h&&h.toLowerCase().indexOf("house")>-1,v=b>=9&&b<=11&&tt,c===3)return f;if(et)e=c===2?4:v?5:2;else if(c===1)e=3;else if(c===2||r.alwaysShowOnMap)e=nt===1?4:6;else if(c===0||!c)if(nt===1)e=v?5:2;else if(nt===2)e=5;else return f;if(k=i.renderBranded&&i.getBrand&&i.getBrand(),k&&k.length)return this.baseMapTemplateSelector.getBrandTemplates(k,s._getColorMapping(ut),e,b);g=void 0;g=y&&!v?2:a.poiType||1;o=o&&!v;y||e!==4&&e!==6||(o=!1);o&&g===2&&(e===5||e===6)&&!tt&&(o=!1);f=this.baseMapTemplateSelector.getPoiVectorImageTemplate(h,s._getColorMapping(ut),e,b,g,o,ot,t.bucket);u.showPoiBadges&&f&&f[0]&&(ft=i.badgeType,rt=n._poiBadgeImages[ft],rt&&f.push(new tr(f[0],rt,2,0,{x:-2,y:3},.875)))}return o&&!y&&(f=f.concat(l.getPushpinTextTemplates(f[f.length-1],null,null,null))),f},n.prototype._getReducedPoiTemplates=function(t){var c=null,r,s,u,e,a;if(t&&(t.taskDisplayState&&t.taskDisplayState.prominence===1||t.entity&&t.entity.poiType===3)&&(r=t.taskDisplayState.colorIndex,r>=1&&r<=3)){s=!1;switch(this._map.getMapType().id){case f.aerial:case f.symbolicNight:s=!0}u=s?n.MicroPoiAerialColors[r]:n.MicroPoiColors[r];i._isCoreConfigSettingEnabled("poiRefresh")&&t.entity&&(e=t.entity,t.entity.poiType===3?u=n.ItineraryPoiColor:e&&e.isPaginationReducedPoi&&e.iconColorFromCard&&(u=e.iconColorFromCard));var h=t.entity&&t.entity.isPaginationReducedPoi?n._poiRadius+1:n._poiRadius,l=u+","+h,o=n._microPoiTemplateDictionary[l];o||(a={centerX:0,centerY:0,radiusX:h,radiusY:h,vectorType:2,style:{fillStyle:u}},o=new it({records:[a],hotspotX:0,hotspotY:0,hitTest:1}),n._microPoiTemplateDictionary[l]=o);c=[o]}return c},n.MicroPoiColors=["#4379bc","#AC2290","#00AAB1","#008300","#f9a11b"],n.MicroPoiAerialColors=["#4379bc","#D542C1","#009AAB","#4EB671","#f9a11b"],n.ItineraryPoiColor="#008272",n._microPoiTemplateDictionary={},n._poiRadius=4,n._poiBadgeImages=[null,{records:[{vectorType:2,centerX:8,centerY:8,radiusX:7.5,radiusY:7.5,style:{fillStyle:"#de3700",lineWidth:1,strokeStyle:"#fff"}},{vectorType:4,pathData:"M9.108 5.882C 8.609 5.383 8.331 4.705 8.335 4c -0.094 0.036 -0.184 0.078 -0.272 0.127 -1.033 0.606 -1.379 1.934 -0.774 2.967l.125 .211c 0.29 0.37 0.225 0.905 -0.145 1.195 -0.37 0.29 -0.905 0.225 -1.195 -0.145l-.709 -.785c -0.739 1.359 -0.324 3.057 0.958 3.921 1.283 0.865 3.012 0.612 3.995 -0.583 0.982 -1.195 0.895 -2.941 -0.202 -4.032l-1.008 -.995z",style:{fillStyle:"#fff"}}]},{records:[{vectorType:2,centerX:8,centerY:8,radiusX:7.5,radiusY:7.5,style:{fillStyle:"#006d21",lineWidth:1,strokeStyle:"#fff"}},{vectorType:4,pathData:"M12 6.5l-1-1.49-2.125 1.424V4h-1.75v2.434L5 5 4 6.5 6.331 8 4 9.5 5 11l2.125-1.434V12h1.75V9.566L11 11l1-1.5L9.669 8z",style:{fillStyle:"#fff"}}]}],n}(),lu=function(n){function t(t){return n.call(this,t)||this}return e(t,n),t.prototype.getTemplates=function(t,r){var u=t,f=t&&t.entity,e,o;return(f||null,t.entity.poiType=3,i._isCoreConfigSettingEnabled("poiRefresh")&&!f.isActiveDay&&u.taskDisplayState.prominence!==1)?[]:u.taskDisplayState&&(!i._isCoreConfigSettingEnabled("poiRefresh")&&u.taskDisplayState.prominence!==1||!f.isActiveDay)?this._getReducedPoiTemplates(u):(!i._isCoreConfigSettingEnabled("poiRefresh")&&u.taskDisplayState&&u.taskDisplayState.prominence===2&&(e=f.iconText,f.iconText=null),o=n.prototype.getTemplates.call(this,t,r),e&&(f.iconText=e),o)},t}(kt),au=function(n){function i(r,u,f){var e=n.call(this,r,"MicroPoiManager",f)||this;return e._clusterId=100,e.spatialIndex=i._pyramidSpatialIndex,e._microPoiSelector=f,e._microPoiClusterDictionary={},e._microPoiRequestProcessor=new pi(r),e._retrieveFromCacheOnly=!0,e.zoomChangedOnClusterSelect=new t,e._microPoiPerfLogger=new vu(e._microPoiRequestProcessor,e,u),e}return e(i,n),i.prototype.fetchMicroPois=function(n,t,r,u,f,e){r===void 0&&(r=null);this._isPrimaryProminence()&&(this._microPoiClusterDictionary={},this._query=n,this._localFilters=r,this._resultYpids=i._getYpids(t),this._retrieveFromCacheOnly=!1,this._isDirty=!0,this._listChainId=u,this._listCatId=f,this._microPoiSelector.setCategoryId(e?e:f),this.refreshMap())},i.prototype.getPrimitives=function(n,t,i,r,u){var f=this;this._shouldRefreshMicroPoiResults()&&this._query?this._microPoiRequestProcessor.getMicroPois(this._query,n,this._retrieveFromCacheOnly,function(n){var i,r,e;f._buildMicroPoiCluster(n);i=f._updateMicroPoisTaskState(n);u&&(r=new nr,r.accumulate(u.bounds,u.crs),e=r.getBounds(),e.buffer(),i=i.filter(function(n){return e.contains(new a(n.geometry.y,n.geometry.x))}));t({primitives:i})},this._listChainId,this._listCatId):t({primitives:[]})},i.prototype.setPrimitives=function(){},i.prototype.getDataUniquenessKey=function(n){return n.quadKey},i.prototype._isDataDefined=function(){return typeof this._query!="undefined"},i.prototype.setTaskDisplayState=function(n){this._isDirty=typeof n.prominence!="undefined"&&this._taskDisplayState&&this._taskDisplayState.prominence!==n.prominence;this._taskDisplayState=this._taskDisplayState||{};d.mergeProperties(this._taskDisplayState,n)},i.prototype.dispose=function(){n.prototype.dispose.call(this);this._microPoiClusterDictionary=null;this._microPoiRequestProcessor.dispose();this._microPoiPerfLogger&&this._microPoiPerfLogger.dispose()},i.prototype._onPrimitiveHoverStarted=function(n){n.primitive&&this._updateMicroPoiHoverState(n.primitive,1)},i.prototype._initialize=function(){var t=this;this._initialized||this._isDisposed||(n.prototype._initialize.call(this),this._layer.setRenderTarget(0),this._events.push(this._map.mapPanStarted.add(function(){t._retrieveFromCacheOnly=!0})),this._events.push(this._map.mapZoomStarted.add(function(){t._retrieveFromCacheOnly=!0})))},i.prototype._addLayerToMap=function(t){t.setZIndex(ot.primaryProminenceZOrder-1);t.hitTestingGraceRadius=9;n.prototype._addLayerToMap.call(this,t)},i.prototype._onPrimitiveHoverStopped=function(n){n.primitive&&this._updateMicroPoiHoverState(n.primitive,0)},i.prototype._setSelectedPrimitive=function(t){var i=this,u,r,f;t&&(u=this._microPoiClusterDictionary[t.clusterId],u.isSingle?n.prototype._setSelectedPrimitive.call(this,t):(r=s.getMercatorZoomLevel(this._map),f=new a(t.geometry.y,t.geometry.x),this._map.constrainView.addOne(function(u){var f=h.fromLocation(u.view.cameraLocation,!0);f===r?n.prototype._setSelectedPrimitive.call(i,t):(i._retrieveFromCacheOnly=!0,i.zoomChangedOnClusterSelect.invoke())}),s.setMapCenter(this._map,f,r+2)))},i.prototype._resetHoveredPoi=function(n){this._updateMicroPoiHoverState(n.primitive,0)},i.prototype._buildMicroPoiCluster=function(n){var i,u,t,f,r,e;if(n&&n.length>0)for(i=0,u=n.length;i<u;i++)if(t=n[i],t.primitives&&t.primitives.length>0){if(f=t.primitives[0].clusterId,this._microPoiClusterDictionary[f])continue;for(this._microPoiClusterDictionary[this._clusterId]=t,r=0,e=n[i].primitives.length;r<e;r++)t.primitives[r].clusterId=this._clusterId;this._clusterId++}},i.prototype._shouldRefreshMicroPoiResults=function(){var n=this._taskDisplayState&&this._taskDisplayState.prominence;return n===1&&!this._taskDisplayState.isAutoFocused&&!this._localFilters?!0:!1},i.prototype._updateMicroPoiHoverState=function(n,t){var i,f;this.poiViewStateChanged.invoke(new oi(this,n,n.viewState,t));var u=this._microPoiClusterDictionary[n.clusterId],r=u&&u.primitives,e=t===1?2:0;if(r){for(i=0,f=r.length;i<f;i++)r[i].viewState=t,r[i].zIndex=e;n.entity.changed.invoke()}},i.prototype._updateMicroPoisTaskState=function(n){var i=this,r=[],u=this._getPoiToolTipTemplateCssClass(),f=function(){return!0};return n.forEach(function(n){n.primitives.forEach(function(e){e.isHoverEnabled=f;e.isMicroPoi=!0;e.taskDisplayState=i._taskDisplayState;e.layer=i._layer;var o=e.entity;o.changed||(o.changed=new t);i._updatePrimitiveForOverlay(e,n.titles,u);i._layer.overlayEvent=0;e.entity.id&&i._resultYpids.indexOf(e.entity.id)!==-1||r.push(e)})}),r},i._getYpids=function(n){var t=[];return n.forEach(function(n){t.push(n.entity.id)}),t},i.prototype._canShowOverlay=function(n){return n.viewState===1},i._pyramidSpatialIndex=new yr(2),i}(ft),vu=function(){function n(t,i,r){var u=this;this._micropoiNetworkLatencyPerfState={};this._micropoiRenderingPerfState={};this._disposables=[];this._disposables.push(t.networkRequestStart.add(function(t){u._micropoiNetworkLatencyPerfState[t]=r.start(n._perfKeyForMicroPoiNetworkLatency)}));this._disposables.push(t.networkResponseReceived.add(function(t){u._micropoiNetworkLatencyPerfState[t].end(t);delete u._micropoiNetworkLatencyPerfState[t];u._micropoiRenderingPerfState[t]=r.start(n._perfKeyForMicroPoiRenderingLatency);i.primitivesRendered.addOne(function(){u._micropoiRenderingPerfState[t].end(t);delete u._micropoiRenderingPerfState[t]})}))}return n.prototype.dispose=function(){this._disposables.forEach(function(n){n.dispose();n=null});this._disposables=[];this._micropoiNetworkLatencyPerfState={};this._micropoiRenderingPerfState={}},n._perfKeyForMicroPoiNetworkLatency="MNT",n._perfKeyForMicroPoiRenderingLatency="MRT",n}(),vi=function(){function n(n,i){this.id=n;this.collisionBehavior=1;i&&(this._title=i);this.changed=new t}return n.prototype.getTitle=function(){return this._title},n}(),yi=function(){function n(n){this.microPoiClusters=n}return n.prototype.dispose=function(){this.microPoiClusters=[]},n}(),pi=function(){function r(n){this._map=n;this._microPoiDictionary=new sr(16);this._pendingQuadKeyRequests={};this.networkRequestStart=new t;this.networkResponseReceived=new t}return r.prototype.getMicroPois=function(n,t,i,r,u,f){var o=t.quadKey,e=o,s,h,c,l;i?(s=[],h=this._microPoiDictionary.getInternalDictionary(),Object.keys(h).forEach(function(n){(n.indexOf(o)===0||o.indexOf(n)===0)&&Array.prototype.push.apply(s,h[n].item.microPoiClusters)}),r&&r(s)):this._pendingQuadKeyRequests[e]?this._pendingQuadKeyRequests[e].push(r):(c=this._microPoiDictionary.getItem(e),l=c?c.microPoiClusters:null,l?r&&r(l):(this._pendingQuadKeyRequests[e]=[],this._pendingQuadKeyRequests[e].push(r),this._sendMicroPoiRequest(n,e,u,f)))},r.prototype.dispose=function(){this._microPoiDictionary.clear();this._pendingQuadKeyRequests={}},r.prototype._sendMicroPoiRequest=function(t,r,f,e){var o=this,s,h;f=f?f:"";e=e?e:"";s=u.newMicroPoiEnabled?u.newMicroPoiRequestUrlFormat:u.microPoiRequestUrlFormat;h=n.GlobalConfig;s=s.replace("{quadkey}",r).replace("{query}",t).replace("{subdomain}",i._getTileSubDomain(r)).replace("{appid}",h.dynamicProperties.appId).replace("{chainId}",f).replace("{categoryId}",e);this.networkRequestStart.invoke(r);u.newMicroPoiEnabled?fi.downloadJson(s,"micropoi",function(n){var i,u,f;if(o.networkResponseReceived.invoke(r),i=null,o._pendingQuadKeyRequests&&o._pendingQuadKeyRequests[r]&&(i=o._pendingQuadKeyRequests[r],delete o._pendingQuadKeyRequests[r]),u=[],n&&n.results)for(f=0;f<n.results.length;f++){var t=n.results[f],e=t.name,s=new vi("ypid:"+t.id,t.name),h=new pt(new a(t.geo.latitude,t.geo.longitude),s);u.push({titles:[e],isSingle:!0,primitives:[h]})}o._microPoiDictionary.addItem(r,new yi(u));i&&i.forEach(function(n){n&&n(u)})},function(){o._pendingQuadKeyRequests&&delete o._pendingQuadKeyRequests[r]},null,!1,null,!1):fi.downloadJsonp(s,"micropoi",function(n){var s,c,v,e,u,y;if(o.networkResponseReceived.invoke(r),s=null,o._pendingQuadKeyRequests&&o._pendingQuadKeyRequests[r]&&(s=o._pendingQuadKeyRequests[r],delete o._pendingQuadKeyRequests[r]),n&&n.hrs){var t=null,h=null,i=null,l=[],f=!1;for(c=0,v=n.hrs.length;c<v;c++)if(t=n.hrs[c],i=null,e=[],f=!0,t&&t.brs){for(i=[],t.type==="mpcluster"?(e=t.names.toString().split(",").slice(0,5),t.brs.length>5&&e.push("..."),f=!1):e.push(t.name),u=0,y=t.brs.length;u<y;u++)if(h=t.brs[u],h){var w=new a(h.y,h.x),b=f?t.ypid:t.ypids[u],k=f?t.name:t.names[u],d=new vi("ypid:"+b,k),p=new pt(w,d);p.isHoverEnabled=function(){return!0};i.push(p)}i&&i.length>0&&l.push({titles:e,isSingle:f,primitives:i})}o._microPoiDictionary.addItem(r,new yi(l));s&&s.forEach(function(n){n&&n(l)})}},function(){o._pendingQuadKeyRequests&&delete o._pendingQuadKeyRequests[r]})},r}(),yu=function(n){function t(t){var r=n.call(this,t)||this;return r._poiRefresh=t.getConfig().poiRefresh&&!i._isMapsSDK(),r}return e(t,n),t.prototype.setCategoryId=function(n){n!==this._localCatId&&(this._localCatId=n,this._resetSelector=!0)},t.prototype.selectorReady=function(){var t=this;return(!this._ready||this._resetSelector)&&(this._ready=this._poiRefresh?new Promise(function(n){t._map.getTemplateSelector().then(function(i){i.selectorReady().then(function(){i.getCategoryIconTemplate(function(i,r){t._fillColor=r;n(t)},t._localCatId)})})}):n.prototype.selectorReady.call(this),this._resetSelector=!1),this._ready},t.prototype.getTemplates=function(n){var i=n,e=null,o,r;if(i&&i.taskDisplayState&&i.taskDisplayState.prominence===1){o=!1;switch(this._map.getMapType().id){case f.aerial:case f.symbolicNight:o=!0}if(r=this._getFillStyle(n,o),!r)return e;var s=Math.round(this._map.getMercatorZoomLevel()),h=this._getRadius(i,s),c=this._getBorderSize(i,s),a=this._getInnerBorderFillStyle(n),l=r+","+c+","+h+","+a,u=t._microPoiTemplateDictionary[l];u||(u=new it(this._getVectorImage(r,r,c,h)),t._microPoiTemplateDictionary[l]=u);e=[u]}return e},t.prototype._getFillStyle=function(n,i){var u,r;if(this._poiRefresh)u=this._fillColor;else if(r=n.taskDisplayState&&n.taskDisplayState.colorIndex,r>=1&&r<=3&&(u=this._map.getMapType().id===f.symbolicWinter?t.MicroPoiWinterColors[r]:i?t.MicroPoiAerialColors[r]:t.MicroPoiColors[r],!n.viewState||n.viewState!==1))return g._convertToRGBA(u,t._defaultAlphaValueForMicropois);return u},t.prototype._getRadius=function(){return t._poiRadius},t.prototype._getBorderSize=function(){return t._borderSize},t.MicroPoiColors=["#4379bc","#cc7fbc","#78cec8","#65b765","#f9a11b"],t.MicroPoiAerialColors=["#4379bc","#b252ae","#229499","#449158","#f9a11b"],t.MicroPoiWinterColors=["#4379bc","#e59dbe","#a3a8e8","#83c2cd","#f9a11b"],t._microPoiTemplateDictionary={},t._poiRadius=3,t._borderSize=0,t._defaultAlphaValueForMicropois=204,t}(rt),pu=function(n){function i(i,r){var u=n.call(this,i,r)||this;return u.poiTapped=new t,u}return e(i,n),i.prototype._initialize=function(){this._isDisposed||(n.prototype._initialize.call(this),this._layer.hasCustomContextMenu=!1)},i.prototype._onPrimitiveTapped=function(n){this._resetHoveredPoi(n);this.poiTapped.invoke(n)},i}(yt),wi=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return e(t,n),t.prototype.getPrimitives=function(n,t){var i=this,r;if(!this._canShowPrimitives()){t&&t({primitives:[]});return}r=this._upcomingMapView?Math.floor(h.fromLocation(this._upcomingMapView.cameraLocation,!0)):this._map.getMercatorZoomLevel();w.tileRefactoringEnabled&&this._useBoundaryDataSource?this._boundaryPolygons||this._noBoundaryData?t&&t({primitives:this._primitives&&this._canShowPrimitives()?this._noBoundaryData?this._primitives:this._boundaryPolygons.primitives:[]}):this._map.getContainer().instanceAsync("GeoDataAPIManager",function(){Microsoft.Maps.SpatialDataService.GeoDataAPIManager.getEntityDetails(i._entityVDPId,{lod:1,getEntityMetadata:!1,entityType:null},i._map.getAuthKey(),function(n){i._boundaryPolygons={primitives:n.results&&n.results.length>0&&n.results[0]?n.results[0].Polygons:[]};i._boundaryPolygons.primitives.length===0&&(i._noBoundaryData=!0);i._boundaryPolygons.primitives.forEach(function(n){n.bucket=l.cityPolygonBucket;n.taskDisplayState=i._primitives[0].taskDisplayState;n.viewState=i._primitives[0].viewState});i._boundaryPolygons.primitives=i._boundaryPolygons.primitives.concat(i._primitives.slice(1));i._updateDisplayProperties();t&&t({primitives:i._primitives&&i._canShowPrimitives()?i._noBoundaryData||!i._useBoundaryDataSource?i._primitives:i._boundaryPolygons.primitives:[]})},null,function(){i._noBoundaryData=!0;t&&t({primitives:i._primitives})})}):this._useBoundaryDataSource&&!this._noBoundaryData&&n?this._boundaryDataSource.getPrimitives(n,function(n){i._primitives&&i._canShowPrimitives()?(n.primitives.forEach(function(n){n.taskDisplayState=i._primitives[0].taskDisplayState;n.viewState=i._primitives[0].viewState}),n.primitives=n.primitives.concat(i._primitives.slice(1)),t&&t(n)):t&&t({primitives:[]})},this._map.getConfig().cityPolygonLayerId,r):t&&t({primitives:this._primitives})},t.prototype.dispose=function(){this._primitives=null;this._boundaryPolygons=null;this._boundaryDataSource=null;n.prototype.dispose.call(this)},t.prototype.setPrimitives=function(t,i){var r=this,u;this._boundaryDataSource?n.prototype.setPrimitives.call(this,t,i):(this._entityVDPId=t[0].entity.getVdpId(),w.tileRefactoringEnabled?(this._useBoundaryDataSource=!0,this._initialize(),n.prototype.setPrimitives.call(this,t,i)):(u=this._map.getConfig().cityPolygonUrlFormat.replace("{entityId}",this._entityVDPId),this._map.getContainer().instanceAsync("LandmarksDataSource",function(u){r._boundaryDataSource=u.getLayerDataSource(r._map.getConfig().cityPolygonVectorLayerId);r._useBoundaryDataSource=!0;r.spatialIndex=r._boundaryDataSource.spatialIndex;r._initialize();n.prototype.setPrimitives.call(r,t,i)},{vectorTileUrlFormat:u,landmarksMinZoom:this._minZoomLevel,landmarksMaxZoom:this._maxZoomLevel,useSheetBasedLandmarks:!0,landmarksVectorLayerId:this._entityVDPId,landmarksDataSourceLayersOfInterest:this._map.getConfig().cityPolygonDataSourceLayersOfInterest,jsonsoSuffix:this._entityVDPId})))},t.prototype.setTargetMapView=function(r){if(n.prototype.setTargetMapView.call(this,r),!this.mapViewFromBackend){this._noBoundaryData=!0;this._alwaysShowPoi();return}if(i._isFeatureEnabled("verticalZipcode"))this._backendZoomLevel=this._backendZoomLevel||this._getBackendZoomLevel();else if(this._backendZoomLevel=Math.floor(h.fromLocation(this.mapViewFromBackend.cameraLocation,!0)),this._backendZoomLevel>t._maxZoomLevelForPolygonData){this._noBoundaryData=!0;this._alwaysShowPoi();return}this._maxZoomLevel=Math.min(this._backendZoomLevel+t._zoomInThreshold,t._maxZoomLevelForPolygonData);this._minZoomLevel=Math.min(this._backendZoomLevel-t._zoomOutThreshold,t._maxZoomLevelForPolygonData)},t.prototype.setTaskDisplayState=function(t){var i=this;t&&t.prominence&&this._primitives&&this._primitives.length&&this._isPrimaryProminence()&&n.prototype._setSelectedPrimitive.call(this,this._primitives[0],t.prominence?!0:!1);n.prototype.setTaskDisplayState.call(this,t);t&&t.cardTitleHoveringState===1&&this._primitives&&this._primitives.length?(this._primitives[0].viewState=2,this._primitives[0].bucket=l.bucketIdForSelectedPoi):t&&t.cardTitleHoveringState===2&&this._primitives&&this._primitives.length?(this._primitives[0].viewState=3,delete this._primitives[0].bucket):t&&t.prominence&&this._checkDataLoadedOnceOnSettingProminence&&(this._checkDataLoadedOnceOnSettingProminence=!1,this._events.push(this._layer.getFrameManager().dataLoaded.addOne(function(n){return i._onDataLoaded(n)})))},t.prototype.computeBestMapView=function(n){var t;if(!this._canChangeMapView()&&!n)return null;if(t=this._canShowPrimitives(),this.mapViewFromBackend&&t){if(this.disableComputingMapViewForFirstTimeLoad)return this.disableComputingMapViewForFirstTimeLoad=!1,null;this._noBoundaryData?this._alwaysShowPoi():(this._primitives&&(this._primitives[0].alwaysShowOnMap=!1,this._primitives[0].viewState=3,delete this._primitives[0].bucket),this._useBoundaryDataSource=!0,this.spatialIndex=this._boundaryDataSource&&this._boundaryDataSource.spatialIndex);var r=this._map.getBounds(!0,this.mapViewFromBackend),f=this._map.getBounds(!0),o=!r.contains(this._map.getView().cameraLocation)&&!(f.contains(r.getNorthwest())&&f.contains(r.getSoutheast())),e=this._getTargetMapView();return this._backendZoomLevel=i._isFeatureEnabled("verticalZipcode")?this._backendZoomLevel||this._getBackendZoomLevel():Math.floor(h.fromLocation(this.mapViewFromBackend.cameraLocation,!0)),s.setMapCenter(this._map,e.cameraLocation,this._backendZoomLevel,null,this.getDefaultAnimator(e))}return t&&this._primitives?(this._alwaysShowPoi(),s.setMapCenter(this._map,this._primitives[0].entity.getLocation(),u.defaultZoomLevel)):null},t.prototype.onContextMenuInvoked=function(){},t.prototype._initialize=function(){var t=this;this._initialized||(n.prototype._initialize.call(this),this._events.push(this._map.mapZoomStopped.add(function(){return t._updateDisplayProperties()})),this._events.push(this._layer.getFrameManager().dataLoaded.addOne(function(n){return t._onDataLoaded(n)})),this._events.push(this.mapViewChanged.add(function(n){return t._onPoiManagerMapViewChanged(n)})),this._events.push(this._map.viewChanged.add(function(n){return t._onMapViewChanged(n)})))},t.prototype._updateDisplayProperties=function(){if(!this._noBoundaryData){var n=this._map.getMercatorZoomLevel();this._canShowPrimitives()?(n<this._minZoomLevel?(this._primitives[0].viewState=2,this._primitives[0].bucket=l.bucketIdForSelectedPoi,this._useBoundaryDataSource=!1,this.spatialIndex=null):n<=this._maxZoomLevel&&n>=this._minZoomLevel?(this._primitives[0].viewState=3,delete this._primitives[0].bucket,this._useBoundaryDataSource=!0,this.spatialIndex=this._boundaryDataSource&&this._boundaryDataSource.spatialIndex):(this._primitives[0].viewState=3,delete this._primitives[0].bucket,this._useBoundaryDataSource=!1,this.spatialIndex=null),this._primitives[0].revision=(this._primitives[0].revision||0)+1,this.invalidated.invoke()):this._useBoundaryDataSource=n<=this._maxZoomLevel&&n>=this._minZoomLevel?!0:!1}},t.prototype._onDataLoaded=function(){var n,t,i,r,u;if(!this._canShowPrimitives()){this._checkDataLoadedOnceOnSettingProminence=!0;return}if(w.tileRefactoringEnabled){if(this._boundaryPolygons&&this._boundaryPolygons.primitives.length>0)return}else for(t=0,i=this._layer.data.length;t<i;t++)if(n=this._layer.data[t],n.primitives&&n.primitives.length>0&&n.primitives[0].geometry.rings&&n.primitives[0].geometry.rings.length>0)return;r=this._map.getBounds(!0);u=this._map.getBounds(!0,this.mapViewFromBackend);r.intersects(u)&&!this._upcomingMapView&&(this._noBoundaryData=!0,this._alwaysShowPoi())},t.prototype._alwaysShowPoi=function(){this._useBoundaryDataSource=!1;this.spatialIndex=null;this._primitives&&(this._primitives[0].viewState=2,this._primitives[0].bucket=l.bucketIdForSelectedPoi,this._primitives[0].revision=(this._primitives[0].revision||0)+1,this.invalidated.invoke())},t.prototype._canShowPrimitives=function(){return this._taskDisplayState&&(this._taskDisplayState.prominence===1||this._taskDisplayState.prominence===2||this._taskDisplayState.cardTitleHoveringState===1)},t.prototype._canChangeMapView=function(){var n=this._map.getMapType();return this._taskDisplayState&&this._taskDisplayState.activationState===1&&n.id!==f.birdseyeV2},t.prototype._getCornerForLocationInMapView=function(n,t){var f=this._map.getViewport(),i=this._map.getViewportPadding(),o=f.pixelWidth-i.left-i.right,s=f.pixelHeight-i.top-i.bottom,e=this._map.getMode().tryLocationToPoint(n,t),r=e.x-i.left>o/2,u=e.y-i.top<s/2;return u&&r?1:u&&!r?0:!u&&r?3:2},t.prototype._getBackendZoomLevel=function(){var i=this,n=null;return this.mapViewFromBackend&&(n=Math.floor(h.fromLocation(this.mapViewFromBackend.cameraLocation,!0)),n>t._maxZoomLevelForPolygonData&&(n=t._maxZoomLevelForPolygonData,this.mapViewChanged.addOne(function(){if(i._primitives){var n=i._primitives[0].entity,t={logData:{feature:b.BaseMapData,action:p.Warning,data:{title:n&&n._title,type:n&&n._locationType}}};y.invokeHandler(v.instrumentationDataHandlerKey,t)}}))),n},t.prototype._onPoiManagerMapViewChanged=function(n){this._upcomingMapView=n},t.prototype._onMapViewChanged=function(){this._upcomingMapView=null},t._maxZoomLevelForPolygonData=14,t._zoomInThreshold=2,t._zoomOutThreshold=2,t}(vt),bi=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return e(t,n),t.prototype._createLayer=function(n){this._layer=new Microsoft.Maps.Layer(n,new Microsoft.Maps.Internal.SDKPrimitiveTemplateSelector(this._map),ot.foregroundZOrder)},t.prototype._setPrimitiveLayer=function(){for(var t,s,r=this,n=[],i=0,u=this._primitives;i<u.length;i++)t=u[i],t.geometryType!==1||t.metadata.polygon||n.push(t);this._layer.metadata?this._layer.metadata.pushpinPostCodes=n:this._layer.metadata={pushpinPostCodes:n};var f=this._map.getMercatorZoomLevel(),e=this._map.getConfig(),o=e.postCodeMinPushpinZoom;f<o&&n.forEach(function(n){var t=r._primitives.indexOf(n);t>=0&&r._primitives.splice(t,1)});s=Microsoft.Maps.Layer;this._primitives&&this._layer&&this._layer.add(this._primitives)},t.prototype._updatePrimitivesAndLayerData=function(t,i){n.prototype._updatePrimitivesAndLayerData.call(this,t,i,!1)},t.prototype._onPrimitiveHoverStarted=function(){return null},t.prototype._getLocations=function(){var n=[];return this._primitives&&this._primitives.forEach(function(t){var i,r;t.geometryType===3?(i=or.fromShapes(t),n.push(i.getSoutheast()),n.push(i.getNorthwest())):t.geometryType===1&&(r=t.geometry,n.push(new a(r.y,r.x)))}),n},t}(yt),wu=function(n){function t(t,i){var r=n.call(this,t,i)||this;return r._computeBestMapViewOnDisplayStateChange=!1,r}return e(t,n),t.prototype._initialize=function(){n.prototype._initialize.call(this);this._layer.hasCustomContextMenu=!1},t.prototype.computeBestMapView=function(){if(this._taskDisplayState.activationState===1)return n.prototype.computeBestMapView.call(this)},t}(vt),bu=function(n){function t(t){return n.call(this,t)||this}return e(t,n),t.prototype.getTemplates=function(t,i){var r=t,u=null,e;if(r&&r.taskDisplayState&&this.baseMapTemplateSelector){var o=r.viewState,s=r.taskDisplayState.colorIndex,f=r.taskDisplayState.prominence;if(f!==1&&f!==2&&r.taskDisplayState.cardTitleHoveringState!==1)return u;if(r.bucket===l.cityPolygonBucket||r.bucket===l.xsrPolygonBucketId)e=f===1||r.taskDisplayState.cardTitleHoveringState===1?2:5,u=this.baseMapTemplateSelector.getCityPolygonTemplates(r.bucket,s-1,e,i);else{if(o===3)return u;u=n.prototype.getTemplates.call(this,t,i)}}return u},t}(kt),ot=function(){function n(){}return n.getZOrderOfTaskPrimitives=function(t){var i;return t&&(t.cardTitleHoveringState===1?i=n.cardHoverZOrder:t.activationState===1?i=n.foregroundZOrder:t.prominence===1?i=n.primaryProminenceZOrder:t.prominence===2?i=n._secondaryProminenceZOrder:t.prominence===3&&(i=n._tertiaryProminenceZOrder),t.stackOrder&&i&&(i+=t.stackOrder)),i},n.cardHoverZOrder=8900,n.foregroundZOrder=8700,n.primaryProminenceZOrder=8500,n._secondaryProminenceZOrder=8300,n._tertiaryProminenceZOrder=8100,n}(),ku=function(n){function t(t,i,r,u,f){var e=n.call(this,t,i,f)||this,h,o,s,c;for(e._taskManager=r,e._container=u,e._currentSelectionControlBindings=[],e._disposables=[],e._disabledStackCollection={},e._disposables.push(f.changed.add(function(n){var t,i;if(e._currentSelectionControl&&n.added&&n.added.length>0)for(t=0;t<n.added.length;t++)if(e._disabledStackCollection[n.added[t].id]===undefined){i=n.added[n.added.length-1];i&&i.getForegroundTask()&&e._taskManager.focusTask(i.getForegroundTask().id);e._exitSelectionMode();break}})),h=r.getStacks(),o=0;o<h.length;o++)s=h[o],e._disposables.push(s.stackSelected.add(function(n){var t=n.stack;e._disabledStackCollection[t.id]||(n.isSelected?e.enableStack(t):e.disableStack(t),e._currentSelectionControl&&e._currentSelectionControl.onSelectionChanged(t.getForegroundTask().id,n.isSelected))})),c=s.getForegroundTask(),e._disabledStackCollection[s.id]=!(c.isSharable&&c.isSharable());return e}return e(t,n),t.prototype.getSelectionControl=function(){return this._currentSelectionControl},t.prototype.setSelectionControl=function(n){var t=this;n&&(this._disposeCurrentSelectionControl(),this._currentSelectionControl=n,n.setInitialData({container:this._container}),this._currentSelectionControlBindings.push(n.controlUpdated.add(function(n){switch(n.state){default:t._changeStacksLockStatus(!0);break;case 2:case 0:t._changeStacksLockStatus(!1)}})))},t.prototype._exitSelectionMode=function(){this._disposeCurrentSelectionControl();y.invokeHandler(v.shareDataHandlerKey,{action:"closeShare"})},t.prototype.getSelectionModeControlName=function(){return"SharePanel"},t.prototype.dispose=function(){n.prototype.dispose.call(this);for(var t=0;t<this._disposables.length;t++)this._disposables[t]&&this._disposables[t].dispose();this._disposeCurrentSelectionControl()},t.prototype._changeStacksLockStatus=function(n){var r=this.stacks,t,i;for((this.stacks==null||this.stacks.length==0)&&(r=this._taskManager.getStacks()),t=0;t<this.stacks.length;t++)i=this.stacks[t],this._disabledStackCollection[i.id]||i.setIsLocked(n)},t.prototype.enableStack=function(n){this._taskManager.focusTask(n.getForegroundTask().id)},t.prototype.disableStack=function(n){var u,f,i,r,t,e;if(n.displayState.activationState=4,u=this._taskManager.getStackById(n.id),u.displayState.activationState=4,n.displayState.activationState=4,f=this._taskManager.getFocusedStack(),i=this._taskManager.getStacks(),n.id===f.id){for(r=null,t=0;t<i.length;t++)if(e=i[t],e.id==n.id){r=this._findNonDisabledStack(t,i,-1);n||(r=this._findNonDisabledStack(t,i,1));break}r&&this._taskManager.focusTask(r.getForegroundTask().id)}this._taskManager.updateProminences(u)},t.prototype._findNonDisabledStack=function(n,t,i){var r=null;do if(n+=i,r=t[n],r)r.displayState.activationState===4&&(r=null);else break;while(!r);return r},t.prototype._disposeCurrentSelectionControl=function(){if(this._currentSelectionControl&&this._currentSelectionControl.dispose(),this._currentSelectionControl=null,this._currentSelectionControlBindings&&this._currentSelectionControlBindings.length>0){for(var n=0;n<this._currentSelectionControlBindings.length;n++)this._currentSelectionControlBindings[n].dispose();this._currentSelectionControlBindings.length=0}},t}(wt);r.BaseTask=fu;r.BaseTaskViewModel=uu;n.BucketPrimitiveTemplateSelector=li;n.CollectionsTaskPoiManager=ai;n.CollectionsPoiTemplateSelector=su;n.CollectionsXsrPoiTemplateSelector=hu;n.DetailsTaskPoiManager=vt;n.ItineraryTaskPoiManager=cu;n.ItineraryTemplateSelector=lu;n.LayoutManager=at;n.MicroPoiManager=au;n.MicroPoiRequestProcessor=pi;n.MicroPoiResultsPoiTemplateSelector=yu;n.NearbyTransitTaskPoiManager=pu;n.PoiManager=ft;n.PolygonBoundaryManager=wi;n.PolygonListingTaskPoiManager=bi;n.ResultsTaskPoiManager=yt;n.SearchResultsPoiTemplateSelector=rt;n.TaskManager=eu;n.TaskPrimitivesZOrderManager=ot;n.TransitStopTaskPoiManager=wu;n.XsrBoundaryTemplateSelector=bu;n.XsrPoiTemplateSelector=kt}catch(ki){if(n.logger)n.logger.logCriticalError(ki);else throw ki;}}).call(window)