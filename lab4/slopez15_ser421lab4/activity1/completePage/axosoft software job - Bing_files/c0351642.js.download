(function(){try{var u=window.$MicrosoftMaps8,t=u.Internal,si=t._WorkDispatcher,d=u.Anchor,wt=u.ArrowTemplate,a=u.BasicTemplate,hi=t._BinaryObject,g=u.BitmapImageTemplate,bt=t._CurveKey,rt=t._Curve,f=t._Color,kt=t._ComponentNames,ci=t._CurveVector4,ut=t._CurveColor,v=t._CurveColorHelper,ft=t.CustomMapStyleManager,nt=t._DiscreteRangeCollectionSpline,n=t._Debug,dt=t._Gimme,e=u.GlobalConfig,i=t._Helper,p=t._JSEvent,gt=t._LatLonCrs,li=u.LocationRect,et=t._LoggerConstants,s=t._LruCache,ni=u.Matrix2D,ai=u.Location,ti=u.MapMath,o=u.MercatorCubeCrs,vi=t._MercatorTileUtility,h=t._Network,ot=t._Observable,yi=t._ObservableObject,pi=u.Point,wi=t.PyramidTileSpatialIndex,st=u.Rectangle,ii=t.SheetSpatialIndex,ri=t.StaticPromise,ht=t._TransformCurve,ct=t._HslaTransformCurve,r=u.VectorImageTemplate,c=t._VectorMath,tt=u.ZoomLevel,lt=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),w=function(){function t(r,u,f,o,h,c){var a,l;this._responsesCache=new s(128);this._sheetbasedSpatialIndex=new ii;this._gridbasedSpatialIndex=new yt;this._map=r;this._workDispatcher=o;this._coreConfig=u;this._constructGeometryFromLabelHints=typeof c=="boolean"?c:!0;a=this instanceof at;t.isNotLabelFilteringPrototype()&&!a&&(console.log("** This is the grid based now :) **"),f="http://ecn.api.m2.tiles.live-int.com/vector/vh/{quadkey}?v=6.0&responseType=jsonp&callback={callback}&jsonso={jsonso}&g=1&mkt={mkt}");n.assertNotNullOrEmpty(f,"vectorTileUrlFormat");this._layersOfInterest=h;this._urlFormat=i._updateTfeUrlDomain(f).replace("{vectorgridsgenid}",e.dynamicProperties.vectorGridsGenerationId).replace("{mkt}",e.dynamicProperties.uiLanguage).replace("{odmgenid}",e.dynamicProperties.compositionHandlerGenerationId);l=e.dynamicProperties.userRegion;this._urlFormat=l&&e.dynamicProperties.isGeopolUserRegion?this._urlFormat.replace(/{ur}/,l):this._urlFormat.replace(/&ur={ur}/,"");this._id=this._jsonsoSuffix="basemap";this._requests={}}return t.isNotLabelFilteringPrototype=function(){var n=i._getUrlParam(window.location,"labelfiltering");return n==="false"||n==="0"},t.prototype.getLayerDataSource=function(n){return!t.isNotLabelFilteringPrototype()&&this._urlFormat.indexOf("//mlm")===-1?new b(n,this,this._sheetbasedSpatialIndex):new b(n,this,this._gridbasedSpatialIndex)},t.prototype.cancelPrimitivesRequest=function(n,i,r){var u=t._getDispatchKey(n,i,r||"",this._id);h.abortRequest(this._requests[u]);this._workDispatcher.cancelDispatchWithKey(u)},t.prototype.getPrimitives=function(n,r,u,f){var l=this,o=n.quadKey,a=o+this.getFilterKey(),s=t._getDispatchKey(n,r,f||"",this._id),h=this._urlFormat.replace(/{quadkey}/ig,o).replace(/{subdomain}/ig,i._getTileSubDomain(o)).replace(/{filter}/ig,this.getFilterKey()),c=e.tileRefactoringEnabled?t._responsesCacheV2.getItem(h):this._responsesCache.getItem(a);c?this._completeRequest(u,this._filterResponse(c[r]),s):this._workDispatcher.dispatch(function(){return l._downloadGrid(n,s,r,h,u)},s,3)},t.prototype._filterResponse=function(n){return n},t.prototype.applyFilter=function(n){this._filter=n},t.prototype.resetFilter=function(){this._filter=null},t.prototype.getFilterKey=function(){var r="",t=this._filter,i,n;if(t&&t.value&&t.distribution)for(i=t.value,n=0;n<i.length;n++)r+=i[n]+":"+t.distribution[n],n<i.length&&(r+=",");return r},t.prototype._downloadGrid=function(r,u,f,e,o){var l=this,s=r.quadKey,c;n.logDebugData("BaseMapDataSource - _downloadgrid() "+s);n.time(i._formatString("Network call for quadkey - {0}",s));c=null;(!this._coreConfig.autoGenBaseMapJsonso||n.getFunctionalTestHooksEnabled())&&(c=s.toString()+"_"+this._jsonsoSuffix);this._requests[u]=h.downloadJsonp(e,"grid",function(n){l._handleResponse(r,e,u,f,o,n,!0)},function(i,h){n.log(null,"ERROR: failed to get {0}",s);l._handleResponse(r,e,u,f,o,t._createEmptyResponse(),!1,h)},c)},t.prototype._handleResponse=function(r,u,f,o,s,h,c,l){var k=this,v,b,y,a,p,w;this._map.isDisposed()||(v=r.quadKey,b=v+this.getFilterKey(),delete this._requests[f],n.groupCollapsed(null,"Callback for lod: {0} quadkey {1}",r.lod.toString(),v),n.timeEnd(i._formatString("Network call for quadkey - {0}",v)),n.time(i._formatString("Parsing vector response for quadkey - {0}",v)),y=e.tileRefactoringEnabled,a=y?t._responsesCacheV2.getItem(u):null,y&&a||(h?a=this._parseResponse(h,r,u):(a=(y?t._responsesCacheV2.getItem(u):this._responsesCache.getItem(b))||{},ot.mergeProperties(a,this._parseNullDataRegion(o))),c&&(y?t._responsesCacheV2.addItem(u,a):this._responsesCache.addItem(b,a))),n.timeEnd(i._formatString("Parsing vector response for quadkey - {0}",v)),p=h&&h.requestFailed?{primitives:null,requestFailed:!0,requestAborted:l===4}:a[o],w=p&&p.primitives,w&&w.length>0?this._map.getTemplateSelector().then(function(n){n.selectorReady().then(function(){for(var t,h,i,r=[],u=[],e=[],o=0;o<w.length;o++)t=w[o],t.entity&&t.entity.oid?e.push(t.entity.oid):t.geometryType===1?r.push(t.bucket):(h=it.getShieldIndices(t.entity),h.length>0&&u.push({bucketId:t.bucket,indexes:h}));i=[];r.length>0&&i.push(n.prefetchImages(r));u.length>0&&i.push(n.prefetchShields(u));e.length>0&&i.push(n.prefetchOrganizationImagesByOrgId(e));Promise.all(i).then(function(){k._completeRequest(s,k._filterResponse(p),f)})})}):this._completeRequest(s,this._filterResponse(p),f),n.groupEnd())},t.prototype._completeRequest=function(n,t,i){if(e.tileRefactoringEnabled)n(t);else{var r=function(n,t){return function(){n(t)}}(n,t);this._workDispatcher.dispatch(r,i,3)}},t._getDispatchKey=function(n,t,i,r){var u=n.quadKey;return u+"_"+t+"_"+i+"_"+r},t._createEmptyResponse=function(){return{entities:[],layers:{},requestFailed:!0}},t.prototype._parseNullDataRegion=function(n){var r,i;return t._nullDataRegionResponse||(r={isNullDataRegionMarker:!0,crs:gt.instance,geometryType:1,geometry:{x:0,y:0,bounds:[90,180,-90,-180]}},t._nullDataRegionResponse={primitives:[r]}),i={},i[n]=t._nullDataRegionResponse,i},t.getAnchorTextSpan=function(n){var t,i,e,r,o,u,f;if(n&&n.lbl)for(i=0,e=n.lbl.length;i<e;i++){for(r=n.lbl[i],o=r.tps&&r.tps.length||0,u=0;u<o;u++)if(f=r.tps[u],t=t||f,!f.n){t=f;break}if(t&&!t.n)break}return t},t.prototype._constructGeometryFromHint=function(n,i){var u,r=t.getAnchorTextSpan(n),f;if(r)switch(i){case 1:u={x:r.x,y:r.y,bounds:[r.y,r.x,r.y,r.x]};break;case 2:u={x:[r.x,r.x],y:[r.y,r.y],bounds:[r.y,r.x,r.y,r.x]};break;case 3:f={x:[r.x,r.x],y:[r.y,r.y]};u={rings:[f],r:[f],bounds:[r.y,r.x,r.y,r.x]}}return u},t.prototype._logResponseError=function(n,t,i){var r=u.logger,f;r&&(f={feature:kt.BaseMapData,action:et.Error,data:{layerId:i||"",response:t||"",url:n||""}},r.logCriticalError(null,f))},t.prototype._parseResponse=function(t,r,u){var ot=t.entities,st=r.crs,y={},c=t.layers,l=t.placement,g,nt,w,ht,h,tt,b,ct,it,k,o,rt,v,s,f,ut,ft,a,d,et;if(this._constructGeometryFromLabelHints&&l&&l.length>0){for(g={},nt=Object.keys(c),w=0,ht=nt.length;w<ht;w++)if(h=nt[w],e.tileRefactoringEnabled||this._layersOfInterest.indexOf(h)>-1)for(y[h]={primitives:[]},tt=c[h],b=0,ct=tt.length;b<ct;b++)(o=tt[b],s=o.entityIndex||o.ei,n.assert(s!==0,"Primitive with entityindex 0 is invalid"),g[s+","+o.gt])||(o.bucket=o.bkt,o.entityIndex=s,o.geometryType=o.gt,o.geometry=this._constructGeometryFromHint(l[s],o.geometryType),n.assert(o.geometry!==null,"Geometry should be constructed from a hint"),f=ot[s],f&&(this._coreConfig.clickBasemapPrimitives&&(f.clickable=f.clickable||!!f.clk,f.clickable&&(o.isTapEnabled||(o.isTapEnabled=o.isHoverEnabled=function(){return!0}),f.changed||(f.changed=new p))),f.name=f.displayName||f.dn,f.labelImportance=f.labelImportance||f.li||-1,f.ypid=f.ypid||f.yp,f.category=f.category||f.cg,f.shieldName=f.shieldName||f.sn||[],f.shieldIndex=f.shieldIndex||f.si||[],f.labelHint=l[s],o.entity=f),o.crs=st,y[h].primitives.push(o),g[s+","+o.gt]=s)}else for(h in c)if(c.hasOwnProperty(h))for(y[h]={primitives:c[h]},it=c[h],k=0;k<it.length;k++)if(o=it[k],!o.bucket){o.g||this._logResponseError(u,JSON.stringify(t),h);o.bucket=o.bkt;o.entityIndex=o.ei;o.geometry=o.g;o.geometryType=o.gt;o.geometry.bounds=o.g.b;switch(o.geometryType){case 1:rt=16384;v=o.geometry;o.geometry.bounds=[Math.min(rt,v.y),v.x,v.y,Math.min(rt,v.x)];break;case 3:a=o.geometry;a.rings=a.r}s=o.entityIndex;f=ot[s];f&&(f.name=f.displayName||f.dn,f.labelImportance=f.labelImportance||f.li||-1,f.ypid=f.ypid||f.yp,f.category=f.category||f.cg,f.shieldName=f.shieldName||f.sn||[],f.shieldIndex=f.shieldIndex||f.si||[],f.labelHint=l&&l[s],o.entity=f.ypid?f:f.tj?f:f);ut=o.geometry;switch(o.geometryType){case 2:ft=ut;i._deltaDecode(ft.x);i._deltaDecode(ft.y);break;case 3:for(a=ut,d=0;d<a.rings.length;d++)et=a.rings[d],i._deltaDecode(et.x),i._deltaDecode(et.y)}o.crs=st}return y},t._responsesCacheV2=new s(50),t}(),ui=function(n){function t(t,i,r,u,f){return n.call(this,t,i,r,u,f,!1)||this}return lt(t,n),t}(w),at=function(n){function t(t,i,r,u,f,e,o,s,h){var c=n.call(this,t,i,r,u,s)||this;return c._importanceThreshold=27,c._percentageforHighImportant=.3,c._id=o,h&&(c._jsonsoSuffix=h),c._minZoom=f,c._maxZoom=e,c}return lt(t,n),t.prototype.getLayerDataSource=function(n){return new b(n,this,this._sheetbasedSpatialIndex)},t.prototype.applyFilter=function(n){this._filter=n},t.prototype.resetFilter=function(){this._filter=null},t.prototype.setLayer=function(n){this._layer=n},t.prototype._filterResponse=function(n){var r={},f=this.staticLandmarks&&this.staticLandmarks(),u,i,t;if(r.primitives=[],n&&n.primitives)for(r.primitives=n.primitives,u=0;u<r.primitives.length;u++)i=r.primitives[u],f?i.isHoverEnabled=i.isTapEnabled=null:i.isHoverEnabled||(i.isHoverEnabled=i.isTapEnabled=function(){return!0}),t=i.entity,t&&(t.changed||(t.changed=new p),t.ypid&&t.ypid.indexOf("ypid:")!==0&&(t.ypid="ypid:"+t.ypid),t.isLandmark=!0),i.layer=this._layer;return r},t.prototype.getPrimitives=function(t,i,r,f,e){var h=w._getDispatchKey(t,i,f||"",this._id),o,s;e=Math.round(e);o=u&&u.Internal&&u.Internal._VenueMapHelper;s=o&&o.isOverlappingVenueMaps(this._coreConfig,t);e<this._minZoom||e>this._maxZoom||this.suppressDataRetrieval&&this.suppressDataRetrieval()||s||this._layer&&!this._layer.getVisible()?n.prototype._completeRequest.call(this,r,{primitives:[]},h):(this._limitPrimitives=12*(e-this._minZoom+1),n.prototype.getPrimitives.call(this,t,i,r,f,e))},t}(w),b=function(){function t(n,t,i){this._layerId=n;this._parentDataSource=t;this.spatialIndex=i;this.invalidated=new p}return t.prototype.getParentDataSource=function(){return this._parentDataSource},t.prototype.getPrimitives=function(n,t,i,r){this._parentDataSource.getPrimitives(n,this._layerId,t,i,r)},t.prototype.applyFilter=function(n){this._parentDataSource.applyFilter(n)},t.prototype.resetFilter=function(){this._parentDataSource.resetFilter()},t.prototype.cancelPrimitivesRequest=function(n,t){this._parentDataSource.cancelPrimitivesRequest(n,this._layerId,t)},t.prototype.getDataUniquenessKey=function(t){n.assertNotNull(t,"regionId");return this._parentDataSource?t.quadKey+this._parentDataSource.getFilterKey():t.quadKey},t}(),bi=function(){function n(){}return n}(),y=function(){function t(r,u,f,o,h,c,l){this._clientPerf=c;this._customStyleManager=u;this._primitiveTemplateCache=new s(100);this._categoryIconCache=new s(100);this._templateName=o;this._state=[];this._stlVersion=i._getStlVersion()||h;this._stlVersionNum=parseFloat(this._stlVersion);this._shieldToRoadIdMapping={};this._bucketToMappedImageIndex={};this._bucketToPassDefinitionIndex={};this._bucketToDrawOrderListIndex={};this._mappedToUnmappedImageIndex={};this._unmappedToMappedImageIndex={};this._unmappedIndexToBucketIds={};this._hitTest=l;this._images={};this.ready=new p;n.enableFunctionalTestHooks&&i._getUrlParam(window.location,"teststylefailure")==="1"&&(t._retryTimeout=1);var a=e.dynamicProperties.compositionHandlerGenerationId,v=r.mapTemplateUrlBase;this._urlFormat=i._updateTfeUrlDomain(f.replace("{urlbase}",v)).replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",a);this._urlImageFormat=i._updateTfeUrlDomain(r.mapImageTemplateUrlFormat.replace("{urlbase}",v)).replace("{stlVersion}",this._stlVersion).replace("{odmgenid}",a);this._poiShadow=r.poiShadowPrototype&&!i._isMapsSDK();this._poiRefresh=r.poiRefresh&&!i._isMapsSDK();this._poiRefresh&&(t.DefaultBucketForLocalCat=t.DefaultBucketForLocalCat_PoiRefresh,ot.mergeProperties(t._localCatIdBucketMapping,t._localCatIdBucketMapping_Delta));this._drawOrder=new s(i._lowMem()?2:8);this._markupOrder=new s(i._lowMem()?1:4);this._shieldImages={};this._shieldScaleListForZoom={};this._initialized=!1;this._retryCount=0;this._localCatIdVectorImageTemplate={}}return t.init=function(){var i={},r={},n={};["203","255","257","251","253","254","252","91754","205","204","207","206","200","264","265","263","250","202","266","261","91571","201","262","256","260","259","258","267","91621","90892"].forEach(function(u){var f=t._localCatIdBucketMapping[u];i[u]=!0;r[f]=!0;n[f]=!0});["337","338","339","340","341","342","350","351","352","1386","1387","353","1370","1371","344","1441","1442","1443"].forEach(function(t){n[t]=!0});t._transitCatIds=i;t._transitBucketIds=r;t._invertedIconBucketIds=n},t.prototype.setProcessDrawOrder=function(n){this.processDrawOrder=n},t.prototype.getName=function(){return this._templateName},t.isDarkTheme=function(n){return!!this._darkTemplates[n]},t.extractCategoryId=function(n,i){var u,r;for(n=n||"",u=n.split("."),r=u.length-1;r>=0;r--)if(t._localCatIdBucketMapping[u[r]])return u[r];return i?t.DefaultBucketForLocalCat:null},t.getBucketForCategory=function(n){return t._localCatIdBucketMapping[n]},t.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t,i){n._requestTemplateData(t,i)})),this._ready},t.prototype._requestTemplateData=function(r,u){var f=this,a,o,s,c,l;!this._requested&&this._urlFormat&&(this._requested=!0,this._delayLoadTimerId&&(window.clearTimeout(this._delayLoadTimerId),this._delayLoadTimerId=null),a=!!i._getStlVersion(),n.logDebugData("BaseMapTemplateSelector - _requestTemplateData() "+this._urlFormat),o=this._clientPerf&&this._clientPerf.start(t._latencyLogKey),s=window[this._templateName],s===undefined||s!==this._templateName||a?s&&!a?(delete window[this._templateName],this._onNetworkResponse(s,o,r)):e.features.jsonXsrResponse.isEnabled?h.downloadJson(this._urlFormat.replace(/{templateName}/ig,this._templateName).replace(/{subdomain}/ig,"0"),"styles",function(n){f._onNetworkResponse(n,o,r)},function(){f._onNetworkError(f._templateName,r,u)},null,!1,null,!1):h.downloadJsonp(this._urlFormat.replace(/{subdomain}/ig,"0"),"styles",function(n){f._onNetworkResponse(n,o,r)},function(){f._onNetworkError(f._templateName,r,u)},this._templateName):(c="XsrPrefetchCallback",l="XsrPrefetchErrorCallback",window[c]=function(n,t){delete window[t];delete window[l];delete window[c];f._onNetworkResponse(n,o,r)},window[l]=function(n){delete window[n];delete window[l];delete window[c];f._retryCount++;f._onNetworkError(n,r,u)}))},t.prototype._onNetworkError=function(i,r,u){var f=this;this._retryCount<t._maxRetries?(this._requested=!1,this._retryCount++,n.logNetworkData(i,"retry "+this._retryCount),this._delayLoadTimerId=Microsoft.Maps.setTimeout(function(){f._requestTemplateData(r,u)},t._retryTimeout*1e3)):n.logNetworkData(i,"max retries");u(null)},t.prototype._onNetworkResponse=function(n,t,i){this._isDisposed||(this._clientPerf&&this._clientPerf.end(t),this._parseTemplate(n,i))},t.prototype._loadTemplates=function(n){if(!this._initialized)throw"BaseMapTemplateSelector: trying to use this class before it has been initialized";this._populateDraworderByZoom(n);this._populateMarkupByZoom(n)},t.prototype._IsCurveGraph=function(n){return typeof n.position!="undefined"&&typeof n.tangentType!="undefined"?!0:!1},t.prototype._IsDiscreateCollectionGraph=function(n){return typeof n.start!="undefined"&&typeof n.end!="undefined"?!0:!1},t.prototype._IsHslaTransformCurveGraph=function(n){return n.graphType===14?!0:!1},t.prototype._IsTransformCurveGraph=function(n){return n.graphType===15&&typeof n.numericTransformCurve!="undefined"?!0:!1},t.prototype._getFixedStringId=function(n){var t=this._fixedStringMap[n];return typeof t!="number"&&(t=-1),t},t.prototype._getColorformat=function(n){var i=null,t;return n.graphType===1&&(t=n.value,t&&typeof t=="string"&&t.slice(1).length===6&&!isNaN(parseInt(t.slice(1),16))?i=1:t&&typeof t=="string"&&t.indexOf("rgba")>-1?i=0:(t||t===0)&&typeof t=="number"&&(i=3)),i},t.prototype._parseTemplate=function(i,u){var w=this,oi,wt,k,si,hi,ci,li,it,kt,d,dt,gt,ft,ai,et,b,ot,l,ni,s,a,h,vi,o,v,lt,at,g,vt,y,yi,ti,p,pi,e,wi,tt,ii,yt,pt,ui;n.time("ParseTemplate");var fi="Smooth",ei="Step",c=i.graphs;if(this._landColor=i.landColor,this._drawOrderList=i.drawOrder,this._shieldStyleResponseData={},i&&i.shields)for(o=0,oi=i.shields.length;o<oi;o++)wt=i.shields[o],this._shieldStyleResponseData[wt.shieldBucketId]=wt.passID[0];for(this._passDefinitionList=i.passDefinitions,this._imageGroups=i.imageGroups,this._groupedImageOptions=i.groupedImageOptions,this._state=i.state||[],this._propertyValues=i.propertyValues,this._svgColor=i.svgColor,r.fontFamilies=i.fontFamilies,this._markupOrderList=i.markupOrder,this._computedSplineGraphs=new Array(c.length),this._computedSplineGraphPaletteKeys=new Array(c.length),this._mapImages=[],this._imgVariants=i.imageVariantsList,this._fixedStringList=i.fixedStrings,this._fixedStringMap={},k=0,si=this._fixedStringList.length;k<si;k++)this._fixedStringMap[this._fixedStringList[k]]=k;for(this._palette=this._createPalette(i.paletteDefinitions,i.paletteItems),hi=this._getFixedStringId("Global.ImageFamily"),ci=this._palette.getStringPaletteValue(hi),this._paletteFlavorKeyId=this._getFixedStringId(ci),li=this._getFixedStringId("Default"),p=0,o=0;o<(this._imgVariants&&this._imgVariants.length);o++){for(kt=this._imgVariants[o],e=0;e<kt.imageReferences.length;e++)if(d=kt.imageReferences[e],d.keyId===this._paletteFlavorKeyId){it=d.imageId;break}else d.keyId===li&&(it=d.imageId);this._unmappedToMappedImageIndex[it]=p;this._mappedToUnmappedImageIndex[p++]=it}for(this._shapeImageLookup={},dt=i.shapeImageLookup&&i.shapeImageLookup.idPair||[],gt=[],ft=0,ai=dt.length;ft<ai;ft++)et=dt[ft],et&&(b=et.second,this._shapeImageLookup[et.first]=b,gt.push(b),this._unmappedToMappedImageIndex[b]||(this._unmappedToMappedImageIndex[b]=p,this._mappedToUnmappedImageIndex[p++]=b));for(this._setStateIndex(),o=0;o<i.visibilityRanges.length;o++)if(ot=i.visibilityRanges[o],ot)for(e=0;e<ot.length;e++){var st=ot[e],p=st.visibleValueId||0,h=i.booleanValues[p];h&&(h.type===1?st.visible=h.fValue||!1:(st.visible=this._palette.getBooleanPaletteValue(h.pValue),st.visiblePaletteKey=h.pValue))}for(this._styleVisibilities=this._getvisibilities(i.drawOrder.visibilityIndex,i.drawOrder.geometry,i.visibilityRanges),this._markupVisibilities=this._getvisibilities(i.markupOrder.visibilityIndex,i.markupOrder.geometry,i.visibilityRanges),o=0;o<c.length;o++)if((l=c[o],l&&!(l.length<1))&&(ni=l[0].graphType,l&&ni))switch(ni){case 1:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.colorValues[a],!h)continue;h.type===1?s.value=h.fValue||0:(s.value=this._palette.getColorPaletteValue(h.pValue,!1),s.paletteKey=h.pValue,isNaN(s.value)&&(s.value=-1))}break;case 2:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.singleValues[a],!h)continue;h.type===1?s.value=h.fValue||0:(s.value=this._palette.getSinglePaletteValue(h.pValue),s.paletteKey=h.pValue)}break;case 16:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.booleanValues[a],!h)continue;h.type===1?s.value=h.fValue||!1:(s.value=this._palette.getBooleanPaletteValue(h.pValue),s.paletteKey=h.pValue)}break;case 17:for(e=0;e<l.length;e++)if(s=l[e],a=typeof s.valueId!="undefined"?s.valueId:s.value,typeof a=="number"){if(h=i.stringValues[a],!h)continue;h.type===1?(vi=h.fValue||0,s.value=this._fixedStringList[vi]):(s.value=this._palette.getStringPaletteValue(h.pValue),s.paletteKey=h.pValue)}}for(o=0;o<c.length;o++)if(c[o]&&!(c[o].length<1)){if(v=c[o][0],lt=this._getColorformat(v),lt!==null){for(at=new ut,e=0;e<c[o].length;e++)y=c[o][e],g=new f(y.value,lt),at.addKey(y.position,g.red,g.green,g.blue,g.alpha,y.tangentType===fi?1:y.tangentType===ei?2:0),e+1<c[o].length&&(c[o][e+1].graphType=1,lt=this._getColorformat(c[o][e+1]));at.computeTangents();this._computedSplineGraphs[o]=at}else if(this._IsCurveGraph(v)){for(vt=new rt,e=0;e<c[o].length;e++)y=c[o][e],yi=new bt(y.position,y.value,y.tangentType===fi?1:y.tangentType===ei?2:0),vt.addKey(yi);vt.computeTangents();this._computedSplineGraphs[o]=vt}else if(this._IsDiscreateCollectionGraph(v)){for(ti=new nt,e=0;e<c[o].length;e++)ti.addRange(c[o][e].start,c[o][e].end,c[o][e].value);this._computedSplineGraphs[o]=ti}else if(this._IsTransformCurveGraph(v))p=v.numericTransformCurve,this._computedSplineGraphs[p]&&(pi=new ht(this._computedSplineGraphs[p]),this._computedSplineGraphs[o]=pi);else if(this._IsHslaTransformCurveGraph(v)){var bi=this._computedSplineGraphs[v.h],ki=this._computedSplineGraphs[v.s],di=this._computedSplineGraphs[v.l],gi=this._computedSplineGraphs[v.a],nr=new ct(bi,ki,di,gi);this._computedSplineGraphs[o]=nr}this._computedSplineGraphs[o]&&(this._computedSplineGraphPaletteKeys[o]=v.paletteKey)}for(e=0,wi=this._drawOrderList.bucket.length;e<wi;e++)tt=this._drawOrderList.bucket[e].toString(),ii=this._drawOrderList.passID[e],this._bucketToPassDefinitionIndex[tt]=ii,this._bucketToDrawOrderListIndex[tt]=e,yt=this._getMappedImageIndex(ii),yt>=0&&(this._bucketToMappedImageIndex[tt]=yt),pt=this._mappedToUnmappedImageIndex[yt],this._unmappedIndexToBucketIds[pt]||(this._unmappedIndexToBucketIds[pt]=[]),this._unmappedIndexToBucketIds[pt].push(tt);n.timeEnd("ParseTemplate");ui=[t._haloImageBucket,t.DefaultBucketForLocalCat,t.pricePoiBucketId,t.xsrPolygonBucketId,t.cityPolygonBucket];this._poiRefresh&&ui.push(t.itineraryPoiBucketId);this.prefetchImages(ui,gt,!0).then(function(){w._initialized=!0;w._ready=new ri(w);u(w);w.ready&&w.ready.invoke()})},t.prototype._getImageByBucketId=function(n){if(this._images){if(!this._images[n]){var t=this._bucketToMappedImageIndex[n];this._updateCachedImages(this._mappedToUnmappedImageIndex[t])}return this._images[n]}return null},t.prototype._updateCachedImages=function(n){var e=t._mapImagesUnmapped[n],o,s,i,u,f,h;if(e&&(o=this._unmappedToMappedImageIndex[n],!this._mapImages[o]&&(this._mapImages[o]=e,s=e.vectorImage,i=this._unmappedIndexToBucketIds[n],i)))for(u=0;u<i.length;u++)f=i[u],h=this._passDefinitionList[this._bucketToPassDefinitionIndex[f]],this._images[f]={scale:h.scale,scaleTransform:h.scaleTransform,template:s?new r(s):null,visibility:this._styleVisibilities[this._bucketToDrawOrderListIndex[f]]}},t.prototype._createPalette=function(n,t){var c,g=n.nodes,it=n.types,f,v,y,w,nt,k,d,rt,s,p,h,b,tt,e,o,l,i,r,a,u;for(ft&&ft.initialize(g,this._fixedStringList),f={},v={},i=0;i<it.length;i++)if(y=it[i],y){for(w=y.parentId,b=this._fixedStringList[y.nameId],f[i]={name:b,properties:[]},w>=0&&(e=f[w],e?f[i].parent=e:v[i]=w),nt=y.properties,k=0;k<nt.length;k++)(d=nt[k],d)&&(rt=this._fixedStringList[d.nameId],f[i].properties.push({propertyName:rt,valueType:d.valueType}));for(u in v)i===v[u]&&(o=f[u],o&&(o.parent=f[i],delete v[u]))}for(s={},p={},i=0;i<g.length;i++)if((h=g[i],h)&&(b=this._fixedStringList[h.nameId],tt=f[h.nodeTypeId],tt||!(h.parentId>=0))){s[i]={name:b,nodeType:tt};h.parentId>=0&&(e=s[h.parentId],e?(e.children||(e.children=[]),e.children.push(s[i])):p[i]=h.parentId);for(u in p)i===p[u]&&(o=s[u],o&&(o.children||(o.children=[]),o.children.push(s[i]),delete p[u]))}for(l={},i=0;i<t.length;i++)if(r=t[i],a=this._fixedStringList[r.keyId],r&&a)switch(r.type){case"StringPaletteItem":l[a]={keyId:r.keyId,type:0,stringId:r.stringPaletteItem};break;case"ColorPaletteItem":l[a]={keyId:r.keyId,type:1,value:r.colorPaletteItem.value,ignoreTransform:r.colorPaletteItem.ignoreTransform,additionalAttributes:r.colorPaletteItem.additionalAttributes};break;case"SinglePaletteItem":l[a]={keyId:r.keyId,type:2,value:r.singlePaletteItem.value,ignoreTransform:r.singlePaletteItem.ignoreTransform};break;case"BooleanPaletteItem":l[a]={keyId:r.keyId,type:3,value:r.booleanPaletteItem}}c=new oi(this._templateName,this._fixedStringList,this._fixedStringMap);for(u in s)c.populate(s[u],l);return this._poiRefresh&&(c.addItem("DefaultPointStateSearch.FontWeight",2),c.addItem("HoverPointStateSearch.FontWeight",3),c.addItem("SelectedPointStateSearch.FontWeight",3),c.addItem("InactiveSelectedPointStateSearch.FontWeight",3)),c},t.prototype._getShieldUnmappedImageIndexes=function(n){var s=[],c=this._shieldImages[n],f=this._shieldStyleResponseData[parseInt(n)],e,h,r,t,o,u,i;if(f)for(e=f.length,c=new Array(e),h=this._getFixedStringId("Default"),r=0;r<e;r++){for(t=this._computeSplineGraphObject(this._passDefinitionList[f[r]].image,1),o=this._imgVariants[t].imageReferences,u=0;u<o.length;u++)if(i=o[u],i.keyId===this._paletteFlavorKeyId){t=i.imageId;break}else i.keyId===h&&(t=i.imageId);s.push(t)}return s},t.prototype._getShieldImages=function(n,i){var u=this._shieldImages[n],h,o,f,e,s;for(u||(u=[]),h=this._getShieldUnmappedImageIndexes(n),f=0;f<h.length;f++){for(e=-1,s=0;s<i.length;s++)if(i[s]===f){e=f;break}(o=t._mapImagesUnmapped[h[f]],o&&o.vectorImage)&&(e===-1||u[e]||(u[e]=new r(o.vectorImage)))}return this._shieldImages[n]=u,u},t.prototype._getShieldScales=function(n,t){var i,u=this._shieldScaleListForZoom[n]||{},o,f,e,r,s;if(u&&(i=u[t]),!i){if(o=this._getStyleScale(n),f=this._shieldStyleResponseData[parseInt(t)],f)for(e=f.length,i=new Array(e),r=0;r<e;r++)s=this._computeSplineGraphObject(this._passDefinitionList[f[r]].shieldScale,o),i[r]=s;u[t]=i;this._shieldScaleListForZoom[n]=u}return i},t.prototype._populateMarkupByZoom=function(r){var o,ot,h,p,tt,it,rt,c,a,l,w,k,u,ut,y,nt,f;for(n.time("ParseMarkupOrder"),o=this._markupOrderList,ot=this._passDefinitionList,o.validKeys={},o.keys=o.bucket,h={},p=[],o.templates=new Array(o.passID.length),tt=this._getStyleScale(r),it=dt.Browser.is_webkit?t._webkitFontFillLightnessFactor:0,u=0,rt=o.bucket.length;u<rt;u++)c={},a=o.passID[u],p[a]||(p[a]=this._getMarkupOrderTemplate(a,tt,it)),c.style=p[a],c.visibility=this._markupVisibilities[u],c.priority=o.priority[u],c.globalOrder=u+1,l=o.bucket[u].toString()+","+this._markupVisibilities[u].geometryType,h[l]?h[l].style.styleDynamic.secondaryFontSize=c.style.styleDynamic.fontSize:h[l]=c;for(w=t._poiStyles[this._templateName],k=w&&Object.keys(w)||[],u=0,ut=k.length;u<ut;u++){var v=k[u],b=v&&v.split(","),ft=b&&b[0],d=b&&parseInt(b[1]);if(ft&&d&&(y=w[v],h[v]={style:{styleStatic:i._copyObject(y.styleStatic),styleDynamic:y.styleDynamic},priority:y.styleDynamic.priority,globalOrder:y.styleDynamic.globalOrder},d===1)){var l=t._userPoiLabelStylesBucket+","+d,g=h[l].style,e=i._copyObject(g.styleStatic),s=g.styleDynamic,et=g.styleDynamic.fontColor;e.wrapDisplayName=!0;e.backgroundColor=t.isDarkTheme(this._templateName)?"rgba(64,64,64,0.7)":"rgba(236,234,227,0.7)";switch(ft){case t.bucketIdForPoi:h[l]&&(r<16?(e.offsetX=13,e.offsetY=13):r>=16&&r<=19?(e.offsetX=15,e.offsetY=15):(e.offsetX=17,e.offsetY=17));break;case t.bucketIdForSelectedPoi:e.offsetX=24;e.offsetY=24;et=this._getColor("SelectedPointState"+t._labelColor,!0)}nt=h[v].style;f=nt.styleDynamic;nt.styleStatic=e;f.font=s.font;f.fontPaletteKey=s.fontPaletteKey;f.fontColor=et;f.fontColorPaletteKey=s.fontColorPaletteKey;f.fontSize=s.fontSize;f.fontScalePaletteKey=s.fontScalePaletteKey;f.secondaryFontSize=s.secondaryFontSize;f.fontWeight=s.fontWeight;f.fontWeightPaletteKey=s.fontWeightPaletteKey;f.outlineColor=s.outlineColor;f.outlineColorPaletteKey=s.outlineColorPaletteKey}}this._markupOrder.addItem(""+r,h);n.time("PopulateMarkupOrder");n.timeEnd("ParseMarkupOrder")},t.prototype._getMarkupOrderTemplate=function(n,i,r){var u=this._passDefinitionList[n],l={styleStatic:{},styleDynamic:{font:"",fontSize:0,fontColor:"",outlineColor:""},markupPassDefinitionIndex:n},f=l.styleStatic,e=l.styleDynamic,b,k,a,v,d,o,s,h,y,p,c,w;e.font=this._computeSplineGraphObject(u.fontName,i)||"SegoeBing";e.fontPaletteKey=this._getSplineGraphPaletteKey(u.fontName);var g=this._computeSplineGraphObject(u.fontBold,i),nt=this._computeSplineGraphObject(u.fontSemiBold,i),tt=this._computeSplineGraphObject(u.fontLight,i);e.fontWeight=g?3:nt?2:tt?1:0;b=this._computeSplineGraphObject(u.fontAllCapitals,i);k=this._computeSplineGraphObject(u.fontSmallCaps,i);f.fontCaps=b?2:k?1:0;a=this._computeSplineGraphObject(u.fontColorTransform,i);e.fontColor=a?this._computeHslaTransform(u.fontColor,i,a,r):this._computeSplineGraphObject(u.fontColor,i);e.fontColorPaletteKey=this._getSplineGraphPaletteKey(u.fontColor);e.fontColorPaletteKey&&(v=e.fontColorPaletteKey.split("."),v.length===2&&(e.fontWeightPaletteKey=v[0]+".FontWeight"));e.fontSize=this._computeSplineGraphObject(u.preferedFontSize,i);e.fontScalePaletteKey=this._getSplineGraphPaletteKey(u.preferedFontSize);f.fontSizeTransform=this._computeSplineGraphObject(u.preferedFontSizeTransform,i);f.fontSizeTransform>0&&(e.fontSize*=f.fontSizeTransform);f.fontMinimumSize=this._computeSplineGraphObject(u.minimumFontSize,i);f.pointLabelPlacementPreference=this._computeSplineGraphObject(u.pointPlacement,i);f.polygonFillPreference=this._computeSplineGraphObject(u.areaFillingPreference,i);f.verticalAlignment=this._computeSplineGraphObject(u.lineVerticalAlign,i);f.fontGlow=this._computeSplineGraphObject(u.fontGlow,i);f.fontItalics=this._computeSplineGraphObject(u.fontItalics,i);f.fontOutlined=this._computeSplineGraphObject(u.fontOutlined,i);f.fontUnderlined=this._computeSplineGraphObject(u.fontUnderlined,i);f.glowColor=this._computeSplineGraphObject(u.glowColor,i);f.glowSize=this._computeSplineGraphObject(u.glowSize,i);d=this._computeSplineGraphObject(u.heightMatch,i);switch(d){case"LabelHeightMatchXHeight":o=2;break;case"LabelHeightMatchAscent":o=1;break;default:o=0}return o!==0&&(s=0,h=this._computeSplineGraphObject(u.heightMatchPixels,i),h&&(y=this._computeSplineGraphObject(u.heightMatchPixelsTransform,i),y&&(h*=y),o===1?s=h*t._capHeightRatio:o===2&&(s=h*t._xHeightRatio),s<e.fontSize&&(e.fontSize=s))),p=this._computeSplineGraphObject(u.outlineColorTransform,i),e.outlineColor=p?this._computeHslaTransform(u.outlineColor,i,p):this._computeSplineGraphObject(u.outlineColor,i),e.outlineColorPaletteKey=this._getSplineGraphPaletteKey(u.outlineColor),f.outlineWidth=this._computeSplineGraphObject(u.outlineWidth,i),f.outlineWidth<2&&(f.outlineWidth+=t._outlineWidthDelta),c={},c.alpha=this._computeSplineGraphObject(u.overrideAlpha,i),c.fontSize=this._computeSplineGraphObject(u.strataFontSize,i),f.strataStyle=c,w=this._computeSplineGraphObject(u.shieldLabelVisibility,i),f.shieldLabelVisibility=w==="Both"?2:w==="NoText"?1:0,l},t.prototype._addRecordStyleString=function(n,t,i,r){var f=n[t];if(typeof f!="undefined"){var e=r[f]||{},u=e.type!=="SvgFixedColor"&&e.svgPaletteColor,o=void 0;u&&u.idPair&&u.idPair.length>0&&(o=this._fixedStringList[u.idPair[0].second]);n[i]=o}},t.prototype._resolveRecord=function(n,t,i,r,u){var s=n[t],f,e,o,h;if(typeof s!="undefined")switch(r){case 1:f=u[s]||{};e=void 0;f.type==="SvgFixedColor"?e=f.color:f.type==="SvgPaletteColor"&&(o=this._palette.getColorPaletteValue(f.svgPaletteColor.idPair[0].second,!1),e=o||o===0?v.convertPackedTorgba(o):f.color||0);n[i]=e;break;case 2:h=this._palette.getSinglePaletteValue(s);n[i]=h}},t.prototype._getDefaultVectorImageTemplate=function(i){var u,r;return this._initialized?(r=t._localCatIdBucketMapping[i],r||(r=t.DefaultBucketForLocalCat),this._images&&r?u=this._getImageByBucketId(r):n.log(null,"Not able to create vector image templates",this._images),u):(n.log(null,"TemplateSelector needs to be initialized before getImage() call",this._initialized),null)},t.prototype._getDefaultVectorImageTemplateAsync=function(i,r){var f=this,u;if(!this._initialized)return n.log(null,"TemplateSelector needs to be initialized before getImage() call",this._initialized),null;u=t._localCatIdBucketMapping[i];u||(u=t.DefaultBucketForLocalCat);this.prefetchImages([u]).then(function(){r&&r(f._images[u])})},t.prototype._getCardVectorImageTemplateAsync=function(n,u,e,o,s,h,c){var v=this,a,l;if(e=e||f.transparent,o=o||f.black,s=s||.7,a=u+e+o+s.toString(),l=this._localCatIdVectorImageTemplate[a],l&&n){Microsoft.Maps.setTimeout(function(){n(l)},0);return}this._getDefaultVectorImageTemplateAsync(u,function(u){var w,y,g,nt,p,f,b,k,tt;if(u&&u.template){for(w=u.template.getVectorImage(),y={},y.hotspotX=w.hotspotX,y.hotspotY=w.hotspotY,y.records=[],g=!1,f=0,b=w.records.length;f<b;f++){y.records[f]=i._copyObject(w.records[f]);y.records[f].style={};for(nt in w.records[f].style)y.records[f].style[nt]=w.records[f].style[nt];p=w.records[f].style.fillStylePaletteKey;p&&(g=!0,p.indexOf(t._backgroundColor)>-1||p.indexOf(t._borderColor)>-1||p.indexOf(t._fillColor)>-1||p.indexOf(t._borderStrokeColor)>-1||p.indexOf(t._strokeColor)>-1?y.records[f].style.fillStyle=e:(p.indexOf(t._colorString)>-1||p.indexOf(t._iconColor)>-1)&&(y.records[f].style.fillStyle=o))}if(!g&&v._templateName==="3348DF34-653A-489E-97B3-7371457982E3")for(f=0,b=y.records.length;f<b;f++)k=y.records[f],tt=k.vectorType,tt===2?k.style.fillStyle=e:tt===4&&(k.style.fillStyle=o);if(l=new r(y),l.setScale(s),h){c=c||h;var it=l.getScale(),d=l.getBounds().getSize(),rt=d.width/it,ut=d.height/it;(d.width>h||d.height>c)&&l.setScale(Math.min(h/rt,c/ut))}v._localCatIdVectorImageTemplate[a]=l}Microsoft.Maps.setTimeout(function(){n&&n(l)},0)})},t.prototype._applyStackedBackgroundShape=function(n,i,u,f){for(var c,o,tt,p,w,l,k,d=this,h=f&&f.getVectorImage(),a=h&&h.records||[],g,v,s="",rt=function(n){var r=d._getFixedStringId(n),u=d._shapeImageLookup[r],i=t._mapImagesUnmapped[u];return i&&i.vectorImage},nt=function(n,t){for(var i,u,f=n&&Object.keys(n)||[],r=0,e=f.length;r<e;r++)i=f[r],i.endsWith("PaletteKey")&&(u=(n[i]||"").split("."),u.length===2&&(n[i]=t+"."+u[1]))},e=0,y=a.length;e<y;e++)if(c=a[e].shapePaletteKey,c)if(s)if(c===s)v=e;else break;else c.endsWith(t._backgroundShapeRecord)&&(g=v=e,s=c);else if(s)break;if(n===2||n===3)tt=n===2?t.pricePoiBucketId:t.itineraryPoiBucketId,p=this._mapImages[this._bucketToMappedImageIndex[tt]],o=p&&p.vectorImage;else{if(w=this._getStackedStringValue(u,s),!w)return f;o=rt(w)}if(o){l=JSON.parse(JSON.stringify(o.records));i||(l=l.filter(function(n){return n.recordType!=="Text"&&n.vectorType!==3}));var it=o.overrideHotspot,b=[].concat(a.slice(0,g),l,i?[]:a.slice(v+1)),ut={hotspotX:it?o.hotspotX:h.hotspotX,hotspotY:it?o.hotspotY:h.hotspotY,hitTest:h.hitTest,records:b};for(f=new r(ut),k=s.split(".")[0],e=0,y=l.length;e<y;e++)nt(b[e],k),nt(b[e].style,k)}return f},t.prototype._applyStackedColor=function(n,t,i,r,u){var e=t[r],f=this._getStackedColorValue(n,e,u);f&&(t[i]=f)},t.prototype._getStackedColorValue=function(n,t,i){var e,r,u;return t=t||"",r=t.split("."),r.length===2&&(u=this._palette.getStackedColorPaletteValue(n.concat(r[0]),r[1],i),e=isNaN(u)?"":isFinite(u)?v.convertPackedTorgba(u):f.black),e},t.prototype._applyStackedScale=function(n,t,i,r){var e=t[r],f=this._getStackedNumericValueItem(n,e),u=f&&f.value;typeof u=="number"&&isFinite(u)&&(t[i]*=u)},t.prototype._getStackedNumericValueItem=function(n,t){var r=null,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedSinglePaletteItem(n.concat(i[0]),i[1])),r},t.prototype._applyStackedEnum=function(n,t,i,r){var f=t[r],u=this._getStackedEnumValue(n,f);u&&(t[i]=u)},t.prototype._getStackedEnumValue=function(n,t){var r,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedEnumPaletteValue(n.concat(i[0]),i[1])),r},t.prototype._applyStackedString=function(n,t,i,r){var f=t[r],u=this._getStackedStringValue(n,f);u&&(t[i]=u)},t.prototype._getStackedStringValue=function(n,t){var r,i;return t=t||"",i=t.split("."),i.length===2&&(r=this._palette.getStackedStringPaletteValue(n.concat(i[0]),i[1])),r},t.prototype._getPoiImageStyleValue=function(n,t,i){var r=this._getFixedStringId(i+n),u=this._palette.getSinglePaletteValue(r,!0);return isNaN(u)&&(r=this._getFixedStringId(t+n),u=this._palette.getSinglePaletteValue(r,!0)),u},t.prototype._getColor=function(n,t){var r=this._getFixedStringId(n),i=this._palette.getColorPaletteValue(r,t);return isNaN(i)?"":i||i===0?v.convertPackedTorgba(i):f.black},t.prototype._getPoiImageColor=function(n,i,r){var u=this._getColor(r+n,!0),f=!1;return u&&(f=!0),f||(u=this._getColor(i+n,!0),u||i.indexOf("Transit")!==0||(u=t._task4Color[n]),i===t._taskList[5]&&(u=t._layerPoiColors[n])),u},t.prototype._getScale=function(n,t,i,r,u){var f,e;return r===void 0&&(r=1),u===void 0&&(u=!1),f=r,f*=this._computeSplineGraphObject(n,i),u||(e=this._computeSplineGraphObject(t,i),e>0&&(f=f*e)),f},t.prototype._setStateIndex=function(){var t="en-us",n,i;for(this._currentStateIndex=0,n=0;n<this._state.length;n++)if(i=this._state[n].idPair[0],i){var f=this._propertyValues[i.second],u=this._fixedStringList[f.propVal].toLowerCase(),r=e.dynamicProperties.market.toLowerCase();if(r===t&&u===t||r.substr(0,2)!==t.substr(0,2)&&u.substr(0,2)===r.substr(0,2)){this._currentStateIndex=n;break}}},t.prototype._getMappedImageIndex=function(n){var f=this._passDefinitionList[n],t=-1,r,u,i;if(typeof f.imageGroup!="undefined"){if(t=Math.round(this._computeSplineGraphObject(f.imageGroup,1)),r=this._imageGroups[t].images,!r)return t;for(u=0;u<r.length;u++)if(i=this._groupedImageOptions[r[u]],i.stateId==this._currentStateIndex){t=i.mapImage;break}else i.stateId==0&&(t=i.mapImage)}return t},t.prototype._processVectorImage=function(n,t){var u,f,i,r;if(n&&t){for(u=0,f=n.records.length;u<f;u++)i=n.records[u],this._resolveRecord(i,"fillValueId","fill",1,t),this._addRecordStyleString(i,"fillValueId","fillStylePaletteKey",t),this._resolveRecord(i,"strokeValueId","stroke",1,t),this._addRecordStyleString(i,"strokeValueId","strokeStylePaletteKey",t),this._resolveRecord(i,"colorValueId","color",1,t),this._addRecordStyleString(i,"colorValueId","colorStylePaletteKey",t),typeof i.scalePaletteKeyId=="number"&&(this._resolveRecord(i,"scalePaletteKeyId","scale",2),i.scalePaletteKey=this._fixedStringList[i.scalePaletteKeyId]),this._resolveRecord(i,"strokeScalePaletteKeyId","strokeScale",2),typeof i.shapePaletteKeyId=="number"&&(i.shapePaletteKey=this._fixedStringList[i.shapePaletteKeyId]),typeof i.lineStyle!="undefined"&&(this._resolveRecord(i.lineStyle,"colorValueId","color",1,t),this._addRecordStyleString(i.lineStyle,"colorValueId","colorStylePaletteKey",t)),r=i,typeof r.stringSourceType!="undefined"&&(this._resolveRecord(r.textStyle,"colorValueId","color",1,t),this._addRecordStyleString(r.textStyle,"colorValueId","colorStylePaletteKey",t),r.textStyle.fontFamily=this._fixedStringList[r.textStyle.fontFamilyId]);n.hitTest=1}},t.prototype._parseImageRecord=function(n,t){var i,r,u;if(n)return(i=n.vectorImage,this._processVectorImage(i,t),r=n.bitmapImage,i)?n:r?(u=document.createElement("img"),u.src=r,u):null},t.prototype.getRoutePoiVectorImageTemplate=function(n,i,u){var a=t.directionIconTypeBuckets[n],nt=t._poiStateNames[i],b="d"+a+nt+u.toString(),f=this._primitiveTemplateCache.getItem(b),v,k,y,e,s,p,o,c,d,g;if(f)return f;if(this._poiRefresh)v=1,k=t._getPointStateName(i,t._poiTypeStateGroups[v]),f=this._getTemplates_PoiRefresh(v,!1,a,null,null,1,u,[k],!0,!0);else{if(f=[],y=this._getStyleScale(u),i===3){switch(n){case"start":e="#1fa94a";s="rgba(227,231,204,0.5)";break;default:e="#4c97ec";s="rgba(204,230,255,0.5)";break;case"end":e="#de2525";s="rgba(248,211,211,0.5)"}(e||s)&&(p=this._getHaloImage(a,y,function(){return n==="turn"?1.25:1.5},function(){return e},function(){return s},function(){return e}),p&&f.push(p))}if(o=this._getImageByBucketId(a),o&&o.template){var tt=this._getScale(o.scale,o.scaleTransform,y),h=o.template.getVectorImage(),w={hitTest:1,hotspotX:undefined,hotspotY:undefined,records:[]};for(c=0,d=h.records.length;c<d;c++)w.records[c]=t._cloneObject(h.records[c]);i===5&&h.records&&h.records.length>1&&h.records[1].style&&(w.records[1].style.fillStyle="#727272");g=new r(w,tt);f.push(g)}}return f&&f.length?this._primitiveTemplateCache.addItem(b,f):f=n==="turn"?[l.directionsTurnTemplate]:[l.poiTemplates[i]],f},t.prototype._getHaloImage=function(n,u,f,e,o,s,h,c){var et,w,y,g,st,v,p,ut,nt,ht,ft,k,tt,it,rt,l,b,a;if(h===void 0&&(h=1),c===void 0&&(c=!0),w=this._images[h===2?t.pricePoiBucketId:t._haloImageBucket],w&&w.template){y={};y.hitTest=1;y.records=[];var ct=this._getScale(w.scale,w.scaleTransform,u),ot=1,d=w.template.getVectorImage();for(y.hotspotX=d.hotspotX,y.hotspotY=d.hotspotY,g=0,st=d.records.length;g<st;g++)if(v=d.records[g],v.vectorType!==3||c){for(p=i._copyObject(v),y.records.push(p),v.scale>0&&(a=f&&f(),a>=0&&(p.scale=a,ot=a)),p.style={},ut=Object.keys(v.style),nt=0,ht=ut.length;nt<ht;nt++)ft=ut[nt],p.style[ft]=v.style[ft];for(k=[],k.push(v.style.strokeStylePaletteKey),k.push(v.style.fillStylePaletteKey),tt=0;tt<k.length;tt++)it=k[tt],it&&(rt=it.split("."),rt.length>1&&(l="."+rt[rt.length-1],(l===t._highlightBorderColor||l===t._borderColor)&&(b=e&&e(l)),(l===t._highlightStrokeColor||l===t._strokeColor)&&(b=s&&s(l)),(l===t._highlightFillColor||l===t._fillColor||l===t._highlightIconColor||l===t._iconColor)&&(b=o&&o(l)),b&&(it===v.style.fillStylePaletteKey?p.style.fillStyle=b:p.style.strokeStyle=b)))}a=ct*ot;a===1.0666666177777648?a=1.084:a===1.15&&(a=1.16);a&&(et=new r(y,a))}return et},t._addDropShadow=function(n,t,r,u,e,o,s,h,c){var y=n[0],v=y&&y.shadowStyle,l,a;v&&(l=window.location,a=i._getUrlParam,v.shadowColor=f.parse(a(l,t)||o).toRgba(),v.shadowBlur=parseFloat(a(l,r)||s.toString()),v.shadowOffset={x:parseFloat(a(l,u)||h.toString()),y:parseFloat(a(l,e)||c.toString())})},t.prototype._addShadow_PoiRefresh=function(n,t,i){var u;if(n&&n.length&&t&&(u=this._computeSplineGraphObject(t.shadow,i),u)){var e=this._computeSplineGraphObject(t.glowColor,i),o=this._computeSplineGraphObject(t.glowSize,i),f=n[0],r=f&&f.shadowStyle;r&&(r.shadowColor=e,r.shadowBlur=o,r.shadowOffset={x:0,y:2})}},t._getPointStateName=function(n,i){var r=t._poiStateNames[n]||"";return i&&r.endsWith("PointState")&&(r=r+(i||"")),r},t.prototype.getCategoryIconTemplate=function(n,u,e,o,s){var l=this,c,h;if(this._stlVersionNum<7.5){this._getCardVectorImageTemplateAsync(n,u,null,e,1,o,s);return}if(c=""+u+e+o+s,h=this._categoryIconCache.getItem(c),n){if(h){Microsoft.Maps.setTimeout(function(){n(h.icon,h.iconColor)},0);return}this._getDefaultVectorImageTemplateAsync(u,function(h){var g=t._transitCatIds[u],tt=h&&h.template,v=null,y="",p="",w,nt,b,it,k;if(tt){for(w=tt.getVectorImage(),nt={hotspotX:w.hotspotX,hotspotY:w.hotspotY,records:[]},b=0,it=w.records.length;b<it;b++){var d=w.records[b],rt=nt.records[b]=i._copyObject(d),a=rt.style=i._copyObject(d.style);d.shapePaletteKey&&d.shapePaletteKey.endsWith(t._backgroundShapeRecord)?(!p&&a.fillStylePaletteKey&&a.fillStylePaletteKey.endsWith(t._fillColor)&&(p=a.fillStyle),a.fillStyle=a.strokeStyle=f.transparent):(y=y||a.fillStyle,a.fillStyle=e||(g?p:y),a.strokeStyle=f.transparent)}v=new r(nt);o&&(s=s||o,k=v.getBounds().getSize(),k.width&&k.height&&v.setScale(Math.min(o/k.width,s/k.height)));l._categoryIconCache.addItem(c,{icon:v,iconColor:g?p:y})}Microsoft.Maps.setTimeout(function(){n(v,g?p:y)},0)})}},t.prototype._getLandmarkVectorImageTemplate_PoiRefresh=function(n,i,r,u){var e=n.bucket,o=n.entity&&n.entity.oid||"",s=t._getPointStateName(i,t._poiTypeStateGroups[u]),h=""+u+e+o+s+r,f=this._primitiveTemplateCache.getItem(h);return f?f:(f=this._getTemplates_PoiRefresh(u,!1,e,null,o,n.geometryType,r,[s],!1,!0),f&&this._primitiveTemplateCache.addItem(h,f),f)},t.prototype._getBucketPaletteKey=function(n,i){var r="",e,o,s,u,c,f,h;if(!n||n===i)return r;if(e=this._getImageByBucketId(n),o=e&&e.template,o)for(s=o.getVectorImage(),u=0,c=s.records.length;u<c;u++)if(f=s.records[u],!f.shapePaletteKey||!f.shapePaletteKey.endsWith(t._backgroundShapeRecord)){r=f.style.fillStylePaletteKey;break}return r&&(h=r.split("."),h.length>1&&(r=h[0])),r},t.prototype._getPoiVectorImageTemplate_PoiRefresh=function(n,i,r,u,f,e){var s;i=i||"";var h=t._getPointStateName(u,t._poiTypeStateGroups[r]),c=n+","+i+","+h+","+f+","+e,o=this._primitiveTemplateCache.getItem(c);if(o)return o;s=t._localCatIdBucketMapping[n];s||(s=t.DefaultBucketForLocalCat);var l=[h],a=t._localCatIdBucketMapping[i],v=this._getBucketPaletteKey(a,s);return v&&l.push(v),o=this._getTemplates_PoiRefresh(r,e,s,a,null,1,f,l,!0,!0),o&&this._primitiveTemplateCache.addItem(c,o),o},t.prototype._getTemplates_PoiRefresh=function(i,u,f,e,o,s,h,c,l,a){var w=null,b,k,nt,y,v,g,rt,p,ft;if(!this._initialized)return n.log(null,"TemplateSelector needs to be initialized before getTemplates() call"),null;if(b=this._passDefinitionList[this._bucketToPassDefinitionIndex[f]],k=this._getStyleScale(h),o&&t._orgImages_poiRefresh[o]){if(nt=this._styleVisibilities[this._bucketToDrawOrderListIndex[f]],l||this._isTemplateVisible(h,nt,s)){var ot=this._getScale(b.scale,b.scaleTransform,k),tt=t._orgImages_poiRefresh[o],it=tt?tt.vectorImage:null;it&&(w=[new r(it,ot)])}}else if(y=this._getImageByBucketId(f),v=y?y.template:null,i===3&&c.push("ItineraryPoint"),v&&a&&(g=JSON.parse(JSON.stringify(v.getVectorImage())),v=new r(g)),v&&(l||this._isTemplateVisible(h,y.visibility,s))){(i===2||u)&&(rt=i===2?2:3,v=this._applyStackedBackgroundShape(rt,u,c,v));v=this._applyStackedBackgroundShape(null,u,c,v);var g=v.getVectorImage(),d=g.records,ut=i===1&&t._invertedIconBucketIds[e];for(p=0,ft=d.length;p<ft;p++)this._applyStackedColor(c,d[p].style,"fillStyle","fillStylePaletteKey",!ut),this._applyStackedColor(c,d[p].style,"strokeStyle","strokeStylePaletteKey",!ut),this._applyStackedScale(c,d[p],"scale","scalePaletteKey");var st=this._getSplineGraphPaletteKey(y.scale),et=this._getStackedNumericValueItem(c,st)||{},ht=this._getScale(y.scale,y.scaleTransform,k,et.value,et.ignoreTransform);v.setScale(ht);w=[v]}return this._addShadow_PoiRefresh(w,b,k),w},t.prototype.getMarkupStyle=function(i,r,u,f){var e=i&&i.bucket,o,p,v,c,l,y;if(e){var a=i.geometryType,s=Math.round(this._scaleToZoom(r)),h=this._markupOrder.getItem(""+s);if(h||(this._loadTemplates(s),h=this._markupOrder.getItem(""+s)),n.assertNotNull(h,"no markup order for zoom "+s),o=h[e+","+a],!o){if(p=e,e=this._getOriginalBucketId(e),n.assert(e!=null,"failed to map bucketId "+p),!e)return;o=h[e+","+a]}if(o)return(v=[],c=t._getPointStateName(u,t._poiTypeStateGroups[f]),c&&v.push(c),l=this._computeStyleDynamic(o,a,s,v),l)?(c&&!this._poiRefresh&&(y=this._getColor(c+t._labelColor,!0),y&&l&&(l.fontColor=y)),{styleStatic:o.style.styleStatic,styleDynamic:l}):void 0}},t.prototype.getLandmarkVectorImageTemplate=function(n,i,u,f){var o=this,b,v,y,h,g,p,w;f===void 0&&(f=5);var l=n.bucket,a=!!it.getTransitJson(n.entity),s=this._scaleToZoom(u);if(this._poiRefresh)return f===5&&t._transitBucketIds[l]&&(f=6),this._getLandmarkVectorImageTemplate_PoiRefresh(n,i,s,f);b=n.entity&&n.entity.oid||"";v=t._poiStateNames[i];n.layer&&n.layer.getHighlighted()&&a&&(s=20,u=tt.toScale(null,s,!0));var k=l+b.toString()+v+u.toString(),e=this._primitiveTemplateCache.getItem(k),d=this._poiShadow&&!a;if(e||(e=this.getTemplates(n,u,!0),!e))return e;if(d&&e[0]instanceof r){if(i===3)for(y=e[0].getVectorImage(),h=0,g=y.records.length;h<g;h++)p=y.records[h].style,w=p.fillStylePaletteKey,w&&w.indexOf(t._iconColor)>-1&&(p.fillStyle="#444");t._addDropShadow(e,"lsc","lsb","lsx","lsy","rgba(0,0,0,0.4)",4,0,2)}if(!d&&(i===3||i==4)){var c=a?"Transit":"Business",rt=this._getStyleScale(s),nt=this._getHaloImage(l,rt,function(){return o._getPoiImageStyleValue(t._highlightScale,c,v)},function(n){return o._getColor(c+n,!0)},function(n){return o._getColor(c+n,!0)},function(n){return o._getColor(c+n,!0)});nt&&e.unshift(nt)}return this._primitiveTemplateCache.addItem(k,e),e},t.prototype._getPoiVectorImageTemplate_Shadow=function(n,i,u,f,e){function ht(n,i){for(var u,o,r=0,f=n.records.length;r<f;r++){var e=n.records[r],s=e.style||{},h=s.fillStylePaletteKey||"";h.indexOf(t._iconColor)>-1&&(u=JSON.parse(JSON.stringify(e)),o=u.style,o.fillStyle="#FFF",i.records.push(u))}}var et=t._taskList[i],ot=t._poiStateNames[u],st=n+ot+et+e,o=this._primitiveTemplateCache.getItem(st),v,k,y,ct,s,nt,p,rt,lt,at,ut,ft;if(o)return o;o=[];var w=t._defaultPoiBackground,b=22,c="";switch(u){case 2:default:b=20;break;case 3:c="#444";break;case 4:w=t._selectedPoiBackground;c="#000";break;case 5:b=16;break;case 6:w=t._selectedPoiBackground}for(c||(c=this._getPoiImageColor(t._fillColor,et,ot)),v=JSON.parse(JSON.stringify(w)),k=v.records,y=0,ct=k.length;y<ct;y++)s=k[y].style,s.fillStylePaletteKey&&s.fillStylePaletteKey.indexOf(t._fillColor)>-1&&(s.fillStyle=c),s.strokeStylePaletteKey&&s.strokeStylePaletteKey.indexOf(t._strokeColor)>-1&&(s.strokeStyle="#FFF");var g=new r(v),vt=g.getBounds(),yt=vt.getSize().width,pt=b/yt||1;if(g.setScale(pt),o.push(g),t._addDropShadow(o,"psc","psb","psx","psy","rgba(0,0,0,0.6)",4,0,2),nt=!e&&this._getDefaultVectorImageTemplate(n),p=nt&&nt.template,p){var h=p.getRawBounds(),tt=h.getSize(),wt=tt.width,it=16/wt||1,bt=p.getVectorImage(),a={hitTest:1,records:[]};ht(bt,a);a.records.length||(rt=t._fallbackIcon,lt=new r(rt),h=lt.getRawBounds(),tt=h.getSize(),it=1,ht(rt,a));at=v.hotspotY;ut=void 0;at&&(ut=new d((h.minPoint.x+h.maxPoint.x)/2,h.minPoint.y+tt.height/2+17/it));a.records.length&&o.push(new r(a,it,ut))}return o.length?this._primitiveTemplateCache.addItem(st,o):(ft=l.poiTemplates[u],o=ft?[ft]:[]),o},t.prototype.getPoiVectorImageTemplate=function(n,u,e,o,s,h,c,a){var rt=this,v,ut,et,g,nt,tt,ot,st,it,w,at,ft,ht,ct;if(s===void 0&&(s=1),h===void 0&&(h=!0),this._poiShadow&&s!==2?v=this._getPoiVectorImageTemplate_Shadow(n,u,e,o,h):this._poiRefresh&&(v=this._getPoiVectorImageTemplate_PoiRefresh(n,c,s,e,o,h)),v)return v.slice();var y=t._taskList[u],p=s===2?t._pricePoiStateNames[e]:t._poiStateNames[e],lt=n+p+y.toString()+o.toString()+"_PT"+s+h;if(v=this._primitiveTemplateCache.getItem(lt),v)return v.slice();if(v=[],ut=this._getStyleScale(o),et=this._getHaloImage(a,ut,function(){return rt._getPoiImageStyleValue(s===1?t._highlightScale:t._scale,y,p)},function(n){return rt._getPoiImageColor(n,y,p)},function(n){return rt._getPoiImageColor(n,y,p)},function(n){return rt._getPoiImageColor(n,y,p)},s,h),et&&v.push(et),g={},g.hitTest=1,g.records=[],nt=s!==2||!h?this._getDefaultVectorImageTemplate(n):null,nt&&nt.template){for(tt=1,s===2?tt=t._scaleForCategoryIconInPricePoi:t._transitCatIds[n]?(ot=this._getImageByBucketId(t._transitBucketForScaling)||nt,tt=this._getScale(ot.scale,ot.scaleTransform,ut)):tt=this._getScale(nt.scale,nt.scaleTransform,ut),st=1,it=nt.template.getVectorImage(),w=0,at=it.records.length;w<at;w++){g.records[w]=i._copyObject(it.records[w]);it.records[w].scale&&(ft=this._getPoiImageStyleValue(t._backgroundScale,y,p),ft>=0&&(g.records[w].scale=ft,st=ft));var vt=g.records[w].style=i._copyObject(it.records[w].style),k=vt.fillStylePaletteKey,b=null;k&&(k.indexOf(t._backgroundColor)>-1?b=this._getPoiImageColor(t._backgroundColor,y,p):k.indexOf(t._borderColor)>-1?b=this._getPoiImageColor(t._borderColor,y,p):k.indexOf(t._colorString)>-1?b=this._getPoiImageColor(t._colorString,y,p):k.indexOf(t._fillColor)>-1?b=s===2?f.transparent:this._getPoiImageColor(t._fillColor,y,p):k.indexOf(t._borderStrokeColor)>-1?b=this._getPoiImageColor(t._borderStrokeColor,y,p):k.indexOf(t._iconColor)>-1?b=this._getPoiImageColor(t._iconColor,y,p):k.indexOf(t._strokeColor)>-1&&(b=this._getPoiImageColor(t._strokeColor,y,p)),b&&(vt.fillStyle=b))}ht=new r(g,1,s===2?new d(0,3):undefined);ht.setScale(tt*st);v.push(ht)}return v.length===0?(ct=l.poiTemplates[e],v=ct?[ct]:[]):this._primitiveTemplateCache.addItem(lt,v),v.slice()},t.prototype._applyPolygonDrawingPass=function(n,t,i,r){var u,e,f;t&&n&&(t.brushColor?(u=this._getStackedColorValue(i,this._fixedStringList[this._computedSplineGraphPaletteKeys[t.brushColor]],!0),n.fillStyle=u||this._computeSplineGraphObject(t.brushColor,r)):t.penColor&&(n.strokeStyle&&(n.secondaryLineWidth=n.lineWidth,n.secondaryStrokeStyle=n.strokeStyle),u=this._getStackedColorValue(i,this._fixedStringList[this._computedSplineGraphPaletteKeys[t.penColor]],!0),n.strokeStyle=u||this._computeSplineGraphObject(t.penColor,r),t.penWidth&&(e=this._getSplineGraphPaletteKey(t.penWidth),f=this._getStackedNumericValueItem(i,e)||{},n.lineWidth=this._getScale(t.penWidth,t.penWidthTransform,r,f.value,f.ignoreTransform))))},t.prototype._getAreaPolygonTemplates_PoiRefresh=function(n,r,u){var c=parseInt(t.xsrPolygonBucketId),l=this._scaleToZoom(r),v="apt_"+c+"_"+n+"_"+l+"_"+u,f=this._primitiveTemplateCache.getItem(v),e,h,s,p,w;if(f)return f;switch(n){default:case 2:e="DefaultAreaStateSearch";break;case 3:e="HoverAreaStateSearch";break;case 4:e="SelectedAreaStateSearch"}var b=e?[e]:[],k=this._getStyleScale(l),y=this._drawOrderList,d=this._passDefinitionList,o=i._allIndexesOf(y.bucket,c);if(o&&o.length){for(h={hitTest:u},s=0,p=o.length;s<p;s++)w=d[y.passID[o[s]]],this._applyPolygonDrawingPass(h,w,b,k);f=[new a(h)];this._primitiveTemplateCache.addItem(v,f)}return f},t.prototype.getCityPolygonTemplates=function(n,i,r,u,e){var v=null;if(n===t.cityPolygonBucket||n===t.xsrPolygonBucketId){if(this._poiRefresh)return this._getAreaPolygonTemplates_PoiRefresh(r,u,e);var s=t._taskList[i],h=t._poiStateNames[r],c=0,l=0,o=this._getPoiImageColor(t._highlightBorderColor,s,h);if(o||(o=this._getPoiImageColor(t._highlightStrokeColor,s,h)),r===2||r===3?(c=5,l=2):r===5&&(c=4,l=1.5,o=this._getPoiImageColor(t._borderColor,s,h),o||(o=this._getPoiImageColor(t._strokeColor,s,h))),o){var y=new a({strokeStyle:f.white,fillStyle:f.transparent,lineWidth:c,hitTest:e}),p=new a({strokeStyle:o,fillStyle:r===3?"rgba(90, 255, 150, 0.4)":f.transparent,lineWidth:l});v=[y,p]}}return v},t.getPushpinTextTemplates=function(n,i,u,f){var h=[],e={style:{fillStyle:"rgb(255,255,255)",font:"Arial, Helvetica, Sans-Serif",fontStyle:1,fontSize:11.25,horizontalAutoScaling:1},text:"{MapDisplay}",anchor:{x:0,y:0},vectorType:3,scale:1},o,l,s,a;if(i){var v=i.height,c=i.width,p=f.x,w=f.y,y={pointsList:[{x:0,y:0},{x:c,y:0},{x:c,y:v},{x:0,y:v}],vectorType:0,style:{fillStyle:"rgba(255,255,255,0)"},scale:1};e.maxWidth=c;e.style.fontSize=10;e.anchor.x=u.x;e.anchor.y=u.y;o={records:[y,e],hitTest:1};h=[new r(o,1,f)]}else l=n.getVectorImage().records,s=l[l.length-1],s&&s.vectorType===2&&(a=t._cloneObject(s),e.maxWidth=a.radiusX*2/1.414,o={records:[a,e],hitTest:1},h=[new r(o,n.getScale())]);return h},t.prototype.getTemplates=function(i,u,f){var a,nt,s,e,h,l,it,o,k,w,b;if(f===void 0&&(f=!1),a=null,!this._initialized)return n.log(null,"TemplateSelector needs to be initialized before getTemplates() call",this._initialized),null;var y=i.entity&&i.entity.oid,p=i.bucket,v=this._scaleToZoom(u);if(y&&t._orgImages[y]){if(nt=this._styleVisibilities[this._bucketToDrawOrderListIndex[p]],this._isTemplateVisible(v,nt,i.geometryType)){var tt=this._passDefinitionList[this._bucketToPassDefinitionIndex[p]],w=this._getStyleScale(v),b=this._getScale(tt.scale,tt.scaleTransform,w),c=t._orgImages[y];a=[new g(c,b,new d((c.naturalWidth||c.width)/2,(c.naturalHeight||c.height)/2))]}}else if(s=this._getImageByBucketId(p),e=s?s.template:null,e&&f&&(h=JSON.parse(JSON.stringify(e.getVectorImage())),e=new r(h)),e&&this._isTemplateVisible(v,s.visibility,i.geometryType)){for(h=e.getVectorImage(),l=0,it=h.records.length;l<it;l++)o=h.records[l].style.fillStylePaletteKey,k=this._getColor(o,!1),k&&o&&(o.indexOf(t._backgroundColor)>-1||o.indexOf(t._borderColor)>-1||o.indexOf(t._colorString)||o.indexOf(t._fillColor))&&(h.records[l].style.fillStyle=k);w=this._getStyleScale(v);b=this._getScale(s.scale,s.scaleTransform,w);e.setScale(b);a=[e]}return a},t.prototype._populateDraworderByZoom=function(t){var s,c,o,d,b,nt,tt,h,i,k,e;if(this.processDrawOrder){n.time("ParseDrawOrder");var u=this._passDefinitionList,l=new Array(u.length),v={bucket:this._drawOrderList.bucket,style:this._drawOrderList.passID,validKeys:{},keys:this._drawOrderList.bucket,templates:new Array(this._drawOrderList.passID.length),visibilities:new Array(this._drawOrderList.passID.length)},f=this._getStyleScale(t),y=0;for(i=0,k=u.length;i<k;i++){if(s={},u[i].arrowHeadLength){var et=this._computeSplineGraphObject(u[i].arrowHeadLength,f)||0,p=[],w=this._computeSplineGraphObject(this._passDefinitionList[i].bitPattern,f),it=this._computeSplineGraphObject(this._passDefinitionList[i].patternRepeat,f);if(w>0){w=Math.floor(w);var rt=!1,ut=0,ft=w.toString(2).length;for(c=0;c<ft;c++)rt=(w>>c&1)!=1,ut++,rt&&p.push(ut);p.length===0&&ft>0&&p.push(c);c<it&&p.push(it-c);s.dashes=p}et>0?(o={},h=this._computeSplineGraphObject(u[i].arrowHeadCode,f),o.arrowHeadParts=h==="ArrowHeadEnumBoth"?3:0,o.arrowShaftLength=this._computeSplineGraphObject(u[i].arrowLength,f)||0,o.arrowShaftSpacing=this._computeSplineGraphObject(u[i].arrowSpacing,f)||0,o.arrowHeadLength=this._computeSplineGraphObject(u[i].arrowHeadLength,f)||0,o.arrowAngle=this._computeSplineGraphObject(u[i].arrowAngle,f),o.arrowAngleFill=this._computeSplineGraphObject(u[i].arrowAngleFill,f)||0,o.arrowHeadStrokeWidth=this._computeSplineGraphObject(u[i].arrowHeadStrokeWidth,f),o.strokeStyle=this._computeSplineGraphObject(u[i].penColor,f),o.lineWidth=this._computeSplineGraphObject(u[i].penWidth,f),l[y]=new wt(o)):(u[i].penColor&&(h=this._computeSplineGraphObject(u[i].penColor,f),s.fillStyle=h),u[i].penWidth&&(h=this._computeSplineGraphObject(u[i].penWidth,f),s.lineWidth=h),s.hitTest=this._hitTest?1:0,l[y]=new a(s))}else if(this._mapImages&&typeof u[i].bitmap!="undefined")if(e=Math.round(this._computeSplineGraphObject(u[i].bitmap,f)),e==-1&&(e=0),this._mapImages[e]||this._updateCachedImages(this._mappedToUnmappedImageIndex[e]),e>=0&&e<this._mapImages.length){if(d=this._mapImages[e],b=d,!d)continue;nt=this._computeSplineGraphObject(u[i].scale,f);b.vectorImage?(b.vectorImage.hitTest=b.vectorImage.hitTest?1:this._hitTest?1:0,l[y]=new r(b.vectorImage,nt)):l[y]=new g(d,nt)}else throw"Image index is out of bounds";else tt=this._computeSplineGraphObject(this._passDefinitionList[i].fillImage,f),e=tt!==null?Math.round(tt):-1,e>=0&&e<this._mapImages.length&&(s.fillImage=this._mapImages[e]),u[i].fillStyle&&(h=this._computeSplineGraphObject(u[i].fillStyle,f),s.fillStyle=h),s.hitTest=this._hitTest?1:0,l[y]=new a(s);y++}for(i=0,k=this._drawOrderList.bucket.length;i<k;i++)v.validKeys[v.keys[i]=v.bucket[i].toString()]=!0,e=this._drawOrderList.passID[i],v.templates[i]=l[e],v.visibilities[i]=this._styleVisibilities[i];this._drawOrder.addItem(""+t,v);n.time("PopulateDraworder");n.timeEnd("ParseDrawOrder")}},t.prototype._getvisibilities=function(n,t,i){for(var u,g,w,s,h,tt,b,f,e,r,it,k,p,a,d=[],rt=n.length,o=0;o<rt;o++){u={drawingStyleVisibilities:{}};switch(t[o]){case 0:u.geometryType=1;break;case 2:u.geometryType=2;break;case 3:u.geometryType=3}g=n[o];for(w in g){s=[];u.densityLodCollection=new nt;switch(w){case"point":h=1;break;case"line":h=2;break;case"polygon":h=3}for(tt=n[o][w],b=i[tt],f=0;f<b.length;f++)r={visible:!1},e=b[f],r.densityDistance=e.densityDistance,r.densityImportance=e.densityImportance,r.visible=e.visible,r.zoom=Math.round(c.calculateZoomforStyleScale(e.startZoomLevel)),r.visiblePaletteKey=e.visiblePaletteKey,s.push(r);var v=c.markupVisible,y=1,l=0;if(h===u.geometryType)for(f=s.length-1;f>=0;f--){if(r=s[f],l=this._getStyleScale(r.zoom),it=r.densityDistance===0&&r.densityImportance===0,it)u.densityLodCollection.addRange(l,y,v);else{for(k=(y-l)/c.zoomDeltaBetweenLods,p=v+k,a=l;a<y;a+=c.zoomDeltaBetweenLods)u.densityLodCollection.addRange(a,a+c.zoomDeltaBetweenLods,p),p=p-1;v+=k}y=l;r.densityLodDelta=v}u.drawingStyleVisibilities[h]=s}d.push(u)}return d},t.prototype._computeHslaTransform=function(n,i,r,u){var o,e,s,f,h;return this._computedSplineGraphs&&(e=this._computedSplineGraphs[n],e&&(s=e.evaluateHsla(i),f=v.applyHslaTransform(s,r),u&&f.z<.7&&(f.z*=u),h=v.hslaTorgba(f.x,f.y,f.z,f.w*t._alphaTransformCoefficient),o=h.toRgba())),o},t.prototype._computeSplineGraphObject=function(n,t){var r=null,i;if(this._computedSplineGraphs)return i=this._computedSplineGraphs[n],i instanceof rt?r=i.evaluate(t):i instanceof ut?r=i.evaluate(t).toRgba():i instanceof nt?r=i.evaluate(t):i instanceof ht?r=i.evaluate(t):i instanceof ct&&(r=i.evaluate(t)),r},t.prototype._getSplineGraphPaletteKey=function(n){var t=this._computedSplineGraphPaletteKeys[n];return this._fixedStringList[t]},t.prototype._intersect=function(n,t){var r=n.crs,b=n.geometry,u=r.getMatrix&&r.getMatrix(t.crs),o,s,h,c,i=b.bounds,f=t.bounds,k=f[0],d=f[1],g=f[2],nt=f[3],p,w;if(u)o=u.projectY(i[3],i[0]),s=u.projectY(i[1],i[2]),h=u.projectX(i[3],i[0]),c=u.projectX(i[1],i[2]);else{var l=r.toLatitude(i[3],i[0]),a=r.toLongitude(i[3],i[0]),v=r.toLatitude(i[1],i[2]),y=r.toLongitude(i[1],i[2]),e=t.crs;o=e.projectToY(l,a);s=e.projectToY(v,y);h=e.projectToX(l,a);c=e.projectToX(v,y)}return p=st.fromSides(h,c,o,s),w=st.fromSides(nt,d,k,g),p.intersects(w)},t.prototype.getDrawOrderList=function(t){n.groupCollapsed(null,"Getting drawOrder List for scale: {0}",t.toString());var i=Math.round(this._scaleToZoom(t)),r=this._drawOrder.getItem(""+i);return r||(n.log(null,"Draworder list not available for zoom: {0}, loading templates",i),this._loadTemplates(i),r=this._drawOrder.getItem(""+i)),n.assert(!this.processDrawOrder||!!r,"BaseMapTemplateSelector.getDrawOrderList: Draworder list not available for zoom: "+i),n.logObject(null,"Result",r),n.groupEnd(),r},t.prototype.indexPrimitives=function(t,i,r){var f,o,h,s,e,u,c;if(n.groupCollapsed(null,"Index primitives"),f={},o=this.getDrawOrderList(r),n.logObject(null,"drawOrderList",o),o)for(h=o.validKeys,s=0;s<t.length;s++)e=t[s],u=e.bucket,h[u]||(u=this._shieldToRoadIdMapping[u],e.bucket=u),h[u]&&this._intersect(e,i)&&(c=f[u]=f[u]||[],c.push(e));return n.logObject(null,"indexed",f),n.groupEnd(),f},t.prototype.getLandColor=function(){return this._landColor[0].value},t.prototype._getMarkupOrderList=function(t){var i=Math.round(this._scaleToZoom(t)),r;return n.groupCollapsed(null,"Get markup order list for zoom: {0}",i.toString()),r=this._markupOrder&&this._markupOrder.getItem(""+i),n.groupEnd(),null},t.prototype._getOriginalBucketId=function(n){var t=Math.floor(parseInt(n)&65535);return t.toString()},t.prototype.getMarkupRecord=function(i,r,u,f){var i,e,a,o,c,s,v,h,y,l;if(r){if(i=Math.round(i),e=this._markupOrder.getItem(""+i),e||(this._loadTemplates(i),e=this._markupOrder.getItem(""+i)),n.assertNotNull(e,"no markup order for zoom "+i),o=e[r+","+u],!o){if(a=r,r=this._getOriginalBucketId(r),n.assert(r!=null,"failed to map bucketId "+a),!r)return;o=e[r+","+u]}if(o){if(c=[],f){s=2;switch(f){case 1:s=3;break;case 2:s=4}v=t._getPointStateName(s,t._poiTypeStateGroups[1]);c=[v]}if(h=this._computeStyleDynamic(o,u,i,c),h)return s&&!this._poiRefresh&&(y=t._poiStateNames[s],l=this._getColor(y+t._labelColor,!0),l&&h&&(h.fontColor=l)),{styleStatic:o.style.styleStatic,styleDynamic:h}}}},t.prototype._computeStyleDynamic=function(n,i,r,u){var f=n.style.styleDynamic||{},o,h=f.visible,b=f.densityDistance,k=f.densityImportance,d=f.densityLodDelta,c=0,l,g,v,s,e,y,p,w,a,nt;if(n.visibility){for(l=n.visibility.drawingStyleVisibilities[i],g=l.length,s=0;s<g;s++)e=l[s],c=c||e.visiblePaletteKey,r>=e.zoom&&(h=e.visible,b=e.densityDistance,k=e.densityImportance,d=e.densityLodDelta);if(i===3){for(v=!1,l=n.visibility.drawingStyleVisibilities[2],s=0;s<l.length;s++)e=l[s],c=c||e.visiblePaletteKey,r>=e.zoom&&(v=e.visible);(h||v)&&(h=!0)}c&&(y=this._getCustomStyle(c),y!==undefined&&(h=y))}if(h&&(o={visible:h,densityDistance:b,densityImportance:k,densityLodDelta:d,priority:n.priority,font:f.font,fontPaletteKey:f.fontPaletteKey,fontSize:f.fontSize,fontScalePaletteKey:f.fontScalePaletteKey,fontWeight:f.fontWeight,fontWeightPaletteKey:f.fontWeightPaletteKey,fontColor:f.fontColor,fontColorPaletteKey:f.fontColorPaletteKey,outlineColor:f.outlineColor,outlineColorPaletteKey:f.outlineColorPaletteKey,secondaryFontSize:f.secondaryFontSize,globalOrder:n.globalOrder},this._poiRefresh&&(this._applyStackedString(u,o,"font","fontPaletteKey"),this._applyStackedScale(u,o,"fontSize","fontScalePaletteKey"),this._applyStackedEnum(u,o,"fontWeight","fontWeightPaletteKey"),this._applyStackedColor(u,o,"fontColor","fontColorPaletteKey",!0),this._applyStackedColor(u,o,"outlineColor","outlineColorPaletteKey",!0)),p=this._passDefinitionList&&this._passDefinitionList[n.style.markupPassDefinitionIndex],p&&this._customStyleManager&&this._customStyleManager.styleString))for(w=t._customStyleProperties,a=0,nt=w.length;a<nt;a++)this._applyCustomStyle(o,p,w[a]);return o},t.prototype._applyCustomStyle=function(n,t,i){var u=t[i],f=this._computedSplineGraphPaletteKeys[u],r=this._getCustomStyle(f);r!==undefined&&(n[i]=r)},t.prototype._getCustomStyle=function(n){var i=this._fixedStringList[n],t=i&&i.split("."),r;return t&&t.length===2&&(r=this._customStyleManager.getElementStyle(t[0],t[1])),r},t.prototype._getStyleScale=function(n){return Math.round(c.calculateStyleScaleForLod(n)*1e7)/1e7},t.prototype.prefetchShields=function(n,i){var r=this;return i===void 0&&(i=3),new Promise(function(u){for(var v,l,c,f,e,a=[],o={},s=0;s<n.length;s++)for(v=r._getShieldUnmappedImageIndexes(n[s].bucketId),l=n[s].indexes,c=0;c<l.length;c++)f=v[l[c]],f>=0&&(t._mapImagesUnmapped[f]?r._updateCachedImages(f):o[f]||(o[f]=!0));for(e in o)o.hasOwnProperty(e)&&a.push(new Promise(function(u){var f=parseInt(e)%2,o=r._urlImageFormat.replace(/{imageIdx}/ig,e).replace(/{orgId}/ig,"").replace(/{subdomain}/ig,(isNaN(f)?0:f)+"");h.downloadJson(o,"XsrImages",function(n,i){if(!r._isDisposed){var f=r._parseImageRecord(n[i],r._svgColor);t._mapImagesUnmapped[parseInt(i)]=f;r._mapImages[r._unmappedToMappedImageIndex[i]]=f}u()},function(){i>0&&Microsoft.Maps.setTimeout(function(){r._isDisposed||r.prefetchShields(n,--i)},200);u()},e,!1,0,!1)}));Promise.all(a).then(function(){u()})})},t.prototype.prefetchOrganizationImages_PoiRefresh=function(n,i){var r=this,f=[],u,e;if(n)for(u=0,e=n.length;u<e;u++)t._orgImages_poiRefresh[n[u]]||f.push(n[u]);return new Promise(function(n){for(var e=[],s=function(n){var u=f[n],o=parseInt(u)%2,s=r._urlImageFormat.replace(/{orgId}/ig,u).replace(/{imageIdx}/ig,"").replace(/{subdomain}/ig,(isNaN(o)?0:o)+"");e.push(new Promise(function(n){h.downloadJson(s,"XsrOrgJsImages",function(i,u){if(i&&!r._isDisposed){var f=r._parseImageRecord(i.image,i.svgColor);t._orgImages_poiRefresh[u]=f}n()},function(t){i>0&&Microsoft.Maps.setTimeout(function(){r._isDisposed||r.prefetchOrganizationImages_PoiRefresh([t],i-1)},200);n()},u,!1,0,!1)}))},u=0,o=f.length;u<o;u++)s(u,o);Promise.all(e).then(function(){n()})})},t.prototype.prefetchOrganizationImagesByOrgId=function(n,i){var f=this,u,r;if(i===void 0&&(i=3),this._poiRefresh)return this.prefetchOrganizationImages_PoiRefresh(n,i);if(u=[],n)for(r=0;r<n.length;r++)t._orgImages[n[r]]||u.push(n[r]);return new Promise(function(n){for(var o=[],r=0;r<u.length;r++){var e=u[r],s=parseInt(e)%2,c=f._urlImageFormat.replace(/{orgId}/ig,e).replace(/{imageIdx}/ig,"").replace(/{subdomain}/ig,(isNaN(s)?0:s)+"");o.push(new Promise(function(n){h.downloadGeneric(c,"XsrOrgImages",function(i,r){var u=document.createElement("img"),f=function(){window.clearTimeout(e);u.onload=null;t._orgImages[r]=u;n()},e=Microsoft.Maps.setTimeout(function(){return f()},1e3);u.onload=function(){f()};u.src="data:image/svg+xml;base64,"+window.btoa(i)},null,function(t){i>0&&Microsoft.Maps.setTimeout(function(){f._isDisposed||f.prefetchOrganizationImagesByOrgId([t],--i)},200);n()},e,0)}))}Promise.all(o).then(function(){n()})})},t.prototype.prefetchImages=function(n,i,r,u){var f=this;return u===void 0&&(u=3),i=i||[],new Promise(function(e){for(var w,l,b,v,k,y=[],a=!1,c={},p=function(n){var i,u;n>=0&&(i=f._mappedToUnmappedImageIndex[n],t._mapImagesUnmapped[i]&&f._updateCachedImages(i),u=f._mapImages[n],a=a||!u,(!u||r)&&(c[i]=!0))},o=0,s=n.length;o<s;o++)w=n[o],l=f._bucketToMappedImageIndex[w],p(l);for(o=0,s=i.length;o<s;o++)l=f._unmappedToMappedImageIndex[i[o]],p(l);if(a)for(r&&(b=Object.keys(c),c={},c[b.join(",")]=!0),v=Object.keys(c),k=function(e){var o=v[e];y.push(new Promise(function(e){var s=o.split(","),c=parseInt(s[0])%2,l=f._urlImageFormat.replace(/{imageIdx}/ig,o).replace(/{orgId}/ig,"").replace(/{subdomain}/ig,(isNaN(c)?0:c)+"");h.downloadJson(l,"XsrImages",function(n,i){var r,o,u,s;if(!f._isDisposed)for(r=0,o=i.length;r<o;r++)u=parseInt(i[r]),s=f._parseImageRecord(n[i[r]],f._svgColor),t._mapImagesUnmapped[u]=s,f._updateCachedImages(u);e()},function(){u>0&&Microsoft.Maps.setTimeout(function(){f._isDisposed||f.prefetchImages(n,i,r,--u)},200);e()},s,!1,0,!1)}))},o=0,s=v.length;o<s;o++)k(o,s);Promise.all(y).then(function(){e()})})},t.prototype.getFetchedShields=function(n,t,i){var f,e,h,u,r;if(!t||!i||!i.length)return null;var n=Math.round(n),o=this._getShieldImages(t,i),s=[];if(o)for(f=this._getShieldScales(n,t),e=0,h=i.length;e<h;e++)u=i[e],r=null,u>=0&&(r=o[u],r&&f&&f[u]&&r.setScale(f[u]),r||(r=l.DefaultShieldTemplate)),s.push(r);return s},t.prototype.getShieldsAsync=function(n,t,i,r){var u=this,f;r&&(f={bucketId:t,indexes:i},this.selectorReady().then(function(){u.prefetchShields([f]).then(function(){r(u.getFetchedShields(n,t,i))})}))},t.prototype.getSDKLandmarkImageTemplates=function(n,i,u){var c,f,o;if(this._v7VenueMapIconProcessed||u||this._showV7HiddenBuckets(),c=n.getState&&n.getState()||2,f=this.getLandmarkVectorImageTemplate(n,c,tt.toScale(null,i,!0)),f&&n.entity.isVenueMapPoi&&(o=f.length-1,o>=0)){var e=f[o],s=t._venueMapsIconSizes,v=Math.max(s.minZoom,Math.min(s.maxZoom,Math.round(i))),h=s[v];if(!h)return null;var y=e.getBounds(),p=e.getScale(),l=y.getSize(),a=Math.max(l.width,l.height);a!==h&&(e=new r(e.getVectorImage(),p*h/a,e.getAnchor()),f=f.slice(),f[o]=e)}return f},t.prototype.dispose=function(){this._shieldStyleResponseData=null;this._computedSplineGraphs=[];this._markupOrder.clear();this._styleVisibilities=[];this._passDefinitionList=[];this._markupVisibilities=[];this._images=null;this._imgVariants=[];this._markupOrderList=null;this._palette=null;this._drawOrderList=null;this._mapImages=[];this._svgColor=[];this._imageGroups=[];this._groupedImageOptions=[];this._fixedStringList=[];this._shieldImages=null;this._shieldScaleListForZoom=null;this._state=[];this._urlFormat=null;this._propertyValues=[];this._drawOrder.clear();this._primitiveTemplateCache.clear();this._categoryIconCache.clear();this._localCatIdVectorImageTemplate=null;this._shieldToRoadIdMapping=null;this._bucketToMappedImageIndex={};this._bucketToPassDefinitionIndex={};this._bucketToDrawOrderListIndex={};this._mappedToUnmappedImageIndex={};this._unmappedToMappedImageIndex={};this._unmappedIndexToBucketIds={};this.ready&&this.ready.dispose();window.clearTimeout(this._delayLoadTimerId);this._isDisposed=!0},t.prototype._scaleToZoom=function(n){return tt.fromScale(null,n,!0)},t.prototype._showV7HiddenBuckets=function(){for(var i,r,u,n=0;n<t._v7BucketsToShow.length;n++)if(i=this._getImageByBucketId(t._v7BucketsToShow[n]),r=i&&i.visibility&&i.visibility.drawingStyleVisibilities[1],r)for(u=0;u<r.length;u++)r[u].visible=!0;this._v7VenueMapIconProcessed=!0},t.prototype._isTemplateVisible=function(n,t,i){for(var o,u=t.drawingStyleVisibilities[i],s=u.length||0,f=!1,e,r=0;r<s;r++)e=e||u[r].visiblePaletteKey,n>=u[r].zoom&&(f=u[r].visible);return this._customStyleManager&&this._customStyleManager.styleString&&(o=this._getCustomStyle(e),typeof o=="boolean"&&(f=o)),f},t._cloneObject=function(n){var i,r,t,f,u;if(!n||typeof n!="object")return n;for(i={},r=Object.keys(n),t=0,f=r.length;t<f;t++)u=r[t],i[u]=this._cloneObject(n[u]);return i},t.prototype.getBrandTemplates=function(n,i,r,f){var l,e;this._brandTemplatesCache||(this._brandTemplatesCache=new s(100));t._brandImageCache||(t._brandImageCache=new s(20));var v=f<13&&r!=4,y=n+(v?"s":""),b=r.toString()+i+y,o=this._brandTemplatesCache.getItem(b);if(o)return o;var k=v?2/3:1,p=12,h=p*k,a=t._brandImageCache.getItem(y);a||(a=new g(u.ImageFromCssHelper.getImageFromCss("brand_"+n),k,new u.Anchor(p,p,1)),t._brandImageCache.addItem(y,a));var d=t._taskList[i],nt=t._poiStateNames[r],c=h+(v?5:4),tt=t._highlightBorderColor,w=1;switch(r){case 4:w=2;tt=t._colorString;break;case 2:c=h+2;break;case 5:c=h}return l=[],c>h&&l.push(t._squareRecord(c,this._getPoiImageColor(t._highlightFillColor,d,nt))),l.push(t._squareRecord(h,"#FFFFFF")),e=c+w/2,l.push({pointsList:[{x:-e,y:-e},{x:e,y:-e},{x:e,y:e},{x:-e,y:e},{x:-e,y:-e}],vectorType:1,style:{lineWidth:w,strokeStyle:this._getPoiImageColor(tt,d,nt)}}),o=[new u.VectorImageTemplate({records:l,hotspotX:0,hotspotY:0,hitTest:1}),a],this._brandTemplatesCache.addItem(b,o),o},t._squareRecord=function(n,t){return{pointsList:[{x:-n,y:-n},{x:n,y:-n},{x:n,y:n},{x:-n,y:n}],vectorType:0,style:{fillStyle:t}}},t._mapImagesUnmapped=[],t._colorString=".Color",t._backgroundColor=".BackgroundColor",t._borderColor=".BorderColor",t._backgroundScale=".BackgroundScale",t._highlightBorderColor=".HighlightBorderColor",t._highlightFillColor=".HighlightFillColor",t._highlightIconColor=".HighlightIconColor",t._highlightScale=".HighlightScale",t._scale=".Scale",t._highlightBorderWidthScale=".HighlightBorderWidthScale",t._labelColor=".LabelColor",t._fillColor=".FillColor",t._borderStrokeColor=".BorderStrokeColor",t._iconColor=".IconColor",t._strokeColor=".StrokeColor",t._highlightStrokeColor=".HighlightStrokeColor",t._backgroundShapeRecord="Shape-Background",t._scaleForCategoryIconInPricePoi=.5,t._orgImages={},t._orgImages_poiRefresh={},t._poiStateNames=["","Micro","DefaultPointState","HoverPointState","SelectedPointState","InactivePointState","InactiveSelectedPointState",],t._poiTypeStateGroups=["","Search","Price","Itinerary","ShowMe","Landmark","Transit","Search",],t._pricePoiStateNames=["","Micro","DefaultPointState2","HoverPointState2","SelectedPointState2","InactivePointState2","InactiveSelectedPointState2",],t._userPoiLabelStylesBucket="357",t.DefaultBucketForLocalCat="357",t.DefaultBucketForLocalCat_PoiRefresh="334",t._taskList=["Task1","Task2","Task3","Transit","Favorite","Layer"],t._haloImageBucket="1372",t.cityPolygonBucket="879",t._localCatIdBucketMapping={EatAndDrink:"286",WhatToDo:"280",WhereToStay:"287",Attraction:"280",Campground:"1366",House:"310",Parking:"275",PivotEntity:"353",Trail:"280","13344":"287","91648":"288","90014":"300","91616":"257","90954":"277","90133":"278","90122":"279","90243":"284","91563":"329","90650":"1365","91533":"271","91649":"281","90948":"1366","90903":"274","90024":"303","90386":"1367","90188":"295","91485":"1368","90727":"306","90859":"325","90089":"276","91538":"296","90298":"318","90738":"67","91348":"309","91572":"287","90320":"297","90837":"313","90045":"273","90016":"304","90960":"1369","91271":"319","90925":"275","90804":"270","90331":"320","90342":"272","90287":"286","90199":"294","90771":"305","91548":"324","91549":"118","91550":"307","91493":"299","90871":"326","90034":"302","90012":"280","91510":"1381","90017":"301","90595":"311","90001":"258","90078":"330","91186":"327","91204":"308","91714":"66","90977":"331","90584":"310","91627":"68","91391":"316","91259":"321","91537":"323","91774":"70","91773":"71","91499":"312","91651":"328","90540":"315","91764":"67","91768":"69","90496":"314","91762":"113","91643":"114","90848":"322","91650":"1359","90942":"317","91621":"64","90892":"1899","91600":"1380","100000":"248","203":"248","255":"254","257":"253","251":"252","253":"251","254":"250","252":"249","91754":"65","205":"247","204":"246","207":"245","206":"244","200":"240","264":"243","265":"242","263":"241","250":"239","202":"238","266":"236","261":"235","91571":"50","201":"234","262":"232","256":"231","260":"229","259":"228","258":"227","267":"226"},t._localCatIdBucketMapping_Delta={House:"1942","90940":"329","90975":"331","90375":"309","90628":"306"},t._transitBucketForScaling="1388",t._task4Color={".BackgroundColor":"rgba(47, 163, 235, 255)",".BorderColor":"rgba(121, 186, 226, 255)",".Color":"rgba(255, 255, 255, 255)",".HighlightBorderColor":"rgba(47, 163, 235, 255)",".HighlightFillColor":"rgba(208,227,247, 180)"},t._layerPoiColors={".BackgroundColor":"rgba(32, 61, 189, 1)",".BorderColor":"rgba(32, 61, 189, 1)",".Color":"rgba(255, 255, 255, 1)",".HighlightBorderColor":"rgba(32, 61, 189, 1)",".HighlightFillColor":"rgba(32, 61, 189, .65)",".HighlightStrokeColor":"rgba(255, 255, 255, 1)",".FillColor":"rgba(32, 61, 189, 1)",".IconColor":"rgba(255, 255, 255, 1)"},t._v7BucketsToShow=["647","648","649","650","651","652","653","689","690","691","692","693","694","695","696","697","698","700","701","702","703","704","706","707","708","709","711","712","713","714","716","717","718","719","720","721","722","723","724","731","732","733","734","735","736","737","738","739","740","741","742","743","744","745","746","747","748","749","771","798","807","809","811","812","813","819","823","826","910","914","915","996","1240","1248","1249","1253","1264","1265","1266","1281","1285","1296","1297","1298","1299","1300","1301","1302"],t.directionIconTypeBuckets={start:"352",middle:"350",via:"1387",turn:"1386",end:"351",ferry:"339",walk:"341",bus:"342",train:"338",airline:"340",tube:"338",auto:"337"},t.poiStylePriorityGroup=999999,t.itineraryPoiBucketId="1941",t.pricePoiBucketId="1901",t.bucketIdForPoi="999999",t.bucketIdForSelectedPoi="999998",t.bucketIdForTransientLensTop="999997",t.bucketIdForTransientLensBottom="999997.5",t.bucketIdForTransientLensLeft="999997.6",t.bucketIdForTransientLensRight="999997.7",t.bucketIdForDirectionsPins="999996",t.xsrPolygonBucketId="1383",t._roadCustomStyle={"999999,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:12,offsetY:12,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"999999,3":{styleStatic:{fontOutlined:!1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"1901,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"999998,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:2,visible:!0,priority:t.poiStylePriorityGroup}},"999997,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.5,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.6,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.7,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999996,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0,offsetX:6,offsetY:6,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#000",outlineColor:"#fff",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}}},t._aerialCustomStyle={"999999,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:12,offsetY:12,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"999999,3":{styleStatic:{fontOutlined:!1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"1901,1":{styleStatic:{fontOutlined:!0,outlineWidth:1,horizontalAlignment:0,wrapDisplayName:!0},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}},"999998,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:2,visible:!0,priority:t.poiStylePriorityGroup}},"999997,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.5,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.6,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999997.7,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:22,offsetY:22,imageWidth:40,imageHeight:40},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:1,visible:!0,priority:t.poiStylePriorityGroup}},"999996,1":{styleStatic:{fontOutlined:!0,outlineWidth:3,horizontalAlignment:0,wrapDisplayName:!0,offsetX:6,offsetY:6,imageWidth:20,imageHeight:20},styleDynamic:{font:"SegoeBing",fontSize:10,fontColor:"#fff",outlineColor:"#000",globalOrder:3,visible:!0,priority:t.poiStylePriorityGroup}}},t._poiStyles={"3348DF34-653A-489E-97B3-7371457982E3":t._roadCustomStyle,"7D2AB870-635B-42F0-A05E-1B07E3F15BEC":t._roadCustomStyle,"097A0D85-2585-425A-8471-60BDD3C5B7C3":t._roadCustomStyle,"A78CB71D-32CA-4F6D-8827-09680717E455":t._roadCustomStyle,"DCD31B1C-B637-4B36-8635-829DF5E46999":t._roadCustomStyle,"DC2B2930-4CA4-45EB-9EE9-3F4EFA4267E5":t._roadCustomStyle,"8CCEE531-6C9C-45AD-9F30-ACE9C310A8B6":t._aerialCustomStyle,"7443EAC9-CD76-4236-B027-22DBC504BF06":t._aerialCustomStyle,"28230F7D-6FAF-49B9-9ED5-254D2E2B8123":t._aerialCustomStyle,"A3A1C843-30CE-4828-984C-AD44EAF2A245":t._aerialCustomStyle,"68C27B9C-4FB4-4CEC-A664-3FC3C2E8A12A":t._aerialCustomStyle,"3AD7646D-02C7-4E2A-B3AB-2044A88171E9":t._aerialCustomStyle},t._darkTemplates={"8CCEE531-6C9C-45AD-9F30-ACE9C310A8B6":!0,"7443EAC9-CD76-4236-B027-22DBC504BF06":!0,"28230F7D-6FAF-49B9-9ED5-254D2E2B8123":!0,"A3A1C843-30CE-4828-984C-AD44EAF2A245":!0,"68C27B9C-4FB4-4CEC-A664-3FC3C2E8A12A":!0,"3AD7646D-02C7-4E2A-B3AB-2044A88171E9":!0},t._latencyLogKey="MC_TD_NL",t._delayLoadTimeout=60,t._maxRetries=5,t._retryTimeout=10,t._alphaTransformCoefficient=1.5,t._outlineWidthDelta=1,t._xHeightRatio=1.15385,t._capHeightRatio=.93752,t._webkitFontFillLightnessFactor=.85,t._defaultPoiBackground={hitTest:1,records:[{vectorType:2,centerX:0,centerY:0,radiusX:10,radiusY:10,scale:1,style:{lineWidth:1,fillStylePaletteKey:"Point.FillColor",strokeStylePaletteKey:"Point.StrokeColor"}}]},t._selectedPoiBackground={hitTest:1,hotspotX:11,hotspotY:28.5,records:[{vectorType:4,pathData:"M11 0C4.9 0 0 4.9 0 11 0 12.7 0.7 14.5 1.7 16.3 3.3 19.5 5.9 22.9 7.8 25.2 8.7 26.2 9.7 27.4 10.3 28.1 10.7 28.5 11.3 28.5 11.7 28.1 12.3 27.4 13.3 26.2 14.2 25.2 15 24.2 15.9 23.1 16.8 21.9 18.1 20.1 19.3 18.2 20.3 16.3 21.3 14.5 22 12.7 22 11 22 4.9 17.1 0 11 0Z",scale:1,style:{lineWidth:1,fillStylePaletteKey:"Point.FillColor",strokeStylePaletteKey:"Point.StrokeColor"}}]},t._fallbackIcon={hitTest:1,records:[{vectorType:2,centerX:0,centerY:0,radiusX:3,radiusY:3,scale:1,style:{fillStylePaletteKey:"Point.IconColor"}}]},t._customStyleProperties=["fontColor","outlineColor"],t._venueMapsIconSizes={minZoom:14,maxZoom:19,14:0,15:7,16:11,17:14,18:18,19:22},t}();y.init();var l=function(){function n(n){this._templateName=n}return n.prototype.dispose=function(){},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t){t(n)})),this._ready},n.prototype.getBrandTemplates=function(){return null},n.prototype.getCategoryIconTemplate=function(n){Microsoft.Maps.setTimeout(function(){n&&n(null,"")},0)},n.prototype.getCityPolygonTemplates=function(){return null},n.prototype.getLandmarkVectorImageTemplate=function(t,i){var r=n._landmarkTemplates[i];return r?[r]:[]},n.prototype.getMarkupStyle=function(){var t=y.isDarkTheme(this._templateName)?n._darkThemeStyle:n._lightThemeStyle;return{styleStatic:t.styleStatic,styleDynamic:i._copyObject(t.styleDynamic)}},n.prototype.getMarkupRecord=function(){var t=y.isDarkTheme(this._templateName)?n._darkThemeStyle:n._lightThemeStyle;return{styleStatic:t.styleStatic,styleDynamic:i._copyObject(t.styleDynamic)}},n.prototype.getName=function(){return this._templateName},n.prototype.getPoiVectorImageTemplate=function(t,i,r){var u=n.poiTemplates[r];return u?[u]:[]},n.prototype.getSDKLandmarkImageTemplates=function(){return null},n.prototype.getRoutePoiVectorImageTemplate=function(t,i){var r;return r=t==="turn"?n.directionsTurnTemplate:n.poiTemplates[i],r?[r]:[]},n.prototype.prefetchShields=function(){return new Promise(function(n){n()})},n.prototype.prefetchImages=function(){return new Promise(function(n){n()})},n.prototype.prefetchOrganizationImagesByOrgId=function(){return new Promise(function(n){n()})},n.prototype.getFetchedShields=function(t,i,r){var u,f,e;if(i&&r&&r.length){for(u=[],f=0,e=r.length;f<e;f++)u.push(n.DefaultShieldTemplate);return u}return null},n.prototype.getShieldsAsync=function(n,t,i,r){var u=this;Microsoft.Maps.setTimeout(function(){r&&r(u.getFetchedShields(n,t,i))},0)},n.prototype.getTemplates=function(){return null},n.prototype.setProcessDrawOrder=function(){},n._lightThemeStyle={styleStatic:{backgroundColor:"rgba(236,234,227,0.7)"},styleDynamic:{visible:!0,font:"SegoeBing",fontSize:10,fontColor:"#000"}},n._darkThemeStyle={styleStatic:{backgroundColor:"rgba(64,64,64,0.7)"},styleDynamic:{visible:!0,font:"SegoeBing",fontSize:10,fontColor:"#fff"}},n._landmarkTemplates=[null,null,new r({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:12,radiusY:12},{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:12,radiusY:12},{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.7)",strokeStyle:"rgba(0,0,0,0.7)",lineWidth:1},centerX:0,centerY:0,radiusX:6,radiusY:6}],hitTest:1})],n.poiTemplates=[null,null,new r({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:10}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(192,192,192,0.4)",strokeStyle:"rgba(64,64,64,0.4)",lineWidth:2},centerX:0,centerY:0,radiusX:16,radiusY:16},{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:10}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#000",lineWidth:2},centerX:0,centerY:0,radiusX:14,radiusY:14},{vectorType:2,style:{fillStyle:"#000"},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:1},centerX:0,centerY:0,radiusX:8,radiusY:8}],hitTest:1}),new r({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:2},centerX:0,centerY:0,radiusX:10,radiusY:10},{vectorType:2,style:{fillStyle:"rgba(0,0,0,0.5)"},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),],n.directionsTurnTemplate=new r({records:[{vectorType:2,style:{fillStyle:"rgba(255,255,255,0.5)",strokeStyle:"rgba(0,0,0,0.5)",lineWidth:1},centerX:0,centerY:0,radiusX:4,radiusY:4}],hitTest:1}),n.DefaultShieldTemplate=new r({records:[{vectorType:2,style:{fillStyle:"#fff",strokeStyle:"#666",lineWidth:1},centerX:0,centerY:0,radiusX:10,radiusY:8},{vectorType:3,style:{fillStyle:"#000",font:"SegoeBing",fontSize:7,fontStyle:1,horizontalAutoScaling:1},anchor:{x:0,y:0},maxWidth:18,text:"{MapDisplay}"}]}),n}(),fi=function(){function n(n,t,i,r,u,f,e){this._coreConfig=n;this._basemapSelector=new y(n,t,i,r,u,f,e);this._selector=this._basemapSelector}return n.prototype.dispose=function(){this._basemapSelector&&this._basemapSelector!==this._selector&&this._basemapSelector.dispose();this._selector&&(this._selector.dispose(),this._selector=null);this._basemapSelector=null;this._ready=null;window.clearTimeout(this._delayLoadTimerId)},n.prototype.selectorReady=function(){var n=this;return this._ready||(this._ready=new Promise(function(t){n._selector.selectorReady().then(function(n){t(n)},function(){if(n._coreConfig&&n._coreConfig.useFallbackStyles){n._selector=new l(n._selector.getName());n._basemapSelector&&n._basemapSelector.ready&&n._basemapSelector.ready.addOne(function(){n._selector=n._basemapSelector});t(n);var i={feature:"",action:et.Error,data:"BaseMapTemplateSelector failed to load, FallbackTemplateSelector loaded"};u.logger&&u.logger.logCriticalError(null,i)}})})),this._ready},n.prototype.getBrandTemplates=function(n,t,i,r){return this._selector&&this._selector.getBrandTemplates(n,t,i,r)},n.prototype.getCategoryIconTemplate=function(n,t,i,r,u){this._selector&&this._selector.getCategoryIconTemplate(n,t,i,r,u)},n.prototype.getCityPolygonTemplates=function(n,t,i,r,u){return this._selector&&this._selector.getCityPolygonTemplates(n,t,i,r,u)},n.prototype.getLandmarkVectorImageTemplate=function(n,t,i,r){return this._selector&&this._selector.getLandmarkVectorImageTemplate(n,t,i,r)},n.prototype.getMarkupStyle=function(n,t,i,r){return this._selector&&this._selector.getMarkupStyle(n,t,i,r)},n.prototype.getMarkupRecord=function(n,t,i,r){return this._selector&&this._selector.getMarkupRecord(n,t,i,r)},n.prototype.getName=function(){return this._selector&&this._selector.getName()},n.prototype.getPoiVectorImageTemplate=function(n,t,i,r,u,f,e,o){return this._selector&&this._selector.getPoiVectorImageTemplate(n,t,i,r,u,f,e,o)},n.prototype.getSDKLandmarkImageTemplates=function(n,t,i){return this._selector&&this._selector.getSDKLandmarkImageTemplates(n,t,i)},n.prototype.getRoutePoiVectorImageTemplate=function(n,t,i){return this._selector&&this._selector.getRoutePoiVectorImageTemplate(n,t,i)},n.prototype.prefetchShields=function(n){return this._selector&&this._selector.prefetchShields(n)},n.prototype.prefetchImages=function(n,t,i,r){return this._selector&&this._selector.prefetchImages(n,t,i,r)},n.prototype.prefetchOrganizationImagesByOrgId=function(n,t){return t===void 0&&(t=3),this._selector&&this._selector.prefetchOrganizationImagesByOrgId(n,t)},n.prototype.getFetchedShields=function(n,t,i){return this._selector&&this._selector.getFetchedShields(n,t,i)},n.prototype.getShieldsAsync=function(n,t,i,r){this._selector&&this._selector.getShieldsAsync(n,t,i,r)},n.prototype.getTemplates=function(n,t){return this._selector&&this._selector.getTemplates(n,t)},n.prototype.setProcessDrawOrder=function(n){this._selector&&this._selector.setProcessDrawOrder(n)},n}(),it=function(){function t(){}return t.getClickable=function(n){var t=n;return!!(t&&t.clickable)},t.getDisplayName=function(n){var i="",t=n;return t.getPrimaryLabelText?i=t.getPrimaryLabelText():t.name?i=t.name:t.getName?i=t.getName():t.title?i=t.title:t.getTitle&&(i=t.getTitle()),i},t.getSecondaryDisplayName=function(n){var i="",t=n;return t.getSecondaryLabelText?i=t.getSecondaryLabelText():t.subtitle?i=t.subtitle:t.getSubtitle&&(i=t.getSubtitle()),i},t.getIconText=function(n){var i="",t=n;return t.getIconText?i=t.getIconText():t.iconText&&(i=t.iconText),i},t.getLabelImportance=function(n){var t=n;return t&&t.labelImportance||0},t.getShieldNames=function(n){var t=n;return t&&t.shieldName},t.getShieldIndices=function(n){var t=n;return t&&t.shieldIndex},t._getShieldAttributeValue=function(n){var t=n&&n.split(":");return t&&t.length>1?t[1].replace(/^["\s]+|["\s]+$/g,""):""},t.getShieldDisplayData=function(i){var r=i.split(","),u="",f="";return n.assertNotNull(r,"shield attributes"),n.assert(r.length===4,"all four shield attributes should be present"),r&&r.length===4&&(u=t._getShieldAttributeValue(r[0]),f=t._getShieldAttributeValue(r[3])),{text:u,modifier:f}},t.getYpid=function(n){var t=n;return t&&(t.ypid||t.businesslistingid)},t.getTransitJson=function(n){var t=n;return t&&t.tj},t.isTransitEntity=function(n){var t=n;return t&&t.representsTransitStop},t.isLandmarkEntity=function(n){var t=n;return t&&t.isLandmark},t}(),vt=function(){function n(n){this._maxValue=16384;this.id="SpatialGrid"+n.quadKey;this._matrixCache=new s(1024);this.bounds=[0,this._maxValue,this._maxValue,0];var t=1<<n.lod,i=1<<(n.lod>0?n.lod-1:0);this._west=n.x/t*360-180;this._east=(n.x+1)/t*360-180;this._north=90-n.y/i*180;this._south=90-(n.y+1)/i*180;this._x1=o.instance.projectToX(this._north,this._west);this._width=(o.instance.projectToX(this._south,this._east)-this._x1)/this._maxValue;this._y1=o.instance.projectToY(this._north,this._west);this._height=(o.instance.projectToY(this._south,this._east)-this._y1)/this._maxValue;this._mercatorToGridCrsMatrix=null}return n.prototype.getMatrix=function(n){var i=n.id,t=this._matrixCache.getItem(i);return t||(t=this._getMatrixInternal(n),this._matrixCache.addItem(i,t)),t},n.prototype._getMatrixInternal=function(n){var i=new ni(this._width,0,0,this._height,this._x1,this._y1),t;return n===o.instance?i:(t=n.getMatrix&&n.getMatrix(o.instance),t)?t.invert().multiply(i):null},n.prototype._getMercatorToGridCrsMatrix=function(){return this._mercatorToGridCrsMatrix||(this._mercatorToGridCrsMatrix=this._getMatrixInternal(o.instance).invert()),this._mercatorToGridCrsMatrix},n.prototype.projectToX=function(n,t){return this._project(n,t,!0)},n.prototype.projectToY=function(n,t){return this._project(n,t,!1)},n.prototype._project=function(n,t,i){var r=o.instance.projectToX(n,t),u=o.instance.projectToY(n,t),f=this._getMercatorToGridCrsMatrix();switch(i){case!0:return f.projectX(r,u);case!1:return f.projectY(r,u)}},n.prototype.toLatitude=function(n,t){var i=this._x1+this._width*n,r=this._y1+this._height*t;return o.instance.toLatitude(i,r)},n.prototype.toLongitude=function(n,t){var i=this._x1+this._width*n,r=this._y1+this._height*t;return o.instance.toLongitude(i,r)},n}(),k=function(){function t(n){var r=0,u=0,t,i;if(n===0)t=0;else{for(var e=n,o=2147483648,f=31;f&&!(e&o);)f--,o/=2;t=(f+1)/2}for(i=0;i<t;i++)r<<=1,r|=n>>(t-i-1)*2&1,i>0&&(u<<=1,u|=n>>(t-i-1)*2+1&1);for(var e=n&2147483647>>32-2*t,s="0",h=t;h--;)s+="0123".charAt(e>>h*2&3);this.quadKey=s;this.x=r;this.y=u;this.lod=t;this.crs=new vt(this);this.bounds=[0,16384,16384,0]}return t.fromLocation=function(n,i){if(i===0)return new t(1);if(i===1)return new t(n.longitude>0?3:2);var r=2<<i-2,u=Math.floor((n.longitude+180)*2*r/360),f=Math.floor((90-n.latitude)*r/180);return u=Math.min(u,r*2-1),f=Math.min(f,r-1),t.fromGridXY(u,f,i)},t.fromGridXY=function(i,r,u){var f=0,e;if(n.assertNotNull(i,"gridX"),n.assertNotNull(r,"gridY"),n.assertNotNull(u,"lod"),u===0)f=1;else{for(f=0,e=0;e<u;e++)f<<=1,f|=r>>u-e-1&1,f<<=1,f|=i>>u-e-1&1;f|=1<<u*2-1}return new t(f)},t}(),yt=function(){function n(){}return n.prototype.getRegionsInBounds=function(t,i){var r=n._getGridLod(i);return n._getRegionsInternal(t,r)},n.prototype.getRegions=function(t,i){var r=n._getGridLod(i);return n._getRegionsInternal(t,r)},n._getGridLod=function(t){var u=Math.round(t*100)/100,i,f,r;if(u<=0)throw"Scale value cannot be less than or equal to 0";for(i=0,f=n._scaleToGridLod.length;i<f;i++)if(r=n._scaleToGridLod[i],u<=r.scale)return r.lod},n._getLodFromGroundResolution=function(n,t){var i=Math.cos(t*c.radiansPerDegree)*ti.earthCircumference,r=i/n/256;return c.log2(r)},n._getRegionsInternal=function(n,t){for(var i,r,f=[],e=n.splitByInternationalDateLine(),u=0;u<e.length;u++){var o=e[u],s=k.fromLocation(o.getNorthwest(),t),h=k.fromLocation(o.getSoutheast(),t);for(i=s.x;i<=h.x;i++)for(r=s.y;r<=h.y;r++)f.push(k.fromGridXY(i,r,t))}return f},n._scaleToGridLod=[{scale:9.55,lod:14},{scale:38.22,lod:12},{scale:152.87,lod:10},{scale:611.5,lod:8},{scale:2445.98,lod:6},{scale:4891.97,lod:5},{scale:9783.94,lod:3},{scale:Number.POSITIVE_INFINITY,lod:2}],n}(),ei=function(){function n(){}return n}(),ki=function(){function n(){}return n}(),oi=function(){function t(n,t,i){this._guid=n;this._items={};this._fixedStringList=t;this._fixedStringMap=i}return t._clone=function(n,t){var i;switch(n.type){case 0:i={keyId:t,type:n.type,stringId:n.stringId};break;case 1:i={keyId:t,type:n.type,value:n.value,ignoreTransform:n.ignoreTransform};break;case 3:i={keyId:t,type:n.type,value:n.value};break;case 2:i={keyId:t,type:n.type,value:n.value,ignoreTransform:n.ignoreTransform}}return i&&(i.additionalAttributes=n.additionalAttributes),i},t.prototype._addItem=function(n){this._items[n.keyId]=n},t.prototype.getStackedColorPaletteValue=function(n,t,i){var u=NaN,r=this._getStackedPaletteItem(n,t,i);return r&&r.type===1&&(u=r.value),u},t.prototype.getStackedSinglePaletteItem=function(n,t){var r=null,i=this._getStackedPaletteItem(n,t,!0);return i&&i.type===2&&(r=i),r},t.prototype.getStackedStringPaletteValue=function(n,t){var r,i=this._getStackedPaletteItem(n,t,!0);return i&&i.type===0&&(r=this._fixedStringList[i.stringId]),r},t.prototype.getStackedEnumPaletteValue=function(n,t){var r,i=this._getStackedPaletteItem(n,t,!0);return i&&i.type===4&&(r=i.value),r},t.prototype._getStackedPaletteItem=function(n,t,i){var o=null,r,s,f,e;if(!n||!t)return null;for(r=0,s=n.length;r<s;r++){var h=n[r]+"."+t,c=this._getFixedStringId(h),u=this._items[c];if(u)if(f=u.additionalAttributes,e=f&&f.propertyReferenceId,e)i&&(t=this._fixedStringList[e]);else{o=u;break}}return o},t.prototype.getColorPaletteValue=function(t,i){var u=NaN,r;return t=t||0,r=this._items[t],r?(!i||r.hasValue)&&(u=r.value):n.assert(!0,"color key missing "+t),u},t.prototype.getSinglePaletteValue=function(t,i){var u=1,r;return t=t||0,r=this._items[t],r?(!i||r.hasValue)&&(u=r.value):n.assert(!0,"number key missing "+t),u},t.prototype.getBooleanPaletteValue=function(t){var r=!1,i;return t=t||0,i=this._items[t],i?r=i.value:n.assert(!0,"boolean key missing "+t),r},t.prototype.getStringPaletteValue=function(t){var r="",i;return t=t||0,i=this._items[t],i?r=this._fixedStringList[i.stringId]:n.assert(!0,"string key missing "+t),r},t.prototype._getFixedStringId=function(n){var t=this._fixedStringMap[n];return typeof t!="number"&&(t=-1),t},t.prototype.populate=function(i,r,u){var a={},o,e,y,c,l,f;if(i.nodeType){for(o=i.nodeType.properties,e={name:i.nodeType.name,parent:i.nodeType.parent,properties:i.nodeType.properties};e.parent&&e.parent.properties;)o=o.concat(e.parent.properties),e=e.parent;for(f=0;f<o.length;f++){var s=o[f].propertyName,v=i.name+"."+s,h=r[v];h?(this._addItem(h),h.hasValue=!0,a[s]=h):(y=u&&u[s],y?(c=this._getFixedStringId(v),c>=0?(l=t._clone(y,c),l.hasValue=!1,this._addItem(l),a[s]=l):n.assert(!0,"KeyId not in FixedStrings "+c)):n.assert(!0,"Palette key should be present "+v))}}if(i.children)for(f=0;f<i.children.length;f++)this.populate(i.children[f],r,a)},t.prototype.addItem=function(n,t){var i=this._getFixedStringId(n),r;i===-1&&(this._fixedStringList.push(n),i=this._fixedStringList.length-1);r={keyId:i,type:4,hasValue:!0,value:t};this._addItem(r)},t}();t._BaseMapDataSource=w;t._BaseMapStreetsideDataSource=ui;t._EntityHelper=it;t._BaseMapTemplateSelector=y;t._BaseMapTemplateSelectorProxy=fi;t._GridId=k;t._GridCrs=vt;t._GridSpatialIndex=yt;t._LandmarkEntity=ei;t._LandmarksDataSource=at;t._LayerDataSource=b}catch(pt){if(u.logger)u.logger.logCriticalError(pt);else throw pt;}}).call(window)